!function(){"use strict";var e={251:function(e,t,r){var n=r(196),s=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var n,a={},c=null,u=null;for(n in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)i.call(t,n)&&!l.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===a[n]&&(a[n]=t[n]);return{$$typeof:s,type:e,key:c,ref:u,props:a,_owner:o.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},893:function(e,t,r){e.exports=r(251)},196:function(e){e.exports=window.React}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e=r(893),t=window.wp.components,n=window.wp.editPost,s=window.wp.i18n,a=window.wp.plugins,i=function(){return(0,e.jsxs)(t.SVG,{height:24,viewBox:"0 0 60 65",width:24,xmlns:"http://www.w3.org/2000/svg",children:[(0,e.jsx)(t.Path,{fill:"#5ba745",d:"M23.72,51.53c0-.18,0-.34-.06-.52a13.11,13.11,0,0,0-2.1-5.53A14.74,14.74,0,0,0,19.12,43c-.27-.21-.5-.11-.51.22l-.24,3.42c0,.33-.38.35-.49,0l-1.5-4.8a1.4,1.4,0,0,0-.77-.78,23.91,23.91,0,0,0-3.1-.84c-1.38-.24-3.39-.39-3.39-.39-.34,0-.45.21-.25.49l2.06,3.76c.2.27,0,.54-.29.33l-4.51-3.6a3.68,3.68,0,0,0-2.86-.48c-1,.16-2.44.46-2.44.46a.68.68,0,0,0-.39.25.73.73,0,0,0-.14.45S.41,43,.54,44a3.63,3.63,0,0,0,1.25,2.62L6.48,50c.28.2.09.49-.23.37l-4.18-.94c-.32-.12-.5,0-.4.37,0,0,.69,1.89,1.31,3.16a24,24,0,0,0,1.66,2.74,1.34,1.34,0,0,0,1,.52l5,.13c.33,0,.41.38.1.48L7.51,58c-.31.1-.34.35-.07.55a14.29,14.29,0,0,0,3.05,1.66,13.09,13.09,0,0,0,5.9.5,25.13,25.13,0,0,0,4.34-1,9.55,9.55,0,0,1-.08-1.2,9.32,9.32,0,0,1,3.07-6.91"}),(0,e.jsx)(t.Path,{fill:"#5ba745",d:"M59.7,41.53a.73.73,0,0,0-.14-.45.68.68,0,0,0-.39-.25s-1.43-.3-2.44-.46a3.64,3.64,0,0,0-2.86.48l-4.51,3.6c-.26.21-.49-.06-.29-.33l2.06-3.76c.2-.28.09-.49-.25-.49,0,0-2,.15-3.39.39a23.91,23.91,0,0,0-3.1.84,1.4,1.4,0,0,0-.77.78l-1.5,4.8c-.11.32-.48.3-.49,0l-.24-3.42c0-.33-.24-.43-.51-.22a14.74,14.74,0,0,0-2.44,2.47A13.11,13.11,0,0,0,36.34,51c0,.18,0,.34-.06.52a9.26,9.26,0,0,1,3,8.1,24.1,24.1,0,0,0,4.34,1,13.09,13.09,0,0,0,5.9-.5,14.29,14.29,0,0,0,3.05-1.66c.27-.2.24-.45-.07-.55l-3.22-1.17c-.31-.1-.23-.47.1-.48l5-.13a1.38,1.38,0,0,0,1-.52A24.6,24.6,0,0,0,57,52.92c.61-1.27,1.31-3.16,1.31-3.16.1-.33-.08-.49-.4-.37l-4.18.94c-.32.12-.51-.17-.23-.37l4.69-3.34A3.63,3.63,0,0,0,59.46,44c.13-1,.24-2.47.24-2.47"}),(0,e.jsx)(t.Path,{fill:"#5ba745",d:"M46.5,25.61c0-.53-.35-.72-.8-.43l-4.86,2.66c-.45.28-.56-.27-.23-.69l4.66-6.23a2,2,0,0,0,.28-1.68,36.51,36.51,0,0,0-2.19-4.89,34,34,0,0,0-2.81-3.94c-.33-.41-.74-.35-.91.16l-2.28,5.68c-.16.5-.6.48-.59-.05l.28-8.93a2.54,2.54,0,0,0-.66-1.64S35,4.27,33.88,3.27,30.78.69,30.78.69a1.29,1.29,0,0,0-1.54,0s-1.88,1.49-3.12,2.59-2.48,2.35-2.48,2.35A2.5,2.5,0,0,0,23,7.27l.27,8.93c0,.53-.41.55-.58.05l-2.29-5.69c-.17-.5-.57-.56-.91-.14a35.77,35.77,0,0,0-3,4.2,35.55,35.55,0,0,0-2,4.62,2,2,0,0,0,.27,1.67l4.67,6.24c.33.42.23,1-.22.69l-4.87-2.66c-.45-.29-.82-.1-.82.43a18.6,18.6,0,0,0,.83,5.07,20.16,20.16,0,0,0,5.37,7.77c3.19,3,5.93,7.8,7.45,11.08A9.6,9.6,0,0,1,30,49.09a9.31,9.31,0,0,1,2.86.45c1.52-3.28,4.26-8.11,7.44-11.09a20.46,20.46,0,0,0,5.09-7,19,19,0,0,0,1.11-5.82"}),(0,e.jsx)(t.Path,{fill:"#5ba745",d:"M36.12,58.44A6.12,6.12,0,1,1,30,52.32a6.11,6.11,0,0,1,6.12,6.12"})]})},o=function(t){void 0===t&&(t=null);var r="";(null==t?void 0:t.children)&&(r=t.children);var n="content-helper-error-message";return(null==t?void 0:t.className)&&(n+=" "+t.className),(0,e.jsx)("div",{className:n,"data-testid":null==t?void 0:t.testId,dangerouslySetInnerHTML:{__html:r}})},l=function(t){return void 0===t&&(t=null),(0,e.jsx)(o,{className:null==t?void 0:t.className,testId:"empty-credentials-message",children:window.wpParselyEmptyCredentialsMessage})},c=function(t,r){var n=t.children;return void 0===r&&(r=null),window.wpParselyEmptyCredentialsMessage?l(r):(0,e.jsx)(e.Fragment,{children:n})},u=window.wp.element,p={month:"short",day:"numeric",year:"numeric"},d={month:"short",day:"numeric"},h=(0,s.__)("Date N/A","wp-parsely");function f(e){return!isNaN(+e)&&0!==e.getTime()}function y(e){if(!1===f(e))return h;var t=p;return e.getUTCFullYear()===(new Date).getUTCFullYear()&&(t=d),Intl.DateTimeFormat(document.documentElement.lang||"en",t).format(e)}function w(e){return{period_start:"".concat(e,"d"),period_end:""}}function v(e,t,r){void 0===t&&(t=1),void 0===r&&(r="");var n=parseInt(e.replace(/\D/g,""),10);if(n<1e3)return e;n<1e4&&(t=1);var s=n,a=n.toString(),i="",o=0;return Object.entries({1e3:"k","1,000,000":"M","1,000,000,000":"B","1,000,000,000,000":"T","1,000,000,000,000,000":"Q"}).forEach((function(e){var r=e[0],l=e[1],c=parseInt(r.replace(/\D/g,""),10);if(n>=c){var u=t;(s=n/c)%1>1/o&&(u=s>10?1:2),u=parseFloat(s.toFixed(2))===parseFloat(s.toFixed(0))?0:u,a=s.toFixed(u),i=l}o=c})),a+r+i}var m,_,g=window.wp.apiFetch,b=r.n(g),x=window.wp.data,j=window.wp.url,P=(m=function(e,t){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},m(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function __(){this.constructor=e}m(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)});!function(e){e.CannotFormulateApiQuery="ch_cannot_formulate_api_query",e.FetchError="fetch_error",e.HttpRequestFailed="http_request_failed",e[e.ParselyApiForbidden=403]="ParselyApiForbidden",e.ParselyApiResponseContainsError="ch_response_contains_error",e.ParselyApiReturnedNoData="ch_parsely_api_returned_no_data",e.ParselyApiReturnedTooManyResults="ch_parsely_api_returned_too_many_results",e.PluginCredentialsNotSetMessageDetected="parsely_credentials_not_set_message_detected",e.PluginSettingsApiSecretNotSet="parsely_api_secret_not_set",e.PluginSettingsSiteIdNotSet="parsely_site_id_not_set",e.PostIsNotPublished="ch_post_not_published"}(_||(_={}));var S=function(t){function r(e,n,a){void 0===a&&(a=(0,s.__)("Error: ","wp-parsely"));var i=t.call(this,a+e)||this;i.hint=null,i.name=i.constructor.name,i.code=n;var o=[_.ParselyApiForbidden,_.ParselyApiResponseContainsError,_.ParselyApiReturnedNoData,_.ParselyApiReturnedTooManyResults,_.PluginCredentialsNotSetMessageDetected,_.PluginSettingsApiSecretNotSet,_.PluginSettingsSiteIdNotSet,_.PostIsNotPublished];return i.retryFetch=!o.includes(i.code),Object.setPrototypeOf(i,r.prototype),i}return P(r,t),r.prototype.Message=function(t){return void 0===t&&(t=null),[_.PluginCredentialsNotSetMessageDetected,_.PluginSettingsSiteIdNotSet,_.PluginSettingsApiSecretNotSet].includes(this.code)?l(t):(this.code===_.FetchError&&(this.hint=this.Hint((0,s.__)("This error can sometimes be caused by ad-blockers or browser tracking protections. Please add this site to any applicable allow lists and try again.","wp-parsely"))),this.code===_.ParselyApiForbidden&&(this.hint=this.Hint((0,s.__)("Please ensure that the Site ID and API Secret given in the plugin's settings are correct.","wp-parsely"))),this.code===_.HttpRequestFailed&&(this.hint=this.Hint((0,s.__)("The Parse.ly API cannot be reached. Please verify that you are online.","wp-parsely"))),(0,e.jsx)(o,{className:null==t?void 0:t.className,testId:"error",children:"<p>".concat(this.message,"</p>").concat(this.hint?this.hint:"")}))},r.prototype.Hint=function(e){return'<p className="content-helper-error-message-hint" data-testid="content-helper-error-message-hint"><strong>'.concat((0,s.__)("Hint:","wp-parsely"),"</strong> ").concat(e,"</p>")},r}(Error),N=function(){return N=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},N.apply(this,arguments)},A=function(e,t,r,n){return new(r||(r=Promise))((function(s,a){function i(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}l((n=n.apply(e,t||[])).next())}))},C=function(e,t){var r,n,s,a,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,o[0]&&(i=0)),i;)try{if(r=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((s=(s=i.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},E=7,R=function(){function e(){this.itmSource="wp-parsely-content-helper",this.apiPeriodRange=w(E)}return e.prototype.getPerformanceDetails=function(){return A(this,void 0,void 0,(function(){var e,t,r,n,a;return C(this,(function(i){switch(i.label){case 0:if(!1===(e=(0,x.select)("core/editor")).isCurrentPostPublished())return[2,Promise.reject(new S((0,s.__)("This post is not published, so its details are unavailable.","wp-parsely"),_.PostIsNotPublished,""))];t=e.getPermalink(),i.label=1;case 1:return i.trys.push([1,4,,5]),[4,this.fetchPerformanceDataFromWpEndpoint(t)];case 2:return r=i.sent(),[4,this.fetchReferrerDataFromWpEndpoint(t,r.views)];case 3:return n=i.sent(),[3,5];case 4:return a=i.sent(),[2,Promise.reject(a)];case 5:return[2,N(N({},r),{referrers:n})]}}))}))},e.prototype.fetchPerformanceDataFromWpEndpoint=function(e){return A(this,void 0,void 0,(function(){var t,r;return C(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,b()({path:(0,j.addQueryArgs)("/wp-parsely/v1/stats/post/detail",N(N({url:e},this.apiPeriodRange),{itm_source:this.itmSource}))})];case 1:return t=n.sent(),[3,3];case 2:return r=n.sent(),[2,Promise.reject(new S(r.message,r.code))];case 3:return(null==t?void 0:t.error)?[2,Promise.reject(new S(t.error.message,_.ParselyApiResponseContainsError))]:0===t.data.length?[2,Promise.reject(new S((0,s.sprintf)(/* translators: URL of the published post */
(0,s.__)("The post %s has 0 views, or the Parse.ly API returned no data.","wp-parsely"),e),_.ParselyApiReturnedNoData,""))]:t.data.length>1?[2,Promise.reject(new S((0,s.sprintf)(/* translators: URL of the published post */
(0,s.__)("Multiple results were returned for the post %s by the Parse.ly API.","wp-parsely"),e),_.ParselyApiReturnedTooManyResults))]:[2,t.data[0]]}}))}))},e.prototype.fetchReferrerDataFromWpEndpoint=function(e,t){return A(this,void 0,void 0,(function(){var r,n;return C(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,b()({path:(0,j.addQueryArgs)("/wp-parsely/v1/referrers/post/detail",N(N({url:e,total_views:t},this.apiPeriodRange),{itm_source:this.itmSource}))})];case 1:return r=s.sent(),[3,3];case 2:return n=s.sent(),[2,Promise.reject(new S(n.message,n.code))];case 3:return(null==r?void 0:r.error)?[2,Promise.reject(new S(r.error.message,_.ParselyApiResponseContainsError))]:[2,r.data]}}))}))},e}(),T=function(){return T=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},T.apply(this,arguments)},O=function(e,t,r,n){return new(r||(r=Promise))((function(s,a){function i(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}l((n=n.apply(e,t||[])).next())}))},k=function(e,t){var r,n,s,a,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,o[0]&&(i=0)),i;)try{if(r=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((s=(s=i.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}};function D(){var r=this,n=(0,u.useState)(!0),s=n[0],a=n[1],i=(0,u.useState)(),o=i[0],l=i[1],c=(0,u.useState)(),p=c[0],d=c[1];return(0,u.useEffect)((function(){var e=new R,t=function(n){return O(r,void 0,void 0,(function(){var r=this;return k(this,(function(s){return e.getPerformanceDetails().then((function(e){d(e),a(!1)})).catch((function(e){return O(r,void 0,void 0,(function(){return k(this,(function(r){switch(r.label){case 0:return n>0&&e.retryFetch?[4,new Promise((function(e){return setTimeout(e,500)}))]:[3,3];case 1:return r.sent(),[4,t(n-1)];case 2:return r.sent(),[3,4];case 3:l(e),a(!1),r.label=4;case 4:return[2]}}))}))})),[2]}))}))};a(!0),t(1)}),[]),o?o.Message():s?(0,e.jsx)("div",{className:"parsely-spinner-wrapper","data-testid":"parsely-spinner-wrapper",children:(0,e.jsx)(t.Spinner,{})}):(0,e.jsx)(F,{data:p})}function F(t){return(0,e.jsxs)("div",{className:"performance-details-panel",children:[(0,e.jsx)(I,{}),(0,e.jsx)(M,T({},t)),(0,e.jsx)(V,T({},t)),(0,e.jsx)(L,T({},t)),(0,e.jsx)(H,T({},t))]})}function I(){var t,r=y(new Date((t=E,function(e,t){if(!1===Number.isInteger(t))return(0,s.__)("days parameter must be an integer","wp-parsely");if(!1===f(e))return h;var r=new Date(e);return r.setDate(r.getDate()-t),function(e){return!1===f(e)?h:e.toISOString().substring(0,10)}(r)}(new Date,t-1)+"T00:00")));return(0,e.jsxs)("div",{className:"section period",children:[/* translators: Number of days for which data is being shown */
(0,s.sprintf)((0,s.__)("Last %d Days","wp-parsely"),E),(0,e.jsx)("span",{children:/* translators: Period starting date in short format */
(0,s.sprintf)((0,s.__)(" (%s - Today)","wp-parsely"),r)})]})}function M(t){var r=t.data;return(0,e.jsx)("div",{className:"section general-performance",children:(0,e.jsxs)("table",{children:[(0,e.jsx)("tbody",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:v(r.views)}),(0,e.jsx)("td",{children:v(r.visitors)}),(0,e.jsx)("td",{children:r.avgEngaged})]})}),(0,e.jsx)("tfoot",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,s.__)("Page Views","wp-parsely")}),(0,e.jsx)("th",{children:(0,s.__)("Visitors","wp-parsely")}),(0,e.jsx)("th",{children:(0,s.__)("Avg. Time","wp-parsely")})]})})]})})}function V(t){var r=t.data;delete r.referrers.types.totals;var n=function(e){switch(e){case"social":return(0,s.__)("Social","wp-parsely");case"search":return(0,s.__)("Search","wp-parsely");case"other":return(0,s.__)("Other","wp-parsely");case"internal":return(0,s.__)("Internal","wp-parsely");case"direct":return(0,s.__)("Direct","wp-parsely")}return e};return(0,e.jsxs)("div",{className:"section referrer-types",children:[(0,e.jsx)("div",{className:"section-title",children:(0,s.__)("Referrers (Page Views)","wp-parsely")}),(0,e.jsx)("div",{className:"multi-percentage-bar",children:Object.entries(r.referrers.types).map((function(t){var r=t[0],a=t[1],i=(0,s.sprintf)(/* translators: 1: Referrer type, 2: Percentage value, %%: Escaped percent sign */
(0,s.__)("%1$s: %2$s%%","wp-parsely"),n(r),a.viewsPercentage);return(0,e.jsx)("div",{"aria-label":i,className:"bar-fill "+r,style:{width:a.viewsPercentage+"%"}},r)}))}),(0,e.jsxs)("table",{children:[(0,e.jsx)("thead",{children:(0,e.jsx)("tr",{children:Object.keys(r.referrers.types).map((function(t){return(0,e.jsx)("th",{children:n(t)},t)}))})}),(0,e.jsx)("tbody",{children:(0,e.jsx)("tr",{children:Object.entries(r.referrers.types).map((function(t){var r=t[0],n=t[1];return(0,e.jsx)("td",{children:v(n.views)},r)}))})})]})]})}function L(t){var r=t.data,n=0;return(0,e.jsxs)("div",{className:"section top-referrers",children:[(0,e.jsxs)("table",{children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{scope:"col",children:(0,s.__)("Top Referrers","wp-parsely")}),(0,e.jsx)("th",{colSpan:2,scope:"colgroup",children:(0,s.__)("Page Views","wp-parsely")})]})}),(0,e.jsx)("tbody",{children:Object.entries(r.referrers.top).map((function(t){var r=t[0],a=t[1];if("totals"===r)return n=Number(a.viewsPercentage),null;var i=r;"direct"===r&&(i=(0,s.__)("Direct","wp-parsely"))
/* translators: %s: Percentage value, %%: Escaped percent sign */;var o=(0,s.sprintf)((0,s.__)("%s%%","wp-parsely"),a.viewsPercentage);return(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{scope:"row",children:i}),(0,e.jsx)("td",{children:(0,e.jsx)("div",{"aria-label":o,className:"percentage-bar",style:{"--bar-fill":a.viewsPercentage+"%"}})}),(0,e.jsx)("td",{children:v(a.views)})]},r)}))})]}),(0,e.jsxs)("div",{children:[" ",/* translators: %s: Percentage value, %%: Escaped percent sign */
(0,s.sprintf)((0,s._n)("%s%% of views came from top referrers.","%s%% of views came from top referrers.",n,"wp-parsely"),n)]})]})}function H(r){var n=r.data,a=(0,e.jsxs)("span",{className:"screen-reader-text",children:[" ",(0,s.__)("(opens in new tab)","wp-parsely")]});return(0,e.jsxs)("div",{className:"section actions",children:[(0,e.jsxs)(t.Button,{href:n.url,rel:"noopener",target:"_blank",variant:"secondary",children:[(0,s.__)("Visit Post","wp-parsely"),a]}),(0,e.jsxs)(t.Button,{href:n.dashUrl,rel:"noopener",target:"_blank",variant:"primary",children:[(0,s.__)("View in Parse.ly","wp-parsely"),a]})]})}var B=function(){return(0,e.jsx)(t.SVG,{"aria-hidden":"true",version:"1.1",viewBox:"0 0 15 15",width:"15",height:"15",xmlns:"http://www.w3.org/2000/svg",children:(0,e.jsx)(t.Path,{d:"M0 14.0025V11.0025L7.5 3.5025L10.5 6.5025L3 14.0025H0ZM12 5.0025L13.56 3.4425C14.15 2.8525 14.15 1.9025 13.56 1.3225L12.68 0.4425C12.09 -0.1475 11.14 -0.1475 10.56 0.4425L9 2.0025L12 5.0025Z"})})},q=function(){return(0,e.jsxs)(t.SVG,{"aria-hidden":"true",version:"1.1",viewBox:"0 0 16 16",width:"16",height:"16",xmlns:"http://www.w3.org/2000/svg",children:[(0,e.jsx)(t.Path,{d:"M0 3.29592C0 2.73237 0.456853 2.27551 1.02041 2.27551H4.08165C4.50432 2.27551 4.84696 2.61815 4.84696 3.04082C4.84696 3.46349 4.50432 3.80613 4.08165 3.80613H1.53062V11.9694H9.69391V9.6735C9.69391 9.25083 10.0366 8.90819 10.4592 8.90819C10.8819 8.90819 11.2245 9.25083 11.2245 9.6735V12.4796C11.2245 13.0432 10.7677 13.5 10.2041 13.5H1.02041C0.456854 13.5 0 13.0432 0 12.4796V3.29592Z"}),(0,e.jsx)(t.Path,{d:"M12.531 1.22415C12.8299 1.52303 12.8299 2.00759 12.531 2.30646L6.15342 8.68404C5.85455 8.98291 5.36998 8.98291 5.07111 8.68404C4.77224 8.38517 4.77224 7.9006 5.07111 7.60173L11.4487 1.22415C11.7476 0.925282 12.2321 0.925282 12.531 1.22415Z"}),(0,e.jsx)(t.Path,{d:"M6.63268 1.51012C6.63268 1.08745 6.97532 0.744812 7.39799 0.744812H12.2449C12.6676 0.744812 13.0103 1.08745 13.0103 1.51012V6.35708C13.0103 6.77975 12.6676 7.12239 12.2449 7.12239C11.8223 7.12239 11.4796 6.77975 11.4796 6.35708V2.27543H7.39799C6.97532 2.27543 6.63268 1.93279 6.63268 1.51012Z"})]})},$=function(){return(0,e.jsx)(t.SVG,{"aria-hidden":"true",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 42 42",children:(0,e.jsx)(t.Path,{d:"M15.3,20.1c0,3.1,2.6,5.7,5.7,5.7s5.7-2.6,5.7-5.7s-2.6-5.7-5.7-5.7S15.3,17,15.3,20.1z M23.4,32.4\n\t\t\tC30.1,30.9,40.5,22,40.5,22s-7.7-12-18-13.3c-0.6-0.1-2.6-0.1-3-0.1c-10,1-18,13.7-18,13.7s8.7,8.6,17,9.9\n\t\t\tC19.4,32.6,22.4,32.6,23.4,32.4z M11.1,20.7c0-5.2,4.4-9.4,9.9-9.4s9.9,4.2,9.9,9.4S26.5,30,21,30S11.1,25.8,11.1,20.7z"})})};function G(t){var r,n=t.post;return(0,e.jsxs)("li",{className:"parsely-top-post","data-testid":"parsely-top-post",children:[(0,e.jsxs)("div",{className:"parsely-top-post-title",children:[(0,e.jsx)("a",{className:"parsely-top-post-stats-link",href:n.dashUrl,target:"_blank",rel:"noreferrer",title:(0,s.__)("View in Parse.ly (opens new tab)","wp-parsely"),children:n.title}),(0,e.jsx)("a",{className:"parsely-top-post-view-link",href:n.url,target:"_blank",rel:"noreferrer",title:(0,s.__)("View Post (opens new tab)","wp-parsely"),children:(0,e.jsx)(q,{})}),0!==n.postId&&(0,e.jsx)("a",{className:"parsely-top-post-edit-link",href:(r=n.postId,"/wp-admin/post.php?post=".concat(r,"&action=edit")),target:"_blank",rel:"noreferrer",title:(0,s.__)("Edit Post (opens new tab)","wp-parsely"),children:(0,e.jsx)(B,{})})]}),(0,e.jsxs)("p",{className:"parsely-top-post-info",children:[(0,e.jsxs)("span",{className:"parsely-top-post-date",children:[(0,e.jsx)("span",{className:"screen-reader-text",children:"Date "}),y(new Date(n.date))]}),(0,e.jsxs)("span",{className:"parsely-top-post-author",children:[(0,e.jsx)("span",{className:"screen-reader-text",children:"Author "}),n.author]}),(0,e.jsxs)("span",{className:"parsely-top-post-views",children:[(0,e.jsx)("span",{className:"screen-reader-text",children:"Number of Views "}),(0,e.jsx)($,{}),n.views]})]})]})}var Q=function(){return Q=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},Q.apply(this,arguments)},W=function(e,t,r,n){return new(r||(r=Promise))((function(s,a){function i(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}l((n=n.apply(e,t||[])).next())}))},U=function(e,t){var r,n,s,a,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,o[0]&&(i=0)),i;)try{if(r=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((s=(s=i.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},Z=function(){function e(){}return e.getRelatedTopPosts=function(){return W(this,void 0,void 0,(function(){var e,t,r,n,a,i,o,l,c,u,p;return U(this,(function(d){switch(d.label){case 0:e=(0,x.select)("core/editor"),t=e.getCurrentPost(),r=(0,x.select)("core").getEntityRecord("root","user",t.author),n=e.getEditedPostAttribute("categories"),a=(0,x.select)("core").getEntityRecord("taxonomy","category",null==n?void 0:n[0]),i=e.getEditedPostAttribute("tags"),o=(0,x.select)("core").getEntityRecord("taxonomy","post_tag",null==i?void 0:i[0]);try{l=this.buildRelatedTopPostsApiQuery(r,a,o)}catch(e){return[2,Promise.reject(e)]}d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this.fetchRelatedTopPostsFromWpEndpoint(l)];case 2:return c=d.sent(),[3,4];case 3:return u=d.sent(),[2,Promise.reject(u)];case 4:return p=(0,s.sprintf)((0,s.__)("Top posts %1$s in last %2$d days.","wp-parsely"),l.message,7),0===c.length&&(p="".concat((0,s.__)("The Parse.ly API did not return any results for related top posts","wp-parsely")," ").concat(l.message,".")),[2,{message:p,posts:c}]}}))}))},e.fetchRelatedTopPostsFromWpEndpoint=function(e){var t;return W(this,void 0,void 0,(function(){var r,n;return U(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,b()({path:(0,j.addQueryArgs)("/wp-parsely/v1/stats/posts",Q(Q({},e.query),{itm_source:"wp-parsely-content-helper"}))})];case 1:return r=s.sent(),[3,3];case 2:return n=s.sent(),[2,Promise.reject(new S(n.message,n.code))];case 3:return(null==r?void 0:r.error)?[2,Promise.reject(new S(r.error.message,_.ParselyApiResponseContainsError))]:[2,null!==(t=null==r?void 0:r.data)&&void 0!==t?t:[]]}}))}))},e.buildRelatedTopPostsApiQuery=function(e,t,r){var n=Q({},w(7));if(null==r?void 0:r.name)return{query:Q({limit:5,tag:r.name},n),
/* translators: %s: message such as "with tag Foo" */
message:(0,s.sprintf)((0,s.__)('with tag "%1$s"',"wp-parsely"),r.name)};if(null==t?void 0:t.name)return{query:Q({limit:5,section:t.name},n),
/* translators: %s: message such as "in category Foo" */
message:(0,s.sprintf)((0,s.__)('in category "%1$s"',"wp-parsely"),t.name)};if(null==e?void 0:e.name)return{query:Q({limit:5,author:e.name},n),
/* translators: %s: message such as "by author John" */
message:(0,s.sprintf)((0,s.__)('by author "%1$s"',"wp-parsely"),e.name)};throw new S((0,s.__)("Cannot formulate query because the post's Tag, Category and Author are empty.","wp-parsely"),_.CannotFormulateApiQuery)},e}(),z=function(e,t,r,n){return new(r||(r=Promise))((function(s,a){function i(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}l((n=n.apply(e,t||[])).next())}))},Y=function(e,t){var r,n,s,a,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,o[0]&&(i=0)),i;)try{if(r=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((s=(s=i.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}};function J(){var r=this,n=(0,u.useState)(!0),s=n[0],a=n[1],i=(0,u.useState)(),o=i[0],l=i[1],c=(0,u.useState)(),p=c[0],d=c[1],h=(0,u.useState)([]),f=h[0],y=h[1];if((0,u.useEffect)((function(){var e=function(t){return z(r,void 0,void 0,(function(){var r=this;return Y(this,(function(n){return Z.getRelatedTopPosts().then((function(e){y(e.posts),d(e.message),a(!1)})).catch((function(n){return z(r,void 0,void 0,(function(){return Y(this,(function(r){switch(r.label){case 0:return t>0&&n.retryFetch?[4,new Promise((function(e){return setTimeout(e,500)}))]:[3,3];case 1:return r.sent(),[4,e(t-1)];case 2:return r.sent(),[3,4];case 3:a(!1),l(n),r.label=4;case 4:return[2]}}))}))})),[2]}))}))};return a(!0),e(1),function(){a(!1),y([]),d(""),l(void 0)}}),[]),o)return o.Message({className:"parsely-top-posts-descr"});var w=(0,e.jsx)("ol",{className:"parsely-top-posts",children:f.map((function(t){return(0,e.jsx)(G,{post:t},t.id)}))});return s?(0,e.jsx)("div",{className:"parsely-spinner-wrapper","data-testid":"parsely-spinner-wrapper",children:(0,e.jsx)(t.Spinner,{})}):(0,e.jsxs)("div",{className:"parsely-top-posts-wrapper",children:[(0,e.jsx)("p",{className:"parsely-top-posts-descr","data-testid":"parsely-top-posts-descr",children:p}),w]})}(0,a.registerPlugin)("wp-parsely-block-editor-sidebar",{icon:i,render:function(){return(0,e.jsxs)(n.PluginSidebar,{icon:(0,e.jsx)(i,{}),name:"wp-parsely-content-helper",className:"wp-parsely-content-helper",title:(0,s.__)("Parse.ly Editor Sidebar","wp-parsely"),children:[(0,e.jsx)(t.Panel,{children:(0,e.jsx)(t.PanelBody,{title:(0,s.__)("Performance Details","wp-parsely"),initialOpen:!0,children:(0,e.jsx)(c,{children:(0,e.jsx)(D,{})})})}),(0,e.jsx)(t.Panel,{children:(0,e.jsx)(t.PanelBody,{title:(0,s.__)("Related Top Posts","wp-parsely"),initialOpen:!1,children:(0,e.jsx)(c,{children:(0,e.jsx)(J,{})})})})]})}})}()}();
(function(a){a(function(){var b,d;(function(){var f=[],e,g;d={start:function(h){var i=a.Deferred();h=h||0;c.loading.show();setTimeout(function(){i.resolve()},h);return i.promise()},stop:function(){if(e){e.reject()}e=null;f=[];c.loading.hide()},until:function(){e=e||a.Deferred().always(b.load.stop);var j=Array.prototype.slice.call(arguments),h=typeof arguments[0]==="number"?j.shift():0,i=f.push(false)-1;j.push(b.load.start(h));a.when.apply(a,j).always(function(){f[i]=true;if(-1===a.inArray(false,f)){e.resolve()}});return e.promise()}}}());b={p:function(e){return a("#cws-wp-help-"+e)},load:d,bindH2Updates:function(){c.menu=a("#adminmenu a.current .wp-menu-name");if(!c.menu.length){c.menu=a("#adminmenu a.current")}c.menu.text(c.h2.edit.input.val());c.h2.edit.input.bind("keyup",function(){c.menu.text(a(this).val())})},sortable:function(){a(this).sortable({opacity:0.8,placeholder:"cws-wp-help-placeholder",axis:"y",cursor:"move",cursorAt:{left:0,top:0},distance:10,delay:50,handle:".sort-handle",items:"> li.cws-wp-help-local, > div#cws-wp-help-remote-docs-block",start:function(h,g){var f=a(g.item),j=a(".cws-wp-help-placeholder"),i;if(f.attr("id")==="cws-wp-help-remote-docs-block"){i=4}else{i=-2}j.height(f.height()+i)},update:function(h,g){var f=a.post(ajaxurl,{action:"cws_wp_help_reorder",_ajax_nonce:c.ul.data("nonce"),order:a(this).sortable("toArray")});b.load.until(200,f)}});a(this).find("> li:not(.cws-wp-help-is-slurped) > ul > li:nth-child(2)").parent("ul").each(b.sortable)},sortableInit:function(){c.ul.find("> #cws-wp-help-remote-docs-block > li").unwrap();c.ul.find("> li.cws-wp-help-is-slurped:first").before('<div id="cws-wp-help-remote-docs-block"></div>');c.ul.find("> li.cws-wp-help-is-slurped").detach().appendTo("#cws-wp-help-remote-docs-block");c.ulSortable.each(b.sortable)},init:function(){if(a.browser.mozilla){c.h2.edit.input.css("top","-3px").css("margin-bottom","1px");c.h3.edit.input.css("margin-top","2px").css("margin-bottom","2.25px")}b.sortableInit();c.ul.find("li.page_item").each(function(){a(this).attr("id","page-"+a(this).attr("class").match(/page-item-([0-9]+)/)[1])});c.apiURL.click(function(){this.select()});c.saveButton.click(function(){b.saveSettings()});c.cancelLink.click(function(f){f.preventDefault();b.restoreSettings();b.hideSettings()});c.settingsButton.click(function(f){f.preventDefault();b.revealSettings(true)});c.h2.display.text.dblclick(function(){b.revealSettings();c.h2.edit.input.focus().select()});c.h3.display.text.dblclick(function(){b.revealSettings();c.h3.edit.input.focus().select()});c.returnMonitor.bind("keydown",function(f){if(13==f.which){a(this).blur();b.saveSettings()}});b.bindH2Updates();c.menuLocation.change(function(){var f=String(window.location);if(c.menuLocation.val().indexOf("submenu")==-1){f=f.replace("/index.php","/admin.php")}else{f=f.replace("/admin.php","/index.php")}var g=String(f)+"&wp-help-preview-menu-location="+c.menuLocation.val();var e=String(f).replace(/\/wp-admin\/.*$/,"/wp-admin/js/common.js");a("#adminmenu").load(g+" #adminmenu",function(){if(window.history.replaceState){window.history.replaceState(null,null,f)}a.getScript(e);b.bindH2Updates()})})},fadeOutIn:function(f,e){f.fadeOut(150,function(){e.fadeIn(150)})},hideShow:function(f,e){f.hide();e.show()},revealSettings:function(e){a([c.h2,c.h3]).each(function(){b.hideShow(this.display.wrap,this.edit.wrap)});c.actions.fadeTo(200,0.3);c.ul.fadeTo(200,0.3);b.fadeOutIn(c.doc,c.settings);if(e){(function(f){f.focus().select()})(c.h2.edit.input)}},restoreSettings:function(){a("input, select",c.settings).each(function(){var e=a(this);if(e.data("original-value")){e.val(e.data("original-value")).change()}})},saveSettings:function(){b.clearError();a([c.h2,c.h3]).each(function(){this.display.text.text(this.edit.input.val())});var e=a.post(ajaxurl,{action:"cws_wp_help_settings",_ajax_nonce:a("#_cws_wp_help_nonce").val(),h2:c.h2.edit.input.val(),h3:c.h3.edit.input.val(),menu_location:c.menuLocation.val(),slurp_url:c.slurp.val()},function(f){f=a.parseJSON(f);c.slurp.val(f.slurp_url);if(f.error){b.error(f.error);c.slurp.focus()}else{b.hideSettings()}if(f.topics){b.p("nodocs").remove();c.ul.html(f.topics);b.sortableInit()}});b.load.until(200,e)},hideSettings:function(){a([c.h2,c.h3]).each(function(){b.hideShow(this.edit.wrap,this.display.wrap)});c.actions.fadeTo(200,1);c.ul.fadeTo(200,1);b.fadeOutIn(c.settings,c.doc)},clearError:function(){c.slurpError.html("").hide()},error:function(e){c.slurpError.html("<p>"+e+"</p>").fadeIn(150)}};var c={h2:{edit:{input:b.p("h2-label"),wrap:b.p("h2-label-wrap")},display:{text:a(".wrap h2:first"),wrap:a(".wrap h2:first")}},h3:{edit:{input:b.p("listing-label"),wrap:b.p("listing-labels")},display:{text:b.p("listing h3"),wrap:b.p("listing h3")}},settingsButton:b.p("settings-on"),menu:function(){return a("#adminmenu a.current")},doc:b.p("document"),ul:b.p("listing-wrap > ul"),ulSortable:b.p("listing-wrap > ul.can-sort"),actions:b.p("actions"),settings:b.p("settings"),listing:b.p("listing"),apiURL:b.p("api-url"),slurp:b.p("slurp-url"),slurpError:b.p("slurp-error"),saveButton:b.p("settings-save"),cancelLink:b.p("settings-cancel"),menuLocation:b.p("menu-location"),loading:b.p("loading"),returnMonitor:a('.wrap input[type="text"]')};b.init()})}(jQuery));
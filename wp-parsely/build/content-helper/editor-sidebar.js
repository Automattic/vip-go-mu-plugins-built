!function(){"use strict";var e={251:function(e,t,r){var n=r(196),s=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var n,a={},c=null,u=null;for(n in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)i.call(t,n)&&!l.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===a[n]&&(a[n]=t[n]);return{$$typeof:s,type:e,key:c,ref:u,props:a,_owner:o.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},893:function(e,t,r){e.exports=r(251)},196:function(e){e.exports=window.React}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e,t,n,s=r(893),a=window.wp.components,i=window.wp.coreData,o=window.wp.data,l=window.wp.editPost,c=window.wp.editor,u=window.wp.element,p=window.wp.i18n,d=window.wp.plugins,h=function(){return(0,s.jsxs)(a.SVG,{height:24,viewBox:"0 0 60 65",width:24,xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)(a.Path,{fill:"#5ba745",d:"M23.72,51.53c0-.18,0-.34-.06-.52a13.11,13.11,0,0,0-2.1-5.53A14.74,14.74,0,0,0,19.12,43c-.27-.21-.5-.11-.51.22l-.24,3.42c0,.33-.38.35-.49,0l-1.5-4.8a1.4,1.4,0,0,0-.77-.78,23.91,23.91,0,0,0-3.1-.84c-1.38-.24-3.39-.39-3.39-.39-.34,0-.45.21-.25.49l2.06,3.76c.2.27,0,.54-.29.33l-4.51-3.6a3.68,3.68,0,0,0-2.86-.48c-1,.16-2.44.46-2.44.46a.68.68,0,0,0-.39.25.73.73,0,0,0-.14.45S.41,43,.54,44a3.63,3.63,0,0,0,1.25,2.62L6.48,50c.28.2.09.49-.23.37l-4.18-.94c-.32-.12-.5,0-.4.37,0,0,.69,1.89,1.31,3.16a24,24,0,0,0,1.66,2.74,1.34,1.34,0,0,0,1,.52l5,.13c.33,0,.41.38.1.48L7.51,58c-.31.1-.34.35-.07.55a14.29,14.29,0,0,0,3.05,1.66,13.09,13.09,0,0,0,5.9.5,25.13,25.13,0,0,0,4.34-1,9.55,9.55,0,0,1-.08-1.2,9.32,9.32,0,0,1,3.07-6.91"}),(0,s.jsx)(a.Path,{fill:"#5ba745",d:"M59.7,41.53a.73.73,0,0,0-.14-.45.68.68,0,0,0-.39-.25s-1.43-.3-2.44-.46a3.64,3.64,0,0,0-2.86.48l-4.51,3.6c-.26.21-.49-.06-.29-.33l2.06-3.76c.2-.28.09-.49-.25-.49,0,0-2,.15-3.39.39a23.91,23.91,0,0,0-3.1.84,1.4,1.4,0,0,0-.77.78l-1.5,4.8c-.11.32-.48.3-.49,0l-.24-3.42c0-.33-.24-.43-.51-.22a14.74,14.74,0,0,0-2.44,2.47A13.11,13.11,0,0,0,36.34,51c0,.18,0,.34-.06.52a9.26,9.26,0,0,1,3,8.1,24.1,24.1,0,0,0,4.34,1,13.09,13.09,0,0,0,5.9-.5,14.29,14.29,0,0,0,3.05-1.66c.27-.2.24-.45-.07-.55l-3.22-1.17c-.31-.1-.23-.47.1-.48l5-.13a1.38,1.38,0,0,0,1-.52A24.6,24.6,0,0,0,57,52.92c.61-1.27,1.31-3.16,1.31-3.16.1-.33-.08-.49-.4-.37l-4.18.94c-.32.12-.51-.17-.23-.37l4.69-3.34A3.63,3.63,0,0,0,59.46,44c.13-1,.24-2.47.24-2.47"}),(0,s.jsx)(a.Path,{fill:"#5ba745",d:"M46.5,25.61c0-.53-.35-.72-.8-.43l-4.86,2.66c-.45.28-.56-.27-.23-.69l4.66-6.23a2,2,0,0,0,.28-1.68,36.51,36.51,0,0,0-2.19-4.89,34,34,0,0,0-2.81-3.94c-.33-.41-.74-.35-.91.16l-2.28,5.68c-.16.5-.6.48-.59-.05l.28-8.93a2.54,2.54,0,0,0-.66-1.64S35,4.27,33.88,3.27,30.78.69,30.78.69a1.29,1.29,0,0,0-1.54,0s-1.88,1.49-3.12,2.59-2.48,2.35-2.48,2.35A2.5,2.5,0,0,0,23,7.27l.27,8.93c0,.53-.41.55-.58.05l-2.29-5.69c-.17-.5-.57-.56-.91-.14a35.77,35.77,0,0,0-3,4.2,35.55,35.55,0,0,0-2,4.62,2,2,0,0,0,.27,1.67l4.67,6.24c.33.42.23,1-.22.69l-4.87-2.66c-.45-.29-.82-.1-.82.43a18.6,18.6,0,0,0,.83,5.07,20.16,20.16,0,0,0,5.37,7.77c3.19,3,5.93,7.8,7.45,11.08A9.6,9.6,0,0,1,30,49.09a9.31,9.31,0,0,1,2.86.45c1.52-3.28,4.26-8.11,7.44-11.09a20.46,20.46,0,0,0,5.09-7,19,19,0,0,0,1.11-5.82"}),(0,s.jsx)(a.Path,{fill:"#5ba745",d:"M36.12,58.44A6.12,6.12,0,1,1,30,52.32a6.11,6.11,0,0,1,6.12,6.12"})]})};!function(e){e.Minutes10="10m",e.Hour="1h",e.Hours2="2h",e.Hours4="4h",e.Hours24="24h",e.Days7="7d",e.Days30="30d"}(e||(e={})),function(e){e.Views="views",e.AvgEngaged="avg_engaged"}(t||(t={})),function(e){e.Author="author",e.Section="section",e.Tag="tag",e.Unavailable="unavailable"}(n||(n={}));var f=function(e,t){return Object.values(t).includes(e)};function y(e,t){void 0===t&&(t=!1);var r=parseInt(e,10),n=e.charAt(e.length-1),s=(0,p.__)("Unknown Period","wp-parsely");switch(n){case"m":s=(0,p.sprintf)(/* translators: 1: Number of minutes */(0,p._n)("Last Minute","Last %1$d Minutes",r,"wp-parsely"),r);break;case"h":s=(0,p.sprintf)(/* translators: 1: Number of hours */(0,p._n)("Last Hour","Last %1$d Hours",r,"wp-parsely"),r);break;case"d":s=(0,p.sprintf)(/* translators: 1: Number of days */(0,p._n)("Last Day","Last %1$d Days",r,"wp-parsely"),r)}return t?s.toLocaleLowerCase():s}function w(e){switch(e){case t.Views:return(0,p.__)("Page Views","wp-parsely");case t.AvgEngaged:return(0,p.__)("Avg. Time","wp-parsely");default:return(0,p.__)("Unknown Metric","wp-parsely")}}var v=function(e){void 0===e&&(e=null);var t="";(null==e?void 0:e.children)&&(t=e.children);var r="content-helper-error-message";return(null==e?void 0:e.className)&&(r+=" "+e.className),(0,s.jsx)("div",{className:r,"data-testid":null==e?void 0:e.testId,dangerouslySetInnerHTML:{__html:t}})},g=function(e){return void 0===e&&(e=null),(0,s.jsx)(v,{className:null==e?void 0:e.className,testId:"empty-credentials-message",children:window.wpParselyEmptyCredentialsMessage})},m=function(){return m=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},m.apply(this,arguments)},_=function(e,t){var r=e.children;return void 0===t&&(t=null),window.wpParselyEmptyCredentialsMessage?(0,s.jsx)(g,m({},t)):(0,s.jsx)(s.Fragment,{children:r})};function x(e,t,r){void 0===t&&(t=1),void 0===r&&(r="");var n=parseInt(e.replace(/\D/g,""),10);if(n<1e3)return e;n<1e4&&(t=1);var s=n,a=n.toString(),i="",o=0;return Object.entries({1e3:"k","1,000,000":"M","1,000,000,000":"B","1,000,000,000,000":"T","1,000,000,000,000,000":"Q"}).forEach((function(e){var r=e[0],l=e[1],c=parseInt(r.replace(/\D/g,""),10);if(n>=c){var u=t;(s=n/c)%1>1/o&&(u=s>10?1:2),u=parseFloat(s.toFixed(2))===parseFloat(s.toFixed(0))?0:u,a=s.toFixed(u),i=l}o=c})),a+r+i}var b,j,P=window.wp.apiFetch,S=r.n(P),N=window.wp.url,C=(b=function(e,t){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},b(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function __(){this.constructor=e}b(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)});!function(e){e.CannotFormulateApiQuery="ch_cannot_formulate_api_query",e.FetchError="fetch_error",e.HttpRequestFailed="http_request_failed",e[e.ParselyApiForbidden=403]="ParselyApiForbidden",e.ParselyApiResponseContainsError="ch_response_contains_error",e.ParselyApiReturnedNoData="ch_parsely_api_returned_no_data",e.ParselyApiReturnedTooManyResults="ch_parsely_api_returned_too_many_results",e.PluginCredentialsNotSetMessageDetected="parsely_credentials_not_set_message_detected",e.PluginSettingsApiSecretNotSet="parsely_api_secret_not_set",e.PluginSettingsSiteIdNotSet="parsely_site_id_not_set",e.PostIsNotPublished="ch_post_not_published"}(j||(j={}));var A=function(e){function t(r,n,s){void 0===s&&(s=(0,p.__)("Error: ","wp-parsely"));var a=e.call(this,s+r)||this;a.hint=null,a.name=a.constructor.name,a.code=n;var i=[j.ParselyApiForbidden,j.ParselyApiResponseContainsError,j.ParselyApiReturnedNoData,j.ParselyApiReturnedTooManyResults,j.PluginCredentialsNotSetMessageDetected,j.PluginSettingsApiSecretNotSet,j.PluginSettingsSiteIdNotSet,j.PostIsNotPublished];return a.retryFetch=!i.includes(a.code),Object.setPrototypeOf(a,t.prototype),a}return C(t,e),t.prototype.Message=function(e){return void 0===e&&(e=null),[j.PluginCredentialsNotSetMessageDetected,j.PluginSettingsSiteIdNotSet,j.PluginSettingsApiSecretNotSet].includes(this.code)?g(e):(this.code===j.FetchError&&(this.hint=this.Hint((0,p.__)("This error can sometimes be caused by ad-blockers or browser tracking protections. Please add this site to any applicable allow lists and try again.","wp-parsely"))),this.code===j.ParselyApiForbidden&&(this.hint=this.Hint((0,p.__)("Please ensure that the Site ID and API Secret given in the plugin's settings are correct.","wp-parsely"))),this.code===j.HttpRequestFailed&&(this.hint=this.Hint((0,p.__)("The Parse.ly API cannot be reached. Please verify that you are online.","wp-parsely"))),(0,s.jsx)(v,{className:null==e?void 0:e.className,testId:"error",children:"<p>".concat(this.message,"</p>").concat(this.hint?this.hint:"")}))},t.prototype.Hint=function(e){return'<p className="content-helper-error-message-hint" data-testid="content-helper-error-message-hint"><strong>'.concat((0,p.__)("Hint:","wp-parsely"),"</strong> ").concat(e,"</p>")},t}(Error),T={month:"short",day:"numeric",year:"numeric"},O={month:"short",day:"numeric"},F=(0,p.__)("Date N/A","wp-parsely");function E(e){if(!1===function(e){return!isNaN(+e)&&0!==e.getTime()}(e))return F;var t=T;return e.getUTCFullYear()===(new Date).getUTCFullYear()&&(t=O),Intl.DateTimeFormat(document.documentElement.lang||"en",t).format(e)}function D(e){return{period_start:e,period_end:""}}var k=function(){return k=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},k.apply(this,arguments)},M=function(e,t,r,n){return new(r||(r=Promise))((function(s,a){function i(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}l((n=n.apply(e,t||[])).next())}))},R=function(e,t){var r,n,s,a,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,o[0]&&(i=0)),i;)try{if(r=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((s=(s=i.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},I=function(){function e(){this.itmSource="wp-parsely-content-helper"}return e.prototype.getPerformanceDetails=function(e){return M(this,void 0,void 0,(function(){var t,r,n,s,a;return R(this,(function(i){switch(i.label){case 0:if(!1===(t=(0,o.select)("core/editor")).isCurrentPostPublished())return[2,Promise.reject(new A((0,p.__)("This post is not published, so its details are unavailable.","wp-parsely"),j.PostIsNotPublished,""))];if(null===(r=t.getPermalink()))return[2,Promise.reject(new A((0,p.__)("The post's URL returned null.","wp-parsely"),j.PostIsNotPublished))];i.label=1;case 1:return i.trys.push([1,4,,5]),[4,this.fetchPerformanceDataFromWpEndpoint(e,r)];case 2:return n=i.sent(),[4,this.fetchReferrerDataFromWpEndpoint(e,r,n.views)];case 3:return s=i.sent(),[3,5];case 4:return a=i.sent(),[2,Promise.reject(a)];case 5:return[2,k(k({},n),{referrers:s})]}}))}))},e.prototype.fetchPerformanceDataFromWpEndpoint=function(e,t){return M(this,void 0,void 0,(function(){var r,n;return R(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,S()({path:(0,N.addQueryArgs)("/wp-parsely/v1/stats/post/detail",k(k({},D(e)),{itm_source:this.itmSource,url:t}))})];case 1:return r=s.sent(),[3,3];case 2:return n=s.sent(),[2,Promise.reject(new A(n.message,n.code))];case 3:return(null==r?void 0:r.error)?[2,Promise.reject(new A(r.error.message,j.ParselyApiResponseContainsError))]:0===r.data.length?[2,Promise.reject(new A((0,p.sprintf)(/* translators: URL of the published post */
(0,p.__)("The post %s has 0 views, or the Parse.ly API returned no data.","wp-parsely"),t),j.ParselyApiReturnedNoData,""))]:r.data.length>1?[2,Promise.reject(new A((0,p.sprintf)(/* translators: URL of the published post */
(0,p.__)("Multiple results were returned for the post %s by the Parse.ly API.","wp-parsely"),t),j.ParselyApiReturnedTooManyResults))]:[2,r.data[0]]}}))}))},e.prototype.fetchReferrerDataFromWpEndpoint=function(e,t,r){return M(this,void 0,void 0,(function(){var n,s;return R(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,S()({path:(0,N.addQueryArgs)("/wp-parsely/v1/referrers/post/detail",k(k({},D(e)),{itm_source:this.itmSource,total_views:r,url:t}))})];case 1:return n=a.sent(),[3,3];case 2:return s=a.sent(),[2,Promise.reject(new A(s.message,s.code))];case 3:return(null==n?void 0:n.error)?[2,Promise.reject(new A(n.error.message,j.ParselyApiResponseContainsError))]:[2,n.data]}}))}))},e}(),V=function(){return V=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},V.apply(this,arguments)},L=function(e,t,r,n){return new(r||(r=Promise))((function(s,a){function i(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}l((n=n.apply(e,t||[])).next())}))},H=function(e,t){var r,n,s,a,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,o[0]&&(i=0)),i;)try{if(r=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((s=(s=i.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}};function U(e){var t=this,r=e.period,n=(0,u.useState)(!0),i=n[0],o=n[1],l=(0,u.useState)(),c=l[0],p=l[1],d=(0,u.useState)(),h=d[0],f=d[1];return(0,u.useEffect)((function(){var e=new I,n=function(s){return L(t,void 0,void 0,(function(){var t=this;return H(this,(function(a){return e.getPerformanceDetails(r).then((function(e){f(e),o(!1)})).catch((function(e){return L(t,void 0,void 0,(function(){return H(this,(function(t){switch(t.label){case 0:return s>0&&e.retryFetch?[4,new Promise((function(e){return setTimeout(e,500)}))]:[3,3];case 1:return t.sent(),[4,n(s-1)];case 2:return t.sent(),[3,4];case 3:p(e),o(!1),t.label=4;case 4:return[2]}}))}))})),[2]}))}))};return o(!0),n(1),function(){p(void 0)}}),[r]),c?c.Message():i?(0,s.jsx)("div",{className:"parsely-spinner-wrapper","data-testid":"parsely-spinner-wrapper",children:(0,s.jsx)(a.Spinner,{})}):(0,s.jsx)($,{data:h,period:r})}function $(e){return(0,s.jsxs)("div",{className:"performance-details-panel",children:[(0,s.jsx)("div",{className:"section period",children:y(e.period)}),(0,s.jsx)(B,V({},e)),(0,s.jsx)(q,V({},e)),(0,s.jsx)(G,V({},e)),(0,s.jsx)(Q,V({},e))]})}function B(e){var t=e.data;return(0,s.jsx)("div",{className:"section general-performance",children:(0,s.jsxs)("table",{children:[(0,s.jsx)("tbody",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:x(t.views)}),(0,s.jsx)("td",{children:x(t.visitors)}),(0,s.jsx)("td",{children:t.avgEngaged})]})}),(0,s.jsx)("tfoot",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:(0,p.__)("Page Views","wp-parsely")}),(0,s.jsx)("th",{children:(0,p.__)("Visitors","wp-parsely")}),(0,s.jsx)("th",{children:(0,p.__)("Avg. Time","wp-parsely")})]})})]})})}function q(e){var t=e.data;delete t.referrers.types.totals;var r=function(e){switch(e){case"social":return(0,p.__)("Social","wp-parsely");case"search":return(0,p.__)("Search","wp-parsely");case"other":return(0,p.__)("Other","wp-parsely");case"internal":return(0,p.__)("Internal","wp-parsely");case"direct":return(0,p.__)("Direct","wp-parsely")}return e};return(0,s.jsxs)("div",{className:"section referrer-types",children:[(0,s.jsx)("div",{className:"section-title",children:(0,p.__)("Referrers (Page Views)","wp-parsely")}),(0,s.jsx)("div",{className:"multi-percentage-bar",children:Object.entries(t.referrers.types).map((function(e){var t=e[0],n=e[1],a=(0,p.sprintf)(/* translators: 1: Referrer type, 2: Percentage value, %%: Escaped percent sign */
(0,p.__)("%1$s: %2$s%%","wp-parsely"),r(t),n.viewsPercentage);return(0,s.jsx)("div",{"aria-label":a,className:"bar-fill "+t,style:{width:n.viewsPercentage+"%"}},t)}))}),(0,s.jsxs)("table",{children:[(0,s.jsx)("thead",{children:(0,s.jsx)("tr",{children:Object.keys(t.referrers.types).map((function(e){return(0,s.jsx)("th",{children:r(e)},e)}))})}),(0,s.jsx)("tbody",{children:(0,s.jsx)("tr",{children:Object.entries(t.referrers.types).map((function(e){var t=e[0],r=e[1];return(0,s.jsx)("td",{children:x(r.views)},t)}))})})]})]})}function G(e){var t=e.data,r=0;return(0,s.jsxs)("div",{className:"section top-referrers",children:[(0,s.jsxs)("table",{children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{scope:"col",children:(0,p.__)("Top Referrers","wp-parsely")}),(0,s.jsx)("th",{colSpan:2,scope:"colgroup",children:(0,p.__)("Page Views","wp-parsely")})]})}),(0,s.jsx)("tbody",{children:Object.entries(t.referrers.top).map((function(e){var t=e[0],n=e[1];if("totals"===t)return r=Number(n.viewsPercentage),null;var a=t;"direct"===t&&(a=(0,p.__)("Direct","wp-parsely"))
/* translators: %s: Percentage value, %%: Escaped percent sign */;var i=(0,p.sprintf)((0,p.__)("%s%%","wp-parsely"),n.viewsPercentage);return(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{scope:"row",children:a}),(0,s.jsx)("td",{children:(0,s.jsx)("div",{"aria-label":i,className:"percentage-bar",style:{"--bar-fill":n.viewsPercentage+"%"}})}),(0,s.jsx)("td",{children:x(n.views)})]},t)}))})]}),(0,s.jsxs)("div",{children:[" ",/* translators: %s: Percentage value, %%: Escaped percent sign */
(0,p.sprintf)((0,p._n)("%s%% of views came from top referrers.","%s%% of views came from top referrers.",r,"wp-parsely"),r)]})]})}function Q(e){var t=e.data,r=(0,s.jsxs)("span",{className:"screen-reader-text",children:[" ",(0,p.__)("(opens in new tab)","wp-parsely")]});return(0,s.jsxs)("div",{className:"section actions",children:[(0,s.jsxs)(a.Button,{href:t.url,rel:"noopener",target:"_blank",variant:"secondary",children:[(0,p.__)("Visit Post","wp-parsely"),r]}),(0,s.jsxs)(a.Button,{href:t.dashUrl,rel:"noopener",target:"_blank",variant:"primary",children:[(0,p.__)("View in Parse.ly","wp-parsely"),r]})]})}var W=function(e){var t=e.filter,r=e.label,a=e.onFilterTypeChange,i=e.onFilterValueChange,o=e.postData,l=function(){return o.tags.length>=1&&o.categories.length>=1||o.tags.length>=1&&o.authors.length>=1||o.categories.length>=1&&o.authors.length>=1},c=function(){return n.Tag===t.type&&o.tags.length>1||n.Section===t.type&&o.categories.length>1||n.Author===t.type&&o.authors.length>1},u=c()&&!l();return(0,s.jsxs)(s.Fragment,{children:[l()&&(0,s.jsx)(Z,{filter:t,label:u?void 0:r,onFilterTypeChange:a,postData:o}),c()&&(0,s.jsx)(z,{filter:t,label:u?r:void 0,onFilterValueChange:i,postData:o})]})},Z=function(e){var t=e.filter,r=e.label,i=e.onFilterTypeChange,o=e.postData;return(0,s.jsxs)(a.SelectControl,{label:r,onChange:function(e){return i(e)},value:t.type,children:[o.tags.length>=1&&(0,s.jsx)("option",{value:n.Tag,children:(0,p.__)("Tag","wp-parsely")}),o.categories.length>=1&&(0,s.jsx)("option",{value:n.Section,children:(0,p.__)("Section","wp-parsely")}),o.authors.length>=1&&(0,s.jsx)("option",{value:n.Author,children:(0,p.__)("Author","wp-parsely")})]})},z=function(e){var t=e.filter,r=e.label,i=e.onFilterValueChange,o=e.postData;return(0,s.jsx)(a.ComboboxControl,{label:r,onChange:function(e){return i(e)},options:n.Tag===t.type?o.tags.map((function(e){return{value:e,label:e}})):n.Section===t.type?o.categories.map((function(e){return{value:e,label:e}})):n.Author===t.type?o.authors.map((function(e){return{value:e,label:e}})):[],value:t.value})},Y=function(){return(0,s.jsx)(a.SVG,{"aria-hidden":"true",version:"1.1",viewBox:"0 0 15 15",width:"15",height:"15",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)(a.Path,{d:"M0 14.0025V11.0025L7.5 3.5025L10.5 6.5025L3 14.0025H0ZM12 5.0025L13.56 3.4425C14.15 2.8525 14.15 1.9025 13.56 1.3225L12.68 0.4425C12.09 -0.1475 11.14 -0.1475 10.56 0.4425L9 2.0025L12 5.0025Z"})})},J=function(){return(0,s.jsxs)(a.SVG,{"aria-hidden":"true",version:"1.1",viewBox:"0 0 16 16",width:"16",height:"16",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)(a.Path,{d:"M0 3.29592C0 2.73237 0.456853 2.27551 1.02041 2.27551H4.08165C4.50432 2.27551 4.84696 2.61815 4.84696 3.04082C4.84696 3.46349 4.50432 3.80613 4.08165 3.80613H1.53062V11.9694H9.69391V9.6735C9.69391 9.25083 10.0366 8.90819 10.4592 8.90819C10.8819 8.90819 11.2245 9.25083 11.2245 9.6735V12.4796C11.2245 13.0432 10.7677 13.5 10.2041 13.5H1.02041C0.456854 13.5 0 13.0432 0 12.4796V3.29592Z"}),(0,s.jsx)(a.Path,{d:"M12.531 1.22415C12.8299 1.52303 12.8299 2.00759 12.531 2.30646L6.15342 8.68404C5.85455 8.98291 5.36998 8.98291 5.07111 8.68404C4.77224 8.38517 4.77224 7.9006 5.07111 7.60173L11.4487 1.22415C11.7476 0.925282 12.2321 0.925282 12.531 1.22415Z"}),(0,s.jsx)(a.Path,{d:"M6.63268 1.51012C6.63268 1.08745 6.97532 0.744812 7.39799 0.744812H12.2449C12.6676 0.744812 13.0103 1.08745 13.0103 1.51012V6.35708C13.0103 6.77975 12.6676 7.12239 12.2449 7.12239C11.8223 7.12239 11.4796 6.77975 11.4796 6.35708V2.27543H7.39799C6.97532 2.27543 6.63268 1.93279 6.63268 1.51012Z"})]})},K=function(){return(0,s.jsx)(a.SVG,{"aria-hidden":"true",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 42 42",children:(0,s.jsx)(a.Path,{d:"M15.3,20.1c0,3.1,2.6,5.7,5.7,5.7s5.7-2.6,5.7-5.7s-2.6-5.7-5.7-5.7S15.3,17,15.3,20.1z M23.4,32.4\n\t\t\tC30.1,30.9,40.5,22,40.5,22s-7.7-12-18-13.3c-0.6-0.1-2.6-0.1-3-0.1c-10,1-18,13.7-18,13.7s8.7,8.6,17,9.9\n\t\t\tC19.4,32.6,22.4,32.6,23.4,32.4z M11.1,20.7c0-5.2,4.4-9.4,9.9-9.4s9.9,4.2,9.9,9.4S26.5,30,21,30S11.1,25.8,11.1,20.7z"})})};function X(e){var t=e.metric,r=e.post,n=e.avgEngagedIcon,a=e.viewsIcon;return"views"===t?(0,s.jsxs)("span",{className:"parsely-top-post-metric-data",children:[(0,s.jsx)("span",{className:"screen-reader-text",children:(0,p.__)("Number of Views","wp-parsely")}),a,x(r.views.toString())]}):"avg_engaged"===t?(0,s.jsxs)("span",{className:"parsely-top-post-metric-data",children:[(0,s.jsx)("span",{className:"screen-reader-text",children:(0,p.__)("Average Time","wp-parsely")}),n,r.avgEngaged]}):(0,s.jsx)("span",{className:"parsely-top-post-metric-data",children:(0,p.__)("-","wp-parsely")})}function ee(e){var t,r=e.metric,n=e.post;return(0,s.jsxs)("li",{className:"parsely-top-post","data-testid":"parsely-top-post",children:[(0,s.jsxs)("div",{className:"parsely-top-post-title",children:[(0,s.jsxs)("a",{className:"parsely-top-post-stats-link",href:n.dashUrl,target:"_blank",rel:"noreferrer",children:[(0,s.jsx)("span",{className:"screen-reader-text",children:(0,p.__)("View in Parse.ly (opens new tab)","wp-parsely")}),n.title]}),(0,s.jsxs)("a",{className:"parsely-top-post-view-link",href:n.url,target:"_blank",rel:"noreferrer",children:[(0,s.jsx)("span",{className:"screen-reader-text",children:(0,p.__)("View Post (opens new tab)","wp-parsely")}),(0,s.jsx)(J,{})]}),0!==n.postId&&(0,s.jsxs)("a",{className:"parsely-top-post-edit-link",href:(t=n.postId,"/wp-admin/post.php?post=".concat(t,"&action=edit")),target:"_blank",rel:"noreferrer",children:[(0,s.jsx)("span",{className:"screen-reader-text",children:(0,p.__)("Edit Post (opens new tab)","wp-parsely")}),(0,s.jsx)(Y,{})]})]}),(0,s.jsxs)("p",{className:"parsely-top-post-info",children:[(0,s.jsxs)("span",{className:"parsely-top-post-date",children:[(0,s.jsx)("span",{className:"screen-reader-text",children:(0,p.__)("Date","wp-parsely")}),E(new Date(n.date))]}),(0,s.jsxs)("span",{className:"parsely-top-post-author",children:[(0,s.jsx)("span",{className:"screen-reader-text",children:(0,p.__)("Author","wp-parsely")}),n.author]}),(0,s.jsx)(X,{metric:r,post:n,viewsIcon:(0,s.jsx)(K,{}),avgEngagedIcon:(0,s.jsx)(a.Dashicon,{icon:"clock"})})]})]})}var te=function(){return te=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},te.apply(this,arguments)},re=function(e,t,r,n){return new(r||(r=Promise))((function(s,a){function i(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}l((n=n.apply(e,t||[])).next())}))},ne=function(e,t){var r,n,s,a,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,o[0]&&(i=0)),i;)try{if(r=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((s=(s=i.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},se=function(){function e(){}return e.getRelatedTopPosts=function(e,t,r){return re(this,void 0,void 0,(function(){var n,s,a;return ne(this,(function(i){switch(i.label){case 0:try{n=this.buildRelatedTopPostsApiQuery(e,t,r)}catch(e){return[2,Promise.reject(e)]}i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.fetchRelatedTopPostsFromWpEndpoint(n)];case 2:return s=i.sent(),[3,4];case 3:return a=i.sent(),[2,Promise.reject(a)];case 4:return[2,{message:this.generateMessage(0===s.length,e,n.message),posts:s}]}}))}))},e.generateMessage=function(e,t,r){return e?(0,p.sprintf)(/* translators: 1: message such as "in category Foo" */
(0,p.__)("No top posts %1$s were found for the specified period and metric.","wp-parsely"),r):(0,p.sprintf)(/* translators: 1: message such as "in category Foo", 2: period such as "last 7 days"*/
(0,p.__)("Top posts %1$s in the %2$s.","wp-parsely"),r,y(t,!0))},e.fetchRelatedTopPostsFromWpEndpoint=function(e){var t;return re(this,void 0,void 0,(function(){var r,n;return ne(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,S()({path:(0,N.addQueryArgs)("/wp-parsely/v1/stats/posts",te(te({},e.query),{itm_source:"wp-parsely-content-helper"}))})];case 1:return r=s.sent(),[3,3];case 2:return n=s.sent(),[2,Promise.reject(new A(n.message,n.code))];case 3:return(null==r?void 0:r.error)?[2,Promise.reject(new A(r.error.message,j.ParselyApiResponseContainsError))]:[2,null!==(t=null==r?void 0:r.data)&&void 0!==t?t:[]]}}))}))},e.buildRelatedTopPostsApiQuery=function(e,t,r){var s=te(te({},D(e)),{limit:5,sort:t});if(n.Tag===r.type)return{query:te({tag:r.value},s),
/* translators: %s: message such as "with tag Foo" */
message:(0,p.sprintf)((0,p.__)('with tag "%1$s"',"wp-parsely"),r.value)};if(n.Section===r.type)return{query:te({section:r.value},s),
/* translators: %s: message such as "in category Foo" */
message:(0,p.sprintf)((0,p.__)('in section "%1$s"',"wp-parsely"),r.value)};if(n.Author===r.type)return{query:te({author:r.value},s),
/* translators: %s: message such as "by author John" */
message:(0,p.sprintf)((0,p.__)('by author "%1$s"',"wp-parsely"),r.value)};throw new A((0,p.__)("No valid filter type has been specified.","wp-parsely"),j.CannotFormulateApiQuery)},e}(),ae=function(){return ae=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},ae.apply(this,arguments)},ie=function(e,t,r,n){return new(r||(r=Promise))((function(s,a){function i(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}l((n=n.apply(e,t||[])).next())}))},oe=function(e,t){var r,n,s,a,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,o[0]&&(i=0)),i;)try{if(r=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((s=(s=i.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}};function le(e){var t=this,r=e.period,i=e.metric,o=e.postData,l=(0,u.useState)(!0),c=l[0],d=l[1],h=(0,u.useState)(),y=h[0],w=h[1],v=(0,u.useState)(),g=v[0],m=v[1],_=(0,u.useState)([]),x=_[0],b=_[1],j=(0,u.useState)({type:n.Unavailable,value:""}),P=j[0],S=j[1];(0,u.useEffect)((function(){var e,s,a=function(e){return ie(t,void 0,void 0,(function(){var t=this;return oe(this,(function(n){return se.getRelatedTopPosts(r,i,P).then((function(e){b(e.posts),m(e.message),d(!1)})).catch((function(r){return ie(t,void 0,void 0,(function(){return oe(this,(function(t){switch(t.label){case 0:return e>0&&r.retryFetch?[4,new Promise((function(e){return setTimeout(e,500)}))]:[3,3];case 1:return t.sent(),[4,a(e-1)];case 2:return t.sent(),[3,4];case 3:d(!1),w(r),t.label=4;case 4:return[2]}}))}))})),[2]}))}))};return d(!0),n.Unavailable===P.type?S((e="",s=n.Unavailable,o.tags.length>=1?(s=n.Tag,e=o.tags[0]):o.categories.length>=1?(s=n.Section,e=o.categories[0]):(s=n.Author,e=o.authors[0]),{type:s,value:e})):a(1),function(){d(!1),b([]),m(""),w(void 0)}}),[r,i,P,o]);var N=(0,s.jsx)("div",{className:"parsely-spinner-wrapper","data-testid":"parsely-spinner-wrapper",children:(0,s.jsx)(a.Spinner,{})}),C=(0,s.jsx)(W,{filter:P,label:(0,p.__)("Filter by","wp-parsely"),onFilterTypeChange:function(e){if(f(e,n)){var t=e;n.Tag===t&&S({type:t,value:o.tags[0]}),n.Section===t&&S({type:t,value:o.categories[0]}),n.Author===t&&S({type:t,value:o.authors[0]})}},onFilterValueChange:function(e){"string"==typeof e&&S(ae(ae({},P),{value:e}))},postData:o});return y?(0,s.jsxs)(s.Fragment,{children:[C,y.Message({className:"parsely-top-posts-descr"})]}):(0,s.jsxs)(s.Fragment,{children:[C,c?N:(0,s.jsxs)("div",{className:"parsely-top-posts-wrapper",children:[(0,s.jsx)("p",{className:"parsely-top-posts-descr","data-testid":"parsely-top-posts-descr",children:g}),(0,s.jsx)("ol",{className:"parsely-top-posts",children:x.map((function(e){return(0,s.jsx)(ee,{metric:i,post:e},e.id)}))})]})]})}(0,d.registerPlugin)("wp-parsely-block-editor-sidebar",{icon:h,render:function(){var r=(0,u.useState)(e.Days7),n=r[0],d=r[1],v=(0,u.useState)(t.Views),g=v[0],m=v[1],x=(0,u.useState)({authors:[],categories:[],tags:[]}),b=x[0],j=x[1],P=(0,o.useSelect)((function(e){var t=e(c.store).getEditedPostAttribute,r=e(i.store).getEntityRecords;return{authors:r("root","user",{include:t("author")}),categories:r("taxonomy","category",{include:t("categories")}),tags:r("taxonomy","post_tag",{include:t("tags")})}}),[]),S=P.authors,N=P.categories,C=P.tags,A=(0,u.useMemo)((function(){return C?C.map((function(e){return e.name})):[]}),[C]),T=(0,u.useMemo)((function(){return N?N.map((function(e){return e.name})):[]}),[N]),O=(0,u.useMemo)((function(){return S?S.map((function(e){return e.name})):[]}),[S]);return(0,u.useEffect)((function(){j({authors:O,tags:A,categories:T})}),[O,A,T]),(0,s.jsxs)(l.PluginSidebar,{icon:(0,s.jsx)(h,{}),name:"wp-parsely-content-helper",className:"wp-parsely-content-helper",title:(0,p.__)("Parse.ly Editor Sidebar","wp-parsely"),children:[(0,s.jsx)(a.Panel,{children:(0,s.jsx)(a.PanelBody,{title:(0,p.__)("Settings","wp-parsely"),initialOpen:!0,children:(0,s.jsx)((function(){return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.SelectControl,{label:(0,p.__)("Period","wp-parsely"),onChange:function(t){f(t,e)&&d(t)},value:n,children:Object.values(e).map((function(e){return(0,s.jsx)("option",{value:e,children:y(e)},e)}))}),(0,s.jsx)(a.SelectControl,{label:(0,p.__)("Metric","wp-parsely"),onChange:function(e){f(e,t)&&m(e)},value:g,children:Object.values(t).map((function(e){return(0,s.jsx)("option",{value:e,children:w(e)},e)}))})]})}),{})})}),(0,s.jsx)(a.Panel,{children:(0,s.jsx)(a.PanelBody,{title:(0,p.__)("Performance Details","wp-parsely"),initialOpen:!0,children:(0,s.jsx)(_,{children:(0,s.jsx)(U,{period:n})})})}),(0,s.jsx)(a.Panel,{children:(0,s.jsx)(a.PanelBody,{title:(0,p.__)("Related Top Posts","wp-parsely"),initialOpen:!1,children:(0,s.jsx)(_,{children:(0,s.jsx)(le,{period:n,metric:g,postData:b})})})})]})}})}()}();
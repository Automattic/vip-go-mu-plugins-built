window.videoPressUploadPoster=function(e,t){return new Promise((function(o,n){wp.media.ajax("videopress-get-upload-token",{async:!0}).done((function(a){var i={},d={},r=new FormData;i.Authorization='X_UPLOAD_TOKEN token="'+a.upload_token+'" blog_id="'+a.upload_blog_id+'"',d.headers=i,d.method="POST",d.url="https://public-api.wordpress.com/rest/v1.1/videos/"+e+"/poster",d.credentials="omit",Object.keys(t).forEach((e=>{r.append(e,t[e])})),d.body=r,wp.apiFetch(d).then((function(e){o(e)})).catch((function(e){n(e)}))}))}))},window.videoPressGetPoster=function(e){const t=function(t,o){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a="https://public-api.wordpress.com/rest/v1.1/videos/"+e+"/poster";n&&n.length&&(a+="?metadata_token="+n),wp.apiFetch({url:a,method:"GET",credentials:"omit"}).then((function(e){t(e)})).catch((function(e){o(e)}))};return new Promise((function(o,n){wp.ajax.post("videopress-get-playback-jwt",{async:!0,guid:e}).done((function(e){t(o,n,e.jwt)})).fail((()=>{t(o,n)}))}))},window.videoPressUploadTrack=function(e,t,o,n,a){return new Promise((function(i,d){wp.media.ajax("videopress-get-upload-token",{async:!0,data:{filename:a.name}}).done((function(r){var s={},p={},c=new FormData;s.Authorization='X_UPLOAD_TOKEN token="'+r.upload_token+'" blog_id="'+r.upload_blog_id+'"',p.headers=s,p.method="POST",p.url="https://public-api.wordpress.com/rest/v1.1/videos/"+e+"/tracks",p.credentials="omit",c.append("kind",t),c.append("srclang",o),c.append("label",n),c.append("vtt",a),p.body=c,wp.apiFetch(p).then((function(e){i(e)})).catch((function(e){d(e)}))}))}))},window.videoPressDeleteTrack=function(e,t,o){return new Promise((function(n,a){wp.media.ajax("videopress-get-upload-token",{async:!0}).done((function(i){var d={},r={},s=new FormData;d.Authorization='X_UPLOAD_TOKEN token="'+i.upload_token+'" blog_id="'+i.upload_blog_id+'"',r.headers=d,r.method="POST",r.url="https://public-api.wordpress.com/rest/v1.1/videos/"+e+"/tracks/delete",r.credentials="omit",s.append("kind",t),s.append("srclang",o),r.body=s,wp.apiFetch(r).then((function(e){n(e)})).catch((function(e){a(e)}))}))}))},wp.apiFetch.use((function(e,t){var o=e.path,n=e.method,a=e.body;if(!o||-1===o.indexOf("/wp/v2/media"))return t(e);if(!n||"post"!==n.toLowerCase())return t(e);var i=a?a.get("file"):null;if(!i||0!==i.type.indexOf("video/"))return t(e);wp.media.ajax("videopress-get-upload-token",{async:!1,data:{filename:i.name}}).done((function(t){var o=e.headers||{};o.Authorization='X_UPLOAD_TOKEN token="'+t.upload_token+'" blog_id="'+t.upload_blog_id+'"',e.headers=o,delete e.path,e.url=t.upload_action_url,e.credentials="omit",a.set("media[]",i),a.delete("file"),e.body=a}));var d=t(e);return new Promise((function(e,t){d.then((function(e){return e instanceof Response&&e.ok?e.json():e})).then((function(t){var o=lodash.get(t,"media[0]"),n=lodash.get(o,"ID"),a=wp.apiFetch({path:"/wp/v2/media/"+n});e(a)})).catch((function(e){"errors"in e&&"object"==typeof e.errors&&e.errors.length>0&&(e=e.errors.shift()),t(e)}))}))}));
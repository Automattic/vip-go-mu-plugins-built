!function(){"use strict";var e={20:function(e,t,n){var r=n(609),i=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,s={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,r)&&!l.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===s[r]&&(s[r]=t[r]);return{$$typeof:i,type:e,key:c,ref:u,props:s,_owner:a.current}}t.Fragment=s,t.jsx=c,t.jsxs=c},848:function(e,t,n){e.exports=n(20)},609:function(e){e.exports=window.React}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){n.d({},{w:function(){return Or},_:function(){return Ar}});var e,t,r,i,s,o,a,l,c,u,p,d,f=n(848),h=window.wp.components,v=window.wp.data,g=window.wp.domReady,y=n.n(g),m=window.wp.element,w=window.wp.i18n,b=window.wp.primitives,x=(0,f.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,f.jsx)(b.Path,{fillRule:"evenodd",d:"M11.25 5h1.5v15h-1.5V5zM6 10h1.5v10H6V10zm12 4h-1.5v6H18v-6z",clipRule:"evenodd"})}),_=window.wp.plugins;void 0!==window.wp&&(p=null!==(t=null===(e=window.wp.editor)||void 0===e?void 0:e.PluginDocumentSettingPanel)&&void 0!==t?t:null!==(i=null===(r=window.wp.editPost)||void 0===r?void 0:r.PluginDocumentSettingPanel)&&void 0!==i?i:null===(s=window.wp.editSite)||void 0===s?void 0:s.PluginDocumentSettingPanel,d=null!==(a=null===(o=window.wp.editor)||void 0===o?void 0:o.PluginSidebar)&&void 0!==a?a:null!==(c=null===(l=window.wp.editPost)||void 0===l?void 0:l.PluginSidebar)&&void 0!==c?c:null===(u=window.wp.editSite)||void 0===u?void 0:u.PluginSidebar);var k=function(){function e(){this._tkq=[],this.isLoaded=!1,this.isEnabled=!1,"undefined"!=typeof wpParselyTracksTelemetry&&(this.isEnabled=!0,this.loadTrackingLibrary())}return e.getInstance=function(){return window.wpParselyTelemetryInstance||Object.defineProperty(window,"wpParselyTelemetryInstance",{value:new e,writable:!1,configurable:!1,enumerable:!1}),window.wpParselyTelemetryInstance},e.prototype.loadTrackingLibrary=function(){var e=this,t=document.createElement("script");t.async=!0,t.src="//stats.wp.com/w.js",t.onload=function(){e.isLoaded=!0,e._tkq=window._tkq||[]},document.head.appendChild(t)},e.trackEvent=function(t){return n=this,r=arguments,s=function(t,n){var r;return void 0===n&&(n={}),function(e,t){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}(this,(function(i){switch(i.label){case 0:return(r=e.getInstance()).isTelemetryEnabled()?[4,e.waitUntilLoaded()]:[2];case 1:return i.sent(),r.trackEvent(t,n),[2]}}))},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{l(s.next(e))}catch(e){t(e)}}function a(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}l((s=s.apply(n,r||[])).next())}));var n,r,i,s},e.waitUntilLoaded=function(){return new Promise((function(t,n){var r=e.getInstance();if(r.isTelemetryEnabled())if(r.isLoaded)t();else var i=0,s=setInterval((function(){r.isLoaded&&(clearInterval(s),t()),(i+=100)>=1e4&&(clearInterval(s),n("Telemetry library not loaded"))}),100);else n("Telemetry not enabled")}))},e.prototype.trackEvent=function(t,n){var r;this.isLoaded?(0!==t.indexOf(e.TRACKS_PREFIX)&&(t=e.TRACKS_PREFIX+t),this.isEventNameValid(t)?(n=this.prepareProperties(n),null===(r=this._tkq)||void 0===r||r.push(["recordEvent",t,n])):console.error("Error tracking event: Invalid event name")):console.error("Error tracking event: Telemetry not loaded")},e.prototype.isTelemetryEnabled=function(){return this.isEnabled},e.prototype.isProprietyValid=function(t){return e.PROPERTY_REGEX.test(t)},e.prototype.isEventNameValid=function(t){return e.EVENT_NAME_REGEX.test(t)},e.prototype.prepareProperties=function(e){return(e=this.sanitizeProperties(e)).parsely_version=wpParselyTracksTelemetry.version,wpParselyTracksTelemetry.user&&(e._ut=wpParselyTracksTelemetry.user.type,e._ui=wpParselyTracksTelemetry.user.id),wpParselyTracksTelemetry.vipgo_env&&(e.vipgo_env=wpParselyTracksTelemetry.vipgo_env),this.sanitizeProperties(e)},e.prototype.sanitizeProperties=function(e){var t=this,n={};return Object.keys(e).forEach((function(r){t.isProprietyValid(r)&&(n[r]=e[r])})),n},e.TRACKS_PREFIX="wpparsely_",e.EVENT_NAME_REGEX=/^(([a-z0-9]+)_){2}([a-z0-9_]+)$/,e.PROPERTY_REGEX=/^[a-z_][a-z0-9_]*$/,e}(),S=(k.trackEvent,function(){return(0,f.jsx)(h.SVG,{"aria-hidden":"true",version:"1.1",viewBox:"0 0 15 15",width:"15",height:"15",xmlns:"http://www.w3.org/2000/svg",children:(0,f.jsx)(h.Path,{d:"M0 14.0025V11.0025L7.5 3.5025L10.5 6.5025L3 14.0025H0ZM12 5.0025L13.56 3.4425C14.15 2.8525 14.15 1.9025 13.56 1.3225L12.68 0.4425C12.09 -0.1475 11.14 -0.1475 10.56 0.4425L9 2.0025L12 5.0025Z"})})}),j=function(e){var t=e.size,n=void 0===t?24:t,r=e.className,i=void 0===r?"wp-parsely-icon":r;return(0,f.jsxs)(h.SVG,{className:i,height:n,viewBox:"0 0 60 65",width:n,xmlns:"http://www.w3.org/2000/svg",children:[(0,f.jsx)(h.Path,{fill:"#5ba745",d:"M23.72,51.53c0-.18,0-.34-.06-.52a13.11,13.11,0,0,0-2.1-5.53A14.74,14.74,0,0,0,19.12,43c-.27-.21-.5-.11-.51.22l-.24,3.42c0,.33-.38.35-.49,0l-1.5-4.8a1.4,1.4,0,0,0-.77-.78,23.91,23.91,0,0,0-3.1-.84c-1.38-.24-3.39-.39-3.39-.39-.34,0-.45.21-.25.49l2.06,3.76c.2.27,0,.54-.29.33l-4.51-3.6a3.68,3.68,0,0,0-2.86-.48c-1,.16-2.44.46-2.44.46a.68.68,0,0,0-.39.25.73.73,0,0,0-.14.45S.41,43,.54,44a3.63,3.63,0,0,0,1.25,2.62L6.48,50c.28.2.09.49-.23.37l-4.18-.94c-.32-.12-.5,0-.4.37,0,0,.69,1.89,1.31,3.16a24,24,0,0,0,1.66,2.74,1.34,1.34,0,0,0,1,.52l5,.13c.33,0,.41.38.1.48L7.51,58c-.31.1-.34.35-.07.55a14.29,14.29,0,0,0,3.05,1.66,13.09,13.09,0,0,0,5.9.5,25.13,25.13,0,0,0,4.34-1,9.55,9.55,0,0,1-.08-1.2,9.32,9.32,0,0,1,3.07-6.91"}),(0,f.jsx)(h.Path,{fill:"#5ba745",d:"M59.7,41.53a.73.73,0,0,0-.14-.45.68.68,0,0,0-.39-.25s-1.43-.3-2.44-.46a3.64,3.64,0,0,0-2.86.48l-4.51,3.6c-.26.21-.49-.06-.29-.33l2.06-3.76c.2-.28.09-.49-.25-.49,0,0-2,.15-3.39.39a23.91,23.91,0,0,0-3.1.84,1.4,1.4,0,0,0-.77.78l-1.5,4.8c-.11.32-.48.3-.49,0l-.24-3.42c0-.33-.24-.43-.51-.22a14.74,14.74,0,0,0-2.44,2.47A13.11,13.11,0,0,0,36.34,51c0,.18,0,.34-.06.52a9.26,9.26,0,0,1,3,8.1,24.1,24.1,0,0,0,4.34,1,13.09,13.09,0,0,0,5.9-.5,14.29,14.29,0,0,0,3.05-1.66c.27-.2.24-.45-.07-.55l-3.22-1.17c-.31-.1-.23-.47.1-.48l5-.13a1.38,1.38,0,0,0,1-.52A24.6,24.6,0,0,0,57,52.92c.61-1.27,1.31-3.16,1.31-3.16.1-.33-.08-.49-.4-.37l-4.18.94c-.32.12-.51-.17-.23-.37l4.69-3.34A3.63,3.63,0,0,0,59.46,44c.13-1,.24-2.47.24-2.47"}),(0,f.jsx)(h.Path,{fill:"#5ba745",d:"M46.5,25.61c0-.53-.35-.72-.8-.43l-4.86,2.66c-.45.28-.56-.27-.23-.69l4.66-6.23a2,2,0,0,0,.28-1.68,36.51,36.51,0,0,0-2.19-4.89,34,34,0,0,0-2.81-3.94c-.33-.41-.74-.35-.91.16l-2.28,5.68c-.16.5-.6.48-.59-.05l.28-8.93a2.54,2.54,0,0,0-.66-1.64S35,4.27,33.88,3.27,30.78.69,30.78.69a1.29,1.29,0,0,0-1.54,0s-1.88,1.49-3.12,2.59-2.48,2.35-2.48,2.35A2.5,2.5,0,0,0,23,7.27l.27,8.93c0,.53-.41.55-.58.05l-2.29-5.69c-.17-.5-.57-.56-.91-.14a35.77,35.77,0,0,0-3,4.2,35.55,35.55,0,0,0-2,4.62,2,2,0,0,0,.27,1.67l4.67,6.24c.33.42.23,1-.22.69l-4.87-2.66c-.45-.29-.82-.1-.82.43a18.6,18.6,0,0,0,.83,5.07,20.16,20.16,0,0,0,5.37,7.77c3.19,3,5.93,7.8,7.45,11.08A9.6,9.6,0,0,1,30,49.09a9.31,9.31,0,0,1,2.86.45c1.52-3.28,4.26-8.11,7.44-11.09a20.46,20.46,0,0,0,5.09-7,19,19,0,0,0,1.11-5.82"}),(0,f.jsx)(h.Path,{fill:"#5ba745",d:"M36.12,58.44A6.12,6.12,0,1,1,30,52.32a6.11,6.11,0,0,1,6.12,6.12"})]})},P=function(){return P=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},P.apply(this,arguments)},T={},E="wp-parsely/settings",L=(0,v.createReduxStore)(E,{initialState:T,reducer:function(e,t){var n,r;switch(void 0===e&&(e=T),t.type){case"SET_SETTINGS":return P(P({},e),((n={})[t.endpoint]=t.settings,n));case"SET_PARTIAL_SETTINGS":var i=e[t.endpoint]||{},s=P(P({},i),t.partialSettings);return P(P({},e),((r={})[t.endpoint]=s,r));default:return e}},actions:{setSettings:function(e,t){return{type:"SET_SETTINGS",endpoint:e,settings:t}},setPartialSettings:function(e,t){return{type:"SET_PARTIAL_SETTINGS",endpoint:e,partialSettings:t}}},selectors:{getSettings:function(e,t){return e[t]}}}),N=window.wp.apiFetch,C=n.n(N),O=function(){return O=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},O.apply(this,arguments)},A=(0,m.createContext)({settings:{},setSettings:function(){console.error("WP Parse.ly: setSettings not implemented")}});function I(){var e=(0,m.useContext)(A);if(void 0===e)throw new Error("useSettings must be used within a SettingsProvider");return e}var R,B,M,D=function(e){var t=e.children,n=e.endpoint,r=e.defaultSettings,i=(0,v.useSelect)((function(e){var t=e(L).getSettings(n);return t||(t=r,(0,v.dispatch)(L).setSettings(n,r).then((function(){}))),{storedSettings:t}}),[r,n]).storedSettings,s=(0,m.useState)(i),o=s[0],a=s[1],l=(0,v.dispatch)(L).setPartialSettings,c=(0,m.useCallback)((function(e){a((function(t){return O(O({},t),e)})),l(n,e)}),[n,l]);!function(e,t,n){var r=(0,m.useRef)(!0),i=(0,m.useRef)(t);(0,m.useEffect)((function(){if(r.current)return r.current=!1,void(i.current=t);JSON.stringify(i.current)!==JSON.stringify(t)&&(i.current=t,C()({path:"/wp-parsely/v2/settings/"+e,method:"PUT",data:t}))}),n)}(n,i,[o]);var u=(0,m.useMemo)((function(){return{settings:i,setSettings:c}}),[i,c]);return(0,f.jsx)(A.Provider,{value:u,children:t})};void 0!==(0,v.select)(E)||(0,v.register)(L),function(e){e.Minutes10="10m",e.Hour="1h",e.Hours2="2h",e.Hours4="4h",e.Hours24="24h",e.Days7="7d",e.Days30="30d"}(R||(R={})),function(e){e.Views="views",e.AvgEngaged="avg_engaged"}(B||(B={})),function(e){e.Author="author",e.Section="section",e.Tag="tag"}(M||(M={}));var F=function(e,t){return Object.values(t).includes(e)};function V(e,t){void 0===t&&(t=!1);var n=parseInt(e,10),r=e.charAt(e.length-1),i=(0,w.__)("Unknown Period","wp-parsely");switch(r){case"m":if(1===n){i=(0,w.__)("Last Minute","wp-parsely");break}i=(0,w.sprintf)(/* translators: 1: Number of minutes */ /* translators: 1: Number of minutes */(0,w._n)("Last %1$d Minute","Last %1$d Minutes",n,"wp-parsely"),n);break;case"h":if(1===n){i=(0,w.__)("Last Hour","wp-parsely");break}i=(0,w.sprintf)(/* translators: 1: Number of hours */ /* translators: 1: Number of hours */(0,w._n)("Last %1$d Hour","Last %1$d Hours",n,"wp-parsely"),n);break;case"d":if(1===n){i=(0,w.__)("Last Day","wp-parsely");break}i=(0,w.sprintf)(/* translators: 1: Number of days */ /* translators: 1: Number of days */(0,w._n)("Last %1$d Day","Last %1$d Days",n,"wp-parsely"),n)}return t?i.toLocaleLowerCase():i}function G(e){switch(e){case B.Views:return(0,w.__)("Page Views","wp-parsely");case B.AvgEngaged:return(0,w.__)("Avg. Time","wp-parsely");default:return(0,w.__)("Unknown Metric","wp-parsely")}}function H(){var e={SmartLinking:!1,TitleSuggestions:!1,ExcerptSuggestions:!1};try{var t=JSON.parse(window.wpParselyContentHelperPermissions);return"object"!=typeof t||null===t?e:t}catch(t){return e}}var z,U,q=window.wp.editor,K=window.wp.hooks,Z=(0,v.dispatch)("core/block-editor"),W=(0,v.dispatch)("core/editor"),Y=(0,v.dispatch)("core/edit-post"),$=(0,f.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,f.jsx)(b.Path,{d:"M19.5 4.5h-7V6h4.44l-5.97 5.97 1.06 1.06L18 7.06v4.44h1.5v-7Zm-13 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-3H17v3a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h3V5.5h-3Z"})}),J=window.wp.wordcount,X=function(e){void 0===e&&(e=null);var t="";(null==e?void 0:e.children)&&(t=e.children);var n="content-helper-error-message";return(null==e?void 0:e.className)&&(n+=" "+e.className),(0,f.jsx)("div",{className:n,"data-testid":null==e?void 0:e.testId,dangerouslySetInnerHTML:{__html:t}})},Q=function(e){var t;return void 0===e&&(e=null),(0,f.jsx)(X,{className:null==e?void 0:e.className,testId:"empty-credentials-message",children:null!==(t=window.wpParselyEmptyCredentialsMessage)&&void 0!==t?t:(0,w.__)("Please ensure that the Site ID and API Secret given in the plugin's settings are correct.","wp-parsely")})},ee=(z=function(e,t){return z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},z(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function __(){this.constructor=e}z(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)});!function(e){e.AccessToFeatureDisabled="ch_access_to_feature_disabled",e.CannotFormulateApiQuery="ch_cannot_formulate_api_query",e.FetchError="fetch_error",e.HttpRequestFailed="http_request_failed",e.ParselyAborted="ch_parsely_aborted",e[e.ParselyApiForbidden=403]="ParselyApiForbidden",e.ParselyApiResponseContainsError="ch_response_contains_error",e.ParselyApiReturnedNoData="ch_parsely_api_returned_no_data",e.ParselyApiReturnedTooManyResults="ch_parsely_api_returned_too_many_results",e.PluginCredentialsNotSetMessageDetected="parsely_credentials_not_set_message_detected",e.PluginSettingsApiSecretNotSet="parsely_api_secret_not_set",e.PluginSettingsSiteIdNotSet="parsely_site_id_not_set",e.PostIsNotPublished="ch_post_not_published",e.UnknownError="ch_unknown_error",e.ParselySuggestionsApiAuthUnavailable="AUTH_UNAVAILABLE",e.ParselySuggestionsApiNoAuthentication="NO_AUTHENTICATION",e.ParselySuggestionsApiNoAuthorization="NO_AUTHORIZATION",e.ParselySuggestionsApiNoData="NO_DATA",e.ParselySuggestionsApiOpenAiError="OPENAI_ERROR",e.ParselySuggestionsApiOpenAiSchema="OPENAI_SCHEMA",e.ParselySuggestionsApiOpenAiUnavailable="OPENAI_UNAVAILABLE",e.ParselySuggestionsApiSchemaError="SCHEMA_ERROR"}(U||(U={}));var te=function(e){function t(n,r,i){void 0===i&&(i=(0,w.__)("Error:","wp-parsely"));var s=this;n.startsWith(i)&&(i=""),(s=e.call(this,i.length>0?"".concat(i," ").concat(n):n)||this).hint=null,s.name=s.constructor.name,s.code=r;var o=[U.AccessToFeatureDisabled,U.ParselyApiForbidden,U.ParselyApiResponseContainsError,U.ParselyApiReturnedNoData,U.ParselyApiReturnedTooManyResults,U.PluginCredentialsNotSetMessageDetected,U.PluginSettingsApiSecretNotSet,U.PluginSettingsSiteIdNotSet,U.PostIsNotPublished,U.UnknownError,U.ParselySuggestionsApiAuthUnavailable,U.ParselySuggestionsApiNoAuthentication,U.ParselySuggestionsApiNoAuthorization,U.ParselySuggestionsApiNoData,U.ParselySuggestionsApiSchemaError];return s.retryFetch=!o.includes(s.code),Object.setPrototypeOf(s,t.prototype),s.code===U.AccessToFeatureDisabled?s.message=(0,w.__)("Access to this feature is disabled by the site's administration.","wp-parsely"):s.code===U.ParselySuggestionsApiNoAuthorization?s.message=(0,w.__)('This AI-powered feature is opt-in. To gain access, please submit a request <a href="https://wpvip.com/parsely-content-helper/" target="_blank" rel="noreferrer">here</a>.',"wp-parsely"):s.code===U.ParselySuggestionsApiOpenAiError||s.code===U.ParselySuggestionsApiOpenAiUnavailable?s.message=(0,w.__)("The Parse.ly API returned an internal server error. Please retry with a different input, or try again later.","wp-parsely"):s.code===U.HttpRequestFailed&&s.message.includes("cURL error 28")?s.message=(0,w.__)("The Parse.ly API did not respond in a timely manner. Please try again later.","wp-parsely"):s.code===U.ParselySuggestionsApiSchemaError?s.message=(0,w.__)("The Parse.ly API returned a validation error. Please try again with different parameters.","wp-parsely"):s.code===U.ParselySuggestionsApiNoData?s.message=(0,w.__)("The Parse.ly API couldn't find any relevant data to fulfill the request. Please retry with a different input.","wp-parsely"):s.code===U.ParselySuggestionsApiOpenAiSchema?s.message=(0,w.__)("The Parse.ly API returned an incorrect response. Please try again later.","wp-parsely"):s.code===U.ParselySuggestionsApiAuthUnavailable&&(s.message=(0,w.__)("The Parse.ly API is currently unavailable. Please try again later.","wp-parsely")),s}return ee(t,e),t.prototype.Message=function(e){return void 0===e&&(e=null),[U.PluginCredentialsNotSetMessageDetected,U.PluginSettingsSiteIdNotSet,U.PluginSettingsApiSecretNotSet].includes(this.code)?Q(e):(this.code===U.FetchError&&(this.hint=this.Hint((0,w.__)("This error can sometimes be caused by ad-blockers or browser tracking protections. Please add this site to any applicable allow lists and try again.","wp-parsely"))),this.code!==U.ParselyApiForbidden&&this.code!==U.ParselySuggestionsApiNoAuthentication||(this.hint=this.Hint((0,w.__)("Please ensure that the Site ID and API Secret given in the plugin's settings are correct.","wp-parsely"))),this.code===U.HttpRequestFailed&&(this.hint=this.Hint((0,w.__)("The Parse.ly API cannot be reached. Please verify that you are online.","wp-parsely"))),(0,f.jsx)(X,{className:null==e?void 0:e.className,testId:"error",children:"<p>".concat(this.message,"</p>").concat(this.hint?this.hint:"")}))},t.prototype.Hint=function(e){return'<p className="content-helper-error-message-hint" data-testid="content-helper-error-message-hint"><strong>'.concat((0,w.__)("Hint:","wp-parsely"),"</strong> ").concat(e,"</p>")},t.prototype.createErrorSnackbar=function(){/<a.*?>/.test(this.message)||(0,v.dispatch)("core/notices").createNotice("error",this.message,{type:"snackbar"})},t}(Error),ne=window.wp.compose,re=(0,f.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,f.jsx)(b.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})}),ie=(0,m.forwardRef)((function({icon:e,size:t=24,...n},r){return(0,m.cloneElement)(e,{width:t,height:t,...n,ref:r})})),se=function(){return(0,f.jsx)(h.SVG,{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",children:(0,f.jsx)(h.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M13.5034 7.91642L9 12.0104L4.49662 7.91642L5.25337 7.08398L8.99999 10.49L12.7466 7.08398L13.5034 7.91642Z",fill:"#1E1E1E"})})},oe={journalist:{label:(0,w.__)("Journalist","wp-parsely")},editorialWriter:{label:(0,w.__)("Editorial Writer","wp-parsely")},investigativeReporter:{label:(0,w.__)("Investigative Reporter","wp-parsely")},techAnalyst:{label:(0,w.__)("Tech Analyst","wp-parsely")},businessAnalyst:{label:(0,w.__)("Business Analyst","wp-parsely")},culturalCommentator:{label:(0,w.__)("Cultural Commentator","wp-parsely")},scienceCorrespondent:{label:(0,w.__)("Science Correspondent","wp-parsely")},politicalAnalyst:{label:(0,w.__)("Political Analyst","wp-parsely")},healthWellnessAdvocate:{label:(0,w.__)("Health and Wellness Advocate","wp-parsely")},environmentalJournalist:{label:(0,w.__)("Environmental Journalist","wp-parsely")},custom:{label:(0,w.__)("Custom Persona","wp-parsely"),icon:re}},ae=Object.keys(oe),le=function(e){return"custom"===e||""===e?oe.custom.label:ce(e)?e:oe[e].label},ce=function(e){return!ae.includes(e)||"custom"===e},ue=function(e){var t=e.value,n=e.onChange,r=(0,m.useState)(""),i=r[0],s=r[1],o=(0,ne.useDebounce)(n,500);return(0,f.jsx)("div",{className:"parsely-persona-selector-custom",children:(0,f.jsx)(h.TextControl,{value:i||t,placeholder:(0,w.__)("Enter a custom persona…","wp-parsely"),onChange:function(e){if(""===e)return n(""),void s("");e.length>32&&(e=e.slice(0,32)),o(e),s(e)}})})},pe=function(e){var t=e.persona,n=e.value,r=void 0===n?(0,w.__)("Select a persona…","wp-parsely"):n,i=e.label,s=void 0===i?(0,w.__)("Persona","wp-parsely"):i,o=e.onChange,a=e.onDropdownChange,l=e.disabled,c=void 0!==l&&l,u=e.allowCustom,p=void 0!==u&&u;return(0,f.jsxs)(h.Disabled,{isDisabled:c,children:[s&&(0,f.jsx)("div",{className:"wp-parsely-dropdown-label",children:s}),(0,f.jsx)(h.DropdownMenu,{label:(0,w.__)("Persona","wp-parsely"),className:"parsely-persona-selector-dropdown"+(c?" is-disabled":""),popoverProps:{className:"wp-parsely-popover"},toggleProps:{children:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"parsely-persona-selector-label",children:ce(t)?oe.custom.label:r}),(0,f.jsx)(se,{})]})},children:function(e){var n=e.onClose;return(0,f.jsx)(h.MenuGroup,{label:(0,w.__)("Persona","wp-parsely"),children:(0,f.jsx)(f.Fragment,{children:ae.map((function(e){if(!p&&"custom"===e)return null;var r=oe[e],i=e===t||ce(t)&&"custom"===e;return(0,f.jsxs)(h.MenuItem,{isSelected:i,className:i?"is-selected":"",role:"menuitemradio",onClick:function(){null==a||a(e),o(e),n(),"custom"===e&&setTimeout((function(){var e=document.querySelector(".parsely-persona-selector-custom input");e&&e.focus()}),0)},children:[r.icon&&(0,f.jsx)(ie,{icon:r.icon}),r.label]},e)}))})})}}),p&&ce(t)&&(0,f.jsx)(ue,{onChange:function(e){o(""!==e?e:"custom")},value:"custom"===t?"":t})]})},de={neutral:{label:(0,w.__)("Neutral","wp-parsely")},formal:{label:(0,w.__)("Formal","wp-parsely")},humorous:{label:(0,w.__)("Humorous","wp-parsely")},confident:{label:(0,w.__)("Confident","wp-parsely")},provocative:{label:(0,w.__)("Provocative","wp-parsely")},serious:{label:(0,w.__)("Serious","wp-parsely")},inspirational:{label:(0,w.__)("Inspirational","wp-parsely")},skeptical:{label:(0,w.__)("Skeptical","wp-parsely")},conversational:{label:(0,w.__)("Conversational","wp-parsely")},analytical:{label:(0,w.__)("Analytical","wp-parsely")},custom:{label:(0,w.__)("Custom Tone","wp-parsely"),icon:re}},fe=Object.keys(de),he=function(e){return"custom"===e||""===e?de.custom.label:ve(e)?e:de[e].label},ve=function(e){return!fe.includes(e)||"custom"===e},ge=function(e){var t=e.value,n=e.onChange,r=(0,m.useState)(""),i=r[0],s=r[1],o=(0,ne.useDebounce)(n,500);return(0,f.jsx)("div",{className:"parsely-tone-selector-custom",children:(0,f.jsx)(h.TextControl,{value:i||t,placeholder:(0,w.__)("Enter a custom tone","wp-parsely"),onChange:function(e){if(""===e)return n(""),void s("");e.length>32&&(e=e.slice(0,32)),o(e),s(e)}})})},ye=function(e){var t=e.tone,n=e.value,r=void 0===n?(0,w.__)("Select a tone","wp-parsely"):n,i=e.label,s=void 0===i?(0,w.__)("Tone","wp-parsely"):i,o=e.onChange,a=e.onDropdownChange,l=e.disabled,c=void 0!==l&&l,u=e.allowCustom,p=void 0!==u&&u;return(0,f.jsxs)(h.Disabled,{isDisabled:c,children:[(0,f.jsx)("div",{className:"wp-parsely-dropdown-label",children:s}),(0,f.jsx)(h.DropdownMenu,{label:(0,w.__)("Tone","wp-parsely"),className:"parsely-tone-selector-dropdown"+(c?" is-disabled":""),popoverProps:{className:"wp-parsely-popover"},toggleProps:{children:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"parsely-tone-selector-label",children:ve(t)?de.custom.label:r}),(0,f.jsx)(se,{})]})},children:function(e){var n=e.onClose;return(0,f.jsx)(h.MenuGroup,{label:(0,w.__)("Select a tone","wp-parsely"),children:(0,f.jsx)(f.Fragment,{children:fe.map((function(e){if(!p&&"custom"===e)return null;var r=de[e],i=e===t||ve(t)&&"custom"===e;return(0,f.jsxs)(h.MenuItem,{isSelected:i,className:i?"is-selected":"",role:"menuitemradio",onClick:function(){null==a||a(e),o(e),n(),"custom"===e&&setTimeout((function(){var e=document.querySelector(".parsely-tone-selector-custom input");e&&e.focus()}),0)},children:[r.icon&&(0,f.jsx)(ie,{icon:r.icon}),r.label]},e)}))})})}}),p&&ve(t)&&(0,f.jsx)(ge,{onChange:function(e){o(""!==e?e:"custom")},value:"custom"===t?"":t})]})},me=function(e){var t=e.isLoading,n=e.onPersonaChange,r=e.onToneChange,i=e.persona,s=e.tone;return(0,f.jsxs)("div",{className:"excerpt-suggestions-settings",children:[(0,f.jsx)(ye,{tone:s,value:he(s),onChange:function(e){r(e)},onDropdownChange:function(e){k.trackEvent("excerpt_generator_ai_tone_changed",{selectedTone:e})},disabled:t,allowCustom:!0}),(0,f.jsx)(pe,{persona:i,value:le(i),onChange:function(e){n(e)},onDropdownChange:function(e){k.trackEvent("excerpt_generator_ai_persona_changed",{persona:e})},disabled:t,allowCustom:!0})]})},we=window.wp.url,be=function(){function e(){this.abortControllers=new Map}return e.prototype.cancelRequest=function(e){if(e)(t=this.abortControllers.get(e))&&(t.abort(),this.abortControllers.delete(e));else{var t,n=Array.from(this.abortControllers.keys()).pop();n&&(t=this.abortControllers.get(n))&&(t.abort(),this.abortControllers.delete(n))}},e.prototype.cancelAll=function(){this.abortControllers.forEach((function(e){return e.abort()})),this.abortControllers.clear()},e.prototype.getOrCreateController=function(e){if(e&&this.abortControllers.has(e))return{abortController:this.abortControllers.get(e),abortId:e};var t=null!=e?e:"auto-"+Date.now(),n=new AbortController;return this.abortControllers.set(t,n),{abortController:n,abortId:t}},e.prototype.fetch=function(e,t){return n=this,r=void 0,s=function(){var n,r,i,s,o,a;return function(e,t){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}(this,(function(l){switch(l.label){case 0:n=this.getOrCreateController(t),r=n.abortController,i=n.abortId,e.signal=r.signal,l.label=1;case 1:return l.trys.push([1,3,4,5]),[4,C()(e)];case 2:return(s=l.sent()).error?[2,Promise.reject(new te(s.error.message,U.ParselyApiResponseContainsError))]:[2,s.data];case 3:return"AbortError"===(o=l.sent()).name?[2,Promise.reject(new te((0,w.__)("The operation was aborted.","wp-parsely"),U.ParselyAborted))]:(a=o.message,"object"==typeof o.message&&o.message[0].msg&&(a=o.message[0].msg),[2,Promise.reject(new te(a,o.code))]);case 4:return this.abortControllers.delete(i),[7];case 5:return[2]}}))},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{l(s.next(e))}catch(e){t(e)}}function a(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}l((s=s.apply(n,r||[])).next())}));var n,r,i,s},e}(),xe=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),_e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return xe(t,e),t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.generateExcerpt=function(e,t,n,r){return i=this,s=void 0,a=function(){return function(e,t){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}(this,(function(i){switch(i.label){case 0:return""===e&&(e="Untitled"),[4,this.fetch({method:"POST",path:(0,we.addQueryArgs)("/wp-parsely/v2/content-helper/excerpt-generator/generate",{title:e,persona:n,style:r}),data:{text:t}})];case 1:return[2,i.sent()]}}))},new((o=void 0)||(o=Promise))((function(e,t){function n(e){try{l(a.next(e))}catch(e){t(e)}}function r(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){var i;t.done?e(t.value):(i=t.value,i instanceof o?i:new o((function(e){e(i)}))).then(n,r)}l((a=a.apply(i,s||[])).next())}));var i,s,o,a},t}(be),ke=function(){return ke=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},ke.apply(this,arguments)},Se=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))},je=function(e,t){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},Pe=function(e){var t=e.isDocumentSettingPanel,n=void 0!==t&&t,r=I(),i=r.settings,s=r.setSettings,o=(0,m.useState)(),a=o[0],l=o[1],c=(0,m.useState)({currentExcerpt:"",isUnderReview:!1,newExcerptGeneratedCount:0,oldExcerpt:""}),u=c[0],p=c[1],d=(0,m.useState)(!1),g=d[0],y=d[1],b=(0,m.useState)(!1),x=b[0],_=b[1],S=(0,m.useState)(i.ExcerptSuggestions.Persona),P=S[0],T=S[1],E=(0,m.useState)(i.ExcerptSuggestions.Tone),L=E[0],N=E[1],C=(0,m.useState)(""),O=C[0],A=C[1],R=(0,v.useDispatch)(q.store).editPost,B=function(e,t){var n;s({ExcerptSuggestions:ke(ke({},i.ExcerptSuggestions),(n={},n[e]=t,n))})},M=(0,v.useSelect)((function(e){var t,n,r=e(q.store),i=r.getEditedPostAttribute,s=(0,r.getEditedPostContent)();s||(s="");var o=(new window.DOMParser).parseFromString(s,"text/html");return s=((null!==(t=o.body.textContent)&&void 0!==t?t:o.body.innerText)||"").replace(/\n{2,}/g,"\n").trim(),{excerpt:null!==(n=i("excerpt"))&&void 0!==n?n:"",postContent:s,postTitle:i("title")}}),[]),D=M.excerpt,F=M.postContent,V=M.postTitle;(0,m.useEffect)((function(){var e;A((e=(0,J.count)(u.currentExcerpt||D,"words",{}))>0?(0,w.sprintf)(
// Translators: %1$s the number of words in the excerpt.
// Translators: %1$s the number of words in the excerpt.
(0,w._n)("%1$s word","%1$s words",e,"wp-parsely"),e):"")}),[u.currentExcerpt,D]),(0,m.useEffect)((function(){var e=document.querySelector(".editor-post-excerpt textarea");e&&(e.scrollTop=0)}),[u.newExcerptGeneratedCount]);var G=(0,f.jsxs)("div",{className:"wp-parsely-excerpt-generator-header",children:[(0,f.jsx)(j,{size:16}),(0,f.jsx)("div",{className:"wp-parsely-excerpt-generator-header-label",children:(0,w.__)("Generate With Parse.ly","wp-parsely")})]}),H=n?(0,w.__)("Write an excerpt (optional)","wp-parsely"):(0,w.__)("Excerpt","wp-parsely");return(0,f.jsxs)("div",{className:"editor-post-excerpt",children:[!n&&(0,f.jsxs)("div",{className:"excerpt-suggestions-text",children:[(0,w.__)("Use Parse.ly AI to generate a concise, engaging excerpt for your post.","wp-parsely"),(0,f.jsxs)(h.Button,{href:"https://docs.wpvip.com/parse-ly/wp-parsely-features/excerpt-suggestions/",target:"_blank",variant:"link",rel:"noopener",children:[(0,w.__)("Learn more about Parse.ly AI","wp-parsely"),(0,f.jsx)(h.Icon,{icon:$,size:18,className:"parsely-external-link-icon"})]})]}),(0,f.jsxs)("div",{style:{position:"relative"},children:[g&&(0,f.jsx)("div",{className:"editor-post-excerpt__loading_animation",children:(0,f.jsx)(Te,{})}),(0,f.jsx)(h.TextareaControl,{__nextHasNoMarginBottom:!0,label:H,className:"editor-post-excerpt__textarea",onChange:function(e){u.isUnderReview||R({excerpt:e}),p(ke(ke({},u),{currentExcerpt:e})),_(!0)},onKeyUp:function(){var e;if(x)_(!1);else{var t=document.querySelector(".editor-post-excerpt textarea"),n=null!==(e=null==t?void 0:t.textContent)&&void 0!==e?e:"";p(ke(ke({},u),{currentExcerpt:n}))}},value:g?"":u.isUnderReview?u.currentExcerpt:D,help:O||null})]}),n&&(0,f.jsxs)(h.Button,{href:(0,w.__)("https://wordpress.org/documentation/article/page-post-settings-sidebar/#excerpt"),target:"_blank",variant:"link",rel:"noopener",children:[(0,w.__)("Learn more about manual excerpts","wp-parsely"),(0,f.jsx)(h.Icon,{icon:$,size:18,className:"parsely-external-link-icon"})]}),(0,f.jsxs)("div",{className:"wp-parsely-excerpt-generator"+(n?" is-doc-set-panel":""),children:[a&&(0,f.jsx)(h.Notice,{className:"wp-parsely-excerpt-generator-error",onRemove:function(){return l(void 0)},status:"info",children:a.Message()}),u.isUnderReview?(0,f.jsxs)(f.Fragment,{children:[n&&G,(0,f.jsxs)("div",{className:"wp-parsely-excerpt-suggestions-review-controls",children:[(0,f.jsx)(h.Button,{variant:"secondary",onClick:function(){return Se(void 0,void 0,void 0,(function(){return je(this,(function(e){switch(e.label){case 0:return[4,R({excerpt:u.currentExcerpt})];case 1:return e.sent(),p(ke(ke({},u),{isUnderReview:!1})),k.trackEvent("excerpt_generator_accepted"),[2]}}))}))},children:(0,w.__)("Accept","wp-parsely")}),(0,f.jsx)(h.Button,{isDestructive:!0,variant:"secondary",onClick:function(){return Se(void 0,void 0,void 0,(function(){return je(this,(function(e){return R({excerpt:u.oldExcerpt}),p(ke(ke({},u),{currentExcerpt:u.oldExcerpt,isUnderReview:!1})),k.trackEvent("excerpt_generator_discarded"),[2]}))}))},children:(0,w.__)("Discard","wp-parsely")})]})]}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(me,{isLoading:g,onPersonaChange:function(e){B("Persona",e),T(e)},onSettingChange:B,onToneChange:function(e){B("Tone",e),N(e)},persona:i.ExcerptSuggestions.Persona,tone:i.ExcerptSuggestions.Tone}),n&&G,(0,f.jsx)("div",{className:"excerpt-suggestions-generate",children:(0,f.jsxs)(h.Button,{onClick:function(){return Se(void 0,void 0,void 0,(function(){var e,t;return je(this,(function(n){switch(n.label){case 0:y(!0),l(void 0),n.label=1;case 1:return n.trys.push([1,3,4,5]),k.trackEvent("excerpt_generator_pressed"),[4,_e.getInstance().generateExcerpt(V,F,P,L)];case 2:return e=n.sent(),p({currentExcerpt:e,isUnderReview:!0,newExcerptGeneratedCount:u.newExcerptGeneratedCount+1,oldExcerpt:D}),[3,5];case 3:return(t=n.sent())instanceof te?l(t):(l(new te((0,w.__)("An unknown error occurred.","wp-parsely"),U.UnknownError)),console.error(t)),[3,5];case 4:return y(!1),[7];case 5:return[2]}}))}))},variant:"primary",isBusy:g,disabled:g||!F,children:[g&&(0,w.__)("Generating Excerpt…","wp-parsely"),!g&&u.newExcerptGeneratedCount>0&&(0,w.__)("Regenerate Excerpt","wp-parsely"),!g&&0===u.newExcerptGeneratedCount&&(0,w.__)("Generate Excerpt","wp-parsely")]})})]}),n&&(0,f.jsxs)(h.Button,{href:"https://docs.wpvip.com/parse-ly/wp-parsely-features/excerpt-suggestions/",target:"_blank",variant:"link",rel:"noopener",children:[(0,w.__)("Learn more about Parse.ly AI","wp-parsely"),(0,f.jsx)(h.Icon,{icon:$,size:18,className:"parsely-external-link-icon"})]})]})]})},Te=function(){return(0,f.jsx)(h.Animate,{type:"loading",children:function(e){var t=e.className;return(0,f.jsx)("span",{className:t,children:(0,w.__)("Generating…","wp-parsely")})}})},Ee=function(){return(0,f.jsx)(q.PostTypeSupportCheck,{supportKeys:"excerpt",children:(0,f.jsx)(p,{name:"parsely-post-excerpt",title:(0,w.__)("Excerpt","wp-parsely"),children:(0,f.jsx)(D,{endpoint:"editor-sidebar",defaultSettings:Ar(window.wpParselyContentHelperSettings),children:(0,f.jsx)(Pe,{isDocumentSettingPanel:!0})})})})},Le=function(e,t){var n,r,i;return t!==Or?e:H().ExcerptSuggestions?((null===(n=null===window||void 0===window?void 0:window.Jetpack_Editor_Initial_State)||void 0===n?void 0:n.available_blocks["ai-content-lens"])&&(console.log("Parse.ly: Jetpack AI is enabled and will be disabled."),(0,K.removeFilter)("blocks.registerBlockType","jetpack/ai-content-lens-features")),(0,_.registerPlugin)("wp-parsely-excerpt-suggestions",{render:function(){return(0,f.jsx)(Ee,{})}}),(null===(r=(0,v.dispatch)("core/editor"))||void 0===r?void 0:r.removeEditorPanel)?null===(i=(0,v.dispatch)("core/editor"))||void 0===i||i.removeEditorPanel("post-excerpt"):null==Y||Y.removeEditorPanel("post-excerpt"),e):e};function Ne(){(0,K.addFilter)("plugins.registerPlugin","wp-parsely-excerpt-suggestions",Le,1e3)}var Ce=window.wp.blockEditor;function Oe(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var Ae=function(){return Ae=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Ae.apply(this,arguments)},Ie=function(e,t){var n=e.children;return void 0===t&&(t=null),window.wpParselyEmptyCredentialsMessage?(0,f.jsx)(Q,Ae({},t)):(0,f.jsx)(f.Fragment,{children:n})},Re=window.wp.blocks,Be=function(e){var t=e.isDetectingEnabled,n=e.onLinkChange,r=e.onLinkRemove,i=e.onLinkAdd,s=e.debounceValue,o=void 0===s?500:s,a=(0,v.useSelect)((function(e){return{blocks:(0,e("core/block-editor").getBlocks)()}}),[]).blocks,l=(0,m.useRef)(a),c=(0,m.useRef)(t);return(0,m.useEffect)((function(){var e=(0,ne.debounce)((function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];if(!t[0]||!c.current)return e.cancel(),l.current=a,void(c.current=t[0]);var o=function(e,t){var n=[],r=function(e,t){var i=new DOMParser;e.forEach((function(e,s){if(t&&t[s]){if(e.innerBlocks.length>0)return r(e.innerBlocks,t[s].innerBlocks);if(JSON.stringify(e)!==JSON.stringify(t[s])){var o=t[s],a=i.parseFromString(e.attributes.content||"","text/html"),l=i.parseFromString((null==o?void 0:o.attributes.content)||"","text/html"),c=Array.from(a.querySelectorAll("a[data-smartlink]")),u=Array.from(l.querySelectorAll("a[data-smartlink]")),p=c.filter((function(e){return!u.some((function(t){return t.dataset.smartlink===e.dataset.smartlink}))})),d=u.filter((function(e){return!c.some((function(t){return t.dataset.smartlink===e.dataset.smartlink}))})),f=c.filter((function(e){var t=u.find((function(t){return t.dataset.smartlink===e.dataset.smartlink}));return t&&t.outerHTML!==e.outerHTML}));(p.length>0||d.length>0||f.length>0)&&n.push({block:e,prevBlock:o,addedLinks:p,removedLinks:d,changedLinks:f})}}}))};return r(e,t),n}(a,l.current);o.length>0&&(o.forEach((function(e){e.changedLinks.length>0&&n&&n(e),e.addedLinks.length>0&&i&&i(e),e.removedLinks.length>0&&r&&r(e)})),l.current=a)}),o);return e(t),function(){e.cancel()}}),[a,o,t,i,n,r]),null},Me=function(e){var t=e.value,n=e.onChange,r=e.max,i=e.min,s=e.suffix,o=e.size,a=e.label,l=e.initialPosition,c=e.disabled,u=e.className;return(0,f.jsxs)("div",{className:"parsely-inputrange-control ".concat(u||""),children:[(0,f.jsx)(h.__experimentalHeading,{className:"parsely-inputrange-control__label",level:3,children:a}),(0,f.jsxs)("div",{className:"parsely-inputrange-control__controls",children:[(0,f.jsx)(h.__experimentalNumberControl,{disabled:c,value:t,suffix:(0,f.jsx)(h.__experimentalInputControlSuffixWrapper,{children:s}),size:null!=o?o:"__unstable-large",min:i,max:r,onChange:function(e){var t=parseInt(e,10);isNaN(t)||n(t)}}),(0,f.jsx)(h.RangeControl,{disabled:c,value:t,showTooltip:!1,initialPosition:l,onChange:function(e){n(e)},withInputField:!1,min:i,max:r})]})]})},De=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))},Fe=function(e,t){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},Ve=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};function Ge(e){return void 0!==e.post_data}function He(e,t){for(var n=e;n&&!(n instanceof HTMLAnchorElement);)n=n.parentNode;return n instanceof HTMLAnchorElement&&n.dataset.smartlink===t}function ze(e){for(var t=e;t;){if(null!==t.nodeName.match(/^H[1-6]$/i)||"figcaption"===t.nodeName.toLowerCase())return!0;t=t.parentNode}return!1}function Ue(e,t,n){var r=(0,Re.getBlockContent)(e),i=(new DOMParser).parseFromString(r,"text/html").body.firstChild;if(i){var s=function(e,t){for(var n=[],r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);r.nextNode();){var i=r.currentNode;i.textContent&&i.textContent.includes(t)&&n.push(i)}return n}(i,t.text),o=0,a=!1;return s.forEach((function(e){var r,i,s;if(e.textContent&&!a)if(function(e,t){for(var n=e.parentNode;n;){if(n.nodeName===t.nodeName)return!0;n=n.parentNode}return!1}(e,n))(null===(r=e.textContent)||void 0===r?void 0:r.includes(t.text))&&o++;else for(var l,c=new RegExp(Oe(t.text),"g");null!==(l=c.exec(e.textContent));){if(o===(null===(i=t.match)||void 0===i?void 0:i.blockOffset)){var u=n.cloneNode(!0);u.textContent=l[0];var p=document.createRange();if(p.setStart(e,l.index),p.setEnd(e,l.index+l[0].length),p.deleteContents(),p.insertNode(u),e.textContent&&l.index+l[0].length<e.textContent.length){var d=document.createTextNode(e.textContent.slice(l.index+l[0].length));null===(s=e.parentNode)||void 0===s||s.insertBefore(d,u.nextSibling)}return void(a=!0)}o++}})),Z.updateBlockAttributes(e.clientId,{content:i.innerHTML}),i.innerHTML}}function qe(e){var t=e.filter((function(e){return e.applied})),n=e.filter((function(e){return!e.applied})),r=function(e,t){return e.match&&t.match?e.match.blockPosition===t.match.blockPosition?e.match.blockLinkPosition-t.match.blockLinkPosition:e.match.blockPosition-t.match.blockPosition:0};return t.sort(r),n.sort(r),Ve(Ve([],n,!0),t,!0)}function Ke(e,t){return void 0===t&&(t=[]),e.forEach((function(e){if(e.innerBlocks.length)return Ke(e.innerBlocks,t);t.push(e)})),t}function Ze(e,t,n,r){return void 0===n&&(n={}),void 0===r&&(r=0),e.forEach((function(e,i){var s,o=r+i;if(null===(s=e.innerBlocks)||void 0===s?void 0:s.length)Ze(e.innerBlocks,t,n,o);else if(e.originalContent){var a=(0,Re.getBlockContent)(e),l=(new DOMParser).parseFromString(a,"text/html").body.firstChild;if(l instanceof HTMLElement){var c=l.textContent;t.forEach((function(t){var r=function(e,t){for(var n,r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(n){var r;if(!n.textContent||!n.textContent.includes(t))return NodeFilter.FILTER_REJECT;for(var i=n.parentNode;i&&i!==e;){if("A"===i.nodeName&&!(null===(r=i.textContent)||void 0===r?void 0:r.includes(t)))return NodeFilter.FILTER_REJECT;i=i.parentNode}return NodeFilter.FILTER_ACCEPT}}),i=[];n=r.nextNode();)i.push(n);return i}(l,t.text),i="".concat(t.text,"#").concat(t.offset);n[i]=n[i]||{encountered:0,linked:0};var s=0,a=0;r.forEach((function(r){for(var l,u,p,d=new RegExp(Oe(t.text),"g"),f=null!==(l=r.textContent)&&void 0!==l?l:"",h=null!==(u=null==c?void 0:c.indexOf(f,s))&&void 0!==u?u:0;null!==(p=d.exec(f));){var v=n[i];if(v.encountered++,a++,v.encountered-1===t.offset&&v.linked<1){if(v.linked++,!on.includes(e.name))return void console.warn("PCH Smart Linking: Skipping non-allowed block (".concat(e.name,"):"),t.text);if(ze(r))return void console.warn("PCH Smart Linking: Skipping heading or caption:",t.text);t.match={blockId:e.clientId,blockOffset:a-1,blockPosition:o,blockLinkPosition:h+p.index}}}s+=f.length}))}))}}})),t}function We(){var e=Ke((0,v.select)("core/block-editor").getBlocks()),t=(0,v.select)("core/editor").getEditedPostContent(),n=(new DOMParser).parseFromString(t,"text/html"),r=Array.from(n.querySelectorAll("a[data-smartlink]")),i=[];return r.forEach((function(t){var r,s,o,a=null!==(r=t.getAttribute("data-smartlink"))&&void 0!==r?r:"",l=t.href,c=null!==(s=t.textContent)&&void 0!==s?s:"",u=t.title,p=e.find((function(e){return(0,Re.getBlockContent)(e).includes(a)}));if(p){var d=e.indexOf(p),f={uid:a,href:l,text:c,title:u,applied:!0,offset:Ye(t,n),match:{blockId:null!==(o=null==p?void 0:p.clientId)&&void 0!==o?o:"",blockPosition:d,blockOffset:-1,blockLinkPosition:-1}};i.push(f)}})),Ze(e,i)}function Ye(e,t){var n,r,i=e.dataset.smartlink,s=null===(n=e.textContent)||void 0===n?void 0:n.trim();if(!i)return-1;if(!s)return-1;for(var o=0,a=t.createTreeWalker(t.body,NodeFilter.SHOW_TEXT);a.nextNode();)for(var l=a.currentNode,c=null!==(r=l.nodeValue)&&void 0!==r?r:"",u=c.indexOf(s);-1!==u;){if(He(l,i))return o;u=c.indexOf(s,u+s.length),o++}return-1}function $e(e){return De(this,arguments,void 0,(function(e,t){var n,r,i,s,o,a,l,c,u,p;return void 0===t&&(t=!1),Fe(this,(function(d){for(n=(0,v.select)(it).getSmartLinks(),t&&(n=n.filter((function(e){var n;return(null===(n=e.match)||void 0===n?void 0:n.blockId)===t}))),r=new DOMParser,i=r.parseFromString(e,"text/html"),s=[],n.forEach((function(e){i.querySelector('a[data-smartlink="'.concat(e.uid,'"]'))||s.push(e)})),o=!1,a=function(e){var t=s[e];if(!(null===(u=t.match)||void 0===u?void 0:u.blockId))return l=e,"continue";var n=(0,v.select)("core/block-editor").getBlock(null===(p=t.match)||void 0===p?void 0:p.blockId);if(!n)return l=e,"continue";var r=(0,Re.getBlockContent)(n),i=(new DOMParser).parseFromString(r,"text/html"),a=Array.from(i.querySelectorAll("a")).find((function(e){return e.textContent===t.text&&e.href===t.href&&!e.hasAttribute("data-smartlink")}));if(!a)return l=e,"continue";s.splice(e--,1),a.setAttribute("data-smartlink",t.uid),a.title=t.title;var c=i.body.firstChild;Z.updateBlockAttributes(n.clientId,{content:c.innerHTML}),o=!0,l=e},c=0;c<s.length;c++)a(c),c=l;return[2,{missingSmartLinks:s,didAnyFixes:o}]}))}))}function Je(){return De(this,void 0,void 0,(function(){var e,t,n;return Fe(this,(function(r){switch(r.label){case 0:return[4,$e((0,v.select)("core/editor").getEditedPostContent())];case 1:return e=r.sent(),t=e.missingSmartLinks,n=e.didAnyFixes,t.forEach((function(e){(0,v.dispatch)(it).removeSmartLink(e.uid)})),[2,n]}}))}))}var Xe,Qe,et=function(e,t){var n=e.querySelector('a[data-smartlink="'.concat(t,'"]'));if(n){n.focus();var r=e.ownerDocument,i=r.createRange();if(n.firstChild){i.setStart(n.firstChild,0),i.setEndAfter(n.firstChild);var s=r.getSelection();s&&(s.removeAllRanges(),s.addRange(i))}n.scrollIntoView({behavior:"smooth",block:"center"})}},tt=function(){return tt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},tt.apply(this,arguments)},nt=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};!function(e){e.All="all",e.Selected="selected"}(Xe||(Xe={})),function(e){e.Inbound="inbound",e.Outbound="outbound"}(Qe||(Qe={}));var rt={isReady:!1,isLoading:!1,applyTo:null,fullContent:!1,smartLinks:{inbound:[],outbound:[]},error:null,settings:{},overlayBlocks:[],wasAlreadyClicked:!1,isRetrying:!1,isReviewModalOpen:!1,retryAttempt:0},it=(0,v.createReduxStore)("wp-parsely/smart-linking",{initialState:rt,reducer:function(e,t){var n,r,i,s;switch(void 0===e&&(e=rt),t.type){case"SET_IS_READY":return tt(tt({},e),{isReady:t.isReady});case"SET_LOADING":return tt(tt({},e),{isLoading:t.isLoading});case"SET_OVERLAY_BLOCKS":return tt(tt({},e),{overlayBlocks:t.overlayBlocks});case"SET_ERROR":return tt(tt({},e),{error:t.error});case"ADD_OVERLAY_BLOCK":return tt(tt({},e),{overlayBlocks:nt(nt([],e.overlayBlocks,!0),[t.block],!1)});case"REMOVE_OVERLAY_BLOCK":return"all"===t.block?tt(tt({},e),{overlayBlocks:[]}):tt(tt({},e),{overlayBlocks:e.overlayBlocks.filter((function(e){return e!==t.block}))});case"SET_FULL_CONTENT":return tt(tt({},e),{fullContent:t.fullContent});case"SET_SETTINGS":return tt(tt({},e),{settings:tt(tt({},e.settings),t.settings)});case"SET_WAS_ALREADY_CLICKED":return tt(tt({},e),{wasAlreadyClicked:t.wasAlreadyClicked});case"SET_APPLY_TO":return tt(tt({},e),{applyTo:t.applyTo});case"SET_IS_RETRYING":return tt(tt({},e),{isRetrying:t.isRetrying,retryAttempt:t.isRetrying===e.isRetrying?e.retryAttempt:0});case"INCREMENT_RETRY_ATTEMPT":return tt(tt({},e),{retryAttempt:e.retryAttempt+1});case"SET_SMART_LINKS":return tt(tt({},e),{smartLinks:tt(tt({},e.smartLinks),(n={},n[t.smartLinkType]=qe(t.smartLinks),n))});case"ADD_SMART_LINK":var o=e.smartLinks[t.smartLinkType],a=o.findIndex((function(e){return e.uid===t.smartLink.uid}));if(-1!==a){var l=nt([],o,!0);return l[a]=t.smartLink,tt(tt({},e),{smartLinks:tt(tt({},e.smartLinks),(r={},r[t.smartLinkType]=qe(l),r))})}return tt(tt({},e),{smartLinks:tt(tt({},e.smartLinks),(i={},i[t.smartLinkType]=qe(nt(nt([],o,!0),[t.smartLink],!1)),i))});case"ADD_SMART_LINKS":var c=e.smartLinks[t.smartLinkType],u=nt([],c,!0);return t.smartLinks.forEach((function(e){var t=c.findIndex((function(t){return t.uid===e.uid}));-1!==t?u[t]=tt(tt({},u[t]),e):u.push(e)})),tt(tt({},e),{smartLinks:tt(tt({},e.smartLinks),(s={},s[t.smartLinkType]=qe(u),s))});case"REMOVE_SMART_LINK":return tt(tt({},e),{smartLinks:tt(tt({},e.smartLinks),{outbound:qe(e.smartLinks.outbound.filter((function(e){return e.uid!==t.uid})))})});case"PURGE_SMART_LINKS_SUGGESTIONS":return tt(tt({},e),{smartLinks:tt(tt({},e.smartLinks),{outbound:e.smartLinks.outbound.filter((function(e){return e.applied}))})});case"SET_IS_REVIEW_MODAL_OPEN":return tt(tt({},e),{isReviewModalOpen:t.isReviewModalOpen});default:return e}},actions:{setIsReady:function(e){return{type:"SET_IS_READY",isReady:e}},setLoading:function(e){return{type:"SET_LOADING",isLoading:e}},setOverlayBlocks:function(e){return{type:"SET_OVERLAY_BLOCKS",overlayBlocks:e}},setError:function(e){return{type:"SET_ERROR",error:e}},addOverlayBlock:function(e){return{type:"ADD_OVERLAY_BLOCK",block:e}},removeOverlayBlock:function(e){return{type:"REMOVE_OVERLAY_BLOCK",block:e}},setFullContent:function(e){return{type:"SET_FULL_CONTENT",fullContent:e}},setSmartLinkingSettings:function(e){return{type:"SET_SETTINGS",settings:e}},setMaxLinks:function(e){return{type:"SET_SETTINGS",settings:{maxLinksPerPost:e}}},setAlreadyClicked:function(e){return{type:"SET_WAS_ALREADY_CLICKED",wasAlreadyClicked:e}},setApplyTo:function(e){return{type:"SET_APPLY_TO",applyTo:e}},setIsRetrying:function(e){return{type:"SET_IS_RETRYING",isRetrying:e}},incrementRetryAttempt:function(){return{type:"INCREMENT_RETRY_ATTEMPT"}},setSmartLinks:function(e){return{type:"SET_SMART_LINKS",smartLinks:e,smartLinkType:Qe.Outbound}},setInboundSmartLinks:function(e){return{type:"SET_SMART_LINKS",smartLinks:e,smartLinkType:Qe.Inbound}},addSmartLink:function(e){return{type:"ADD_SMART_LINK",smartLink:e,smartLinkType:Qe.Outbound}},addInboundSmartLink:function(e){return{type:"ADD_SMART_LINK",smartLink:e,smartLinkType:Qe.Inbound}},updateSmartLink:function(e){return{type:"ADD_SMART_LINK",smartLink:e,smartLinkType:Qe.Outbound}},updateInboundSmartLink:function(e){return{type:"ADD_SMART_LINK",smartLink:e,smartLinkType:Qe.Inbound}},addSmartLinks:function(e,t){return void 0===t&&(t=Qe.Outbound),t===Qe.Inbound?{type:"ADD_SMART_LINKS",smartLinks:e,smartLinkType:Qe.Inbound}:{type:"ADD_SMART_LINKS",smartLinks:e,smartLinkType:Qe.Outbound}},addInboundSmartLinks:function(e){return{type:"ADD_SMART_LINKS",smartLinks:e,smartLinkType:Qe.Inbound}},removeSmartLink:function(e){return{type:"REMOVE_SMART_LINK",uid:e}},purgeSmartLinksSuggestions:function(){return{type:"PURGE_SMART_LINKS_SUGGESTIONS"}},setIsReviewModalOpen:function(e){return{type:"SET_IS_REVIEW_MODAL_OPEN",isReviewModalOpen:e}}},selectors:{isReady:function(e){return e.isReady},isLoading:function(e){return e.isLoading},isFullContent:function(e){return e.fullContent},isReviewModalOpen:function(e){return e.isReviewModalOpen},getApplyTo:function(e){return e.applyTo},getError:function(e){return e.error},getSmartLinkingSettings:function(e){return e.settings},getOverlayBlocks:function(e){return e.overlayBlocks},getMaxLinks:function(e){var t;return null!==(t=e.settings.maxLinksPerPost)&&void 0!==t?t:sn},getSuggestedLinks:function(e){return e.smartLinks.outbound.filter((function(e){return!e.applied}))},wasAlreadyClicked:function(e){return e.wasAlreadyClicked},isRetrying:function(e){return e.isRetrying},getRetryAttempt:function(e){return e.retryAttempt},hasUnappliedLinks:function(e){return e.smartLinks.outbound.some((function(e){return!e.applied}))},getSmartLinks:function(e,t){return void 0===t&&(t=Qe.Outbound),t===Qe.Inbound?e.smartLinks.inbound:e.smartLinks.outbound},getOutboundSmartLinks:function(e){return e.smartLinks.outbound},getInboundSmartLinks:function(e){return e.smartLinks.inbound}}});(0,v.register)(it);var st=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))},ot=function(e,t){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},at=function(e){var t,n=e.disabled,r=void 0!==n&&n,i=e.selectedBlock,s=e.onSettingChange,o=(0,m.useRef)(),a=(0,m.useState)(""),l=a[0],c=a[1],u=(0,m.useState)(!1),p=u[0],d=u[1],g=(0,m.useState)(!1)[1],y=null==i?void 0:i.clientId,b=(0,v.useSelect)((function(e){var t=e(it),n=t.getMaxLinks,r=t.isFullContent,i=t.wasAlreadyClicked,s=t.getApplyTo;return{maxLinks:n(),fullContent:r(),alreadyClicked:i(),applyTo:s()}}),[]),x=b.maxLinks,_=b.fullContent,k=b.alreadyClicked,S=b.applyTo,j=(0,v.useDispatch)(it),P=j.setMaxLinks,T=j.setFullContent,E=j.setAlreadyClicked,L=j.setApplyTo,N=(0,m.useState)(null!==(t=S)&&void 0!==t?t:y?"selected":"all"),C=N[0],O=N[1];return(0,m.useEffect)((function(){var e;"selected"===C&&(null==i?void 0:i.name)&&!on.includes(i.name)?O("all"):O(null!==(e=S)&&void 0!==e?e:y?"selected":"all")}),[S,null==i?void 0:i.name,y]),(0,m.useEffect)((function(){var e,t;if(!r){var n=function(e){return st(void 0,void 0,void 0,(function(){return ot(this,(function(t){switch(t.label){case 0:return r?[2]:p?[4,new Promise((function(e){return setTimeout(e,500)}))]:[3,2];case 1:t.sent(),t.label=2;case 2:return S===Xe.Selected&&setTimeout((function(){c(e)}),100),L(null),O("all"),g((function(e){return!e})),[2]}}))}))};if(i||S===Xe.All||n((0,w.__)("Select a block to apply Smart Links.","wp-parsely")),i&&S!==Xe.All&&!on.includes(i.name)){var s=null!==(t=null===(e=(0,Re.getBlockType)(i.name))||void 0===e?void 0:e.title)&&void 0!==t?t:i.name;
/* translators: %s: block name */n((0,w.sprintf)((0,w.__)("%s blocks are not supported for Smart Links.","wp-parsely"),s))}T(Xe.All===C)}}),[p,S,C,r,i,y,L,T,c]),(0,m.useEffect)((function(){if(!r&&o.current&&C&&!k&&y){var e=o.current.querySelector('button[data-value="'.concat(C,'"]'));e&&"true"!==e.getAttribute("aria-checked")&&(L(C),E(!0))}}),[y,_,r,S]),(0,m.useEffect)((function(){c(null)}),[y]),(0,f.jsx)("div",{className:"parsely-panel-settings",children:(0,f.jsxs)("div",{className:"parsely-panel-settings-body",children:[(0,f.jsxs)("div",{className:"smart-linking-block-select",children:[(0,f.jsx)(h.Disabled,{isDisabled:r,children:(0,f.jsxs)(h.__experimentalToggleGroupControl,{ref:o,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,isBlock:!0,value:C,label:(0,w.__)("Apply Smart Links to","wp-parsely"),onChange:function(e){return st(void 0,void 0,void 0,(function(){return ot(this,(function(t){switch(t.label){case 0:return r?[2]:(d(!0),[4,T(Xe.All===e)]);case 1:return t.sent(),[4,L(e)];case 2:return t.sent(),setTimeout((function(){d(!1)}),500),[2]}}))}))},children:[(0,f.jsx)(h.__experimentalToggleGroupControlOption,{label:(0,w.__)("Selected Block","wp-parsely"),value:"selected"}),(0,f.jsx)(h.__experimentalToggleGroupControlOption,{label:(0,w.__)("All Blocks","wp-parsely"),value:"all"})]})}),l&&(0,f.jsxs)("div",{className:"wp-parsely-smart-linking-hint",children:[(0,f.jsx)("strong",{children:(0,w.__)("Hint:","wp-parsely")})," ",l]})]}),(0,f.jsx)("div",{className:"smart-linking-settings",children:(0,f.jsx)(Me,{value:x,onChange:function(e){P(null!=e?e:1),s("MaxLinks",null!=e?e:sn)},label:(0,w.__)("Target Number of Links","wp-parsely"),suffix:(0,w.__)("Links","wp-parsely"),min:1,max:20,initialPosition:x,disabled:r})})]})})},lt={month:"short",day:"numeric",year:"numeric"},ct={month:"short",day:"numeric"},ut=(0,w.__)("Date N/A","wp-parsely");function pt(e){return{period_start:e,period_end:""}}var dt=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ft=function(){return ft=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},ft.apply(this,arguments)},ht=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))},vt=function(e,t){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},gt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return dt(t,e),t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.fetchSmartLinksExtraData=function(e){return ht(this,void 0,void 0,(function(){var t,n,r,i;return vt(this,(function(s){switch(s.label){case 0:return[4,Promise.all([this.fetch({path:(0,we.addQueryArgs)("/wp-parsely/v2/stats/posts",ft(ft({},pt(R.Days30)),{limit:e.length,sort:B.AvgEngaged,urls:e.map((function(e){return e.href}))}))}),this.getPostMetaForURLs(e.map((function(e){return e.href})))])];case 1:return t=s.sent(),n=t[0],r=t[1],i=e.map((function(e){var t,i,s,o,a=r.find((function(t){return t.url===e.href})),l=n.find((function(t){return t.url===e.href}));if(void 0===a&&void 0===l)return console.warn("PCH Smart Linking: Skipping potentially nonexistent URL: ".concat(e.href)),null;var c={wp_post_meta:{author:null!==(t=null==a?void 0:a.author)&&void 0!==t?t:null==l?void 0:l.author,date:null!==(i=null==a?void 0:a.date)&&void 0!==i?i:null==l?void 0:l.date,thumbnail:null==a?void 0:a.thumbnail,title:null!==(s=null==a?void 0:a.title)&&void 0!==s?s:null==l?void 0:l.title,url:null!==(o=null==a?void 0:a.url)&&void 0!==o?o:null==l?void 0:l.url,type:null==a?void 0:a.type}};return void 0!==l&&(c.post_stats={avg_engaged:null==l?void 0:l.avgEngaged,views:null==l?void 0:l.views,visitors:null==l?void 0:l.visitors}),ft(ft({},e),c)})).filter((function(e){return null!==e})),[2,i]}}))}))},t.prototype.generateSmartLinks=function(e){return ht(this,arguments,void 0,(function(e,t,n){var r;return void 0===t&&(t=sn),void 0===n&&(n=[]),vt(this,(function(i){switch(i.label){case 0:return[4,this.fetch({method:"POST",path:(0,we.addQueryArgs)("/wp-parsely/v2/content-helper/smart-linking/generate",{max_links:t}),data:{url_exclusion_list:n,text:e}})];case 1:return r=i.sent(),[4,this.fetchSmartLinksExtraData(r)];case 2:return[2,i.sent()]}}))}))},t.prototype.addSmartLink=function(e,t){return ht(this,void 0,void 0,(function(){return vt(this,(function(n){switch(n.label){case 0:return[4,this.fetch({method:"POST",path:"/wp-parsely/v2/content-helper/smart-linking/".concat(e,"/add"),data:{link:t}})];case 1:return[2,n.sent()]}}))}))},t.prototype.addSmartLinks=function(e,t){return ht(this,void 0,void 0,(function(){return vt(this,(function(n){switch(n.label){case 0:if(0===e)throw new te((0,w.__)("Invalid post ID.","wp-parsely"),U.PostIsNotPublished);return[4,this.fetch({method:"POST",path:"/wp-parsely/v2/content-helper/smart-linking/".concat(e,"/add-multiple"),data:{links:t}})];case 1:return[2,n.sent()]}}))}))},t.prototype.setSmartLinks=function(e,t){return ht(this,void 0,void 0,(function(){var n;return vt(this,(function(r){switch(r.label){case 0:if(0===e)throw new te((0,w.__)("Invalid post ID.","wp-parsely"),U.PostIsNotPublished);return n=t.filter((function(e){return e.applied})),[4,this.fetch({method:"POST",path:"/wp-parsely/v2/content-helper/smart-linking/".concat(e,"/set"),data:{links:n}})];case 1:return[2,r.sent()]}}))}))},t.prototype.getSmartLinks=function(e){return ht(this,void 0,void 0,(function(){var t;return vt(this,(function(n){switch(n.label){case 0:return[4,this.fetch({method:"GET",path:"/wp-parsely/v2/content-helper/smart-linking/".concat(e,"/get")})];case 1:return t=n.sent(),[4,this.fetchSmartLinksExtraData(t.outbound)];case 2:return[2,{outbound:n.sent(),inbound:t.inbound}]}}))}))},t.prototype.getPostMetaForURLs=function(e){return ht(this,void 0,void 0,(function(){return vt(this,(function(t){switch(t.label){case 0:return[4,this.fetch({method:"POST",path:"/wp-parsely/v2/content-helper/smart-linking/get-post-meta-for-urls",data:{urls:e}})];case 1:return[2,t.sent()]}}))}))},t}(be),yt=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))},mt=function(e,t){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},wt=(0,f.jsxs)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:[(0,f.jsx)(b.Path,{d:"M15.5 7.5h-7V9h7V7.5Zm-7 3.5h7v1.5h-7V11Zm7 3.5h-7V16h7v-1.5Z"}),(0,f.jsx)(b.Path,{d:"M17 4H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2ZM7 5.5h10a.5.5 0 0 1 .5.5v12a.5.5 0 0 1-.5.5H7a.5.5 0 0 1-.5-.5V6a.5.5 0 0 1 .5-.5Z"})]}),bt=(0,f.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,f.jsx)(b.Path,{d:"M20 11.2H6.8l3.7-3.7-1-1L3.9 12l5.6 5.5 1-1-3.7-3.7H20z"})}),xt=(0,f.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,f.jsx)(b.Path,{d:"m14.5 6.5-1 1 3.7 3.7H4v1.6h13.2l-3.7 3.7 1 1 5.6-5.5z"})}),_t=function(){return _t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},_t.apply(this,arguments)},kt=function(e){var t=e.styles,n=(0,m.useState)([]),r=n[0],i=n[1];return(0,m.useEffect)((function(){var e;e=t.filter((function(e){return("theme"===e.__unstableType||"user"===e.__unstableType)&&e.css})).map((function(e){var t,n,r,i,s=(n=null!==(t=e.css)&&void 0!==t?t:"",r=".wp-parsely-preview-editor",i=n.split("}").map((function(e){if(!e.trim())return"";var t=e.split("{"),n=t[0],i=t[1];if(!i)return e;var s=n.split(",").map((function(e){var t=e.trim();return t?"body"===t?r:"".concat(r," ").concat(t):""})).join(", ");return"".concat(s," {").concat(i,"}")})),i.join(" "));return _t(_t({},e),{css:s})})),i(e)}),[t]),(0,f.jsx)(f.Fragment,{children:r.map((function(e,t){return(0,f.jsx)("style",{children:e.css},t)}))})},St=function(e){var t=e.block,n=e.link,r=e.useOriginalBlock,i=(0,m.useMemo)((function(){return r?t:(0,Re.cloneBlock)(t)}),[n,t,r]),s=(0,m.useCallback)((function(e,t){if(!n.applied){var r=document.createElement("mark");return r.className="smart-linking-highlight",void(e.attributes.content=Ue(e,t,r))}var i=(0,Re.getBlockContent)(e),s=(new DOMParser).parseFromString(i,"text/html").body.firstChild;if(s){var o=s.querySelector('a[data-smartlink="'.concat(t.uid,'"]'));o&&o.classList.add("smart-linking-highlight"),e.attributes.content=s.innerHTML}}),[n.applied]);if((0,m.useEffect)((function(){var e=document.querySelector(".wp-parsely-preview-editor");if(e){s(i,n);var t=new MutationObserver((function(e){e.forEach((function(e){"childList"===e.type&&(t.disconnect(),e.addedNodes.forEach((function(e){if(e instanceof HTMLElement){var t=document.querySelector('.wp-parsely-preview-editor [data-block="'.concat(i.clientId,'"]'));t&&t.setAttribute("contenteditable","false")}})),t.observe(document.body,{childList:!0,subtree:!0}))}))}));return t.observe(e,{childList:!0,subtree:!0}),function(){return t.disconnect()}}}),[i,s,n]),!t)return(0,f.jsx)(f.Fragment,{});var o=(0,v.select)("core/block-editor").getSettings();return(0,f.jsx)("div",{className:"wp-parsely-preview-editor",children:(0,f.jsx)(h.Disabled,{className:"wp-block-post-content editor-styles-wrapper",children:(0,f.jsxs)(Ce.BlockEditorProvider,{value:[i],settings:_t(_t({},o),{__unstableIsPreviewMode:!0,templateLock:"all"}),children:[(0,f.jsx)(kt,{styles:o.styles}),(0,f.jsx)(Ce.BlockList,{})]})})})},jt=function(e){var t=e.topOrBottom;return(0,f.jsx)("div",{className:"three-dots ".concat("top"===t?"is-top":"is-bottom"),children:"( … )"})},Pt=function(e){var t,n,r,i,s,o,a=e.link;return(0,f.jsxs)("div",{className:"linking-post-details",children:[(0,f.jsx)("div",{className:"linking-post-image",children:(null===(t=a.post_data)||void 0===t?void 0:t.image)?(0,f.jsx)("img",{className:"linking-post-image",src:a.post_data.image,alt:a.post_data.title,width:64}):(0,f.jsx)("div",{className:"icon-container",children:(0,f.jsx)(ie,{icon:wt,size:24})})}),(0,f.jsxs)("div",{className:"linking-post-info",children:[(0,f.jsx)("div",{className:"linking-post-title",children:(0,f.jsx)("a",{href:null===(n=a.post_data)||void 0===n?void 0:n.permalink,target:"_blank",rel:"noreferrer",children:null===(r=a.post_data)||void 0===r?void 0:r.title})}),(0,f.jsxs)("div",{className:"linking-post-meta",children:[null===(i=a.post_data)||void 0===i?void 0:i.date," by ",null===(s=a.post_data)||void 0===s?void 0:s.author]})]}),(0,f.jsx)("div",{className:"linking-post-type",children:null===(o=a.post_data)||void 0===o?void 0:o.type})]})},Tt=function(e){var t,n,r,i,s=e.link,o=e.onPrevious,a=e.onNext,l=e.hasPrevious,c=e.hasNext,u=(0,m.useState)([]),p=u[0],d=u[1];return(0,m.useEffect)((function(){var e,t=null===(e=s.post_data)||void 0===e?void 0:e.paragraph,n="\x3c!-- wp:paragraph --\x3e\n".concat(null!=t?t:"<p></p>","\n\x3c!-- /wp:paragraph --\x3e");t&&d((0,Re.parse)(n))}),[s]),(0,f.jsxs)("div",{className:"smart-linking-review-suggestion",children:[(0,f.jsx)(h.KeyboardShortcuts,{shortcuts:{left:o,right:a,up:o,down:a}}),(0,f.jsx)("div",{className:"review-suggestion-post-title",children:null===(t=s.post_data)||void 0===t?void 0:t.title}),(0,f.jsxs)("div",{className:"review-suggestion-preview",children:[!(null===(n=s.post_data)||void 0===n?void 0:n.is_first_paragraph)&&(0,f.jsx)(jt,{topOrBottom:"top"}),(0,f.jsx)(St,{block:p[0],link:s,useOriginalBlock:!0}),!(null===(r=s.post_data)||void 0===r?void 0:r.is_last_paragraph)&&(0,f.jsx)(jt,{topOrBottom:"bottom"})]}),(0,f.jsx)(h.__experimentalDivider,{}),(0,f.jsx)(Pt,{link:s}),(0,f.jsxs)("div",{className:"review-controls",children:[(0,f.jsx)(h.Tooltip,{shortcut:"←",text:(0,w.__)("Previous","wp-parsely"),children:(0,f.jsx)(h.Button,{disabled:!l,className:"wp-parsely-review-suggestion-previous",onClick:o,icon:bt,children:(0,w.__)("Previous","wp-parsely")})}),(0,f.jsx)("div",{className:"reviews-controls-middle",children:(0,f.jsx)(h.Button,{target:"_blank",href:(null===(i=s.post_data)||void 0===i?void 0:i.edit_link)+"&smart-link="+s.uid,variant:"secondary",onClick:function(){k.trackEvent("smart_linking_open_in_editor_pressed",{type:"inbound",uid:s.uid})},children:(0,w.__)("Open in the Editor","wp-parsely")})}),(0,f.jsx)(h.Tooltip,{shortcut:"→",text:(0,w.__)("Next","wp-parsely"),children:(0,f.jsxs)(h.Button,{disabled:!c,onClick:a,className:"wp-parsely-review-suggestion-next",children:[(0,w.__)("Next","wp-parsely"),(0,f.jsx)(ie,{icon:xt})]})})]})]})},Et=function(e){var t=e.size,n=void 0===t?24:t,r=e.className,i=void 0===r?"wp-parsely-icon":r;return(0,f.jsxs)(h.SVG,{xmlns:"http://www.w3.org/2000/svg",className:i,width:n,height:n,viewBox:"0 0 24 24",fill:"none",children:[(0,f.jsx)(h.Path,{d:"M8.18983 5.90381L8.83642 7.54325L10.4758 8.18983L8.83642 8.8364L8.18983 10.4759L7.54324 8.8364L5.90381 8.18983L7.54324 7.54325L8.18983 5.90381Z"}),(0,f.jsx)(h.Path,{d:"M15.048 5.90381L15.9101 8.08972L18.0961 8.95186L15.9101 9.81397L15.048 11.9999L14.1859 9.81397L12 8.95186L14.1859 8.08972L15.048 5.90381Z"}),(0,f.jsx)(h.Path,{d:"M11.238 10.4761L12.3157 13.2085L15.048 14.2861L12.3157 15.3638L11.238 18.0962L10.1603 15.3638L7.42798 14.2861L10.1603 13.2085L11.238 10.4761Z"})]})},Lt=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},Nt=function(e){var t=e.activeLink,n=e.outboundLinks,r=e.inboundLinks,i=e.setSelectedLink,s=(0,m.useRef)(null),o=(0,m.useRef)([]),a=(0,m.useState)([]),l=a[0],c=a[1];(0,m.useEffect)((function(){n&&r&&c(Lt(Lt([],n,!0),r,!0))}),[r,n]),(0,m.useEffect)((function(){if(t){var e=null==l?void 0:l.findIndex((function(e){return e.uid===t.uid}));if(void 0!==e&&-1!==e&&s.current&&o.current[e]){var n=s.current,r=o.current[e];if(r){if(r.focus(),0===e)return void(n.scrollTop=0);var i=n.getBoundingClientRect(),a=r.getBoundingClientRect();(a.top<i.top||a.bottom>i.bottom)&&(n.scrollTop=r.offsetTop-n.offsetTop)}}}}),[t,l]);var u=function(){var e=document.querySelector(".smart-linking-review-sidebar-tabs [data-active-item]"),t=null==e?void 0:e.nextElementSibling;t||(t=document.querySelector('.smart-linking-review-sidebar-tabs [role="tab"]')),t&&t.click()},p=(0,f.jsxs)("span",{className:"smart-linking-menu-label",children:[(0,w.__)("NEW","wp-parsely"),(0,f.jsx)(Et,{})]}),d=[];n&&n.length>0&&d.push({name:"outbound",title:(0,w.__)("Outbound","wp-parsely")}),r&&r.length>0&&d.push({name:"inbound",title:(0,w.__)("Inbound","wp-parsely")});var v="outbound";return d=d.filter((function(e){return"outbound"===e.name&&r&&0===r.length&&(e.title=(0,w.__)("Outbound Smart Links","wp-parsely"),v="outbound"),"inbound"===e.name&&n&&0===n.length&&(e.title=(0,w.__)("Inbound Smart Links","wp-parsely"),v="inbound"),e})),(0,f.jsxs)("div",{className:"smart-linking-review-sidebar",ref:s,children:[(0,f.jsx)(h.KeyboardShortcuts,{shortcuts:{tab:function(){return u()},"shift+tab":function(){return u()}}}),(0,f.jsx)(h.TabPanel,{className:"smart-linking-review-sidebar-tabs",initialTabName:v,tabs:d,onSelect:function(e){var t,s;"outbound"===e&&n&&n.length>0&&i(n[0]),"inbound"===e&&r&&r.length>0&&i(r[0]),k.trackEvent("smart_linking_modal_tab_selected",{tab:e,total_inbound:null!==(t=null==r?void 0:r.length)&&void 0!==t?t:0,total_outbound:null!==(s=null==n?void 0:n.length)&&void 0!==s?s:0})},children:function(e){return(0,f.jsxs)(f.Fragment,{children:["outbound"===e.name&&(0,f.jsx)(f.Fragment,{children:n&&0!==n.length?n.map((function(e,n){return(0,f.jsxs)(h.MenuItem,{ref:function(e){o.current[n]=e},className:(null==t?void 0:t.uid)===e.uid?"is-selected":"",role:"menuitemradio",isSelected:(null==t?void 0:t.uid)===e.uid,onClick:function(){return i(e)},children:[(0,f.jsx)("span",{className:"smart-linking-menu-item",children:e.text}),!e.applied&&p]},e.uid)})):(0,f.jsxs)(f.Fragment,{children:[" ",(0,w.__)("No outbound links found.","wp-parsely")]})}),"inbound"===e.name&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"review-sidebar-tip",children:(0,w.__)("This section shows external posts that link back to the current post.","wp-parsely")}),r&&0!==r.length?r.map((function(e,r){var s;return(0,f.jsx)(h.MenuItem,{ref:function(e){o.current[(n?n.length:0)+r]=e},className:(null==t?void 0:t.uid)===e.uid?"is-selected":"",role:"menuitemradio",isSelected:(null==t?void 0:t.uid)===e.uid,onClick:function(){return i(e)},children:(0,f.jsx)("span",{className:"smart-linking-menu-item",children:null===(s=e.post_data)||void 0===s?void 0:s.title})},e.uid)})):(0,f.jsxs)(f.Fragment,{children:[" ",(0,w.__)("No inbound links found.","wp-parsely")]})]})]})}})]})},Ct=(0,f.jsx)(b.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,f.jsx)(b.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm.5 16c0 .3-.2.5-.5.5H5c-.3 0-.5-.2-.5-.5V7h15v12zM9 10H7v2h2v-2zm0 4H7v2h2v-2zm4-4h-2v2h2v-2zm4 0h-2v2h2v-2zm-4 4h-2v2h2v-2zm4 0h-2v2h2v-2z"})}),Ot=(0,f.jsx)(b.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,f.jsx)(b.Path,{d:"M10 4.5a1 1 0 11-2 0 1 1 0 012 0zm1.5 0a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zm2.25 7.5v-1A2.75 2.75 0 0011 8.25H7A2.75 2.75 0 004.25 11v1h1.5v-1c0-.69.56-1.25 1.25-1.25h4c.69 0 1.25.56 1.25 1.25v1h1.5zM4 20h9v-1.5H4V20zm16-4H4v-1.5h16V16z",fillRule:"evenodd",clipRule:"evenodd"})}),At=(0,f.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,f.jsx)(b.Path,{d:"m7.3 9.7 1.4 1.4c.2-.2.3-.3.4-.5 0 0 0-.1.1-.1.3-.5.4-1.1.3-1.6L12 7 9 4 7.2 6.5c-.6-.1-1.1 0-1.6.3 0 0-.1 0-.1.1-.3.1-.4.2-.6.4l1.4 1.4L4 11v1h1l2.3-2.3zM4 20h9v-1.5H4V20zm0-5.5V16h16v-1.5H4z"})}),It=(0,f.jsx)(b.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,f.jsx)(b.Path,{d:"M3.99961 13C4.67043 13.3354 4.6703 13.3357 4.67017 13.3359L4.67298 13.3305C4.67621 13.3242 4.68184 13.3135 4.68988 13.2985C4.70595 13.2686 4.7316 13.2218 4.76695 13.1608C4.8377 13.0385 4.94692 12.8592 5.09541 12.6419C5.39312 12.2062 5.84436 11.624 6.45435 11.0431C7.67308 9.88241 9.49719 8.75 11.9996 8.75C14.502 8.75 16.3261 9.88241 17.5449 11.0431C18.1549 11.624 18.6061 12.2062 18.9038 12.6419C19.0523 12.8592 19.1615 13.0385 19.2323 13.1608C19.2676 13.2218 19.2933 13.2686 19.3093 13.2985C19.3174 13.3135 19.323 13.3242 19.3262 13.3305L19.3291 13.3359C19.3289 13.3357 19.3288 13.3354 19.9996 13C20.6704 12.6646 20.6703 12.6643 20.6701 12.664L20.6697 12.6632L20.6688 12.6614L20.6662 12.6563L20.6583 12.6408C20.6517 12.6282 20.6427 12.6108 20.631 12.5892C20.6078 12.5459 20.5744 12.4852 20.5306 12.4096C20.4432 12.2584 20.3141 12.0471 20.1423 11.7956C19.7994 11.2938 19.2819 10.626 18.5794 9.9569C17.1731 8.61759 14.9972 7.25 11.9996 7.25C9.00203 7.25 6.82614 8.61759 5.41987 9.9569C4.71736 10.626 4.19984 11.2938 3.85694 11.7956C3.68511 12.0471 3.55605 12.2584 3.4686 12.4096C3.42484 12.4852 3.39142 12.5459 3.36818 12.5892C3.35656 12.6108 3.34748 12.6282 3.34092 12.6408L3.33297 12.6563L3.33041 12.6614L3.32948 12.6632L3.32911 12.664C3.32894 12.6643 3.32879 12.6646 3.99961 13ZM11.9996 16C13.9326 16 15.4996 14.433 15.4996 12.5C15.4996 10.567 13.9326 9 11.9996 9C10.0666 9 8.49961 10.567 8.49961 12.5C8.49961 14.433 10.0666 16 11.9996 16Z"})}),Rt=(0,f.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,f.jsx)(b.Path,{d:"M15.5 9.5a1 1 0 100-2 1 1 0 000 2zm0 1.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zm-2.25 6v-2a2.75 2.75 0 00-2.75-2.75h-4A2.75 2.75 0 003.75 15v2h1.5v-2c0-.69.56-1.25 1.25-1.25h4c.69 0 1.25.56 1.25 1.25v2h1.5zm7-2v2h-1.5v-2c0-.69-.56-1.25-1.25-1.25H15v-1.5h2.5A2.75 2.75 0 0120.25 15zM9.5 8.5a1 1 0 11-2 0 1 1 0 012 0zm1.5 0a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z",fillRule:"evenodd"})}),Bt=(0,f.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,f.jsx)(b.Path,{d:"M12 13.06l3.712 3.713 1.061-1.06L13.061 12l3.712-3.712-1.06-1.06L12 10.938 8.288 7.227l-1.061 1.06L10.939 12l-3.712 3.712 1.06 1.061L12 13.061z"})}),Mt=(0,f.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,f.jsx)(b.Path,{d:"M16.7 7.1l-6.3 8.5-3.3-2.5-.9 1.2 4.5 3.4L17.9 8z"})}),Dt=function(e){var t,n,r=e.post,i=e.imageUrl,s=e.icon,o=void 0===s?wt:s,a=e.size,l=void 0===a?100:a,c=e.className,u=void 0===c?"":c,p=null!==(t=null==r?void 0:r.thumbnail)&&void 0!==t?t:i,d=null!==(n=null==r?void 0:r.title.rendered)&&void 0!==n?n:"";return(0,f.jsx)("div",{className:"parsely-thumbnail ".concat(u),style:{width:l,height:l},children:p?(0,f.jsx)("img",{src:p,alt:d,width:l,height:l}):(0,f.jsx)("div",{className:"parsely-thumbnail-icon-container",children:(0,f.jsx)(h.Icon,{icon:o,size:l})})})};function Ft(e,t,n){void 0===t&&(t=1),void 0===n&&(n="");var r=parseInt(e.replace(/\D/g,""),10);if(r<1e3)return e;r<1e4&&(t=1);var i=r,s=r.toString(),o="",a=0;return Object.entries({1e3:"k","1,000,000":"M","1,000,000,000":"B","1,000,000,000,000":"T","1,000,000,000,000,000":"Q"}).forEach((function(e){var n=e[0],l=e[1],c=parseInt(n.replace(/\D/g,""),10);if(r>=c){var u=t;(i=r/c)%1>1/a&&(u=i>10?1:2),u=parseFloat(i.toFixed(2))===parseFloat(i.toFixed(0))?0:u,s=i.toFixed(u),o=l}a=c})),s+n+o}var Vt,Gt=function(e){var t,n,r,i,s=null===(t=e.link.match)||void 0===t?void 0:t.blockId,o=(0,v.useSelect)((function(e){var t=e("core/block-editor"),n=t.getBlock,r=t.getBlockParents;return s?{block:n(s),parents:r(s).map((function(e){return n(e)})).filter((function(e){return void 0!==e}))}:{block:void 0,parents:[]}}),[s]),a=o.block,l=o.parents;return a?(0,f.jsxs)("div",{className:"review-suggestions-breadcrumbs",children:[l.map((function(e,t){var n;return(0,f.jsxs)("span",{children:[(0,f.jsx)("span",{className:"breadcrumbs-parent-block",children:null===(n=(0,Re.getBlockType)(e.name))||void 0===n?void 0:n.title}),(0,f.jsx)("span",{className:"breadcrumbs-parent-separator",children:" / "})]},t)})),(0,f.jsxs)("span",{className:"breadcrumbs-current-block",children:[(0,f.jsx)("span",{className:"breadcrumbs-current-block-type",children:null===(n=(0,Re.getBlockType)(a.name))||void 0===n?void 0:n.title}),(null===(i=null===(r=a.attributes)||void 0===r?void 0:r.metadata)||void 0===i?void 0:i.name)&&(0,f.jsx)("span",{className:"breadcrumbs-current-block-name",children:a.attributes.metadata.name})]})]}):(0,f.jsx)(f.Fragment,{})},Ht=function(e){var t,n,r,i,s,o,a,l,c,u,p,d,v,g,y=e.link,m=null!==(n=null===(t=y.wp_post_meta)||void 0===t?void 0:t.author)&&void 0!==n?n:(0,w.__)("N/A","wp-parsely"),b=null!==(i=null===(r=y.post_stats)||void 0===r?void 0:r.avg_engaged)&&void 0!==i?i:(0,w.__)("N/A","wp-parsely"),x=(null===(s=y.wp_post_meta)||void 0===s?void 0:s.date)?function(e){if(!1===function(e){return!isNaN(+e)&&0!==e.getTime()}(e))return ut;var t=lt;return e.getUTCFullYear()===(new Date).getUTCFullYear()&&(t=ct),Intl.DateTimeFormat(document.documentElement.lang||"en",t).format(e)}(new Date(y.wp_post_meta.date)):(0,w.__)("N/A","wp-parsely"),_=null!==(a=null===(o=y.wp_post_meta)||void 0===o?void 0:o.thumbnail)&&void 0!==a&&a,k=null!==(c=null===(l=y.wp_post_meta)||void 0===l?void 0:l.title)&&void 0!==c?c:(0,w.__)("N/A","wp-parsely"),S=null!==(p=null===(u=y.wp_post_meta)||void 0===u?void 0:u.type)&&void 0!==p?p:(0,w.__)("External","wp-parsely"),j=null===(d=y.wp_post_meta)||void 0===d?void 0:d.url,P=(null===(v=y.post_stats)||void 0===v?void 0:v.views)?Ft(y.post_stats.views):(0,w.__)("N/A","wp-parsely"),T=(null===(g=y.post_stats)||void 0===g?void 0:g.visitors)?Ft(y.post_stats.visitors):(0,w.__)("N/A","wp-parsely");return(0,f.jsxs)("div",{className:"wp-parsely-link-suggestion-link-details",children:[(0,f.jsx)("div",{className:"thumbnail-column",children:_?(0,f.jsx)(Dt,{imageUrl:_,size:52}):(0,f.jsx)(Dt,{icon:wt,size:52})}),(0,f.jsxs)("div",{className:"data-column",children:[(0,f.jsxs)("div",{className:"title-row",children:[(0,f.jsx)(h.Tooltip,{text:k,children:(0,f.jsx)("span",{children:k})}),j&&(0,f.jsx)(h.Button,{href:j,target:"_blank",variant:"link",rel:"noopener",children:(0,f.jsx)(ie,{icon:$,size:18})})]}),(0,f.jsxs)("div",{className:"data-row",children:[(0,f.jsxs)("div",{className:"data-point",children:[(0,f.jsx)(ie,{icon:Ct,size:16}),(0,f.jsx)("span",{children:x})]}),(0,f.jsxs)("div",{className:"data-point shrinkable",children:[(0,f.jsx)(ie,{icon:Ot,size:16}),(0,f.jsx)(h.Tooltip,{text:m,children:(0,f.jsx)("span",{children:m})})]}),(0,f.jsxs)("div",{className:"data-point shrinkable",children:[(0,f.jsx)(ie,{icon:At,size:16}),(0,f.jsx)(h.Tooltip,{text:S,children:(0,f.jsx)("span",{children:S})})]})]}),y.post_stats&&(0,f.jsxs)("div",{className:"data-row",children:[P&&(0,f.jsxs)("div",{className:"data-point",children:[(0,f.jsx)(ie,{icon:It,size:16}),(0,f.jsx)("span",{children:P})]}),T&&(0,f.jsxs)("div",{className:"data-point",children:[(0,f.jsx)(ie,{icon:Rt,size:16}),(0,f.jsx)("span",{children:T})]}),b&&(0,f.jsxs)("div",{className:"data-point",children:[(0,f.jsx)(h.Dashicon,{icon:"clock",size:16}),(0,f.jsx)("span",{children:b})]})]})]})]})},zt=function(e){var t=e.link,n=e.onNext,r=e.onPrevious,i=e.onAccept,s=e.onReject,o=e.onRemove,a=e.onSelectInEditor,l=e.hasPrevious,c=e.hasNext;if(t&&void 0!==t.post_data)return(0,f.jsx)(Tt,{link:t,onNext:n,onPrevious:r,onAccept:i,onReject:s,onRemove:o,onSelectInEditor:a,hasPrevious:l,hasNext:c});if(!(null==t?void 0:t.match))return(0,f.jsx)(f.Fragment,{children:(0,w.__)("This Smart Link does not have any matches in the current content.","wp-parsely")});var u=t.match.blockId,p=(0,v.select)("core/block-editor").getBlock(u),d=t.applied;return p?(0,f.jsxs)("div",{className:"smart-linking-review-suggestion",children:[(0,f.jsx)(h.KeyboardShortcuts,{shortcuts:{left:r,right:n,up:r,down:n,a:function(){t&&!t.applied&&i()},r:function(){t&&(t.applied?o():s())}}}),(0,f.jsx)(Gt,{link:t}),(0,f.jsx)("div",{className:"review-suggestion-preview",children:(0,f.jsx)(St,{block:p,link:t})}),(0,f.jsx)(h.__experimentalDivider,{}),(0,f.jsx)(Ht,{link:t}),(0,f.jsxs)("div",{className:"review-controls",children:[(0,f.jsx)(h.Tooltip,{shortcut:"←",text:(0,w.__)("Previous","wp-parsely"),children:(0,f.jsx)(h.Button,{disabled:!l,className:"wp-parsely-review-suggestion-previous",onClick:r,icon:bt,children:(0,w.__)("Previous","wp-parsely")})}),(0,f.jsxs)("div",{className:"reviews-controls-middle",children:[!d&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(h.Tooltip,{shortcut:"R",text:(0,w.__)("Reject","wp-parsely"),children:(0,f.jsx)(h.Button,{className:"wp-parsely-review-suggestion-reject",icon:Bt,onClick:s,variant:"secondary",children:(0,w.__)("Reject","wp-parsely")})}),(0,f.jsx)(h.Tooltip,{shortcut:"A",text:(0,w.__)("Accept","wp-parsely"),children:(0,f.jsx)(h.Button,{className:"wp-parsely-review-suggestion-accept",icon:Mt,onClick:i,variant:"secondary",children:(0,w.__)("Accept","wp-parsely")})})]}),d&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(h.Tooltip,{shortcut:"R",text:(0,w.__)("Remove","wp-parsely"),children:(0,f.jsx)(h.Button,{className:"wp-parsely-review-suggestion-reject",icon:Bt,onClick:o,variant:"secondary",children:(0,w.__)("Remove","wp-parsely")})}),(0,f.jsx)(h.Button,{className:"wp-parsely-review-suggestion-accept",onClick:a,variant:"secondary",children:(0,w.__)("Select in Editor","wp-parsely")})]})]}),(0,f.jsx)(h.Tooltip,{shortcut:"→",text:(0,w.__)("Next","wp-parsely"),children:(0,f.jsxs)(h.Button,{disabled:!c,onClick:n,className:"wp-parsely-review-suggestion-next",children:[(0,w.__)("Next","wp-parsely"),(0,f.jsx)(ie,{icon:xt})]})})]})]}):(0,f.jsx)(f.Fragment,{children:(0,w.__)("No block is selected.","wp-parsely")})},Ut=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))},qt=function(e,t){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},Kt=(0,m.memo)((function(e){var t=e.onClose,n=e.isOpen,r=e.onAppliedLink,i=(0,m.useState)(!1),s=i[0],o=i[1],a=(0,m.useState)(n),l=a[0],c=a[1],u=(0,v.useSelect)((function(e){var t=e(it),n=t.getInboundSmartLinks,r=t.getSuggestedLinks,i=t.getSmartLinks,s=t.getOutboundSmartLinks,o=s(),a=n();return{smartLinks:o,inboundSmartLinks:a,allSmartLinks:o.concat(a),getSmartLinks:i,getOutboundSmartLinks:s,getSuggestedLinks:r}}),[]),p=u.allSmartLinks,d=u.smartLinks,g=u.inboundSmartLinks,y=u.getSuggestedLinks,b=u.getSmartLinks,x=u.getOutboundSmartLinks,_=(0,m.useState)(d[0]),S=_[0],j=_[1],P=(0,v.useDispatch)(it),T=P.purgeSmartLinksSuggestions,E=P.updateSmartLink,L=P.removeSmartLink,N=function(e,t){return Ut(void 0,void 0,void 0,(function(){var n,r,i,s,o,a,l,c,u;return qt(this,(function(p){switch(p.label){case 0:return n=e.clientId,e?(r=(0,Re.getBlockContent)(e),i=(new DOMParser).parseFromString(r,"text/html"),(s=i.body.firstChild)?((o=Array.from(s.querySelectorAll('a[data-smartlink="'.concat(t.uid,'"]')))).length>0&&(a=o[0],(l=a.parentNode)&&(c=document.createTextNode(null!==(u=a.textContent)&&void 0!==u?u:""),l.replaceChild(c,a),Z.updateBlockAttributes(n,{content:s.innerHTML}))),[4,L(t.uid)]):[2]):[2];case 1:return p.sent(),[2]}}))}))},C=(0,m.useCallback)((function(){c(!1),x().filter((function(e){return!e.applied})).length>0?o(!0):(W.unlockPostAutosaving("smart-linking-review-modal"),t())}),[x,t]),O=function(e){o(!1),e?(c(!1),T().then((function(){C()}))):c(!0)},A=function(){if(Ge(S)){var e=g.indexOf(S);if(!g[t=e+1])return;j(g[t])}else{var t;if(e=d.indexOf(S),!d[t=e+1])return;j(d[t])}},I=function(){if(Ge(S)){var e=g.indexOf(S);if(!g[t=e-1])return;j(g[t])}else{var t;if(e=d.indexOf(S),!d[t=e-1])return;j(d[t])}};return(0,m.useEffect)((function(){l?W.lockPostAutosaving("smart-linking-review-modal"):l&&0===p.length&&C()}),[l,t,p,C]),(0,m.useEffect)((function(){c(n)}),[n]),(0,f.jsxs)(f.Fragment,{children:[l&&(0,f.jsx)(h.Modal,{title:(0,w.__)("Review Smart Links","wp-parsely"),className:"wp-parsely-smart-linking-review-modal",onRequestClose:C,shouldCloseOnClickOutside:!1,shouldCloseOnEsc:!1,children:(0,f.jsxs)("div",{className:"smart-linking-modal-body",children:[(0,f.jsx)(Nt,{outboundLinks:d,inboundLinks:g,activeLink:S,setSelectedLink:j}),S&&(Ge(S)?(0,f.jsx)(Tt,{link:S,onNext:A,onPrevious:I,hasNext:g.indexOf(S)<g.length-1,hasPrevious:g.indexOf(S)>0}):(0,f.jsx)(zt,{link:S,hasNext:b().indexOf(S)<b().length-1,hasPrevious:b().indexOf(S)>0,onNext:A,onPrevious:I,onAccept:function(){return Ut(void 0,void 0,void 0,(function(){var e,t;return qt(this,(function(n){switch(n.label){case 0:return S.match?(r(S),[4,(i=S.match.blockId,s=S,Ut(void 0,void 0,void 0,(function(){var e,t;return qt(this,(function(n){switch(n.label){case 0:return(e=document.createElement("a")).href=s.href,e.title=s.title,e.setAttribute("data-smartlink",s.uid),(t=(0,v.select)("core/block-editor").getBlock(i))?(Ue(t,s,e),s.applied=!0,[4,E(s)]):[2];case 1:return n.sent(),[2]}}))})))]):[2];case 1:return n.sent(),k.trackEvent("smart_linking_link_accepted",{link:S.href,title:S.title,text:S.text,uid:S.uid}),0===y().length?(C(),[2]):(e=d.indexOf(S),d[t=e+1]?j(d[t]):j(d[0]),[2])}var i,s}))}))},onReject:function(){return Ut(void 0,void 0,void 0,(function(){var e,t;return qt(this,(function(n){switch(n.label){case 0:return e=d.indexOf(S),d[t=e+1]?j(d[t]):d[0]?j(d[0]):C(),[4,L(S.uid)];case 1:return n.sent(),k.trackEvent("smart_linking_link_rejected",{link:S.href,title:S.title,text:S.text,uid:S.uid}),[2]}}))}))},onRemove:function(){return Ut(void 0,void 0,void 0,(function(){var e,t,n,r;return qt(this,(function(i){switch(i.label){case 0:return S.match?(e=(0,v.select)("core/block-editor").getBlock(S.match.blockId))?(t=b(),n=t.indexOf(S),r=n-1,[4,N(e,S)]):[3,2]:[2];case 1:if(i.sent(),k.trackEvent("smart_linking_link_removed",{link:S.href,title:S.title,text:S.text,uid:S.uid}),0===(t=b()).length&&g.length>0)return j(g[0]),[2];if(0===t.length&&0===g.length)return C(),[2];if(t[r])return j(t[r]),[2];j(t[0]),i.label=2;case 2:return[2]}}))}))},onSelectInEditor:function(){if(S.match){var e=(0,v.select)("core/block-editor").getBlock(S.match.blockId);if(e){Z.selectBlock(e.clientId);var t=document.querySelector('[data-block="'.concat(e.clientId,'"]'));t&&et(t,S.uid),k.trackEvent("smart_linking_select_in_editor_pressed",{type:"outbound",uid:S.uid}),C()}}}}))]})}),s&&(0,f.jsxs)(h.Modal,{title:(0,w.__)("Review Smart Links","wp-parsely"),onRequestClose:function(){return O(!1)},className:"wp-parsely-smart-linking-close-dialog",children:[(0,w.__)("Are you sure you want to close? All un-accepted smart links will not be added.","wp-parsely"),(0,f.jsxs)("div",{className:"smart-linking-close-dialog-actions",children:[(0,f.jsx)(h.Button,{variant:"secondary",onClick:function(){return O(!1)},children:(0,w.__)("Go Back","wp-parsely")}),(0,f.jsx)(h.Button,{variant:"primary",onClick:function(){return O(!0)},children:(0,w.__)("Close","wp-parsely")})]})]})]})})),Zt=function(){return Zt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Zt.apply(this,arguments)},Wt=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))},Yt=function(e,t){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},$t=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};!function(e){e.Unknown="unknown",e.ContentHelperSidebar="content_helper_sidebar",e.BlockInspector="block_inspector"}(Vt||(Vt={}));var Jt,Xt=function(e){var t=e.className,n=e.selectedBlockClientId,r=e.context,i=void 0===r?Vt.Unknown:r,s=e.permissions,o=I(),a=o.settings,l=o.setSettings,c=(0,m.useState)(!1),u=c[0];!function(e){var t=(0,m.useState)(!1),n=t[0],r=t[1],i=(0,m.useState)(!1),s=i[0],o=i[1],a=(0,m.useRef)(!1),l=(0,m.useRef)(!1),c=(0,v.useSelect)((function(e){var t=e("core/editor");return{isSavingPost:t.isSavingPost(),isAutosavingPost:t.isAutosavingPost()}}),[]),u=c.isSavingPost,p=c.isAutosavingPost;(0,m.useEffect)((function(){u&&!l.current?yt(void 0,void 0,void 0,(function(){var t;return mt(this,(function(n){switch(n.label){case 0:return[4,Je()];case 1:return t=n.sent(),o(t),l.current=!0,e(!0),[2]}}))})):(l.current=!1,e(!1))}),[u,e]),(0,m.useEffect)((function(){!u&&!p||a.current?u||p||!a.current||(r(!0),a.current=!1):(r(!1),a.current=!0)}),[u,p]),(0,m.useEffect)((function(){n&&l.current&&s&&yt(void 0,void 0,void 0,(function(){return mt(this,(function(e){switch(e.label){case 0:return[4,(0,v.dispatch)(q.store).savePost()];case 1:return e.sent(),l.current=!1,[2]}}))}))}),[s,n])}(c[1]),function(e){var t=(0,v.useSelect)((function(e){var t=e("core/editor");return{isSavingPost:t.isSavingPost(),isAutosavingPost:t.isAutosavingPost()}}),[]),n=t.isSavingPost,r=t.isAutosavingPost,i=(0,v.useSelect)((function(e){return{postId:(0,e("core/editor").getCurrentPostId)()}}),[]).postId,s=(0,v.useSelect)((function(e){return{getSmartLinks:e(it).getSmartLinks}}),[]).getSmartLinks;(0,m.useEffect)((function(){n&&!r&&i&&e&&gt.getInstance().setSmartLinks(i,s()).catch((function(){console.error("WP Parse.ly: Failed to save smart links on post save.")}))}),[s,r,n,i,e])}(u);var p=(0,ne.useDebounce)(l,500),d=(0,m.useState)(0),g=d[0],y=d[1],b=(0,m.useState)(!1),x=b[0],_=b[1],S=(0,v.useDispatch)("core/notices").createNotice,j=(0,v.useSelect)((function(e){var t=e(it),n=t.isReady,r=t.isLoading,i=t.isReviewModalOpen,s=t.getOverlayBlocks,o=t.getSuggestedLinks,a=t.getError,l=t.isFullContent,c=t.getMaxLinks,u=t.getSmartLinkingSettings,p=t.getApplyTo,d=t.isRetrying,f=t.getRetryAttempt,h=t.getSmartLinks,v=t.getInboundSmartLinks;return{ready:n(),loading:r(),reviewModalIsOpen:i(),error:a(),maxLinks:c(),isFullContent:l(),overlayBlocks:s(),suggestedLinks:o(),smartLinkingSettings:u(),applyTo:p(),retrying:d(),retryAttempt:f(),smartLinks:h(),inboundSmartLinks:v()}}),[]),P=j.ready,T=j.loading,E=j.reviewModalIsOpen,L=j.isFullContent,N=j.overlayBlocks,C=j.error,O=j.suggestedLinks,A=j.maxLinks,R=j.smartLinkingSettings,B=j.applyTo,M=j.retrying,D=j.retryAttempt,F=j.smartLinks,V=j.inboundSmartLinks,G=(0,m.useMemo)((function(){return F.filter((function(e){return e.applied}))}),[F]),H=(0,v.useDispatch)(it),z=H.setIsReady,K=H.setLoading,Z=H.setError,Y=H.addSmartLinks,J=H.addInboundSmartLinks,X=H.addOverlayBlock,Q=H.removeOverlayBlock,ee=H.setSmartLinkingSettings,re=H.setApplyTo,se=H.setMaxLinks,oe=H.setIsRetrying,ae=H.incrementRetryAttempt,le=H.purgeSmartLinksSuggestions,ce=H.setIsReviewModalOpen,ue=(0,v.useSelect)((function(e){return{postId:(0,e("core/editor").getCurrentPostId)()}}),[]).postId,pe=(0,m.useRef)(!1);(0,m.useEffect)((function(){if(!0===s.SmartLinking&&!P&&!pe.current){pe.current=!0;var e=We();ue?gt.getInstance().getSmartLinks(ue).then((function(e){return Wt(void 0,void 0,void 0,(function(){var t,n,r;return Yt(this,(function(i){switch(i.label){case 0:return t=e.outbound,n=e.inbound,r=(0,v.select)("core/block-editor").getBlocks(),t=Ze(r,t),[4,J(n)];case 1:return i.sent(),[2,Y(t)]}}))}))})).then((function(){return Y(e)})).then((function(){z(!0)})):Y(e).then((function(){z(!0)}))}}),[s.SmartLinking,P,ue,J,Y,z,pe]),(0,m.useEffect)((function(){x?g>0&&S("success",/* translators: %d: number of smart links applied */ /* translators: %d: number of smart links applied */
(0,w.sprintf)((0,w.__)("%s smart links successfully applied.","wp-parsely"),g),{type:"snackbar"}):y(0)}),[x]),(0,m.useEffect)((function(){if(!(Object.keys(R).length>0)){var e={maxLinksPerPost:a.SmartLinking.MaxLinks};ee(e)}}),[ee,a]);var de=(0,v.useSelect)((function(e){var t=e("core/block-editor"),r=t.getSelectedBlock,i=t.getBlock,s=t.getBlocks,o=e("core/editor"),a=o.getEditedPostContent,l=o.getCurrentPostAttribute;return{allBlocks:s(),selectedBlock:n?i(n):r(),postContent:a(),postPermalink:l("link")}}),[n]),fe=de.allBlocks,he=de.selectedBlock,ve=de.postContent,ge=de.postPermalink,ye=function(e){return Wt(void 0,void 0,void 0,(function(){var t,n,r,i,s;return Yt(this,(function(o){switch(o.label){case 0:t=[],o.label=1;case 1:return o.trys.push([1,4,,9]),[4,re((n=L||!he)?Xe.All:Xe.Selected)];case 2:return o.sent(),a=ge.replace(/^https?:\/\//i,""),r=["http://"+a,"https://"+a],i=function(e){return e.map((function(e){return e.href}))}(F),r.push.apply(r,i),[4,gt.getInstance().generateSmartLinks(he&&!n?(0,Re.getBlockContent)(he):ve,A,r)];case 3:return t=o.sent(),[3,9];case 4:if((s=o.sent()).code&&s.code===U.ParselyAborted)throw s.numRetries=3-e,s;return e>0&&s.retryFetch?(console.error(s),[4,oe(!0)]):[3,8];case 5:return o.sent(),[4,ae()];case 6:return o.sent(),[4,ye(e-1)];case 7:return[2,o.sent()];case 8:throw s;case 9:return[2,t]}var a}))}))},me=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Wt(void 0,$t([],e,!0),void 0,(function(e){return void 0===e&&(e="all"),Yt(this,(function(t){switch(t.label){case 0:return[4,X(e)];case 1:return t.sent(),be(),[2]}}))}))},we=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Wt(void 0,$t([],e,!0),void 0,(function(e){return void 0===e&&(e="all"),Yt(this,(function(t){switch(t.label){case 0:return[4,Q(e)];case 1:return t.sent(),0===N.length&&xe(),[2]}}))}))},be=function(){W.lockPostSaving("wp-parsely-block-overlay"),document.querySelectorAll('.edit-post-header__settings>[type="button"]').forEach((function(e){e.setAttribute("disabled","disabled")}))},xe=function(){document.querySelectorAll('.edit-post-header__settings>[type="button"]').forEach((function(e){e.removeAttribute("disabled")})),W.unlockPostSaving("wp-parsely-block-overlay")};return(0,f.jsxs)("div",{className:"wp-parsely-smart-linking",children:[(0,f.jsx)(Be,{isDetectingEnabled:!E,onLinkRemove:function(e){!function(e){De(this,void 0,void 0,(function(){var t,n,r;return Fe(this,(function(i){switch(i.label){case 0:return[4,$e((0,Re.getBlockContent)(e),e.clientId)];case 1:return t=i.sent(),n=t.missingSmartLinks,r=t.didAnyFixes,n.forEach((function(e){(0,v.dispatch)(it).removeSmartLink(e.uid)})),[2,r]}}))}))}(e.block)}}),(0,f.jsxs)(h.PanelRow,{className:t,children:[(0,f.jsxs)("div",{className:"smart-linking-text",children:[(0,w.__)("Automatically insert links to your most relevant, top performing content.","wp-parsely"),(0,f.jsxs)(h.Button,{href:"https://docs.wpvip.com/parse-ly/wp-parsely-features/smart-linking/",target:"_blank",variant:"link",children:[(0,w.__)("Learn more about Parse.ly AI","wp-parsely"),(0,f.jsx)(ie,{icon:$,size:18,className:"parsely-external-link-icon"})]})]}),C&&(0,f.jsx)(h.Notice,{status:"info",onRemove:function(){return Z(null)},className:"wp-parsely-content-helper-error",children:C.Message()}),x&&g>0&&(0,f.jsx)(h.Notice,{status:"success",onRemove:function(){return _(!1)},className:"wp-parsely-smart-linking-suggested-links",children:(0,w.sprintf)(/* translators: 1 - number of smart links generated */ /* translators: 1 - number of smart links generated */
(0,w.__)("Successfully added %s smart links.","wp-parsely"),g>0?g:O.length)}),(0,f.jsx)(at,{disabled:T,selectedBlock:he,onSettingChange:function(e,t){var n;p({SmartLinking:Zt(Zt({},a.SmartLinking),(n={},n[e]=t,n))}),"MaxLinks"===e&&se(t)}}),(0,f.jsx)("div",{className:"smart-linking-generate",children:(0,f.jsx)(h.Button,{onClick:function(){return Wt(void 0,void 0,void 0,(function(){var e,t,n,r,s,o,a,l;return Yt(this,(function(c){switch(c.label){case 0:return[4,K(!0)];case 1:return c.sent(),[4,le()];case 2:return c.sent(),[4,Z(null)];case 3:return c.sent(),_(!1),k.trackEvent("smart_linking_generate_pressed",{is_full_content:L,selected_block:null!==(o=null==he?void 0:he.name)&&void 0!==o?o:"none",context:i}),[4,me(L?"all":null==he?void 0:he.clientId)];case 4:c.sent(),e=setTimeout((function(){var e;K(!1),k.trackEvent("smart_linking_generate_timeout",{is_full_content:L,selected_block:null!==(e=null==he?void 0:he.name)&&void 0!==e?e:"none",context:i}),we(L?"all":null==he?void 0:he.clientId)}),18e4),t=B,c.label=5;case 5:return c.trys.push([5,8,10,15]),[4,ye(3)];case 6:return n=c.sent(),[4,(u=n,Wt(void 0,void 0,void 0,(function(){var e;return Yt(this,(function(t){switch(t.label){case 0:return u=u.filter((function(e){return!F.some((function(t){return t.uid===e.uid&&t.applied}))})),e=ge.replace(/^https?:\/\//,"").replace(/\/+$/,""),u=(u=u.filter((function(t){return!t.href.includes(e)||(console.warn("PCH Smart Linking: Skipping self-reference link: ".concat(t.href)),!1)}))).filter((function(e){return!F.some((function(t){return t.href===e.href?(console.warn("PCH Smart Linking: Skipping duplicate link: ".concat(e.href)),!0):t.text===e.text&&t.offset!==e.offset&&(console.warn("PCH Smart Linking: Skipping duplicate link text: ".concat(e.text)),!0)}))})),u=(u=Ze(L?fe:[he],u,{}).filter((function(e){return e.match}))).filter((function(e){if(!e.match)return!1;var t=e.match.blockLinkPosition,n=t+e.text.length;return!F.some((function(r){if(!r.match)return!1;if(e.match.blockId!==r.match.blockId)return!1;var i=r.match.blockLinkPosition,s=i+r.text.length;return t>=i&&n<=s}))})),[4,Y(u)];case 1:return t.sent(),[2,u]}}))})))];case 7:if(0===c.sent().length)throw new te((0,w.__)("No smart links were generated.","wp-parsely"),U.ParselySuggestionsApiNoData,"");return ce(!0),[3,15];case 8:return r=c.sent(),s=new te(null!==(a=r.message)&&void 0!==a?a:"An unknown error has occurred.",null!==(l=r.code)&&void 0!==l?l:U.UnknownError),r.code&&r.code===U.ParselyAborted&&(s.message=(0,w.sprintf)(/* translators: %d: number of retry attempts, %s: attempt plural */ /* translators: %d: number of retry attempts, %s: attempt plural */
(0,w.__)("The Smart Linking process was cancelled after %1$d %2$s.","wp-parsely"),r.numRetries,(0,w._n)("attempt","attempts",r.numRetries,"wp-parsely"))),console.error(r),[4,Z(s)];case 9:return c.sent(),s.createErrorSnackbar(),[3,15];case 10:return[4,K(!1)];case 11:return c.sent(),[4,re(t)];case 12:return c.sent(),[4,oe(!1)];case 13:return c.sent(),[4,we(L?"all":null==he?void 0:he.clientId)];case 14:return c.sent(),clearTimeout(e),[7];case 15:return[2]}var u}))}))},variant:"primary",isBusy:T,disabled:T,children:M?(0,w.sprintf)(/* translators: %1$d: number of retry attempts, %2$d: maximum number of retries */ /* translators: %1$d: number of retry attempts, %2$d: maximum number of retries */
(0,w.__)("Retrying… Attempt %1$d of %2$d","wp-parsely"),D,3):T?(0,w.__)("Generating Smart Links…","wp-parsely"):(0,w.__)("Add Smart Links","wp-parsely")})}),(G.length>0||V.length>0)&&(0,f.jsx)("div",{className:"smart-linking-manage",children:(0,f.jsx)(h.Button,{onClick:function(){return Wt(void 0,void 0,void 0,(function(){var e,t;return Yt(this,(function(n){switch(n.label){case 0:return[4,Je()];case 1:return e=n.sent(),t=We(),[4,Y(t)];case 2:return n.sent(),ce(!0),k.trackEvent("smart_linking_review_pressed",{num_smart_links:F.length,has_fixed_links:e,context:i}),[2]}}))}))},variant:"secondary",disabled:T,children:(0,w.__)("Review Smart Links","wp-parsely")})})]}),E&&(0,f.jsx)(Kt,{isOpen:E,onAppliedLink:function(){y((function(e){return e+1}))},onClose:function(){_(!0),ce(!1)}})]})},Qt=function(){return Qt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Qt.apply(this,arguments)},en=function(e){var t=e.selectedBlockClientId,n=e.label,r=(0,v.useSelect)((function(e){return{retrying:(0,e(it).isRetrying)()}}),[]).retrying,i=(0,m.useState)(document.createElement("div"))[0];return i.className="wp-parsely-block-overlay","all"===t&&(i.className+=" full-content-overlay"),i.onclick=function(e){var n=document.querySelector(".wp-parsely-block-overlay-cancel");n&&e.target===n?e.stopPropagation():(e.stopPropagation(),e.stopImmediatePropagation(),"all"!==t&&(Z.selectBlock(t,-1),i.ownerDocument.activeElement.blur()))},(0,m.useEffect)((function(){if(t){if("all"===t){var e=document.querySelector(".interface-navigable-region.interface-interface-skeleton__content");return null==e||e.appendChild(i),null==e||e.setAttribute("style","overflow: hidden"),i.style.top=(null==e?void 0:e.scrollTop)+"px",function(){(null==e?void 0:e.contains(i))&&e.removeChild(i),null==e||e.setAttribute("style",""),i.style.top=""}}var n=document.querySelector('[data-block="'.concat(t,'"]'));return null==n||n.setAttribute("contenteditable","false"),null==n||n.setAttribute("aria-disabled","true"),null==n||n.appendChild(i),function(){null==n||n.setAttribute("contenteditable","true"),null==n||n.removeAttribute("aria-disabled"),(null==n?void 0:n.contains(i))&&n.removeChild(i)}}})),(0,m.createPortal)((0,f.jsxs)("div",{className:"wp-parsely-block-overlay-label",children:[(0,f.jsx)(h.Spinner,{}),!r&&(0,f.jsx)("span",{children:n}),r&&(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)("span",{children:[(0,w.__)("Retrying to Generate Smart Links…","wp-parsely")," ",(0,f.jsx)(h.Button,{className:"wp-parsely-block-overlay-cancel",variant:"link",onClick:function(){gt.getInstance().cancelRequest()},children:(0,w.__)("Cancel","wp-parsely")})]})})]}),i)},tn=function(){return(0,v.useSelect)((function(e){return{overlayBlocks:(0,e(it).getOverlayBlocks)()}}),[]).overlayBlocks.includes("all")?(0,f.jsx)(en,{label:(0,w.__)("Generating Smart Links…","wp-parsely"),selectedBlockClientId:"all"}):(0,f.jsx)(f.Fragment,{})},nn=(0,ne.createHigherOrderComponent)((function(e){return function(t){return(0,v.useSelect)((function(e){return{overlayBlocks:(0,e(it).getOverlayBlocks)()}}),[]).overlayBlocks.includes(t.clientId)?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(e,Qt({},t)),(0,f.jsx)(en,{label:(0,w.__)("Generating Smart Links…","wp-parsely"),selectedBlockClientId:t.clientId})]}):(0,f.jsx)(e,Qt({},t))}}),"withBlockOverlay"),rn=function(){return rn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},rn.apply(this,arguments)},sn=10,on=null!==(Jt=window.wpParselySmartLinkingAllowedBlocks)&&void 0!==Jt?Jt:["core/paragraph"],an=H(),ln=(0,ne.createHigherOrderComponent)((function(e){return function(t){return on.includes(t.name)?(0,f.jsx)(D,{endpoint:"editor-sidebar",defaultSettings:Ar(),children:(0,f.jsx)(e,rn({},t))}):(0,f.jsx)(e,rn({},t))}}),"withSettingsProvider"),cn=(0,ne.createHigherOrderComponent)((function(e){return function(t){if(!t.isSelected||!on.includes(t.name))return(0,f.jsx)(e,rn({},t));var n=I(),r=n.settings,i=n.setSettings;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(e,rn({},t)),(0,f.jsx)(Ce.InspectorControls,{group:"list",children:(0,f.jsx)(h.PanelBody,{title:(0,w.__)("Smart Linking","wp-parsely"),initialOpen:r.SmartLinking.Open,className:"wp-parsely-panel wp-parsely-smart-linking-panel",icon:(0,f.jsx)(j,{}),onToggle:function(e){i({SmartLinking:rn(rn({},r.SmartLinking),{Open:e})}),k.trackEvent("smart_linking_block_inspector_panel_toggled",{open:e})},children:(0,f.jsx)(Ie,{children:(0,f.jsx)(Xt,{selectedBlockClientId:t.clientId,context:Vt.BlockInspector,permissions:an})})})})]})}}),"withSmartLinkingPanel"),un=(0,ne.compose)(ln,cn),pn=function(){!0===an.SmartLinking&&((0,K.addFilter)("editor.BlockEdit","wpparsely/smart-linking-inspector-control-panel",un),(0,K.addFilter)("editor.BlockEdit","wpparsely/block-overlay",nn),(0,_.registerPlugin)("wp-parsely-block-overlay",{render:tn}),y()((function(){var e=new URLSearchParams(window.location.search).get("smart-link");e&&function(){return e=this,t=void 0,r=function(){return function(e,t){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}(this,(function(e){return[2,new Promise((function(e){var t=(0,v.subscribe)((function(){((0,v.select)("core/editor").isCleanNewPost()||(0,v.select)("core/block-editor").getBlockCount()>0)&&(t(),e())}))}))]}))},new((n=void 0)||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}));var e,t,n,r}().then((function(){var t=document.querySelector(".wp-block-post-content");et(t,e)}))})))},dn=(0,f.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,f.jsx)(b.Path,{d:"M7 11.5h10V13H7z"})}),fn=(0,f.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,f.jsx)(b.Path,{d:"M13 19h-2v-2h2v2zm0-6h-2v-2h2v2zm0-6h-2V5h2v2z"})}),hn=function(e){var t=e.title,n=e.icon,r=e.subtitle,i=e.level,s=void 0===i?2:i,o=e.children,a=e.controls,l=e.onClick,c=e.isOpen,u=e.isLoading,p=e.dropdownChildren;return(0,f.jsxs)("div",{className:"performance-stat-panel",children:[(0,f.jsxs)(h.__experimentalHStack,{className:"panel-header level-"+s,children:[(0,f.jsx)(h.__experimentalHeading,{level:s,children:t}),r&&!c&&(0,f.jsx)("span",{className:"panel-subtitle",children:r}),a&&!p&&(0,f.jsx)(h.DropdownMenu,{icon:n,label:(0,w.__)("Settings","wp-parsely"),className:"panel-settings-button",controls:a}),p&&(0,f.jsx)(h.DropdownMenu,{icon:n,label:(0,w.__)("Settings","wp-parsely"),className:"panel-settings-button",children:p}),n&&!p&&!a&&(0,f.jsx)(h.Button,{icon:n,className:"panel-settings-button",isPressed:c,onClick:l})]}),(0,f.jsx)("div",{className:"panel-body",children:u?(0,f.jsx)("div",{className:"parsely-spinner-wrapper","data-testid":"parsely-spinner-wrapper",children:(0,f.jsx)(h.Spinner,{})}):o})]})},vn=function(e){var t=e.data,n=e.isLoading,r=(0,m.useState)(B.Views),i=r[0],s=r[1],o=(0,m.useState)(!1),a=o[0],l=o[1];n||delete t.referrers.types.totals;var c=function(e){switch(e){case"social":return(0,w.__)("Social","wp-parsely");case"search":return(0,w.__)("Search","wp-parsely");case"other":return(0,w.__)("Other","wp-parsely");case"internal":return(0,w.__)("Internal","wp-parsely");case"direct":return(0,w.__)("Direct","wp-parsely")}return e},u=(0,w.sprintf)((0,w.__)("By %s","wp-parsely"),G(i));
/* translators: %s: metric description */return(0,f.jsxs)(hn,{title:(0,w.__)("Categories","wp-parsely"),level:3,subtitle:u,isOpen:a,onClick:function(){return l(!a)},children:[a&&(0,f.jsx)("div",{className:"panel-settings",children:(0,f.jsx)(h.SelectControl,{value:i,prefix:(0,w.__)("By:","wp-parsely"),onChange:function(e){F(e,B)&&s(e)},children:Object.values(B).map((function(e){return(0,f.jsxs)("option",{value:e,disabled:"avg_engaged"===e,children:[G(e),"avg_engaged"===e&&" "+(0,w.__)("(coming soon)","wp-parsely")]},e)}))})}),n?(0,f.jsx)("div",{className:"parsely-spinner-wrapper","data-testid":"parsely-spinner-wrapper",children:(0,f.jsx)(h.Spinner,{})}):(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{className:"multi-percentage-bar",children:Object.entries(t.referrers.types).map((function(e){var t=e[0],n=e[1],r=(0,w.sprintf)(/* translators: 1: Referrer type, 2: Percentage value, %%: Escaped percent sign */ /* translators: 1: Referrer type, 2: Percentage value, %%: Escaped percent sign */
(0,w.__)("%1$s: %2$s%%","wp-parsely"),c(t),n.viewsPercentage);return(0,f.jsx)(h.Tooltip
/* translators: %s: percentage value */,{
/* translators: %s: percentage value */
text:"".concat(c(t)," - ").concat((0,w.sprintf)((0,w.__)("%s%%","wp-parsely"),n.viewsPercentage)),delay:150,children:(0,f.jsx)("div",{"aria-label":r,className:"bar-fill "+t,style:{width:n.viewsPercentage+"%"}})},t)}))}),(0,f.jsx)("div",{className:"percentage-bar-labels",children:Object.entries(t.referrers.types).map((function(e){var t=e[0],n=e[1];return(0,f.jsxs)("div",{className:"single-label "+t,children:[(0,f.jsx)("div",{className:"label-color "+t}),(0,f.jsx)("div",{className:"label-text",children:c(t)}),(0,f.jsx)("div",{className:"label-value",children:Ft(n.views)})]},t)}))})]})]})},gn=(0,f.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,f.jsx)(b.Path,{d:"M12 4V2.2L9 4.8l3 2.5V5.5c3.6 0 6.5 2.9 6.5 6.5 0 2.9-1.9 5.3-4.5 6.2v.2l-.1-.2c-.4.1-.7.2-1.1.2l.2 1.5c.3 0 .6-.1 1-.2 3.5-.9 6-4 6-7.7 0-4.4-3.6-8-8-8zm-7.9 7l1.5.2c.1-1.2.5-2.3 1.2-3.2l-1.1-.9C4.8 8.2 4.3 9.6 4.1 11zm1.5 1.8l-1.5.2c.1.7.3 1.4.5 2 .3.7.6 1.3 1 1.8l1.2-.8c-.3-.5-.6-1-.8-1.5s-.4-1.1-.4-1.7zm1.5 5.5c1.1.9 2.4 1.4 3.8 1.6l.2-1.5c-1.1-.1-2.2-.5-3.1-1.2l-.9 1.1z"})}),yn=(0,f.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,f.jsx)(b.Path,{d:"M11 13h2v-2h-2v2zm-6 0h2v-2H5v2zm12-2v2h2v-2h-2z"})}),mn=function(){return mn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},mn.apply(this,arguments)},wn=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},bn=[{name:"views",title:(0,w.__)("Page Views","wp-parsely"),icon:It},{name:"visitors",title:(0,w.__)("Visitors","wp-parsely"),icon:Rt},{name:"avgEngaged",title:(0,w.__)("Avg. Engaged","wp-parsely"),icon:(0,f.jsx)((function(){return(0,f.jsxs)(h.SVG,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,f.jsx)(h.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M12 19.5C16.1421 19.5 19.5 16.1421 19.5 12C19.5 7.85786 16.1421 4.5 12 4.5C7.85786 4.5 4.5 7.85786 4.5 12C4.5 16.1421 7.85786 19.5 12 19.5ZM12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21Z",fill:"#1E1E1E"}),(0,f.jsx)(h.Path,{d:"M11 12L12 7L13 12H11Z",fill:"#1E1E1E"}),(0,f.jsx)(h.Path,{d:"M12 13C12.5523 13 13 12.5523 13 12H11C11 12.5523 11.4477 13 12 13Z",fill:"#1E1E1E"}),(0,f.jsx)(h.Path,{d:"M12.8144 11.3845L15.6429 15.6271L11.4002 12.7987L12.8144 11.3845Z",fill:"#1E1E1E"})]})}),{})},{name:"recirculation",title:(0,w.__)("Recirculation","wp-parsely"),icon:gn,smallText:!0}],xn=function(e,t){return e.PerformanceStats.VisibleDataPoints.includes(t)},kn=function(e){var t=e.title,n=e.value,r=e.icon,i=e.smallText,s=e.isVisible;return void 0===s||s?(0,f.jsxs)("div",{className:"data-point",children:[(0,f.jsx)(ie,{size:24,icon:r}),(0,f.jsx)("span",{className:"data-point-title",children:t}),(0,f.jsx)("span",{className:"data-point-value"+(i?" is-small":""),children:n})]}):null},Sn=function(e){var t=e.dataPoints;return(0,f.jsx)("div",{className:"performance-data-points",children:t.map((function(e){var t=e.title,n=e.value,r=e.icon,i=e.smallText,s=e.isVisible;return(0,f.jsx)(kn,{title:t,value:n,icon:r,smallText:i,isVisible:s},t)}))})},jn=function(e){var t=e.onClose,n=I(),r=n.settings,i=n.setSettings;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(h.MenuGroup,{label:(0,w.__)("Performance Stats","wp-parsely"),children:bn.map((function(e){return(0,f.jsxs)(h.MenuItem,{icon:xn(r,e.name)?Mt:dn,onClick:function(){return n=e.name,xn(r,s=n)?(i({PerformanceStats:mn(mn({},r.PerformanceStats),{VisibleDataPoints:r.PerformanceStats.VisibleDataPoints.filter((function(e){return e!==s}))})}),k.trackEvent("editor_sidebar_performance_datapoint_hidden",{datapoint:s})):(i({PerformanceStats:mn(mn({},r.PerformanceStats),{VisibleDataPoints:wn(wn([],r.PerformanceStats.VisibleDataPoints,!0),[s],!1)})}),k.trackEvent("editor_sidebar_performance_datapoint_shown",{datapoint:s})),void t();var n,s},children:[(0,f.jsx)(ie,{icon:e.icon}),e.title]},e.name)}))}),(0,f.jsx)(h.MenuGroup,{children:(0,f.jsx)(h.MenuItem,{onClick:function(){i({PerformanceStats:mn(mn({},r.PerformanceStats),{VisibleDataPoints:["views","visitors","avgEngaged","recirculation"]})}),k.trackEvent("editor_sidebar_performance_datapoints_reset"),t()},children:(0,w.__)("Reset all","wp-parsely")})})]})},Pn=function(e){var t=e.data,n=e.isLoading,r=void 0!==n&&n,i=I().settings,s=[];return r||(s=bn.map((function(e){var n;switch(e.name){case"views":n=Ft(t.views);break;case"visitors":n=Ft(t.visitors);break;case"avgEngaged":n=t.avgEngaged;break;default:n=(0,w.__)("Coming soon!","wp-parsely")}return mn(mn({},e),{value:n,isVisible:xn(i,e.name)})}))),(0,f.jsx)(hn,{title:(0,w.__)("Overview","wp-parsely"),level:3,icon:yn,dropdownChildren:function(e){var t=e.onClose;return(0,f.jsx)(jn,{onClose:t})},children:r?(0,f.jsx)("div",{className:"parsely-spinner-wrapper","data-testid":"parsely-spinner-wrapper",children:(0,f.jsx)(h.Spinner,{})}):(0,f.jsx)(Sn,{dataPoints:s})})},Tn=function(e){var t=e.data,n=e.isLoading,r=(0,m.useState)(B.Views),i=r[0],s=r[1],o=(0,m.useState)(!1),a=o[0],l=o[1],c=(0,w.sprintf)((0,w.__)("By %s","wp-parsely"),G(i));return(0,f.jsxs)(hn,{title:(0,w.__)("Referrers","wp-parsely"),subtitle:c,level:3,isOpen:a,onClick:function(){return l(!a)},children:[a&&(0,f.jsx)("div",{className:"panel-settings",children:(0,f.jsx)(h.SelectControl,{value:i,prefix:(0,w.__)("By:","wp-parsely"),onChange:function(e){F(e,B)&&s(e)},children:Object.values(B).map((function(e){return(0,f.jsxs)("option",{value:e,disabled:"avg_engaged"===e,children:[G(e),"avg_engaged"===e&&" "+(0,w.__)("(coming soon)","wp-parsely")]},e)}))})}),n?(0,f.jsx)("div",{className:"parsely-spinner-wrapper","data-testid":"parsely-spinner-wrapper",children:(0,f.jsx)(h.Spinner,{})}):(0,f.jsx)("div",{className:"referrers-list",children:Object.entries(t.referrers.top).map((function(e){var t=e[0],n=e[1];if("totals"===t)return null;var r=t;"direct"===t&&(r=(0,w.__)("Direct","wp-parsely"))
/* translators: %s: Percentage value, %%: Escaped percent sign */;var i=(0,w.sprintf)((0,w.__)("%s%%","wp-parsely"),n.viewsPercentage);return(0,f.jsxs)("div",{className:"referrers-row",children:[(0,f.jsx)("div",{className:"referrers-row-title",children:(0,f.jsx)("span",{children:r})}),(0,f.jsx)("div",{className:"referrers-row-bar",children:(0,f.jsx)("div",{"aria-label":i,className:"percentage-bar",style:{"--bar-fill":n.viewsPercentage+"%"}})}),(0,f.jsx)("div",{className:"referrers-row-value",children:(0,f.jsx)("span",{children:n.views})})]},t)}))})]})},En=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Ln=function(){return Ln=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Ln.apply(this,arguments)},Nn=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))},Cn=function(e,t){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},On=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.itmSource="wp-parsely-content-helper",t}return En(t,e),t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.getPerformanceStats=function(e){return Nn(this,void 0,void 0,(function(){var t,n,r,i,s,o,a,l,c;return Cn(this,(function(u){switch(u.label){case 0:if(t=(0,v.select)("core/editor"),n=null!==(l=t.getEditedPostAttribute("status"))&&void 0!==l?l:"draft",r=null!==(c=window.wpParselyTrackableStatuses)&&void 0!==c?c:["publish"],!t.isCurrentPostPublished()&&!r.includes(n))return[2,Promise.reject(new te((0,w.__)("This post is not published, so its details are unavailable.","wp-parsely"),U.PostIsNotPublished,""))];if(null===(i=t.getCurrentPostId()))return[2,Promise.reject(new te((0,w.__)("The post's ID returned null.","wp-parsely"),U.PostIsNotPublished))];u.label=1;case 1:return u.trys.push([1,4,,5]),[4,this.fetchPerformanceDataFromWpEndpoint(e,i)];case 2:return s=u.sent(),[4,this.fetchReferrerDataFromWpEndpoint(e,i,s.views)];case 3:return o=u.sent(),[3,5];case 4:return a=u.sent(),[2,Promise.reject(a)];case 5:return[2,Ln(Ln({},s),{referrers:o})]}}))}))},t.prototype.fetchPerformanceDataFromWpEndpoint=function(e,t){return Nn(this,void 0,void 0,(function(){var n,r,i;return Cn(this,(function(s){switch(s.label){case 0:return[4,this.fetch({path:(0,we.addQueryArgs)("/wp-parsely/v2/stats/post/".concat(t,"/details"),Ln(Ln({},pt(e)),{itm_source:this.itmSource}))})];case 1:return 0===(n=s.sent()).length?(r=null!==(i=(0,v.select)("core/editor").getEditedPostAttribute("title"))&&void 0!==i?i:"",[2,Promise.reject(new te((0,w.sprintf)(/* translators: Title of the published post */ /* translators: Title of the published post */
(0,w.__)("<strong>%s</strong> has 0 views, or the Parse.ly API returned no data.","wp-parsely"),r),U.ParselyApiReturnedNoData,""))]):n.length>1?[2,Promise.reject(new te((0,w.sprintf)(/* translators: URL of the published post */ /* translators: URL of the published post */
(0,w.__)("Multiple results were returned for the post %d by the Parse.ly API.","wp-parsely"),t),U.ParselyApiReturnedTooManyResults))]:[2,n[0]]}}))}))},t.prototype.fetchReferrerDataFromWpEndpoint=function(e,t,n){return Nn(this,void 0,void 0,(function(){return Cn(this,(function(r){switch(r.label){case 0:return[4,this.fetch({path:(0,we.addQueryArgs)("/wp-parsely/v2/stats/post/".concat(t,"/referrers"),Ln(Ln({},pt(e)),{itm_source:this.itmSource,total_views:n}))})];case 1:return[2,r.sent()]}}))}))},t}(be),An=function(){return An=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},An.apply(this,arguments)},In=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))},Rn=function(e,t){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},Bn=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},Mn=[{name:"overview",label:(0,w.__)("Overview","wp-parsely")},{name:"categories",label:(0,w.__)("Referrer Categories","wp-parsely")},{name:"referrers",label:(0,w.__)("Referrers","wp-parsely")}],Dn=function(e,t){return e.PerformanceStats.VisiblePanels.includes(t)},Fn=function(e){var t=e.onClose,n=I(),r=n.settings,i=n.setSettings;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(h.MenuGroup,{label:(0,w.__)("Performance Stats","wp-parsely"),children:Mn.map((function(e){return(0,f.jsx)(h.MenuItem,{disabled:e.forced,icon:Dn(r,e.name)?Mt:dn,onClick:function(){return function(e){var t;(null===(t=Mn.find((function(t){return t.name===e})))||void 0===t?void 0:t.forced)||(Dn(r,e)?(i({PerformanceStats:An(An({},r.PerformanceStats),{VisiblePanels:r.PerformanceStats.VisiblePanels.filter((function(t){return t!==e}))})}),k.trackEvent("editor_sidebar_performance_panel_closed",{panel:e})):(i({PerformanceStats:An(An({},r.PerformanceStats),{VisiblePanels:Bn(Bn([],r.PerformanceStats.VisiblePanels,!0),[e],!1)})}),k.trackEvent("editor_sidebar_performance_panel_opened",{panel:e})))}(e.name),void t()},children:e.label},e.name)}))}),(0,f.jsx)(h.MenuGroup,{children:(0,f.jsx)(h.MenuItem,{onClick:function(){i({PerformanceStats:An(An({},r.PerformanceStats),{VisiblePanels:Mn.map((function(e){return e.name}))})}),k.trackEvent("editor_sidebar_performance_panels_reset"),t()},children:(0,w.__)("Reset all","wp-parsely")})})]})},Vn=function(e){var t=e.period,n=(0,m.useState)(!0),r=n[0],i=n[1],s=(0,m.useState)(),o=s[0],a=s[1],l=(0,m.useState)(),c=l[0],u=l[1],p=I(),d=p.settings,v=p.setSettings;return(0,m.useEffect)((function(){var e=On.getInstance(),n=function(r){return In(void 0,void 0,void 0,(function(){return Rn(this,(function(s){return e.getPerformanceStats(t).then((function(e){u(e),i(!1)})).catch((function(e){return In(void 0,void 0,void 0,(function(){return Rn(this,(function(t){switch(t.label){case 0:return r>0&&e.retryFetch?[4,new Promise((function(e){return setTimeout(e,500)}))]:[3,3];case 1:return t.sent(),[4,n(r-1)];case 2:return t.sent(),[3,4];case 3:a(e),i(!1),t.label=4;case 4:return[2]}}))}))})),[2]}))}))};return i(!0),n(1),function(){a(void 0)}}),[t]),(0,f.jsxs)("div",{className:"wp-parsely-performance-panel",children:[(0,f.jsx)(hn,{title:(0,w.__)("Performance Stats","wp-parsely"),icon:fn,dropdownChildren:function(e){var t=e.onClose;return(0,f.jsx)(Fn,{onClose:t})},children:(0,f.jsx)("div",{className:"panel-settings",children:(0,f.jsx)(h.SelectControl,{size:"__unstable-large",value:d.PerformanceStats.Period,prefix:(0,f.jsx)(h.__experimentalInputControlPrefixWrapper,{children:(0,w.__)("Period:","wp-parsely")}),onChange:function(e){F(e,R)&&(v({PerformanceStats:An(An({},d.PerformanceStats),{Period:e})}),k.trackEvent("editor_sidebar_performance_period_changed",{period:e}))},children:Object.values(R).map((function(e){return(0,f.jsx)("option",{value:e,children:V(e)},e)}))})})}),o?o.Message():(0,f.jsxs)(f.Fragment,{children:[Dn(d,"overview")&&(0,f.jsx)(Pn,{data:c,isLoading:r}),Dn(d,"categories")&&(0,f.jsx)(vn,{data:c,isLoading:r}),Dn(d,"referrers")&&(0,f.jsx)(Tn,{data:c,isLoading:r})]}),window.wpParselyPostUrl&&(0,f.jsx)(h.Button,{className:"wp-parsely-view-post",variant:"primary",onClick:function(){k.trackEvent("editor_sidebar_view_post_pressed")},href:window.wpParselyPostUrl,rel:"noopener",target:"_blank",children:(0,w.__)("View this in Parse.ly","wp-parsely")})]})},Gn=function(e){var t=e.period;return(0,f.jsx)(h.Panel,{children:(0,f.jsx)(Ie,{children:(0,f.jsx)(Vn,{period:t})})})},Hn=function(e){var t=e.filters,n=e.postData,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["filters","postData"]);if(0===n.authors.length&&0===n.categories.length&&0===n.tags.length)return null;var i,s=n.authors.map((function(e){return{value:e,label:e}}));return i=!0!==window.wpParselyUseCategorySlugsInSearches?n.categories.map((function(e){return{value:e.name,label:e.name}})):n.categories.map((function(e){return{value:e.slug,label:e.name}})),(0,f.jsxs)("div",{className:"related-posts-filter-settings",children:[n.authors.length>=1&&(0,f.jsx)(h.ComboboxControl,{__next40pxDefaultSize:!0,allowReset:!0,placeholder:(0,w.__)("Author","wp-parsely"),onChange:function(e){return r.onFiltersChange(e,M.Author)},options:s,value:t.author}),n.categories.length>=1&&(0,f.jsx)(h.ComboboxControl,{__next40pxDefaultSize:!0,allowReset:!0,placeholder:(0,w.__)("Section","wp-parsely"),onChange:function(e){return r.onFiltersChange(e,M.Section)},options:i,value:t.section}),n.tags.length>=1&&(0,f.jsx)(h.FormTokenField,{__experimentalShowHowTo:!1,__next40pxDefaultSize:!0,label:"",placeholder:(0,w.__)("Tags","wp-parsely"),onChange:function(e){return r.onFiltersChange(e.toString(),M.Tag)},value:t.tags,suggestions:n.tags,maxLength:5})]})},zn=(0,f.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,f.jsx)(b.Path,{d:"M10 17.389H8.444A5.194 5.194 0 1 1 8.444 7H10v1.5H8.444a3.694 3.694 0 0 0 0 7.389H10v1.5ZM14 7h1.556a5.194 5.194 0 0 1 0 10.39H14v-1.5h1.556a3.694 3.694 0 0 0 0-7.39H14V7Zm-4.5 6h5v-1.5h-5V13Z"})}),Un=(0,f.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,f.jsx)(b.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M5.625 5.5h9.75c.069 0 .125.056.125.125v9.75a.125.125 0 0 1-.125.125h-9.75a.125.125 0 0 1-.125-.125v-9.75c0-.069.056-.125.125-.125ZM4 5.625C4 4.728 4.728 4 5.625 4h9.75C16.273 4 17 4.728 17 5.625v9.75c0 .898-.727 1.625-1.625 1.625h-9.75A1.625 1.625 0 0 1 4 15.375v-9.75Zm14.5 11.656v-9H20v9C20 18.8 18.77 20 17.251 20H6.25v-1.5h11.001c.69 0 1.249-.528 1.249-1.219Z"})}),qn=function(){return(0,f.jsx)(h.SVG,{xmlns:"http://www.w3.org/2000/svg",width:"1",height:"40",viewBox:"0 0 1 40",fill:"none",children:(0,f.jsx)(h.Rect,{width:"1",height:"40",fill:"#cccccc"})})};function Kn(e){var t=e.metric,n=e.post,r=e.avgEngagedIcon,i=e.viewsIcon;return"views"===t?(0,f.jsxs)("span",{className:"parsely-post-metric-data",children:[(0,f.jsx)("span",{className:"screen-reader-text",children:(0,w.__)("Number of Views","wp-parsely")}),i,Ft(n.views.toString())]}):"avg_engaged"===t?(0,f.jsxs)("span",{className:"parsely-post-metric-data",children:[(0,f.jsx)("span",{className:"screen-reader-text",children:(0,w.__)("Average Time","wp-parsely")}),r,n.avgEngaged]}):(0,f.jsx)("span",{className:"parsely-post-metric-data",children:"-"})}var Zn=function(e){var t,n,r=e.metric,i=e.post,s=e.postContent,o=(0,v.useDispatch)("core/notices").createNotice,a=s&&(t=s,n=Oe(i.rawUrl),new RegExp("<a [^>]*href=[\"'](http://|https://)?.*".concat(n,".*[\"'][^>]*>"),"i").test(t));return(0,f.jsxs)("div",{className:"related-post-single","data-testid":"related-post-single",children:[(0,f.jsx)("div",{className:"related-post-title",children:(0,f.jsxs)("a",{href:i.url,target:"_blank",rel:"noreferrer",children:[(0,f.jsx)("span",{className:"screen-reader-text",children:(0,w.__)("View on website (opens new tab)","wp-parsely")}),i.title]})}),(0,f.jsx)("div",{className:"related-post-actions",children:(0,f.jsxs)("div",{className:"related-post-info",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{className:"related-post-metric",children:(0,f.jsx)(Kn,{metric:r,post:i,viewsIcon:(0,f.jsx)(ie,{icon:It}),avgEngagedIcon:(0,f.jsx)(h.Dashicon,{icon:"clock",size:24})})}),a&&(0,f.jsx)("div",{className:"related-post-linked",children:(0,f.jsx)(h.Tooltip,{text:(0,w.__)("This post is linked in the content","wp-parsely"),children:(0,f.jsx)(ie,{icon:zn,size:24})})})]}),(0,f.jsx)(qn,{}),(0,f.jsxs)("div",{children:[(0,f.jsx)(h.Button,{icon:Un,iconSize:24,onClick:function(){navigator.clipboard.writeText(i.rawUrl).then((function(){o("success",(0,w.__)("URL copied to clipboard","wp-parsely"),{type:"snackbar"})}))},label:(0,w.__)("Copy URL to clipboard","wp-parsely")}),(0,f.jsx)(h.Button,{icon:(0,f.jsx)(j,{}),iconSize:18,href:i.dashUrl,target:"_blank",label:(0,w.__)("View in Parse.ly","wp-parsely")})]})]})})]})},Wn=window.wp.coreData,Yn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),$n=function(){return $n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},$n.apply(this,arguments)},Jn=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))},Xn=function(e,t){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},Qn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yn(t,e),t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.getRelatedPosts=function(e,t,n){return Jn(this,void 0,void 0,(function(){var r,i;return Xn(this,(function(s){switch(s.label){case 0:r=[],s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.fetchRelatedPostsFromWpEndpoint(e,t,n)];case 2:return r=s.sent(),[3,4];case 3:return i=s.sent(),[2,Promise.reject(i)];case 4:return[2,r]}}))}))},t.prototype.fetchRelatedPostsFromWpEndpoint=function(e,t,n){return Jn(this,void 0,void 0,(function(){var r,i;return Xn(this,(function(s){return r=(0,we.addQueryArgs)("/wp-parsely/v2/stats/posts",$n($n({author:n.author,section:n.section,tag:n.tags},pt(e)),{limit:5,sort:t,itm_source:"wp-parsely-content-helper"})),[2,null!==(i=this.fetch({path:r}))&&void 0!==i?i:[]]}))}))},t}(be),er=function(){return er=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},er.apply(this,arguments)},tr={isFirstRun:!0,isLoading:!1,filters:{author:"",section:"",tags:[]},posts:[]},nr=(0,v.createReduxStore)("wp-parsely/related-posts",{initialState:tr,reducer:function(e,t){switch(void 0===e&&(e=tr),t.type){case"SET_FIRST_RUN":return er(er({},e),{isFirstRun:t.isFirstRun});case"SET_LOADING":return er(er({},e),{isLoading:t.isLoading});case"SET_POSTS":return er(er({},e),{posts:t.posts});case"SET_FILTERS":return er(er({},e),{filters:t.filters});case"RESET":return tr;default:return e}},actions:{setFirstRun:function(e){return{type:"SET_FIRST_RUN",isFirstRun:e}},setLoading:function(e){return{type:"SET_LOADING",isLoading:e}},setPosts:function(e){return{type:"SET_POSTS",posts:e}},setFilters:function(e){return{type:"SET_FILTERS",filters:e}},reset:function(){return{type:"RESET"}}},selectors:{getState:function(e){return e},isFirstRun:function(e){return e.isFirstRun},isLoading:function(e){return e.isLoading},getPosts:function(e){return e.posts},getFilters:function(e){return e.filters}}});(0,v.register)(nr);var rr,ir=function(){return ir=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},ir.apply(this,arguments)},sr=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))},or=function(e,t){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},ar=function(){var e=I(),t=e.settings,n=e.setSettings,r=t.RelatedPosts.Period,i=t.RelatedPosts.Metric,s=(0,m.useState)({authors:[],categories:[],tags:[]}),o=s[0],a=s[1],l=function(){var e=(0,m.useState)({authors:void 0,categories:void 0,tags:void 0,isReady:!1}),t=e[0],n=e[1],r=(0,v.useSelect)((function(e){var t,n,r,i,s,o,a=e(Wn.store),l=a.getEntityRecords,c=a.hasFinishedResolution,u=a.isResolving,p=e("core/editor"),d=p.getEditedPostAttribute("author"),f=p.getEditedPostAttribute("categories"),h=p.getEditedPostAttribute("tags");return{authorRecords:i=Number.isInteger(d)?null!==(t=l("root","user",{include:[d],context:"view"}))&&void 0!==t?t:void 0:null,categoryRecords:s=Array.isArray(f)&&f.length>0&&f.every(Number.isInteger)?null!==(n=l("taxonomy","category",{include:f,context:"view"}))&&void 0!==n?n:void 0:null,tagRecords:o=Array.isArray(h)&&h.length>0&&h.every(Number.isInteger)?null!==(r=l("taxonomy","post_tag",{include:h,context:"view"}))&&void 0!==r?r:void 0:null,isLoading:u("getEntityRecords",["root","user",{include:[d],context:"view"}])||u("getEntityRecords",["taxonomy","category",{include:f,context:"view"}])||u("getEntityRecords",["taxonomy","post_tag",{include:h,context:"view"}]),hasResolved:(c("getEntityRecords",["root","user",{include:[d],context:"view"}])||null===i)&&(c("getEntityRecords",["taxonomy","category",{include:f,context:"view"}])||null===s)&&(c("getEntityRecords",["taxonomy","post_tag",{include:h,context:"view"}])||null===o)}}),[]);return(0,m.useEffect)((function(){var e=r.authorRecords,t=r.categoryRecords,i=r.tagRecords,s=r.isLoading;r.hasResolved&&!s&&n({authors:e,categories:t,tags:i,isReady:!0})}),[r]),t}(),c=l.authors,u=l.categories,p=l.tags,d=l.isReady,g=function(e){return!(!Array.isArray(e)||0===e.length)&&e.every((function(e){return"name"in e&&"id"in e&&"slug"in e&&"description"in e&&"link"in e}))};(0,m.useEffect)((function(){if(d){var e,t=function(e){return g(e)?e.map((function(e){return e.name})):[]};a({authors:t(c),categories:(e=u,g(e)?e.map((function(e){return{name:e.name,slug:e.slug}})):[]),tags:t(p)})}}),[c,u,p,d]);var y=(0,v.useSelect)((function(e){var t=e(nr),n=t.isLoading,r=t.getPosts,i=t.getFilters;return{firstRun:(0,t.isFirstRun)(),loading:n(),posts:r(),filters:i()}}),[]),b=y.firstRun,x=y.loading,_=y.posts,S=y.filters,j=(0,v.useDispatch)(nr),P=j.setFirstRun,T=j.setLoading,E=j.setPosts,L=j.setFilters,N=(0,m.useState)(),C=N[0],O=N[1],A=(0,m.useState)(void 0),D=A[0],H=A[1],z=(0,ne.useDebounce)(H,1e3);(0,v.useSelect)((function(e){if("undefined"==typeof jest){var t=e("core/editor").getEditedPostContent;z(t())}else z("Jest test is running")}),[z]);var U=function(e,t,n,r){return sr(void 0,void 0,void 0,(function(){return or(this,(function(i){return T(!0),Qn.getInstance().getRelatedPosts(e,t,n).then((function(e){E(e),T(!1)})).catch((function(i){return sr(void 0,void 0,void 0,(function(){return or(this,(function(s){switch(s.label){case 0:return r>0&&i.retryFetch?[4,new Promise((function(e){return setTimeout(e,500)}))]:[3,3];case 1:return s.sent(),[4,U(e,t,n,r-1)];case 2:return s.sent(),[3,4];case 3:T(!1),O(i),E([]),s.label=4;case 4:return[2]}}))}))})),[2]}))}))};return b&&(U(r,i,S,1),P(!1)),0===o.authors.length&&0===o.categories.length&&0===o.tags.length&&d?(0,f.jsx)("div",{className:"wp-parsely-related-posts",children:(0,f.jsx)("div",{className:"related-posts-body",children:(0,w.__)("Error: No author, section, or tags could be found for this post.","wp-parsely")})}):(0,f.jsxs)("div",{className:"wp-parsely-related-posts",children:[(0,f.jsx)("div",{className:"related-posts-description",children:(0,w.__)("Find top-performing related posts.","wp-parsely")}),(0,f.jsxs)("div",{className:"related-posts-body",children:[(0,f.jsxs)("div",{className:"related-posts-settings",children:[(0,f.jsx)(h.SelectControl,{size:"__unstable-large",onChange:function(e){return function(e){if(F(e,B)){var i=e;n({RelatedPosts:ir(ir({},t.RelatedPosts),{Metric:i})}),k.trackEvent("related_posts_metric_changed",{metric:i}),U(r,i,S,1)}}(e)},prefix:(0,f.jsx)(h.__experimentalInputControlPrefixWrapper,{children:(0,w.__)("Metric:","wp-parsely")}),value:i,children:Object.values(B).map((function(e){return(0,f.jsx)("option",{value:e,children:G(e)},e)}))}),(0,f.jsx)(h.SelectControl,{size:"__unstable-large",value:r,prefix:(0,f.jsxs)(h.__experimentalInputControlPrefixWrapper,{children:[(0,w.__)("Period:","wp-parsely")," "]}),onChange:function(e){return function(e){if(F(e,R)){var r=e;n({RelatedPosts:ir(ir({},t.RelatedPosts),{Period:r})}),k.trackEvent("related_posts_period_changed",{period:r}),U(r,i,S,1)}}(e)},children:Object.values(R).map((function(e){return(0,f.jsx)("option",{value:e,children:V(e)},e)}))})]}),(0,f.jsx)(Hn,{label:(0,w.__)("Filter by","wp-parsely"),filters:S,onFiltersChange:function(e,t){var n,s;if(null==e&&(e=""),M.Tag===t){var o=[];""!==e&&(o=e.split(",").map((function(e){return e.trim()}))),s=ir(ir({},S),{tags:o})}else s=ir(ir({},S),((n={})[t]=e,n));L(s),U(r,i,s,1)},postData:o}),(0,f.jsxs)("div",{className:"related-posts-wrapper",children:[C&&C.Message(),x&&(0,f.jsx)("div",{className:"related-posts-loading-message","data-testid":"parsely-related-posts-loading-message",children:(0,w.__)("Loading…","wp-parsely")}),!b&&!x&&!C&&0===_.length&&(0,f.jsx)("div",{className:"related-posts-empty",children:(0,w.__)("No related posts found.","wp-parsely")}),!x&&_.length>0&&(0,f.jsx)("div",{className:"related-posts-list",children:_.map((function(e){return(0,f.jsx)(Zn,{metric:i,post:e,postContent:D},e.id)}))})]})]})]})},lr=(0,f.jsx)(b.SVG,{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,f.jsx)(b.Path,{d:"M10.97 10.159a3.382 3.382 0 0 0-2.857.955l1.724 1.723-2.836 2.913L7 17h1.25l2.913-2.837 1.723 1.723a3.38 3.38 0 0 0 .606-.825c.33-.63.446-1.343.35-2.032L17 10.695 13.305 7l-2.334 3.159Z"})}),cr=(0,f.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,f.jsx)(b.Path,{d:"M18.3 11.7c-.6-.6-1.4-.9-2.3-.9H6.7l2.9-3.3-1.1-1-4.5 5L8.5 16l1-1-2.7-2.7H16c.5 0 .9.2 1.3.5 1 1 1 3.4 1 4.5v.3h1.5v-.2c0-1.5 0-4.3-1.5-5.7z"})}),ur=(0,f.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,f.jsx)(b.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M12 5.5A2.25 2.25 0 0 0 9.878 7h4.244A2.251 2.251 0 0 0 12 5.5ZM12 4a3.751 3.751 0 0 0-3.675 3H5v1.5h1.27l.818 8.997a2.75 2.75 0 0 0 2.739 2.501h4.347a2.75 2.75 0 0 0 2.738-2.5L17.73 8.5H19V7h-3.325A3.751 3.751 0 0 0 12 4Zm4.224 4.5H7.776l.806 8.861a1.25 1.25 0 0 0 1.245 1.137h4.347a1.25 1.25 0 0 0 1.245-1.137l.805-8.861Z"})}),pr=(0,f.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,f.jsx)(b.Path,{d:"m21.5 9.1-6.6-6.6-4.2 5.6c-1.2-.1-2.4.1-3.6.7-.1 0-.1.1-.2.1-.5.3-.9.6-1.2.9l3.7 3.7-5.7 5.7v1.1h1.1l5.7-5.7 3.7 3.7c.4-.4.7-.8.9-1.2.1-.1.1-.2.2-.3.6-1.1.8-2.4.6-3.6l5.6-4.1zm-7.3 3.5.1.9c.1.9 0 1.8-.4 2.6l-6-6c.8-.4 1.7-.5 2.6-.4l.9.1L15 4.9 19.1 9l-4.9 3.6z"})}),dr=function(){return dr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},dr.apply(this,arguments)},fr=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},hr=0;!function(e){e.PostTitle="postTitles",e.Heading="headings"}(rr||(rr={}));var vr={isLoading:!1,postTitles:{titles:[]},headings:{titles:[]}},gr=(0,v.createReduxStore)("wp-parsely/write-titles",{initialState:vr,reducer:function(e,t){var n,r,i,s,o,a;switch(void 0===e&&(e=vr),t.type){case"SET_LOADING":return dr(dr({},e),{isLoading:t.isLoading});case"SET_TITLES":return dr(dr({},e),((n={})[t.titleType]=dr(dr({},e[t.titleType]),{titles:fr(fr([],e[t.titleType].titles.filter((function(e){return e.isPinned})),!0),t.data.map((function(e){return{title:e,isPinned:!1,id:hr++}})),!0)}),n));case"REMOVE_TITLE":return dr(dr({},e),((r={})[t.titleType]=dr(dr({},e[t.titleType]),{titles:e[t.titleType].titles.filter((function(e){return e.id!==t.title.id}))}),r));case"PIN_TITLE":return dr(dr({},e),((i={})[t.titleType]=dr(dr({},e[t.titleType]),{titles:e[t.titleType].titles.map((function(e){return e.id===t.title.id?dr(dr({},e),{isPinned:!0}):e}))}),i));case"UNPIN_TITLE":return dr(dr({},e),((s={})[t.titleType]=dr(dr({},e[t.titleType]),{titles:e[t.titleType].titles.map((function(e){return e.id===t.title.id?dr(dr({},e),{isPinned:!1}):e}))}),s));case"SET_ACCEPTED_TITLE":return dr(dr({},e),((o={})[t.titleType]=dr(dr({},e[t.titleType]),{acceptedTitle:t.title}),o));case"SET_ORIGINAL_TITLE":return dr(dr({},e),((a={})[t.titleType]=dr(dr({},e[t.titleType]),{originalTitle:t.title}),a));default:return e}},actions:{setLoading:function(e){return{type:"SET_LOADING",isLoading:e}},setTitles:function(e,t){return{type:"SET_TITLES",titleType:e,data:t}},removeTitle:function(e,t){return{type:"REMOVE_TITLE",titleType:e,title:t}},setAcceptedTitle:function(e,t){return{type:"SET_ACCEPTED_TITLE",titleType:e,title:t}},pinTitle:function(e,t){return{type:"PIN_TITLE",titleType:e,title:t}},unpinTitle:function(e,t){return{type:"UNPIN_TITLE",titleType:e,title:t}},setOriginalTitle:function(e,t){return{type:"SET_ORIGINAL_TITLE",titleType:e,title:t}}},selectors:{getState:function(e){return e},isLoading:function(e){return e.isLoading},getTitles:function(e,t){return e[t].titles.map((function(e){return e}))},getPinnedTitles:function(e,t){return e[t].titles.filter((function(e){return e.isPinned}))},isPinned:function(e,t,n){var r,i;return null!==(i=null===(r=e[t].titles.find((function(e){return e.id===n.id})))||void 0===r?void 0:r.isPinned)&&void 0!==i&&i},getAcceptedTitle:function(e,t){return e[t].acceptedTitle},isAcceptedTitle:function(e,t,n){var r;return(null===(r=e[t].acceptedTitle)||void 0===r?void 0:r.id)===n.id},getOriginalTitle:function(e,t){var n;if(e[t].originalTitle)return{id:-1,title:null!==(n=e[t].originalTitle)&&void 0!==n?n:"",isPinned:!1}}}});(0,v.register)(gr);var yr=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))},mr=function(e,t){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},wr=function(e){var t=(0,m.useState)(!1),n=t[0],r=t[1],i=function(){return r(!1)},s=(0,v.useDispatch)(gr),o=s.removeTitle,a=s.setAcceptedTitle,l=s.pinTitle,c=s.unpinTitle,u=s.setOriginalTitle,p=(0,v.useSelect)((function(t){return t(gr).isPinned(e.type,e.title)}),[e.title,e.type]),d=(0,v.useSelect)((function(e){return(0,e("core/editor").getEditedPostAttribute)("title")}),[]),g=d===e.title.title,y=function(){return yr(void 0,void 0,void 0,(function(){return mr(this,(function(t){switch(t.label){case 0:return k.trackEvent("title_suggestion_pinned",{pinned:!p,type:e.type,title:e.title.title}),p?[4,c(e.type,e.title)]:[3,2];case 1:return t.sent(),[3,4];case 2:return[4,l(e.type,e.title)];case 3:t.sent(),t.label=4;case 4:return[2]}}))}))};return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{className:"wp-parsely-title-suggestion"+(g?" title-in-use":"")+(e.isOriginal?" original-title":"")+(p?" pinned-title":""),children:[(0,f.jsxs)("div",{className:"suggested-title",children:[e.isOriginal&&(0,f.jsx)(h.__experimentalHeading,{className:"suggested-title-original",level:3,children:(0,w.__)("Original","wp-parsely")}),e.title.title]}),(0,f.jsx)("div",{className:"suggested-title-actions",children:(0,f.jsxs)("div",{className:"suggested-title-actions-container",children:[e.isOriginal&&(0,f.jsx)(h.Button,{onClick:function(){return yr(void 0,void 0,void 0,(function(){return mr(this,(function(t){switch(t.label){case 0:return k.trackEvent("title_suggestion_restored",{type:e.type,restored_title:e.title.title,accepted_title:d}),W.editPost({title:e.title.title}),[4,u(e.type,void 0)];case 1:return t.sent(),[2]}}))}))},icon:cr,label:(0,w.__)("Restore","wp-parsely")}),!e.isOriginal&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{className:"suggested-title-actions-left",children:[(0,f.jsx)(h.Button,{onClick:function(){g||r(!0)},disabled:g,icon:Mt,label:g?(0,w.__)("Applied","wp-parsely"):(0,w.__)("Apply","wp-parsely")}),!p&&(0,f.jsx)(h.Button,{onClick:function(){return yr(void 0,void 0,void 0,(function(){return mr(this,(function(t){switch(t.label){case 0:return k.trackEvent("title_suggestion_removed",{type:e.type,title:e.title.title}),[4,o(e.type,e.title)];case 1:return t.sent(),[2]}}))}))},icon:ur,label:(0,w.__)("Remove","wp-parsely")})]}),(0,f.jsx)(qn,{}),(0,f.jsx)("div",{className:"suggested-title-actions-right",children:p?(0,f.jsx)(h.Button,{onClick:y,icon:dn,label:(0,w.__)("Unpin","wp-parsely")}):(0,f.jsx)(h.Button,{onClick:y,icon:pr,label:(0,w.__)("Pin","wp-parsely")})})]})]})})]}),n&&(0,f.jsx)(h.Modal,{title:(0,w.__)("Replace Title?","wp-parsely"),onRequestClose:i,children:(0,f.jsxs)("div",{className:"wp-parsely-suggested-title-modal",children:[(0,f.jsx)("h2",{children:e.title.title}),(0,w.__)("You'll still be able to restore your original title until you exit the editor.","wp-parsely"),(0,f.jsxs)("div",{className:"suggested-title-modal-actions",children:[(0,f.jsx)(h.Button,{onClick:i,variant:"secondary",children:(0,w.__)("Cancel","wp-parsely")}),(0,f.jsx)(h.Button,{onClick:function(){return yr(void 0,void 0,void 0,(function(){return mr(this,(function(t){switch(t.label){case 0:return g?[2]:(k.trackEvent("title_suggestion_applied",{title:e.title.title,type:e.type}),[4,a(e.type,e.title)]);case 1:return t.sent(),i(),[2]}}))}))},variant:"primary",children:(0,w.__)("Replace","wp-parsely")})]})]})})]})},br=function(e){var t=e.pinnedTitles,n=e.isOpen,r=(0,m.useState)(n),i=r[0],s=r[1];return(0,f.jsx)(h.Panel,{className:"wp-parsely-pinned-suggestions",children:(0,f.jsx)(h.PanelBody,{className:"wp-parsely-collapsible-panel",icon:lr,title:(0,w.__)("Pinned","wp-parsely"),onToggle:function(){s(!i),k.trackEvent("title_suggestions_pinned_toggled",{is_open:!i,pinned_titles:t.length})},opened:i,children:(0,f.jsx)("div",{className:"title-suggestions-container",children:t.map((function(e){return(0,f.jsx)(wr,{title:e,type:rr.PostTitle},e.title)}))})})})},xr=function(e){var t=e.isLoading,n=e.onPersonaChange,r=e.onToneChange,i=e.persona,s=e.tone;return(0,f.jsxs)("div",{className:"title-suggestions-settings",children:[(0,f.jsx)(ye,{tone:s,value:he(s),onChange:function(e){r(e)},onDropdownChange:function(e){k.trackEvent("title_suggestions_ai_tone_changed",{tone:e})},disabled:t,allowCustom:!0}),(0,f.jsx)(pe,{persona:i,value:le(i),onChange:function(e){n(e)},onDropdownChange:function(e){k.trackEvent("title_suggestions_ai_persona_changed",{persona:e})},disabled:t,allowCustom:!0})]})},_r=function(e){var t=e.suggestions,n=e.isOpen,r=e.isLoading,i=void 0!==r&&r,s=(0,m.useState)(n),o=s[0],a=s[1];return(0,f.jsx)(h.Panel,{className:"wp-parsely-title-suggestions",children:(0,f.jsx)(h.PanelBody,{className:"wp-parsely-collapsible-panel",title:(0,w.__)("Suggestions","wp-parsely"),icon:(0,f.jsx)(Et,{className:"components-panel__icon"}),onToggle:function(){a(!o),k.trackEvent("title_suggestions_suggestions_toggled",{is_open:!o,suggestions:t.length})},opened:o,children:(0,f.jsxs)("div",{className:"title-suggestions-container",children:[i&&(0,f.jsxs)("div",{className:"wp-parsely-loading-overlay",children:[(0,f.jsx)(h.Spinner,{}),(0,w.__)("Loading…","wp-parsely")]}),t.map((function(e){return(0,f.jsx)(wr,{title:e,type:rr.PostTitle},e.title)}))]})})})},kr=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Sr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return kr(t,e),t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.generateTitles=function(e){return t=this,n=arguments,i=function(e,t,n,r){var i;return void 0===t&&(t=3),function(e,t){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}(this,(function(s){return[2,null!=(i=this.fetch({method:"POST",path:(0,we.addQueryArgs)("/wp-parsely/v2/content-helper/title-suggestions/generate",{limit:t,tone:he(n),persona:le(r)}),data:{text:e}}))?i:[]]}))},new((r=void 0)||(r=Promise))((function(e,s){function o(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(o,a)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i},t}(be),jr=function(){return jr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},jr.apply(this,arguments)},Pr=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))},Tr=function(e,t){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},Er=function(){var e=I(),t=e.settings,n=e.setSettings,r=(0,m.useState)(),i=r[0],s=r[1],o=(0,m.useState)(t.TitleSuggestions.Tone),a=o[0],l=o[1],c=(0,m.useState)(t.TitleSuggestions.Persona),u=c[0],p=c[1],d=(0,v.useSelect)((function(e){var t=e(gr),n=t.isLoading,r=t.getTitles,i=t.getAcceptedTitle,s=t.getOriginalTitle,o=r(rr.PostTitle);return{acceptedTitle:i(rr.PostTitle),loading:n(),titles:o.filter((function(e){return!e.isPinned})),pinnedTitles:o.filter((function(e){return e.isPinned})),allTitles:o,originalTitle:s(rr.PostTitle)}}),[]),g=d.loading,y=d.titles,b=d.pinnedTitles,x=d.allTitles,_=d.acceptedTitle,S=d.originalTitle,j=(0,v.useDispatch)(gr),P=j.setTitles,T=j.setLoading,E=j.setAcceptedTitle,L=j.setOriginalTitle,N=(0,v.useDispatch)("core/notices").createNotice,C=function(e,r){var i;n({TitleSuggestions:jr(jr({},t.TitleSuggestions),(i={},i[e]=r,i))})},O=(0,v.useSelect)((function(e){return(0,e("core/editor").getEditedPostContent)()}),[]),A=(0,v.useSelect)((function(e){return(0,e("core/editor").getEditedPostAttribute)("title")}),[]);return(0,m.useEffect)((function(){_&&(L(rr.PostTitle,A),W.editPost({title:null==_?void 0:_.title}),_&&((0,v.dispatch)(gr).pinTitle(rr.PostTitle,_),k.trackEvent("title_suggestions_accept_pressed",{old_title:A,new_title:_.title})),E(rr.PostTitle,void 0),N("success",(0,w.__)("Title suggestion applied.","wp-parsely"),{type:"snackbar",className:"parsely-title-suggestion-applied",explicitDismiss:!0,actions:[{label:(0,w.__)("Undo","wp-parsely"),onClick:function(){W.editPost({title:A}),L(rr.PostTitle,void 0)}}]}))}),[_]),(0,m.useEffect)((function(){void 0!==i&&i.createErrorSnackbar()}),[i]),(0,f.jsx)(h.PanelRow,{children:(0,f.jsxs)("div",{className:"wp-parsely-title-suggestions-wrapper",children:[(0,f.jsxs)("div",{className:"title-suggestions-header",children:[x.length>0?(0,f.jsx)("span",{className:"parsely-write-titles-text",children:(0,m.createInterpolateElement)(
// translators: %1$s is the tone, %2$s is the persona.
// translators: %1$s is the tone, %2$s is the persona.
(0,w.__)("We've generated a few <tone/> titles based on the content of your post, written as a <persona/>.","wp-parsely"),{tone:(0,f.jsx)("strong",{children:he(a)}),persona:(0,f.jsx)("strong",{children:le(u)})})}):(0,w.__)("Use Parse.ly AI to generate a title for your post.","wp-parsely"),(0,f.jsxs)(h.Button,{href:"https://docs.wpvip.com/parse-ly/wp-parsely-features/title-suggestions/",target:"_blank",variant:"link",children:[(0,w.__)("Learn more about Parse.ly AI","wp-parsely"),(0,f.jsx)(ie,{icon:$,size:18,className:"parsely-external-link-icon"})]})]}),i&&(0,f.jsx)(h.Notice,{className:"wp-parsely-content-helper-error",onRemove:function(){return s(void 0)},status:"info",children:i.Message()}),void 0!==S&&(0,f.jsx)(wr,{title:S,type:rr.PostTitle,isOriginal:!0}),0<x.length&&(0,f.jsxs)(f.Fragment,{children:[b.length>0&&(0,f.jsx)(br,{pinnedTitles:b,isOpen:!0}),y.length>0&&(0,f.jsx)(_r,{suggestions:y,isOpen:!0,isLoading:g})]}),(0,f.jsx)(xr,{isLoading:g,onPersonaChange:function(e){C("Persona",e),p(e)},onSettingChange:C,onToneChange:function(e){C("Tone",e),l(e)},persona:t.TitleSuggestions.Persona,tone:t.TitleSuggestions.Tone}),(0,f.jsx)("div",{className:"title-suggestions-generate",children:(0,f.jsxs)(h.Button,{variant:"primary",isBusy:g,disabled:g||"custom"===a||"custom"===u,onClick:function(){return Pr(void 0,void 0,void 0,(function(){return Tr(this,(function(e){switch(e.label){case 0:return s(void 0),!1!==g?[3,2]:(k.trackEvent("title_suggestions_generate_pressed",{request_more:y.length>0,total_titles:y.length,total_pinned:y.filter((function(e){return e.isPinned})).length,tone:a,persona:u}),[4,(t=rr.PostTitle,n=O,r=a,i=u,Pr(void 0,void 0,void 0,(function(){var e,o,a;return Tr(this,(function(l){switch(l.label){case 0:return[4,T(!0)];case 1:l.sent(),e=Sr.getInstance(),l.label=2;case 2:return l.trys.push([2,5,,6]),[4,e.generateTitles(n,3,r,i)];case 3:return o=l.sent(),[4,P(t,o)];case 4:return l.sent(),[3,6];case 5:return a=l.sent(),s(a),P(t,[]),[3,6];case 6:return[4,T(!1)];case 7:return l.sent(),[2]}}))})))]);case 1:e.sent(),e.label=2;case 2:return[2]}var t,n,r,i}))}))},children:[g&&(0,w.__)("Generating Titles…","wp-parsely"),!g&&x.length>0&&(0,w.__)("Generate More","wp-parsely"),!g&&0===x.length&&(0,w.__)("Generate Titles","wp-parsely")]})})]})})},Lr=function(){return Lr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Lr.apply(this,arguments)},Nr=function(e){var t=e.trackToggle,n=e.permissions,r=I(),i=r.settings,s=r.setSettings;return(0,f.jsxs)(h.Panel,{children:[n.TitleSuggestions&&(0,f.jsx)(h.PanelBody,{title:(0,w.__)("Title Suggestions","wp-parsely"),initialOpen:i.TitleSuggestions.Open,onToggle:function(e){s({TitleSuggestions:Lr(Lr({},i.TitleSuggestions),{Open:e})}),t("title_suggestions",e)},children:(0,f.jsx)(Ie,{children:(0,f.jsx)(Er,{})})}),n.ExcerptSuggestions&&(0,f.jsx)(q.PostTypeSupportCheck,{supportKeys:"excerpt",children:(0,f.jsx)(h.PanelBody,{title:(0,w.__)("Excerpt Suggestions","wp-parsely"),initialOpen:i.ExcerptSuggestions.Open,onToggle:function(e){s({ExcerptSuggestions:Lr(Lr({},i.ExcerptSuggestions),{Open:e})}),t("excerpt_suggestions",e)},children:(0,f.jsx)(Ie,{children:(0,f.jsx)(Pe,{})})})}),n.SmartLinking&&(0,f.jsx)(h.PanelBody,{title:(0,w.__)("Smart Linking","wp-parsely"),initialOpen:i.SmartLinking.Open,onToggle:function(e){s({SmartLinking:Lr(Lr({},i.SmartLinking),{Open:e})}),t("smart_linking",e)},children:(0,f.jsx)(Ie,{children:(0,f.jsx)(Xt,{context:Vt.ContentHelperSidebar,permissions:n})})}),(0,f.jsx)(h.PanelBody,{title:(0,w.__)("Related Posts","wp-parsely"),initialOpen:i.RelatedPosts.Open,onToggle:function(e){s({RelatedPosts:Lr(Lr({},i.RelatedPosts),{Open:e})}),t("related_top_posts",e)},children:(0,f.jsx)(Ie,{children:(0,f.jsx)(ar,{})})})]})},Cr=function(){return Cr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Cr.apply(this,arguments)},Or="wp-parsely-block-editor-sidebar",Ar=function(e){void 0===e&&(e="");var t,n={InitialTabName:"tools",PerformanceStats:{Period:R.Days7,VisiblePanels:["overview","categories","referrers"],VisibleDataPoints:["views","visitors","avgEngaged","recirculation"]},RelatedPosts:{Metric:B.Views,Open:!1,Period:R.Days7},SmartLinking:{MaxLinks:sn,Open:!1},TitleSuggestions:{Open:!1,Tone:"neutral",Persona:"journalist"},ExcerptSuggestions:{Open:!1,Persona:"journalist",Tone:"neutral"}};""===e&&(e=window.wpParselyContentHelperSettings);try{t=JSON.parse(e)}catch(e){return n}var r=Cr(Cr({},n),t);return"string"!=typeof r.InitialTabName&&(r.InitialTabName=n.InitialTabName),"object"!=typeof r.PerformanceStats&&(r.PerformanceStats=n.PerformanceStats),F(r.PerformanceStats.Period,R)||(r.PerformanceStats.Period=n.PerformanceStats.Period),Array.isArray(r.PerformanceStats.VisiblePanels)||(r.PerformanceStats.VisiblePanels=n.PerformanceStats.VisiblePanels),Array.isArray(r.PerformanceStats.VisibleDataPoints)||(r.PerformanceStats.VisibleDataPoints=n.PerformanceStats.VisibleDataPoints),"object"!=typeof r.RelatedPosts&&(r.RelatedPosts=n.RelatedPosts),F(r.RelatedPosts.Metric,B)||(r.RelatedPosts.Metric=n.RelatedPosts.Metric),"boolean"!=typeof r.RelatedPosts.Open&&(r.RelatedPosts.Open=n.RelatedPosts.Open),F(r.RelatedPosts.Period,R)||(r.RelatedPosts.Period=n.RelatedPosts.Period),"object"!=typeof r.SmartLinking&&(r.SmartLinking=n.SmartLinking),"number"!=typeof r.SmartLinking.MaxLinks&&(r.SmartLinking.MaxLinks=n.SmartLinking.MaxLinks),"boolean"!=typeof r.SmartLinking.Open&&(r.SmartLinking.Open=n.SmartLinking.Open),"object"!=typeof r.TitleSuggestions&&(r.TitleSuggestions=n.TitleSuggestions),"boolean"!=typeof r.TitleSuggestions.Open&&(r.TitleSuggestions.Open=n.TitleSuggestions.Open),"string"!=typeof r.TitleSuggestions.Tone&&(r.TitleSuggestions.Tone=n.TitleSuggestions.Tone),"string"!=typeof r.TitleSuggestions.Persona&&(r.TitleSuggestions.Persona=n.TitleSuggestions.Persona),"object"!=typeof r.ExcerptSuggestions&&(r.ExcerptSuggestions=n.ExcerptSuggestions),"boolean"!=typeof r.ExcerptSuggestions.Open&&(r.ExcerptSuggestions.Open=n.ExcerptSuggestions.Open),"string"!=typeof r.ExcerptSuggestions.Tone&&(r.ExcerptSuggestions.Tone=n.ExcerptSuggestions.Tone),"string"!=typeof r.ExcerptSuggestions.Persona&&(r.ExcerptSuggestions.Persona=n.ExcerptSuggestions.Persona),r},Ir=function(){var e=I(),t=e.settings,n=e.setSettings,r=H(),i=(0,v.useSelect)((function(e){var t;return(null===(t=window.wp.editor)||void 0===t?void 0:t.PluginSidebar)?e("core/interface").getActiveComplementaryArea("core"):e("core/interface").getActiveComplementaryArea("core/edit-post")}),[]);(0,m.useEffect)((function(){"wp-parsely-block-editor-sidebar/wp-parsely-content-helper"===i&&k.trackEvent("editor_sidebar_opened")}),[i]);var s=function(e,t){t?k.trackEvent("editor_sidebar_panel_opened",{panel:e}):k.trackEvent("editor_sidebar_panel_closed",{panel:e})};return(0,f.jsx)(d,{icon:(0,f.jsx)(j,{className:"wp-parsely-sidebar-icon"}),name:"wp-parsely-content-helper",className:"wp-parsely-content-helper",title:(0,w.__)("Parse.ly","wp-parsely"),children:(0,f.jsx)(D,{endpoint:"editor-sidebar",defaultSettings:Ar(),children:(0,f.jsx)(h.Panel,{className:"wp-parsely-sidebar-main-panel",children:(0,f.jsx)(h.TabPanel,{className:"wp-parsely-sidebar-tabs",initialTabName:t.InitialTabName,tabs:[{icon:(0,f.jsx)(S,{}),name:"tools",title:(0,w.__)("Tools","wp-parsely")},{icon:x,name:"performance",title:(0,w.__)("Performance","wp-parsely")}],onSelect:function(e){n(Cr(Cr({},t),{InitialTabName:e})),k.trackEvent("editor_sidebar_tab_selected",{tab:e})},children:function(e){return(0,f.jsxs)(f.Fragment,{children:["tools"===e.name&&(0,f.jsx)(Nr,{permissions:r,trackToggle:s}),"performance"===e.name&&(0,f.jsx)(Gn,{period:t.PerformanceStats.Period})]})}})})})})};Ne&&Ne(),(0,_.registerPlugin)(Or,{icon:j,render:function(){return(0,f.jsx)(D,{endpoint:"editor-sidebar",defaultSettings:Ar(),children:(0,f.jsx)(Ir,{})})}}),y()((function(){pn&&pn()}))}()}();
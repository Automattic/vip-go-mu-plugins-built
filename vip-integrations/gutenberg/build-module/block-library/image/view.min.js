import{store as B,getContext as b,getElement as x,withSyncEvent as S}from"@wordpress/interactivity";var w=!1,W=0,{state:e,actions:O,callbacks:$}=B("core/image",{state:{currentImageId:null,get currentImage(){return e.metadata[e.currentImageId]},get overlayOpened(){return e.currentImageId!==null},get roleAttribute(){return e.overlayOpened?"dialog":null},get ariaModal(){return e.overlayOpened?"true":null},get enlargedSrc(){return e.currentImage.uploadedSrc||"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},get figureStyles(){return e.overlayOpened&&`${e.currentImage.figureStyles?.replace(/margin[^;]*;?/g,"")};`},get imgStyles(){return e.overlayOpened&&`${e.currentImage.imgStyles?.replace(/;$/,"")}; object-fit:cover;`},get imageButtonRight(){let{imageId:t}=b();return e.metadata[t].imageButtonRight},get imageButtonTop(){let{imageId:t}=b();return e.metadata[t].imageButtonTop},get isContentHidden(){let t=b();return e.overlayEnabled&&e.currentImageId===t.imageId},get isContentVisible(){let t=b();return!e.overlayEnabled&&e.currentImageId===t.imageId}},actions:{showLightbox(){let{imageId:t}=b();e.metadata[t].imageRef?.complete&&(e.scrollTopReset=document.documentElement.scrollTop,e.scrollLeftReset=document.documentElement.scrollLeft,e.overlayEnabled=!0,e.currentImageId=t,$.setOverlayStyles())},hideLightbox(){e.overlayEnabled&&(e.overlayEnabled=!1,setTimeout(function(){e.currentImage.buttonRef.focus({preventScroll:!0}),e.currentImageId=null},450))},handleKeydown:S(t=>{if(e.overlayEnabled){if(t.key==="Tab"){t.preventDefault();let{ref:c}=x();c.querySelector("button").focus()}t.key==="Escape"&&O.hideLightbox()}}),handleTouchMove:S(t=>{e.overlayEnabled&&t.preventDefault()}),handleTouchStart(){w=!0},handleTouchEnd(){W=Date.now(),w=!1},handleScroll(){e.overlayOpened&&!w&&Date.now()-W>450&&window.scrollTo(e.scrollLeftReset,e.scrollTopReset)}},callbacks:{setOverlayStyles(){if(!e.overlayEnabled)return;let{naturalWidth:t,naturalHeight:c,offsetWidth:g,offsetHeight:s}=e.currentImage.imageRef,{x:f,y:p}=e.currentImage.imageRef.getBoundingClientRect(),r=t/c,d=g/s;if(e.currentImage.scaleAttr==="contain")if(r>d){let l=g/r;p+=(s-l)/2,s=l}else{let l=s*r;f+=(g-l)/2,g=l}d=g/s;let n=parseFloat(e.currentImage.targetWidth!=="none"?e.currentImage.targetWidth:t),i=parseFloat(e.currentImage.targetHeight!=="none"?e.currentImage.targetHeight:c),u=n/i,h=n,m=i,o=n,a=i;if(r.toFixed(2)!==u.toFixed(2)){if(r>u){let l=n/r;i-l>n?(i=l,n=l*r):i=n/r}else{let l=i*r;n-l>i?(n=l,i=l/r):n=i*r}o=n,a=i,u=n/i,d>u?(h=n,m=h/d):(m=i,h=m*d)}(g>o||s>a)&&(o=g,a=s);let y=0;window.innerWidth>480?y=80:window.innerWidth>1920&&(y=160);let I=80,v=Math.min(window.innerWidth-y,o),R=Math.min(window.innerHeight-I,a),A=v/R;d>A?(o=v,a=o/d):(a=R,o=a*d);let E=g/o,H=n*(o/h),T=i*(a/m);e.overlayStyles=`
					--wp--lightbox-initial-top-position: ${p}px;
					--wp--lightbox-initial-left-position: ${f}px;
					--wp--lightbox-container-width: ${o+1}px;
					--wp--lightbox-container-height: ${a+1}px;
					--wp--lightbox-image-width: ${H}px;
					--wp--lightbox-image-height: ${T}px;
					--wp--lightbox-scale: ${E};
					--wp--lightbox-scrollbar-width: ${window.innerWidth-document.documentElement.clientWidth}px;
				`},setButtonStyles(){let{ref:t}=x();if(!t)return;let{imageId:c}=b();e.metadata[c].imageRef=t,e.metadata[c].currentSrc=t.currentSrc;let{naturalWidth:g,naturalHeight:s,offsetWidth:f,offsetHeight:p}=t;if(g===0||s===0)return;let r=t.parentElement,d=t.parentElement.clientWidth,n=t.parentElement.clientHeight,i=r.querySelector("figcaption");if(i){let a=window.getComputedStyle(i);["absolute","fixed"].includes(a.position)||(n=n-i.offsetHeight-parseFloat(a.marginTop)-parseFloat(a.marginBottom))}let u=n-p,h=d-f,m=u+16,o=h+16;if(e.metadata[c].scaleAttr==="contain"){let a=g/s,y=f/p;if(a>=y){let I=f/a;m=(p-I)/2+u+16,o=h+16}else{let I=p*a;m=u+16,o=(f-I)/2+h+16}}e.metadata[c].imageButtonTop=m,e.metadata[c].imageButtonRight=o},setOverlayFocus(){if(e.overlayEnabled){let{ref:t}=x();t.focus()}},initTriggerButton(){let{imageId:t}=b(),{ref:c}=x();e.metadata[t].buttonRef=c}}},{lock:!0});
//# sourceMappingURL=view.min.js.map

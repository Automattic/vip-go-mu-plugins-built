"use strict";var wp;(wp||={}).sync=(()=>{var nl=Object.create;var Wn=Object.defineProperty;var rl=Object.getOwnPropertyDescriptor;var sl=Object.getOwnPropertyNames;var il=Object.getPrototypeOf,ol=Object.prototype.hasOwnProperty;var mn=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),gi=(e,t)=>{for(var n in t)Wn(e,n,{get:t[n],enumerable:!0})},mi=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of sl(t))!ol.call(e,s)&&s!==n&&Wn(e,s,{get:()=>t[s],enumerable:!(r=rl(t,s))||r.enumerable});return e};var Pe=(e,t,n)=>(n=e!=null?nl(il(e)):{},mi(t||!e||!e.__esModule?Wn(n,"default",{value:e,enumerable:!0}):n,e)),cl=e=>mi(Wn({},"__esModule",{value:!0}),e);var hc=mn((Vu,uc)=>{uc.exports=window.wp.privateApis});var bc=mn((Gu,Sc)=>{Sc.exports=window.wp.hooks});var Ac=mn((Ju,Cc)=>{Cc.exports=window.wp.apiFetch});var Pc=mn((Lr,Fc)=>{(function(e,t){typeof Lr=="object"&&typeof Fc<"u"?t(Lr):typeof define=="function"&&define.amd?define(["exports"],t):(e=e||self,t(e.Diff={}))})(Lr,function(e){"use strict";function t(){}t.prototype={diff:function(d,g){var w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},S=w.callback;typeof w=="function"&&(S=w,w={}),this.options=w;var x=this;function b(L){return S?(setTimeout(function(){S(void 0,L)},0),!0):L}d=this.castInput(d),g=this.castInput(g),d=this.removeEmpty(this.tokenize(d)),g=this.removeEmpty(this.tokenize(g));var k=g.length,v=d.length,_=1,O=k+v,N=[{newPos:-1,components:[]}],I=this.extractCommon(N[0],g,d,0);if(N[0].newPos+1>=k&&I+1>=v)return b([{value:this.join(g),count:g.length}]);function B(){for(var L=-1*_;L<=_;L+=2){var it=void 0,dt=N[L-1],ot=N[L+1],ut=(ot?ot.newPos:0)-L;dt&&(N[L-1]=void 0);var K=dt&&dt.newPos+1<k,Ht=ot&&0<=ut&&ut<v;if(!K&&!Ht){N[L]=void 0;continue}if(!K||Ht&&dt.newPos<ot.newPos?(it=r(ot),x.pushComponent(it.components,void 0,!0)):(it=dt,it.newPos++,x.pushComponent(it.components,!0,void 0)),ut=x.extractCommon(it,g,d,L),it.newPos+1>=k&&ut+1>=v)return b(n(x,it.components,g,d,x.useLongestToken));N[L]=it}_++}if(S)(function L(){setTimeout(function(){if(_>O)return S();B()||L()},0)})();else for(;_<=O;){var J=B();if(J)return J}},pushComponent:function(d,g,w){var S=d[d.length-1];S&&S.added===g&&S.removed===w?d[d.length-1]={count:S.count+1,added:g,removed:w}:d.push({count:1,added:g,removed:w})},extractCommon:function(d,g,w,S){for(var x=g.length,b=w.length,k=d.newPos,v=k-S,_=0;k+1<x&&v+1<b&&this.equals(g[k+1],w[v+1]);)k++,v++,_++;return _&&d.components.push({count:_}),d.newPos=k,v},equals:function(d,g){return this.options.comparator?this.options.comparator(d,g):d===g||this.options.ignoreCase&&d.toLowerCase()===g.toLowerCase()},removeEmpty:function(d){for(var g=[],w=0;w<d.length;w++)d[w]&&g.push(d[w]);return g},castInput:function(d){return d},tokenize:function(d){return d.split("")},join:function(d){return d.join("")}};function n(h,d,g,w,S){for(var x=0,b=d.length,k=0,v=0;x<b;x++){var _=d[x];if(_.removed){if(_.value=h.join(w.slice(v,v+_.count)),v+=_.count,x&&d[x-1].added){var N=d[x-1];d[x-1]=d[x],d[x]=N}}else{if(!_.added&&S){var O=g.slice(k,k+_.count);O=O.map(function(B,J){var L=w[v+J];return L.length>B.length?L:B}),_.value=h.join(O)}else _.value=h.join(g.slice(k,k+_.count));k+=_.count,_.added||(v+=_.count)}}var I=d[b-1];return b>1&&typeof I.value=="string"&&(I.added||I.removed)&&h.equals("",I.value)&&(d[b-2].value+=I.value,d.pop()),d}function r(h){return{newPos:h.newPos,components:h.components.slice(0)}}var s=new t;function i(h,d,g){return s.diff(h,d,g)}function o(h,d){if(typeof h=="function")d.callback=h;else if(h)for(var g in h)h.hasOwnProperty(g)&&(d[g]=h[g]);return d}var c=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,l=/\S/,a=new t;a.equals=function(h,d){return this.options.ignoreCase&&(h=h.toLowerCase(),d=d.toLowerCase()),h===d||this.options.ignoreWhitespace&&!l.test(h)&&!l.test(d)},a.tokenize=function(h){for(var d=h.split(/(\s+|[()[\]{}'"]|\b)/),g=0;g<d.length-1;g++)!d[g+1]&&d[g+2]&&c.test(d[g])&&c.test(d[g+2])&&(d[g]+=d[g+2],d.splice(g+1,2),g--);return d};function u(h,d,g){return g=o(g,{ignoreWhitespace:!0}),a.diff(h,d,g)}function f(h,d,g){return a.diff(h,d,g)}var p=new t;p.tokenize=function(h){var d=[],g=h.split(/(\n|\r\n)/);g[g.length-1]||g.pop();for(var w=0;w<g.length;w++){var S=g[w];w%2&&!this.options.newlineIsToken?d[d.length-1]+=S:(this.options.ignoreWhitespace&&(S=S.trim()),d.push(S))}return d};function m(h,d,g){return p.diff(h,d,g)}function y(h,d,g){var w=o(g,{ignoreWhitespace:!0});return p.diff(h,d,w)}var E=new t;E.tokenize=function(h){return h.split(/(\S.+?[.!?])(?=\s+|$)/)};function C(h,d,g){return E.diff(h,d,g)}var D=new t;D.tokenize=function(h){return h.split(/([{}:;,]|\s+)/)};function z(h,d,g){return D.diff(h,d,g)}function R(h){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?R=function(d){return typeof d}:R=function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},R(h)}function j(h){return G(h)||wt(h)||vt()}function G(h){if(Array.isArray(h)){for(var d=0,g=new Array(h.length);d<h.length;d++)g[d]=h[d];return g}}function wt(h){if(Symbol.iterator in Object(h)||Object.prototype.toString.call(h)==="[object Arguments]")return Array.from(h)}function vt(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var yt=Object.prototype.toString,X=new t;X.useLongestToken=!0,X.tokenize=p.tokenize,X.castInput=function(h){var d=this.options,g=d.undefinedReplacement,w=d.stringifyReplacer,S=w===void 0?function(x,b){return typeof b>"u"?g:b}:w;return typeof h=="string"?h:JSON.stringify(_t(h,null,null,S),S,"  ")},X.equals=function(h,d){return t.prototype.equals.call(X,h.replace(/,([\r\n])/g,"$1"),d.replace(/,([\r\n])/g,"$1"))};function Xt(h,d,g){return X.diff(h,d,g)}function _t(h,d,g,w,S){d=d||[],g=g||[],w&&(h=w(S,h));var x;for(x=0;x<d.length;x+=1)if(d[x]===h)return g[x];var b;if(yt.call(h)==="[object Array]"){for(d.push(h),b=new Array(h.length),g.push(b),x=0;x<h.length;x+=1)b[x]=_t(h[x],d,g,w,S);return d.pop(),g.pop(),b}if(h&&h.toJSON&&(h=h.toJSON()),R(h)==="object"&&h!==null){d.push(h),b={},g.push(b);var k=[],v;for(v in h)h.hasOwnProperty(v)&&k.push(v);for(k.sort(),x=0;x<k.length;x+=1)v=k[x],b[v]=_t(h[v],d,g,w,v);d.pop(),g.pop()}else b=h;return b}var Yt=new t;Yt.tokenize=function(h){return h.slice()},Yt.join=Yt.removeEmpty=function(h){return h};function Nr(h,d,g){return Yt.diff(h,d,g)}function Be(h){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},g=h.split(/\r\n|[\n\v\f\r\x85]/),w=h.match(/\r\n|[\n\v\f\r\x85]/g)||[],S=[],x=0;function b(){var _={};for(S.push(_);x<g.length;){var O=g[x];if(/^(\-\-\-|\+\+\+|@@)\s/.test(O))break;var N=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(O);N&&(_.index=N[1]),x++}for(k(_),k(_),_.hunks=[];x<g.length;){var I=g[x];if(/^(Index:|diff|\-\-\-|\+\+\+)\s/.test(I))break;if(/^@@/.test(I))_.hunks.push(v());else{if(I&&d.strict)throw new Error("Unknown line "+(x+1)+" "+JSON.stringify(I));x++}}}function k(_){var O=/^(---|\+\+\+)\s+(.*)$/.exec(g[x]);if(O){var N=O[1]==="---"?"old":"new",I=O[2].split("	",2),B=I[0].replace(/\\\\/g,"\\");/^".*"$/.test(B)&&(B=B.substr(1,B.length-2)),_[N+"FileName"]=B,_[N+"Header"]=(I[1]||"").trim(),x++}}function v(){for(var _=x,O=g[x++],N=O.split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),I={oldStart:+N[1],oldLines:+N[2]||1,newStart:+N[3],newLines:+N[4]||1,lines:[],linedelimiters:[]},B=0,J=0;x<g.length&&!(g[x].indexOf("--- ")===0&&x+2<g.length&&g[x+1].indexOf("+++ ")===0&&g[x+2].indexOf("@@")===0);x++){var L=g[x].length==0&&x!=g.length-1?" ":g[x][0];if(L==="+"||L==="-"||L===" "||L==="\\")I.lines.push(g[x]),I.linedelimiters.push(w[x]||`
`),L==="+"?B++:L==="-"?J++:L===" "&&(B++,J++);else break}if(!B&&I.newLines===1&&(I.newLines=0),!J&&I.oldLines===1&&(I.oldLines=0),d.strict){if(B!==I.newLines)throw new Error("Added line count did not match for hunk at line "+(_+1));if(J!==I.oldLines)throw new Error("Removed line count did not match for hunk at line "+(_+1))}return I}for(;x<g.length;)b();return S}function Qt(h,d,g){var w=!0,S=!1,x=!1,b=1;return function k(){if(w&&!x){if(S?b++:w=!1,h+b<=g)return b;x=!0}if(!S)return x||(w=!0),d<=h-b?-b++:(S=!0,k())}}function It(h,d){var g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof d=="string"&&(d=Be(d)),Array.isArray(d)){if(d.length>1)throw new Error("applyPatch only works with a single input.");d=d[0]}var w=h.split(/\r\n|[\n\v\f\r\x85]/),S=h.match(/\r\n|[\n\v\f\r\x85]/g)||[],x=d.hunks,b=g.compareLine||function(jr,gn,qn,ge){return gn===ge},k=0,v=g.fuzzFactor||0,_=0,O=0,N,I;function B(jr,gn){for(var qn=0;qn<jr.lines.length;qn++){var ge=jr.lines[qn],Yr=ge.length>0?ge[0]:" ",el=ge.length>0?ge.substr(1):ge;if(Yr===" "||Yr==="-"){if(!b(gn+1,w[gn],Yr,el)&&(k++,k>v))return!1;gn++}}return!0}for(var J=0;J<x.length;J++){for(var L=x[J],it=w.length-L.oldLines,dt=0,ot=O+L.oldStart-1,ut=Qt(ot,_,it);dt!==void 0;dt=ut())if(B(L,ot+dt)){L.offset=O+=dt;break}if(dt===void 0)return!1;_=L.offset+L.oldStart+L.oldLines}for(var K=0,Ht=0;Ht<x.length;Ht++){var xt=x[Ht],Ct=xt.oldStart+xt.offset+K-1;K+=xt.newLines-xt.oldLines,Ct<0&&(Ct=0);for(var zt=0;zt<xt.lines.length;zt++){var Gt=xt.lines[zt],Zt=Gt.length>0?Gt[0]:" ",Kn=Gt.length>0?Gt.substr(1):Gt,Pr=xt.linedelimiters[zt];if(Zt===" ")Ct++;else if(Zt==="-")w.splice(Ct,1),S.splice(Ct,1);else if(Zt==="+")w.splice(Ct,0,Kn),S.splice(Ct,0,Pr),Ct++;else if(Zt==="\\"){var pn=xt.lines[zt-1]?xt.lines[zt-1][0]:null;pn==="+"?N=!0:pn==="-"&&(I=!0)}}}if(N)for(;!w[w.length-1];)w.pop(),S.pop();else I&&(w.push(""),S.push(`
`));for(var pe=0;pe<w.length-1;pe++)w[pe]=w[pe]+S[pe];return w.join("")}function Mr(h,d){typeof h=="string"&&(h=Be(h));var g=0;function w(){var S=h[g++];if(!S)return d.complete();d.loadFile(S,function(x,b){if(x)return d.complete(x);var k=It(b,S,d);d.patched(S,k,function(v){if(v)return d.complete(v);w()})})}w()}function Fe(h,d,g,w,S,x,b){b||(b={}),typeof b.context>"u"&&(b.context=4);var k=m(g,w,b);k.push({value:"",lines:[]});function v(dt){return dt.map(function(ot){return" "+ot})}for(var _=[],O=0,N=0,I=[],B=1,J=1,L=function(ot){var ut=k[ot],K=ut.lines||ut.value.replace(/\n$/,"").split(`
`);if(ut.lines=K,ut.added||ut.removed){var Ht;if(!O){var xt=k[ot-1];O=B,N=J,xt&&(I=b.context>0?v(xt.lines.slice(-b.context)):[],O-=I.length,N-=I.length)}(Ht=I).push.apply(Ht,j(K.map(function(pe){return(ut.added?"+":"-")+pe}))),ut.added?J+=K.length:B+=K.length}else{if(O)if(K.length<=b.context*2&&ot<k.length-2){var Ct;(Ct=I).push.apply(Ct,j(v(K)))}else{var zt,Gt=Math.min(K.length,b.context);(zt=I).push.apply(zt,j(v(K.slice(0,Gt))));var Zt={oldStart:O,oldLines:B-O+Gt,newStart:N,newLines:J-N+Gt,lines:I};if(ot>=k.length-2&&K.length<=b.context){var Kn=/\n$/.test(g),Pr=/\n$/.test(w),pn=K.length==0&&I.length>Zt.oldLines;!Kn&&pn&&I.splice(Zt.oldLines,0,"\\ No newline at end of file"),(!Kn&&!pn||!Pr)&&I.push("\\ No newline at end of file")}_.push(Zt),O=0,N=0,I=[]}B+=K.length,J+=K.length}},it=0;it<k.length;it++)L(it);return{oldFileName:h,newFileName:d,oldHeader:S,newHeader:x,hunks:_}}function ii(h,d,g,w,S,x,b){var k=Fe(h,d,g,w,S,x,b),v=[];h==d&&v.push("Index: "+h),v.push("==================================================================="),v.push("--- "+k.oldFileName+(typeof k.oldHeader>"u"?"":"	"+k.oldHeader)),v.push("+++ "+k.newFileName+(typeof k.newHeader>"u"?"":"	"+k.newHeader));for(var _=0;_<k.hunks.length;_++){var O=k.hunks[_];v.push("@@ -"+O.oldStart+","+O.oldLines+" +"+O.newStart+","+O.newLines+" @@"),v.push.apply(v,O.lines)}return v.join(`
`)+`
`}function Gc(h,d,g,w,S,x){return ii(h,h,d,g,w,S,x)}function $c(h,d){return h.length!==d.length?!1:Vr(h,d)}function Vr(h,d){if(d.length>h.length)return!1;for(var g=0;g<d.length;g++)if(d[g]!==h[g])return!1;return!0}function Jc(h){var d=Fr(h.lines),g=d.oldLines,w=d.newLines;g!==void 0?h.oldLines=g:delete h.oldLines,w!==void 0?h.newLines=w:delete h.newLines}function Kc(h,d,g){h=oi(h,g),d=oi(d,g);var w={};(h.index||d.index)&&(w.index=h.index||d.index),(h.newFileName||d.newFileName)&&(ci(h)?ci(d)?(w.oldFileName=Jn(w,h.oldFileName,d.oldFileName),w.newFileName=Jn(w,h.newFileName,d.newFileName),w.oldHeader=Jn(w,h.oldHeader,d.oldHeader),w.newHeader=Jn(w,h.newHeader,d.newHeader)):(w.oldFileName=h.oldFileName,w.newFileName=h.newFileName,w.oldHeader=h.oldHeader,w.newHeader=h.newHeader):(w.oldFileName=d.oldFileName||h.oldFileName,w.newFileName=d.newFileName||h.newFileName,w.oldHeader=d.oldHeader||h.oldHeader,w.newHeader=d.newHeader||h.newHeader)),w.hunks=[];for(var S=0,x=0,b=0,k=0;S<h.hunks.length||x<d.hunks.length;){var v=h.hunks[S]||{oldStart:1/0},_=d.hunks[x]||{oldStart:1/0};if(li(v,_))w.hunks.push(ai(v,b)),S++,k+=v.newLines-v.oldLines;else if(li(_,v))w.hunks.push(ai(_,k)),x++,b+=_.newLines-_.oldLines;else{var O={oldStart:Math.min(v.oldStart,_.oldStart),oldLines:0,newStart:Math.min(v.newStart+b,_.oldStart+k),newLines:0,lines:[]};qc(O,v.oldStart,v.lines,_.oldStart,_.lines),x++,S++,w.hunks.push(O)}}return w}function oi(h,d){if(typeof h=="string"){if(/^@@/m.test(h)||/^Index:/m.test(h))return Be(h)[0];if(!d)throw new Error("Must provide a base reference or pass in a patch");return Fe(void 0,void 0,d,h)}return h}function ci(h){return h.newFileName&&h.newFileName!==h.oldFileName}function Jn(h,d,g){return d===g?d:(h.conflict=!0,{mine:d,theirs:g})}function li(h,d){return h.oldStart<d.oldStart&&h.oldStart+h.oldLines<d.oldStart}function ai(h,d){return{oldStart:h.oldStart,oldLines:h.oldLines,newStart:h.newStart+d,newLines:h.newLines,lines:h.lines}}function qc(h,d,g,w,S){var x={offset:d,lines:g,index:0},b={offset:w,lines:S,index:0};for(ui(h,x,b),ui(h,b,x);x.index<x.lines.length&&b.index<b.lines.length;){var k=x.lines[x.index],v=b.lines[b.index];if((k[0]==="-"||k[0]==="+")&&(v[0]==="-"||v[0]==="+"))Wc(h,x,b);else if(k[0]==="+"&&v[0]===" "){var _;(_=h.lines).push.apply(_,j(fe(x)))}else if(v[0]==="+"&&k[0]===" "){var O;(O=h.lines).push.apply(O,j(fe(b)))}else k[0]==="-"&&v[0]===" "?di(h,x,b):v[0]==="-"&&k[0]===" "?di(h,b,x,!0):k===v?(h.lines.push(k),x.index++,b.index++):Br(h,fe(x),fe(b))}hi(h,x),hi(h,b),Jc(h)}function Wc(h,d,g){var w=fe(d),S=fe(g);if(fi(w)&&fi(S)){if(Vr(w,S)&&pi(g,w,w.length-S.length)){var x;(x=h.lines).push.apply(x,j(w));return}else if(Vr(S,w)&&pi(d,S,S.length-w.length)){var b;(b=h.lines).push.apply(b,j(S));return}}else if($c(w,S)){var k;(k=h.lines).push.apply(k,j(w));return}Br(h,w,S)}function di(h,d,g,w){var S=fe(d),x=Xc(g,S);if(x.merged){var b;(b=h.lines).push.apply(b,j(x.merged))}else Br(h,w?x:S,w?S:x)}function Br(h,d,g){h.conflict=!0,h.lines.push({conflict:!0,mine:d,theirs:g})}function ui(h,d,g){for(;d.offset<g.offset&&d.index<d.lines.length;){var w=d.lines[d.index++];h.lines.push(w),d.offset++}}function hi(h,d){for(;d.index<d.lines.length;){var g=d.lines[d.index++];h.lines.push(g)}}function fe(h){for(var d=[],g=h.lines[h.index][0];h.index<h.lines.length;){var w=h.lines[h.index];if(g==="-"&&w[0]==="+"&&(g="+"),g===w[0])d.push(w),h.index++;else break}return d}function Xc(h,d){for(var g=[],w=[],S=0,x=!1,b=!1;S<d.length&&h.index<h.lines.length;){var k=h.lines[h.index],v=d[S];if(v[0]==="+")break;if(x=x||k[0]!==" ",w.push(v),S++,k[0]==="+")for(b=!0;k[0]==="+";)g.push(k),k=h.lines[++h.index];v.substr(1)===k.substr(1)?(g.push(k),h.index++):b=!0}if((d[S]||"")[0]==="+"&&x&&(b=!0),b)return g;for(;S<d.length;)w.push(d[S++]);return{merged:w,changes:g}}function fi(h){return h.reduce(function(d,g){return d&&g[0]==="-"},!0)}function pi(h,d,g){for(var w=0;w<g;w++){var S=d[d.length-g+w].substr(1);if(h.lines[h.index+w]!==" "+S)return!1}return h.index+=g,!0}function Fr(h){var d=0,g=0;return h.forEach(function(w){if(typeof w!="string"){var S=Fr(w.mine),x=Fr(w.theirs);d!==void 0&&(S.oldLines===x.oldLines?d+=S.oldLines:d=void 0),g!==void 0&&(S.newLines===x.newLines?g+=S.newLines:g=void 0)}else g!==void 0&&(w[0]==="+"||w[0]===" ")&&g++,d!==void 0&&(w[0]==="-"||w[0]===" ")&&d++}),{oldLines:d,newLines:g}}function Qc(h){for(var d=[],g,w,S=0;S<h.length;S++)g=h[S],g.added?w=1:g.removed?w=-1:w=0,d.push([w,g.value]);return d}function Zc(h){for(var d=[],g=0;g<h.length;g++){var w=h[g];w.added?d.push("<ins>"):w.removed&&d.push("<del>"),d.push(tl(w.value)),w.added?d.push("</ins>"):w.removed&&d.push("</del>")}return d.join("")}function tl(h){var d=h;return d=d.replace(/&/g,"&amp;"),d=d.replace(/</g,"&lt;"),d=d.replace(/>/g,"&gt;"),d=d.replace(/"/g,"&quot;"),d}e.Diff=t,e.diffChars=i,e.diffWords=u,e.diffWordsWithSpace=f,e.diffLines=m,e.diffTrimmedLines=y,e.diffSentences=C,e.diffCss=z,e.diffJson=Xt,e.diffArrays=Nr,e.structuredPatch=Fe,e.createTwoFilesPatch=ii,e.createPatch=Gc,e.applyPatch=It,e.applyPatches=Mr,e.parsePatch=Be,e.merge=Kc,e.convertChangesToDMP=Qc,e.convertChangesToXML=Zc,e.canonicalize=_t,Object.defineProperty(e,"__esModule",{value:!0})})});var ti=mn((xh,jc)=>{"use strict";jc.exports=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var r,s,i;if(Array.isArray(t)){if(r=t.length,r!=n.length)return!1;for(s=r;s--!==0;)if(!e(t[s],n[s]))return!1;return!0}if(t instanceof Map&&n instanceof Map){if(t.size!==n.size)return!1;for(s of t.entries())if(!n.has(s[0]))return!1;for(s of t.entries())if(!e(s[1],n.get(s[0])))return!1;return!0}if(t instanceof Set&&n instanceof Set){if(t.size!==n.size)return!1;for(s of t.entries())if(!n.has(s[0]))return!1;return!0}if(ArrayBuffer.isView(t)&&ArrayBuffer.isView(n)){if(r=t.length,r!=n.length)return!1;for(s=r;s--!==0;)if(t[s]!==n[s])return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(i=Object.keys(t),r=i.length,r!==Object.keys(n).length)return!1;for(s=r;s--!==0;)if(!Object.prototype.hasOwnProperty.call(n,i[s]))return!1;for(s=r;s--!==0;){var o=i[s];if(!e(t[o],n[o]))return!1}return!0}return t!==t&&n!==n}});var Zd={};gi(Zd,{Awareness:()=>dn,Y:()=>he,YJS_VERSION:()=>Qd,privateApis:()=>si});var he={};gi(he,{AbsolutePosition:()=>hr,AbstractConnector:()=>Ss,AbstractStruct:()=>on,AbstractType:()=>Y,Array:()=>Ue,ContentAny:()=>de,ContentBinary:()=>Le,ContentDeleted:()=>cn,ContentDoc:()=>Re,ContentEmbed:()=>qt,ContentFormat:()=>H,ContentJSON:()=>jn,ContentString:()=>Tt,ContentType:()=>Et,Doc:()=>Bt,GC:()=>st,ID:()=>Jt,Item:()=>V,Map:()=>Te,PermanentUserData:()=>Es,RelativePosition:()=>rn,Skip:()=>tt,Snapshot:()=>Rn,Text:()=>sn,Transaction:()=>pr,UndoManager:()=>Ae,UpdateDecoderV1:()=>ft,UpdateDecoderV2:()=>lt,UpdateEncoderV1:()=>Ft,UpdateEncoderV2:()=>mt,XmlElement:()=>Oe,XmlFragment:()=>Ie,XmlHook:()=>Pn,XmlText:()=>br,YArrayEvent:()=>wr,YEvent:()=>De,YMapEvent:()=>yr,YTextEvent:()=>xr,YXmlEvent:()=>Sr,applyUpdate:()=>Yn,applyUpdateV2:()=>ue,cleanupYTextFormatting:()=>nc,compareIDs:()=>Ee,compareRelativePositions:()=>ka,convertUpdateFormatV1ToV2:()=>za,convertUpdateFormatV2ToV1:()=>Fo,createAbsolutePositionFromRelativePosition:()=>Ea,createDeleteSet:()=>kr,createDeleteSetFromStructStore:()=>Is,createDocFromSnapshot:()=>Ua,createID:()=>U,createRelativePositionFromJSON:()=>pa,createRelativePositionFromTypeIndex:()=>ma,createSnapshot:()=>Fs,decodeRelativePosition:()=>Sa,decodeSnapshot:()=>Ca,decodeSnapshotV2:()=>Ao,decodeStateVector:()=>Ns,decodeUpdate:()=>Va,decodeUpdateV2:()=>Ro,diffUpdate:()=>ja,diffUpdateV2:()=>Ps,emptySnapshot:()=>Aa,encodeRelativePosition:()=>ya,encodeSnapshot:()=>_a,encodeSnapshotV2:()=>Co,encodeStateAsUpdate:()=>Rs,encodeStateAsUpdateV2:()=>ln,encodeStateVector:()=>Vs,encodeStateVectorFromUpdate:()=>Ba,encodeStateVectorFromUpdateV2:()=>No,equalDeleteSets:()=>Eo,equalSnapshots:()=>va,findIndexSS:()=>bt,findRootTypeKey:()=>Bs,getItem:()=>ke,getItemCleanEnd:()=>_s,getItemCleanStart:()=>rt,getState:()=>F,getTypeChildren:()=>Ka,isDeleted:()=>Ne,isParentOf:()=>Ln,iterateDeletedStructs:()=>ve,logType:()=>ha,logUpdate:()=>Ma,logUpdateV2:()=>Lo,mergeDeleteSets:()=>_e,mergeUpdates:()=>vr,mergeUpdatesV2:()=>Mn,obfuscateUpdate:()=>Ya,obfuscateUpdateV2:()=>Ha,parseUpdateMeta:()=>Fa,parseUpdateMetaV2:()=>Mo,readUpdate:()=>la,readUpdateV2:()=>Ls,relativePositionToJSON:()=>fa,snapshot:()=>Da,snapshotContainsUpdate:()=>Ia,transact:()=>M,tryGc:()=>Ra,typeListToArraySnapshot:()=>qa,typeMapGetAllSnapshot:()=>Xo,typeMapGetSnapshot:()=>Qa});var P=()=>new Map,Xn=e=>{let t=P();return e.forEach((n,r)=>{t.set(r,n)}),t},q=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},wi=(e,t)=>{let n=[];for(let[r,s]of e)n.push(t(s,r));return n},yi=(e,t)=>{for(let[n,r]of e)if(t(r,n))return!0;return!1};var Ot=()=>new Set;var Qn=e=>e[e.length-1];var xi=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},At=Array.from;var Si=(e,t)=>{for(let n=0;n<e.length;n++)if(t(e[n],n,e))return!0;return!1};var bi=(e,t)=>{let n=new Array(e);for(let r=0;r<e;r++)n[r]=t(r,n);return n};var me=Array.isArray;var te=class{constructor(){this._observers=P()}on(t,n){return q(this._observers,t,Ot).add(n),n}once(t,n){let r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){let r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return At((this._observers.get(t)||P()).values()).forEach(r=>r(...n))}destroy(){this._observers=P()}},Ye=class{constructor(){this._observers=P()}on(t,n){q(this._observers,t,Ot).add(n)}once(t,n){let r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){let r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return At((this._observers.get(t)||P()).values()).forEach(r=>r(...n))}destroy(){this._observers=P()}};var ht=Math.floor;var He=Math.abs;var Zn=(e,t)=>e<t?e:t,$t=(e,t)=>e>t?e:t,nu=Number.isNaN;var tr=e=>e!==0?e<0:1/e<0;var zr=Number.MAX_SAFE_INTEGER,ru=Number.MIN_SAFE_INTEGER,su=1<<31;var Ei=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&ht(e)===e),iu=Number.isNaN,ou=Number.parseInt;var Gr=String.fromCharCode,cu=String.fromCodePoint,lu=Gr(65535),ll=e=>e.toLowerCase(),al=/^\s*/g,dl=e=>e.replace(al,""),ul=/([A-Z])/g,$r=(e,t)=>dl(e.replace(ul,n=>`${t}${ll(n)}`));var hl=e=>{let t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.codePointAt(s);return r},Ge=typeof TextEncoder<"u"?new TextEncoder:null,fl=e=>Ge.encode(e),vi=Ge?fl:hl;var ze=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});ze&&ze.decode(new Uint8Array).length===1&&(ze=null);var _i=(e,t)=>bi(t,()=>e).join("");var we=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},Dt=()=>new we;var pl=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t};var nt=e=>{let t=new Uint8Array(pl(e)),n=0;for(let r=0;r<e.bufs.length;r++){let s=e.bufs[r];t.set(s,n),n+=s.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},gl=(e,t)=>{let n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array($t(n,t)*2),e.cpos=0)},W=(e,t)=>{let n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t};var qe=W;var A=(e,t)=>{for(;t>127;)W(e,128|127&t),t=ht(t/128);W(e,127&t)},bn=(e,t)=>{let n=tr(t);for(n&&(t=-t),W(e,(t>63?128:0)|(n?64:0)|63&t),t=ht(t/64);t>0;)W(e,(t>127?128:0)|127&t),t=ht(t/128)},Jr=new Uint8Array(3e4),ml=Jr.length/3,wl=(e,t)=>{if(t.length<ml){let n=Ge.encodeInto(t,Jr).written||0;A(e,n);for(let r=0;r<n;r++)W(e,Jr[r])}else Q(e,vi(t))},yl=(e,t)=>{let n=unescape(encodeURIComponent(t)),r=n.length;A(e,r);for(let s=0;s<r;s++)W(e,n.codePointAt(s))},ee=Ge&&Ge.encodeInto?wl:yl;var Ti=(e,t)=>We(e,nt(t)),We=(e,t)=>{let n=e.cbuf.length,r=e.cpos,s=Zn(n-r,t.length),i=t.length-s;e.cbuf.set(t.subarray(0,s),r),e.cpos+=s,i>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array($t(n*2,i)),e.cbuf.set(t.subarray(s)),e.cpos=i)},Q=(e,t)=>{A(e,t.byteLength),We(e,t)},Kr=(e,t)=>{gl(e,t);let n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},xl=(e,t)=>Kr(e,4).setFloat32(0,t,!1),Sl=(e,t)=>Kr(e,8).setFloat64(0,t,!1),bl=(e,t)=>Kr(e,8).setBigInt64(0,t,!1);var Ai=new DataView(new ArrayBuffer(4)),El=e=>(Ai.setFloat32(0,e),Ai.getFloat32(0)===e),Je=(e,t)=>{switch(typeof t){case"string":W(e,119),ee(e,t);break;case"number":Ei(t)&&He(t)<=2147483647?(W(e,125),bn(e,t)):El(t)?(W(e,124),xl(e,t)):(W(e,123),Sl(e,t));break;case"bigint":W(e,122),bl(e,t);break;case"object":if(t===null)W(e,126);else if(me(t)){W(e,117),A(e,t.length);for(let n=0;n<t.length;n++)Je(e,t[n])}else if(t instanceof Uint8Array)W(e,116),Q(e,t);else{W(e,118);let n=Object.keys(t);A(e,n.length);for(let r=0;r<n.length;r++){let s=n[r];ee(e,s),Je(e,t[s])}}break;case"boolean":W(e,t?120:121);break;default:W(e,127)}},Sn=class extends we{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&A(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}};var Di=e=>{e.count>0&&(bn(e.encoder,e.count===1?e.s:-e.s),e.count>1&&A(e.encoder,e.count-2))},ye=class{constructor(){this.encoder=new we,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Di(this),this.count=1,this.s=t)}toUint8Array(){return Di(this),nt(this.encoder)}};var Ui=e=>{if(e.count>0){let t=e.diff*2+(e.count===1?0:1);bn(e.encoder,t),e.count>1&&A(e.encoder,e.count-2)}},Ke=class{constructor(){this.encoder=new we,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Ui(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Ui(this),nt(this.encoder)}},er=class{constructor(){this.sarr=[],this.s="",this.lensE=new ye}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){let t=new we;return this.sarr.push(this.s),this.s="",ee(t,this.sarr.join("")),We(t,this.lensE.toUint8Array()),nt(t)}};var Lt=e=>new Error(e),Ut=()=>{throw Lt("Method unimplemented")},ct=()=>{throw Lt("Unexpected case")};var Oi=Lt("Unexpected end of array"),Li=Lt("Integer out of Range"),Xe=class{constructor(t){this.arr=t,this.pos=0}},$=e=>new Xe(e),Wr=e=>e.pos!==e.arr.length;var kl=(e,t)=>{let n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},Z=e=>kl(e,T(e));var xe=e=>e.arr[e.pos++];var T=e=>{let t=0,n=1,r=e.arr.length;for(;e.pos<r;){let s=e.arr[e.pos++];if(t=t+(s&127)*n,n*=128,s<128)return t;if(t>zr)throw Li}throw Oi},kn=e=>{let t=e.arr[e.pos++],n=t&63,r=64,s=(t&64)>0?-1:1;if((t&128)===0)return s*n;let i=e.arr.length;for(;e.pos<i;){if(t=e.arr[e.pos++],n=n+(t&127)*r,r*=128,t<128)return s*n;if(n>zr)throw Li}throw Oi};var vl=e=>{let t=T(e);if(t===0)return"";{let n=String.fromCodePoint(xe(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(xe(e));else for(;t>0;){let r=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,s),t-=r}return decodeURIComponent(escape(n))}},_l=e=>ze.decode(Z(e)),re=ze?_l:vl;var Xr=(e,t)=>{let n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},Cl=e=>Xr(e,4).getFloat32(0,!1),Al=e=>Xr(e,8).getFloat64(0,!1),Dl=e=>Xr(e,8).getBigInt64(0,!1);var Ul=[e=>{},e=>null,kn,Cl,Al,Dl,e=>!1,e=>!0,re,e=>{let t=T(e),n={};for(let r=0;r<t;r++){let s=re(e);n[s]=Qe(e)}return n},e=>{let t=T(e),n=[];for(let r=0;r<t;r++)n.push(Qe(e));return n},Z],Qe=e=>Ul[127-xe(e)](e),En=class extends Xe{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Wr(this)?this.count=T(this)+1:this.count=-1),this.count--,this.s}};var Se=class extends Xe{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=kn(this);let t=tr(this.s);this.count=1,t&&(this.s=-this.s,this.count=T(this)+2)}return this.count--,this.s}};var Ze=class extends Xe{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let t=kn(this),n=t&1;this.diff=ht(t/2),this.count=1,n&&(this.count=T(this)+2)}return this.s+=this.diff,this.count--,this.s}},nr=class{constructor(t){this.decoder=new Se(t),this.str=re(this.decoder),this.spos=0}read(){let t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}};var uu=crypto.subtle,Ri=crypto.getRandomValues.bind(crypto);var Zr=()=>Ri(new Uint32Array(1))[0];var Tl="10000000-1000-4000-8000"+-1e11,Ni=()=>Tl.replace(/[018]/g,e=>(e^Zr()&15>>e/4).toString(16));var se=Date.now;var es=e=>new Promise(e);var pu=Promise.all.bind(Promise);var ns=e=>e===void 0?null:e;var rs=class{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}},Mi=new rs,Rl=!0;try{typeof localStorage<"u"&&localStorage&&(Mi=localStorage,Rl=!1)}catch{}var Vi=Mi;var Fi=Object.assign,Pi=Object.keys,ji=(e,t)=>{for(let n in e)t(e[n],n)};var ss=e=>Pi(e).length,Bi=e=>Pi(e).length;var Yi=e=>{for(let t in e)return!1;return!0},Ml=(e,t)=>{for(let n in e)if(!t(e[n],n))return!1;return!0},is=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),os=(e,t)=>e===t||Bi(e)===Bi(t)&&Ml(e,(n,r)=>(n!==void 0||is(t,r))&&t[r]===n),Vl=Object.freeze,cs=e=>{for(let t in e){let n=e[t];(typeof n=="object"||typeof n=="function")&&cs(e[t])}return Vl(e)};var _n=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&_n(e,t,n+1)}};var ls=e=>e,Bl=(e,t)=>e===t;var vn=(e,t)=>{if(e==null||t==null)return Bl(e,t);if(e.constructor!==t.constructor)return!1;if(e===t)return!0;switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:{if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break}case Set:{if(e.size!==t.size)return!1;for(let n of e)if(!t.has(n))return!1;break}case Map:{if(e.size!==t.size)return!1;for(let n of e.keys())if(!t.has(n)||!vn(e.get(n),t.get(n)))return!1;break}case Object:if(ss(e)!==ss(t))return!1;for(let n in e)if(!is(e,n)||!vn(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!vn(e[n],t[n]))return!1;break;default:return!1}return!0},zi=(e,t)=>t.includes(e);var tn=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",rr=typeof window<"u"&&typeof document<"u"&&!tn,gu=typeof navigator<"u"?/Mac/.test(navigator.platform):!1,Rt,Fl=[],Pl=()=>{if(Rt===void 0)if(tn){Rt=P();let e=process.argv,t=null;for(let n=0;n<e.length;n++){let r=e[n];r[0]==="-"?(t!==null&&Rt.set(t,""),t=r):t!==null?(Rt.set(t,r),t=null):Fl.push(r)}t!==null&&Rt.set(t,"")}else typeof location=="object"?(Rt=P(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){let[t,n]=e.split("=");Rt.set(`--${$r(t,"-")}`,n),Rt.set(`-${$r(t,"-")}`,n)}})):Rt=P();return Rt},ds=e=>Pl().has(e);var Cn=e=>tn?ns(process.env[e.toUpperCase().replaceAll("-","_")]):ns(Vi.getItem(e));var Gi=e=>ds("--"+e)||Cn(e)!==null,mu=Gi("production"),jl=tn&&zi(process.env.FORCE_COLOR,["true","1","2"]),$i=jl||!ds("--no-colors")&&!Gi("no-color")&&(!tn||process.stdout.isTTY)&&(!tn||ds("--color")||Cn("COLORTERM")!==null||(Cn("TERM")||"").includes("color"));var Ji=e=>new Uint8Array(e),Yl=(e,t,n)=>new Uint8Array(e,t,n);var Hl=e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=Gr(e[n]);return btoa(t)},zl=e=>Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),Gl=e=>{let t=atob(e),n=Ji(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n},$l=e=>{let t=Buffer.from(e,"base64");return Yl(t.buffer,t.byteOffset,t.byteLength)},Ki=rr?Hl:zl,qi=rr?Gl:$l;var Wi=e=>{let t=Ji(e.byteLength);return t.set(e),t};var hs=class{constructor(t,n){this.left=t,this.right=n}},Nt=(e,t)=>new hs(e,t);var be=typeof document<"u"?document:{};var wu=typeof DOMParser<"u"?new DOMParser:null;var Qi=e=>wi(e,(t,n)=>`${n}:${t};`).join("");var yu=be.ELEMENT_NODE,xu=be.TEXT_NODE,Su=be.CDATA_SECTION_NODE,bu=be.COMMENT_NODE,Eu=be.DOCUMENT_NODE,ku=be.DOCUMENT_TYPE_NODE,vu=be.DOCUMENT_FRAGMENT_NODE;var Mt=Symbol;var An=Mt(),Dn=Mt(),fs=Mt(),ps=Mt(),gs=Mt(),Un=Mt(),ms=Mt(),en=Mt(),ws=Mt(),Zi=e=>{e.length===1&&e[0]?.constructor===Function&&(e=e[0]());let t=[],n=[],r=0;for(;r<e.length;r++){let s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){let s=e[r];s instanceof Symbol||n.push(s)}return n};var _u=se();var Xl={[An]:Nt("font-weight","bold"),[Dn]:Nt("font-weight","normal"),[fs]:Nt("color","blue"),[gs]:Nt("color","green"),[ps]:Nt("color","grey"),[Un]:Nt("color","red"),[ms]:Nt("color","purple"),[en]:Nt("color","orange"),[ws]:Nt("color","black")},Ql=e=>{e.length===1&&e[0]?.constructor===Function&&(e=e[0]());let t=[],n=[],r=P(),s=[],i=0;for(;i<e.length;i++){let o=e[i],c=Xl[o];if(c!==void 0)r.set(c.left,c.right);else{if(o===void 0)break;if(o.constructor===String||o.constructor===Number){let l=Qi(r);i>0||l.length>0?(t.push("%c"+o),n.push(l)):t.push(o)}else break}}for(i>0&&(s=n,s.unshift(t.join("")));i<e.length;i++){let o=e[i];o instanceof Symbol||s.push(o)}return s},to=$i?Ql:Zi,sr=(...e)=>{console.log(...to(e)),eo.forEach(t=>t.print(e))},ys=(...e)=>{console.warn(...to(e)),e.unshift(en),eo.forEach(t=>t.print(e))};var eo=Ot();var no=e=>({[Symbol.iterator](){return this},next:e}),ro=(e,t)=>no(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),ir=(e,t)=>no(()=>{let{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});var Ss=class extends te{constructor(t,n){super(),this.doc=t,this.awareness=n}},In=class{constructor(t,n){this.clock=t,this.len=n}},le=class{constructor(){this.clients=new Map}},ve=(e,t,n)=>t.clients.forEach((r,s)=>{let i=e.doc.store.clients.get(s);if(i!=null){let o=i[i.length-1],c=o.id.clock+o.length;for(let l=0,a=r[l];l<r.length&&a.clock<c;a=r[++l])Uo(e,i,a.clock,a.len,n)}}),ra=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){let s=ht((n+r)/2),i=e[s],o=i.clock;if(o<=t){if(t<o+i.len)return s;n=s+1}else r=s-1}return null},Ne=(e,t)=>{let n=e.clients.get(t.client);return n!==void 0&&ra(n,t.clock)!==null},Ts=e=>{e.clients.forEach(t=>{t.sort((s,i)=>s.clock-i.clock);let n,r;for(n=1,r=1;n<t.length;n++){let s=t[r-1],i=t[n];s.clock+s.len>=i.clock?s.len=$t(s.len,i.clock+i.len-s.clock):(r<n&&(t[r]=i),r++)}t.length=r})},_e=e=>{let t=new le;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,s)=>{if(!t.clients.has(s)){let i=r.slice();for(let o=n+1;o<e.length;o++)xi(i,e[o].clients.get(s)||[]);t.clients.set(s,i)}});return Ts(t),t},On=(e,t,n,r)=>{q(e.clients,t,()=>[]).push(new In(n,r))},kr=()=>new le,Is=e=>{let t=kr();return e.clients.forEach((n,r)=>{let s=[];for(let i=0;i<n.length;i++){let o=n[i];if(o.deleted){let c=o.id.clock,l=o.length;if(i+1<n.length)for(let a=n[i+1];i+1<n.length&&a.deleted;a=n[++i+1])l+=a.length;s.push(new In(c,l))}}s.length>0&&t.clients.set(r,s)}),t},Vt=(e,t)=>{A(e.restEncoder,t.clients.size),At(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),A(e.restEncoder,n);let s=r.length;A(e.restEncoder,s);for(let i=0;i<s;i++){let o=r[i];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},Kt=e=>{let t=new le,n=T(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();let s=T(e.restDecoder),i=T(e.restDecoder);if(i>0){let o=q(t.clients,s,()=>[]);for(let c=0;c<i;c++)o.push(new In(e.readDsClock(),e.readDsLen()))}}return t},oo=(e,t,n)=>{let r=new le,s=T(e.restDecoder);for(let i=0;i<s;i++){e.resetDsCurVal();let o=T(e.restDecoder),c=T(e.restDecoder),l=n.clients.get(o)||[],a=F(n,o);for(let u=0;u<c;u++){let f=e.readDsClock(),p=f+e.readDsLen();if(f<a){a<p&&On(r,o,a,p-a);let m=bt(l,f),y=l[m];for(!y.deleted&&y.id.clock<f&&(l.splice(m+1,0,Er(t,y,f-y.id.clock)),m++);m<l.length&&(y=l[m++],y.id.clock<p);)y.deleted||(p<y.id.clock+y.length&&l.splice(m,0,Er(t,y,p-y.id.clock)),y.delete(t))}else On(r,o,f,p-f)}}if(r.clients.size>0){let i=new mt;return A(i.restEncoder,0),Vt(i,r),i.toUint8Array()}return null},Eo=(e,t)=>{if(e.clients.size!==t.clients.size)return!1;for(let[n,r]of e.clients.entries()){let s=t.clients.get(n);if(s===void 0||r.length!==s.length)return!1;for(let i=0;i<r.length;i++){let o=r[i],c=s[i];if(o.clock!==c.clock||o.len!==c.len)return!1}}return!0},ko=Zr,Bt=class e extends te{constructor({guid:t=Ni(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:i=null,autoLoad:o=!1,shouldLoad:c=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=ko(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new fr,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=c,this.autoLoad=o,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=es(a=>{this.on("load",()=>{this.isLoaded=!0,a(this)})});let l=()=>es(a=>{let u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),a())};this.on("sync",u)});this.on("sync",a=>{a===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=a===void 0||a===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){let t=this._item;t!==null&&!this.shouldLoad&&M(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(At(this.subdocs).map(t=>t.guid))}transact(t,n=null){return M(this,t,n)}get(t,n=Y){let r=q(this.share,t,()=>{let i=new n;return i._integrate(this,null),i}),s=r.constructor;if(n!==Y&&s!==n)if(s===Y){let i=new n;i._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=i}),i._start=r._start;for(let o=i._start;o!==null;o=o.right)o.parent=i;return i._length=r._length,this.share.set(t,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Ue)}getText(t=""){return this.get(t,sn)}getMap(t=""){return this.get(t,Te)}getXmlElement(t=""){return this.get(t,Oe)}getXmlFragment(t=""){return this.get(t,Ie)}toJSON(){let t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,At(this.subdocs).forEach(n=>n.destroy());let t=this._item;if(t!==null){this._item=null;let n=t.content;n.doc=new e({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,M(t.parent.doc,r=>{let s=n.doc;t.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}},Ce=class{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return T(this.restDecoder)}readDsLen(){return T(this.restDecoder)}},ft=class extends Ce{readLeftID(){return U(T(this.restDecoder),T(this.restDecoder))}readRightID(){return U(T(this.restDecoder),T(this.restDecoder))}readClient(){return T(this.restDecoder)}readInfo(){return xe(this.restDecoder)}readString(){return re(this.restDecoder)}readParentInfo(){return T(this.restDecoder)===1}readTypeRef(){return T(this.restDecoder)}readLen(){return T(this.restDecoder)}readAny(){return Qe(this.restDecoder)}readBuf(){return Wi(Z(this.restDecoder))}readJSON(){return JSON.parse(re(this.restDecoder))}readKey(){return re(this.restDecoder)}},ur=class{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=T(this.restDecoder),this.dsCurrVal}readDsLen(){let t=T(this.restDecoder)+1;return this.dsCurrVal+=t,t}},lt=class extends ur{constructor(t){super(t),this.keys=[],T(t),this.keyClockDecoder=new Ze(Z(t)),this.clientDecoder=new Se(Z(t)),this.leftClockDecoder=new Ze(Z(t)),this.rightClockDecoder=new Ze(Z(t)),this.infoDecoder=new En(Z(t),xe),this.stringDecoder=new nr(Z(t)),this.parentInfoDecoder=new En(Z(t),xe),this.typeRefDecoder=new Se(Z(t)),this.lenDecoder=new Se(Z(t))}readLeftID(){return new Jt(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Jt(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Qe(this.restDecoder)}readBuf(){return Z(this.restDecoder)}readJSON(){return Qe(this.restDecoder)}readKey(){let t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{let n=this.stringDecoder.read();return this.keys.push(n),n}}},ae=class{constructor(){this.restEncoder=Dt()}toUint8Array(){return nt(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){A(this.restEncoder,t)}writeDsLen(t){A(this.restEncoder,t)}},Ft=class extends ae{writeLeftID(t){A(this.restEncoder,t.client),A(this.restEncoder,t.clock)}writeRightID(t){A(this.restEncoder,t.client),A(this.restEncoder,t.clock)}writeClient(t){A(this.restEncoder,t)}writeInfo(t){qe(this.restEncoder,t)}writeString(t){ee(this.restEncoder,t)}writeParentInfo(t){A(this.restEncoder,t?1:0)}writeTypeRef(t){A(this.restEncoder,t)}writeLen(t){A(this.restEncoder,t)}writeAny(t){Je(this.restEncoder,t)}writeBuf(t){Q(this.restEncoder,t)}writeJSON(t){ee(this.restEncoder,JSON.stringify(t))}writeKey(t){ee(this.restEncoder,t)}},nn=class{constructor(){this.restEncoder=Dt(),this.dsCurrVal=0}toUint8Array(){return nt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){let n=t-this.dsCurrVal;this.dsCurrVal=t,A(this.restEncoder,n)}writeDsLen(t){t===0&&ct(),A(this.restEncoder,t-1),this.dsCurrVal+=t}},mt=class extends nn{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Ke,this.clientEncoder=new ye,this.leftClockEncoder=new Ke,this.rightClockEncoder=new Ke,this.infoEncoder=new Sn(qe),this.stringEncoder=new er,this.parentInfoEncoder=new Sn(qe),this.typeRefEncoder=new ye,this.lenEncoder=new ye}toUint8Array(){let t=Dt();return A(t,0),Q(t,this.keyClockEncoder.toUint8Array()),Q(t,this.clientEncoder.toUint8Array()),Q(t,this.leftClockEncoder.toUint8Array()),Q(t,this.rightClockEncoder.toUint8Array()),Q(t,nt(this.infoEncoder)),Q(t,this.stringEncoder.toUint8Array()),Q(t,nt(this.parentInfoEncoder)),Q(t,this.typeRefEncoder.toUint8Array()),Q(t,this.lenEncoder.toUint8Array()),We(t,nt(this.restEncoder)),nt(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){Je(this.restEncoder,t)}writeBuf(t){Q(this.restEncoder,t)}writeJSON(t){Je(this.restEncoder,t)}writeKey(t){let n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}},sa=(e,t,n,r)=>{r=$t(r,t[0].id.clock);let s=bt(t,r);A(e.restEncoder,t.length-s),e.writeClient(n),A(e.restEncoder,r);let i=t[s];i.write(e,r-i.id.clock);for(let o=s+1;o<t.length;o++)t[o].write(e,0)},Os=(e,t,n)=>{let r=new Map;n.forEach((s,i)=>{F(t,i)>s&&r.set(i,s)}),Hn(t).forEach((s,i)=>{n.has(i)||r.set(i,0)}),A(e.restEncoder,r.size),At(r.entries()).sort((s,i)=>i[0]-s[0]).forEach(([s,i])=>{sa(e,t.clients.get(s),s,i)})},ia=(e,t)=>{let n=P(),r=T(e.restDecoder);for(let s=0;s<r;s++){let i=T(e.restDecoder),o=new Array(i),c=e.readClient(),l=T(e.restDecoder);n.set(c,{i:0,refs:o});for(let a=0;a<i;a++){let u=e.readInfo();switch(31&u){case 0:{let f=e.readLen();o[a]=new st(U(c,l),f),l+=f;break}case 10:{let f=T(e.restDecoder);o[a]=new tt(U(c,l),f),l+=f;break}default:{let f=(u&192)===0,p=new V(U(c,l),null,(u&128)===128?e.readLeftID():null,null,(u&64)===64?e.readRightID():null,f?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,f&&(u&32)===32?e.readString():null,ic(e,u));o[a]=p,l+=p.length}}}}return n},oa=(e,t,n)=>{let r=[],s=At(n.keys()).sort((m,y)=>m-y);if(s.length===0)return null;let i=()=>{if(s.length===0)return null;let m=n.get(s[s.length-1]);for(;m.refs.length===m.i;)if(s.pop(),s.length>0)m=n.get(s[s.length-1]);else return null;return m},o=i();if(o===null)return null;let c=new fr,l=new Map,a=(m,y)=>{let E=l.get(m);(E==null||E>y)&&l.set(m,y)},u=o.refs[o.i++],f=new Map,p=()=>{for(let m of r){let y=m.id.client,E=n.get(y);E?(E.i--,c.clients.set(y,E.refs.slice(E.i)),n.delete(y),E.i=0,E.refs=[]):c.clients.set(y,[m]),s=s.filter(C=>C!==y)}r.length=0};for(;;){if(u.constructor!==tt){let y=q(f,u.id.client,()=>F(t,u.id.client))-u.id.clock;if(y<0)r.push(u),a(u.id.client,u.id.clock-1),p();else{let E=u.getMissing(e,t);if(E!==null){r.push(u);let C=n.get(E)||{refs:[],i:0};if(C.refs.length===C.i)a(E,F(t,E)),p();else{u=C.refs[C.i++];continue}}else(y===0||y<u.length)&&(u.integrate(e,y),f.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=i(),o===null)break;u=o.refs[o.i++]}}if(c.clients.size>0){let m=new mt;return Os(m,c,new Map),A(m.restEncoder,0),{missing:l,update:m.toUint8Array()}}return null},ca=(e,t)=>Os(e,t.doc.store,t.beforeState),Ls=(e,t,n,r=new lt(e))=>M(t,s=>{s.local=!1;let i=!1,o=s.doc,c=o.store,l=ia(r,o),a=oa(s,c,l),u=c.pendingStructs;if(u){for(let[p,m]of u.missing)if(m<F(c,p)){i=!0;break}if(a){for(let[p,m]of a.missing){let y=u.missing.get(p);(y==null||y>m)&&u.missing.set(p,m)}u.update=Mn([u.update,a.update])}}else c.pendingStructs=a;let f=oo(r,s,c);if(c.pendingDs){let p=new lt($(c.pendingDs));T(p.restDecoder);let m=oo(p,s,c);f&&m?c.pendingDs=Mn([f,m]):c.pendingDs=f||m}else c.pendingDs=f;if(i){let p=c.pendingStructs.update;c.pendingStructs=null,ue(s.doc,p)}},n,!1),la=(e,t,n)=>Ls(e,t,n,new ft(e)),ue=(e,t,n,r=lt)=>{let s=$(t);Ls(s,e,n,new r(s))},Yn=(e,t,n)=>ue(e,t,n,ft),aa=(e,t,n=new Map)=>{Os(e,t.store,n),Vt(e,Is(t.store))},ln=(e,t=new Uint8Array([0]),n=new mt)=>{let r=Ns(t);aa(n,e,r);let s=[n.toUint8Array()];if(e.store.pendingDs&&s.push(e.store.pendingDs),e.store.pendingStructs&&s.push(Ps(e.store.pendingStructs.update,t)),s.length>1){if(n.constructor===Ft)return vr(s.map((i,o)=>o===0?i:Fo(i)));if(n.constructor===mt)return Mn(s)}return s[0]},Rs=(e,t)=>ln(e,t,new Ft),vo=e=>{let t=new Map,n=T(e.restDecoder);for(let r=0;r<n;r++){let s=T(e.restDecoder),i=T(e.restDecoder);t.set(s,i)}return t},Ns=e=>vo(new Ce($(e))),Ms=(e,t)=>(A(e.restEncoder,t.size),At(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{A(e.restEncoder,n),A(e.restEncoder,r)}),e),da=(e,t)=>Ms(e,Hn(t.store)),ua=(e,t=new nn)=>(e instanceof Map?Ms(t,e):da(t,e),t.toUint8Array()),Vs=e=>ua(e,new ae),bs=class{constructor(){this.l=[]}},co=()=>new bs,lo=(e,t)=>e.l.push(t),ao=(e,t)=>{let n=e.l,r=n.length;e.l=n.filter(s=>t!==s),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},_o=(e,t,n)=>_n(e.l,[t,n]),Jt=class{constructor(t,n){this.client=t,this.clock=n}},Ee=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,U=(e,t)=>new Jt(e,t),uo=(e,t)=>{A(e,t.client),A(e,t.clock)},ho=e=>U(T(e),T(e)),Bs=e=>{for(let[t,n]of e.doc.share.entries())if(n===e)return t;throw ct()},Ln=(e,t)=>{for(;t!==null;){if(t.parent===e)return!0;t=t.parent._item}return!1},ha=e=>{let t=[],n=e._start;for(;n;)t.push(n),n=n.right;console.log("Children: ",t),console.log("Children content: ",t.filter(r=>!r.deleted).map(r=>r.content))},Es=class{constructor(t,n=t.getMap("users")){let r=new Map;this.yusers=n,this.doc=t,this.clients=new Map,this.dss=r;let s=(i,o)=>{let c=i.get("ds"),l=i.get("ids"),a=u=>this.clients.set(u,o);c.observe(u=>{u.changes.added.forEach(f=>{f.content.getContent().forEach(p=>{p instanceof Uint8Array&&this.dss.set(o,_e([this.dss.get(o)||kr(),Kt(new Ce($(p)))]))})})}),this.dss.set(o,_e(c.map(u=>Kt(new Ce($(u)))))),l.observe(u=>u.changes.added.forEach(f=>f.content.getContent().forEach(a))),l.forEach(a)};n.observe(i=>{i.keysChanged.forEach(o=>s(n.get(o),o))}),n.forEach(s)}setUserMapping(t,n,r,{filter:s=()=>!0}={}){let i=this.yusers,o=i.get(r);o||(o=new Te,o.set("ids",new Ue),o.set("ds",new Ue),i.set(r,o)),o.get("ids").push([n]),i.observe(c=>{setTimeout(()=>{let l=i.get(r);if(l!==o){o=l,this.clients.forEach((f,p)=>{r===f&&o.get("ids").push([p])});let a=new ae,u=this.dss.get(r);u&&(Vt(a,u),o.get("ds").push([a.toUint8Array()]))}},0)}),t.on("afterTransaction",c=>{setTimeout(()=>{let l=o.get("ds"),a=c.deleteSet;if(c.local&&a.clients.size>0&&s(c,a)){let u=new ae;Vt(u,a),l.push([u.toUint8Array()])}})})}getUserByClientId(t){return this.clients.get(t)||null}getUserByDeletedId(t){for(let[n,r]of this.dss.entries())if(Ne(r,t))return n;return null}},rn=class{constructor(t,n,r,s=0){this.type=t,this.tname=n,this.item=r,this.assoc=s}},fa=e=>{let t={};return e.type&&(t.type=e.type),e.tname&&(t.tname=e.tname),e.item&&(t.item=e.item),e.assoc!=null&&(t.assoc=e.assoc),t},pa=e=>new rn(e.type==null?null:U(e.type.client,e.type.clock),e.tname??null,e.item==null?null:U(e.item.client,e.item.clock),e.assoc==null?0:e.assoc),hr=class{constructor(t,n,r=0){this.type=t,this.index=n,this.assoc=r}},ga=(e,t,n=0)=>new hr(e,t,n),or=(e,t,n)=>{let r=null,s=null;return e._item===null?s=Bs(e):r=U(e._item.id.client,e._item.id.clock),new rn(r,s,t,n)},ma=(e,t,n=0)=>{let r=e._start;if(n<0){if(t===0)return or(e,null,n);t--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>t)return or(e,U(r.id.client,r.id.clock+t),n);t-=r.length}if(r.right===null&&n<0)return or(e,r.lastId,n);r=r.right}return or(e,null,n)},wa=(e,t)=>{let{type:n,tname:r,item:s,assoc:i}=t;if(s!==null)A(e,0),uo(e,s);else if(r!==null)qe(e,1),ee(e,r);else if(n!==null)qe(e,2),uo(e,n);else throw ct();return bn(e,i),e},ya=e=>{let t=Dt();return wa(t,e),nt(t)},xa=e=>{let t=null,n=null,r=null;switch(T(e)){case 0:r=ho(e);break;case 1:n=re(e);break;case 2:t=ho(e)}let s=Wr(e)?kn(e):0;return new rn(t,n,r,s)},Sa=e=>xa($(e)),ba=(e,t)=>{let n=ke(e,t),r=t.clock-n.id.clock;return{item:n,diff:r}},Ea=(e,t,n=!0)=>{let r=t.store,s=e.item,i=e.type,o=e.tname,c=e.assoc,l=null,a=0;if(s!==null){if(F(r,s.client)<=s.clock)return null;let u=n?Ds(r,s):ba(r,s),f=u.item;if(!(f instanceof V))return null;if(l=f.parent,l._item===null||!l._item.deleted){a=f.deleted||!f.countable?0:u.diff+(c>=0?0:1);let p=f.left;for(;p!==null;)!p.deleted&&p.countable&&(a+=p.length),p=p.left}}else{if(o!==null)l=t.get(o);else if(i!==null){if(F(r,i.client)<=i.clock)return null;let{item:u}=n?Ds(r,i):{item:ke(r,i)};if(u instanceof V&&u.content instanceof Et)l=u.content.type;else return null}else throw ct();c>=0?a=l._length:a=0}return ga(l,a,e.assoc)},ka=(e,t)=>e===t||e!==null&&t!==null&&e.tname===t.tname&&Ee(e.item,t.item)&&Ee(e.type,t.type)&&e.assoc===t.assoc,Rn=class{constructor(t,n){this.ds=t,this.sv=n}},va=(e,t)=>{let n=e.ds.clients,r=t.ds.clients,s=e.sv,i=t.sv;if(s.size!==i.size||n.size!==r.size)return!1;for(let[o,c]of s.entries())if(i.get(o)!==c)return!1;for(let[o,c]of n.entries()){let l=r.get(o)||[];if(c.length!==l.length)return!1;for(let a=0;a<c.length;a++){let u=c[a],f=l[a];if(u.clock!==f.clock||u.len!==f.len)return!1}}return!0},Co=(e,t=new nn)=>(Vt(t,e.ds),Ms(t,e.sv),t.toUint8Array()),_a=e=>Co(e,new ae),Ao=(e,t=new ur($(e)))=>new Rn(Kt(t),vo(t)),Ca=e=>Ao(e,new Ce($(e))),Fs=(e,t)=>new Rn(e,t),Aa=Fs(kr(),new Map),Da=e=>Fs(Is(e.store),Hn(e.store)),ie=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!Ne(t.ds,e.id),ks=(e,t)=>{let n=q(e.meta,ks,Ot),r=e.doc.store;n.has(t)||(t.sv.forEach((s,i)=>{s<F(r,i)&&rt(e,U(i,s))}),ve(e,t.ds,s=>{}),n.add(t))},Ua=(e,t,n=new Bt)=>{if(e.gc)throw new Error("Garbage-collection must be disabled in `originDoc`!");let{sv:r,ds:s}=t,i=new mt;return e.transact(o=>{let c=0;r.forEach(l=>{l>0&&c++}),A(i.restEncoder,c);for(let[l,a]of r){if(a===0)continue;a<F(e.store,l)&&rt(o,U(l,a));let u=e.store.clients.get(l)||[],f=bt(u,a-1);A(i.restEncoder,f+1),i.writeClient(l),A(i.restEncoder,0);for(let p=0;p<=f;p++)u[p].write(i,0)}Vt(i,s)}),ue(n,i.toUint8Array(),"snapshot"),n},Ta=(e,t,n=lt)=>{let r=new n($(t)),s=new Pt(r,!1);for(let o=s.curr;o!==null;o=s.next())if((e.sv.get(o.id.client)||0)<o.id.clock+o.length)return!1;let i=_e([e.ds,Kt(r)]);return Eo(e.ds,i)},Ia=(e,t)=>Ta(e,t,ft),fr=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},Hn=e=>{let t=new Map;return e.clients.forEach((n,r)=>{let s=n[n.length-1];t.set(r,s.id.clock+s.length)}),t},F=(e,t)=>{let n=e.clients.get(t);if(n===void 0)return 0;let r=n[n.length-1];return r.id.clock+r.length},Do=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{let r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw ct()}n.push(t)},bt=(e,t)=>{let n=0,r=e.length-1,s=e[r],i=s.id.clock;if(i===t)return r;let o=ht(t/(i+s.length-1)*r);for(;n<=r;){if(s=e[o],i=s.id.clock,i<=t){if(t<i+s.length)return o;n=o+1}else r=o-1;o=ht((n+r)/2)}throw ct()},Oa=(e,t)=>{let n=e.clients.get(t.client);return n[bt(n,t.clock)]},ke=Oa,vs=(e,t,n)=>{let r=bt(t,n),s=t[r];return s.id.clock<n&&s instanceof V?(t.splice(r+1,0,Er(e,s,n-s.id.clock)),r+1):r},rt=(e,t)=>{let n=e.doc.store.clients.get(t.client);return n[vs(e,n,t.clock)]},_s=(e,t,n)=>{let r=t.clients.get(n.client),s=bt(r,n.clock),i=r[s];return n.clock!==i.id.clock+i.length-1&&i.constructor!==st&&r.splice(s+1,0,Er(e,i,n.clock-i.id.clock+1)),i},La=(e,t,n)=>{let r=e.clients.get(t.id.client);r[bt(r,t.id.clock)]=n},Uo=(e,t,n,r,s)=>{if(r===0)return;let i=n+r,o=vs(e,t,n),c;do c=t[o++],i<c.id.clock+c.length&&vs(e,t,i),s(c);while(o<t.length&&t[o].id.clock<i)},pr=class{constructor(t,n,r){this.doc=t,this.deleteSet=new le,this.beforeState=Hn(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}},fo=(e,t)=>t.deleteSet.clients.size===0&&!yi(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(Ts(t.deleteSet),ca(e,t),Vt(e,t.deleteSet),!0),po=(e,t,n)=>{let r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&q(e.changed,t,Ot).add(n)},ar=(e,t)=>{let n=e[t],r=e[t-1],s=t;for(;s>0;n=r,r=e[--s-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof V&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}let i=t-s;return i&&e.splice(t+1-i,i),i},To=(e,t,n)=>{for(let[r,s]of e.clients.entries()){let i=t.clients.get(r);for(let o=s.length-1;o>=0;o--){let c=s[o],l=c.clock+c.len;for(let a=bt(i,c.clock),u=i[a];a<i.length&&u.id.clock<l;u=i[++a]){let f=i[a];if(c.clock+c.len<=f.id.clock)break;f instanceof V&&f.deleted&&!f.keep&&n(f)&&f.gc(t,!1)}}}},Io=(e,t)=>{e.clients.forEach((n,r)=>{let s=t.clients.get(r);for(let i=n.length-1;i>=0;i--){let o=n[i],c=Zn(s.length-1,1+bt(s,o.clock+o.len-1));for(let l=c,a=s[l];l>0&&a.id.clock>=o.clock;a=s[l])l-=1+ar(s,l)}})},Ra=(e,t,n)=>{To(e,t,n),Io(e,t)},Oo=(e,t)=>{if(t<e.length){let n=e[t],r=n.doc,s=r.store,i=n.deleteSet,o=n._mergeStructs;try{Ts(i),n.afterState=Hn(n.doc.store),r.emit("beforeObserverCalls",[n,r]);let c=[];n.changed.forEach((l,a)=>c.push(()=>{(a._item===null||!a._item.deleted)&&a._callObserver(n,l)})),c.push(()=>{n.changedParentTypes.forEach((l,a)=>{a._dEH.l.length>0&&(a._item===null||!a._item.deleted)&&(l=l.filter(u=>u.target._item===null||!u.target._item.deleted),l.forEach(u=>{u.currentTarget=a,u._path=null}),l.sort((u,f)=>u.path.length-f.path.length),c.push(()=>{_o(a._dEH,l,n)}))}),c.push(()=>r.emit("afterTransaction",[n,r])),c.push(()=>{n._needFormattingCleanup&&nd(n)})}),_n(c,[])}finally{r.gc&&To(i,s,r.gcFilter),Io(i,s),n.afterState.forEach((u,f)=>{let p=n.beforeState.get(f)||0;if(p!==u){let m=s.clients.get(f),y=$t(bt(m,p),1);for(let E=m.length-1;E>=y;)E-=1+ar(m,E)}});for(let u=o.length-1;u>=0;u--){let{client:f,clock:p}=o[u].id,m=s.clients.get(f),y=bt(m,p);y+1<m.length&&ar(m,y+1)>1||y>0&&ar(m,y)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(sr(en,An,"[yjs] ",Dn,Un,"Changed the client-id because another client seems to be using it."),r.clientID=ko()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){let u=new Ft;fo(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){let u=new mt;fo(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}let{subdocsAdded:c,subdocsLoaded:l,subdocsRemoved:a}=n;(c.size>0||a.size>0||l.size>0)&&(c.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),a.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:l,added:c,removed:a},r,n]),a.forEach(u=>u.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):Oo(e,t+1)}}},M=(e,t,n=null,r=!0)=>{let s=e._transactionCleanups,i=!1,o=null;e._transaction===null&&(i=!0,e._transaction=new pr(e,n,r),s.push(e._transaction),s.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(i){let c=e._transaction===s[0];e._transaction=null,c&&Oo(s,0)}}return o},Cs=class{constructor(t,n){this.insertions=n,this.deletions=t,this.meta=new Map}},go=(e,t,n)=>{ve(e,n.deletions,r=>{r instanceof V&&t.scope.some(s=>s===e.doc||Ln(s,r))&&Gs(r,!1)})},mo=(e,t,n)=>{let r=null,s=e.doc,i=e.scope;M(s,c=>{for(;t.length>0&&e.currStackItem===null;){let l=s.store,a=t.pop(),u=new Set,f=[],p=!1;ve(c,a.insertions,m=>{if(m instanceof V){if(m.redone!==null){let{item:y,diff:E}=Ds(l,m.id);E>0&&(y=rt(c,U(y.id.client,y.id.clock+E))),m=y}!m.deleted&&i.some(y=>y===c.doc||Ln(y,m))&&f.push(m)}}),ve(c,a.deletions,m=>{m instanceof V&&i.some(y=>y===c.doc||Ln(y,m))&&!Ne(a.insertions,m.id)&&u.add(m)}),u.forEach(m=>{p=sc(c,m,u,a.insertions,e.ignoreRemoteMapChanges,e)!==null||p});for(let m=f.length-1;m>=0;m--){let y=f[m];e.deleteFilter(y)&&(y.delete(c),p=!0)}e.currStackItem=p?a:null}c.changed.forEach((l,a)=>{l.has(null)&&a._searchMarker&&(a._searchMarker.length=0)}),r=c},e);let o=e.currStackItem;if(o!=null){let c=r.changedParentTypes;e.emit("stack-item-popped",[{stackItem:o,type:n,changedParentTypes:c,origin:e},e]),e.currStackItem=null}return o},Ae=class extends te{constructor(t,{captureTimeout:n=500,captureTransaction:r=l=>!0,deleteFilter:s=()=>!0,trackedOrigins:i=new Set([null]),ignoreRemoteMapChanges:o=!1,doc:c=me(t)?t[0].doc:t instanceof Bt?t:t.doc}={}){super(),this.scope=[],this.doc=c,this.addToScope(t),this.deleteFilter=s,i.add(this),this.trackedOrigins=i,this.captureTransaction=r,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.currStackItem=null,this.lastChange=0,this.ignoreRemoteMapChanges=o,this.captureTimeout=n,this.afterTransactionHandler=l=>{if(!this.captureTransaction(l)||!this.scope.some(C=>l.changedParentTypes.has(C)||C===this.doc)||!this.trackedOrigins.has(l.origin)&&(!l.origin||!this.trackedOrigins.has(l.origin.constructor)))return;let a=this.undoing,u=this.redoing,f=a?this.redoStack:this.undoStack;a?this.stopCapturing():u||this.clear(!1,!0);let p=new le;l.afterState.forEach((C,D)=>{let z=l.beforeState.get(D)||0,R=C-z;R>0&&On(p,D,z,R)});let m=se(),y=!1;if(this.lastChange>0&&m-this.lastChange<this.captureTimeout&&f.length>0&&!a&&!u){let C=f[f.length-1];C.deletions=_e([C.deletions,l.deleteSet]),C.insertions=_e([C.insertions,p])}else f.push(new Cs(l.deleteSet,p)),y=!0;!a&&!u&&(this.lastChange=m),ve(l,l.deleteSet,C=>{C instanceof V&&this.scope.some(D=>D===l.doc||Ln(D,C))&&Gs(C,!0)});let E=[{stackItem:f[f.length-1],origin:l.origin,type:a?"redo":"undo",changedParentTypes:l.changedParentTypes},this];y?this.emit("stack-item-added",E):this.emit("stack-item-updated",E)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(t){let n=new Set(this.scope);t=me(t)?t:[t],t.forEach(r=>{n.has(r)||(n.add(r),(r instanceof Y?r.doc!==this.doc:r!==this.doc)&&ys("[yjs#509] Not same Y.Doc"),this.scope.push(r))})}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,n=!0){(t&&this.canUndo()||n&&this.canRedo())&&this.doc.transact(r=>{t&&(this.undoStack.forEach(s=>go(r,this,s)),this.undoStack=[]),n&&(this.redoStack.forEach(s=>go(r,this,s)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:n}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let t;try{t=mo(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){this.redoing=!0;let t;try{t=mo(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}};function*Na(e){let t=T(e.restDecoder);for(let n=0;n<t;n++){let r=T(e.restDecoder),s=e.readClient(),i=T(e.restDecoder);for(let o=0;o<r;o++){let c=e.readInfo();if(c===10){let l=T(e.restDecoder);yield new tt(U(s,i),l),i+=l}else if((31&c)!==0){let l=(c&192)===0,a=new V(U(s,i),null,(c&128)===128?e.readLeftID():null,null,(c&64)===64?e.readRightID():null,l?e.readParentInfo()?e.readString():e.readLeftID():null,l&&(c&32)===32?e.readString():null,ic(e,c));yield a,i+=a.length}else{let l=e.readLen();yield new st(U(s,i),l),i+=l}}}}var Pt=class{constructor(t,n){this.gen=Na(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===tt);return this.curr}},Ma=e=>Lo(e,ft),Lo=(e,t=lt)=>{let n=[],r=new t($(e)),s=new Pt(r,!1);for(let o=s.curr;o!==null;o=s.next())n.push(o);sr("Structs: ",n);let i=Kt(r);sr("DeleteSet: ",i)},Va=e=>Ro(e,ft),Ro=(e,t=lt)=>{let n=[],r=new t($(e)),s=new Pt(r,!1);for(let i=s.curr;i!==null;i=s.next())n.push(i);return{structs:n,ds:Kt(r)}},Nn=class{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}},vr=e=>Mn(e,ft,Ft),No=(e,t=nn,n=lt)=>{let r=new t,s=new Pt(new n($(e)),!1),i=s.curr;if(i!==null){let o=0,c=i.id.client,l=i.id.clock!==0,a=l?0:i.id.clock+i.length;for(;i!==null;i=s.next())c!==i.id.client&&(a!==0&&(o++,A(r.restEncoder,c),A(r.restEncoder,a)),c=i.id.client,a=0,l=i.id.clock!==0),i.constructor===tt&&(l=!0),l||(a=i.id.clock+i.length);a!==0&&(o++,A(r.restEncoder,c),A(r.restEncoder,a));let u=Dt();return A(u,o),Ti(u,r.restEncoder),r.restEncoder=u,r.toUint8Array()}else return A(r.restEncoder,0),r.toUint8Array()},Ba=e=>No(e,ae,ft),Mo=(e,t=lt)=>{let n=new Map,r=new Map,s=new Pt(new t($(e)),!1),i=s.curr;if(i!==null){let o=i.id.client,c=i.id.clock;for(n.set(o,c);i!==null;i=s.next())o!==i.id.client&&(r.set(o,c),n.set(i.id.client,i.id.clock),o=i.id.client),c=i.id.clock+i.length;r.set(o,c)}return{from:n,to:r}},Fa=e=>Mo(e,ft),Pa=(e,t)=>{if(e.constructor===st){let{client:n,clock:r}=e.id;return new st(U(n,r+t),e.length-t)}else if(e.constructor===tt){let{client:n,clock:r}=e.id;return new tt(U(n,r+t),e.length-t)}else{let n=e,{client:r,clock:s}=n.id;return new V(U(r,s+t),null,U(r,s+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},Mn=(e,t=lt,n=mt)=>{if(e.length===1)return e[0];let r=e.map(u=>new t($(u))),s=r.map(u=>new Pt(u,!0)),i=null,o=new n,c=new Nn(o);for(;s=s.filter(p=>p.curr!==null),s.sort((p,m)=>{if(p.curr.id.client===m.curr.id.client){let y=p.curr.id.clock-m.curr.id.clock;return y===0?p.curr.constructor===m.curr.constructor?0:p.curr.constructor===tt?1:-1:y}else return m.curr.id.client-p.curr.id.client}),s.length!==0;){let u=s[0],f=u.curr.id.client;if(i!==null){let p=u.curr,m=!1;for(;p!==null&&p.id.clock+p.length<=i.struct.id.clock+i.struct.length&&p.id.client>=i.struct.id.client;)p=u.next(),m=!0;if(p===null||p.id.client!==f||m&&p.id.clock>i.struct.id.clock+i.struct.length)continue;if(f!==i.struct.id.client)oe(c,i.struct,i.offset),i={struct:p,offset:0},u.next();else if(i.struct.id.clock+i.struct.length<p.id.clock)if(i.struct.constructor===tt)i.struct.length=p.id.clock+p.length-i.struct.id.clock;else{oe(c,i.struct,i.offset);let y=p.id.clock-i.struct.id.clock-i.struct.length;i={struct:new tt(U(f,i.struct.id.clock+i.struct.length),y),offset:0}}else{let y=i.struct.id.clock+i.struct.length-p.id.clock;y>0&&(i.struct.constructor===tt?i.struct.length-=y:p=Pa(p,y)),i.struct.mergeWith(p)||(oe(c,i.struct,i.offset),i={struct:p,offset:0},u.next())}}else i={struct:u.curr,offset:0},u.next();for(let p=u.curr;p!==null&&p.id.client===f&&p.id.clock===i.struct.id.clock+i.struct.length&&p.constructor!==tt;p=u.next())oe(c,i.struct,i.offset),i={struct:p,offset:0}}i!==null&&(oe(c,i.struct,i.offset),i=null),js(c);let l=r.map(u=>Kt(u)),a=_e(l);return Vt(o,a),o.toUint8Array()},Ps=(e,t,n=lt,r=mt)=>{let s=Ns(t),i=new r,o=new Nn(i),c=new n($(e)),l=new Pt(c,!1);for(;l.curr;){let u=l.curr,f=u.id.client,p=s.get(f)||0;if(l.curr.constructor===tt){l.next();continue}if(u.id.clock+u.length>p)for(oe(o,u,$t(p-u.id.clock,0)),l.next();l.curr&&l.curr.id.client===f;)oe(o,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===f&&l.curr.id.clock+l.curr.length<=p;)l.next()}js(o);let a=Kt(c);return Vt(i,a),i.toUint8Array()},ja=(e,t)=>Ps(e,t,ft,Ft),Vo=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:nt(e.encoder.restEncoder)}),e.encoder.restEncoder=Dt(),e.written=0)},oe=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Vo(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),A(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},js=e=>{Vo(e);let t=e.encoder.restEncoder;A(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){let r=e.clientStructs[n];A(t,r.written),We(t,r.restEncoder)}},_r=(e,t,n,r)=>{let s=new n($(e)),i=new Pt(s,!1),o=new r,c=new Nn(o);for(let a=i.curr;a!==null;a=i.next())oe(c,t(a),0);js(c);let l=Kt(s);return Vt(o,l),o.toUint8Array()},Bo=({formatting:e=!0,subdocs:t=!0,yxml:n=!0}={})=>{let r=0,s=P(),i=P(),o=P(),c=P();return c.set(null,null),l=>{switch(l.constructor){case st:case tt:return l;case V:{let a=l,u=a.content;switch(u.constructor){case cn:break;case Et:{if(n){let f=u.type;f instanceof Oe&&(f.nodeName=q(i,f.nodeName,()=>"node-"+r)),f instanceof Pn&&(f.hookName=q(i,f.hookName,()=>"hook-"+r))}break}case de:{let f=u;f.arr=f.arr.map(()=>r);break}case Le:{let f=u;f.content=new Uint8Array([r]);break}case Re:{let f=u;t&&(f.opts={},f.doc.guid=r+"");break}case qt:{let f=u;f.embed={};break}case H:{let f=u;e&&(f.key=q(o,f.key,()=>r+""),f.value=q(c,f.value,()=>({i:r})));break}case jn:{let f=u;f.arr=f.arr.map(()=>r);break}case Tt:{let f=u;f.str=_i(r%10+"",f.str.length);break}default:ct()}return a.parentSub&&(a.parentSub=q(s,a.parentSub,()=>r+"")),r++,l}default:ct()}}},Ya=(e,t)=>_r(e,Bo(t),ft,Ft),Ha=(e,t)=>_r(e,Bo(t),lt,mt),za=e=>_r(e,ls,ft,mt),Fo=e=>_r(e,ls,lt,Ft),wo="You must not compute changes after the event-handler fired.",De=class{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Ga(this.currentTarget,this.target))}deletes(t){return Ne(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Lt(wo);let t=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){let i=n._map.get(s),o,c;if(this.adds(i)){let l=i.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(i))if(l!==null&&this.deletes(l))o="delete",c=Qn(l.content.getContent());else return;else l!==null&&this.deletes(l)?(o="update",c=Qn(l.content.getContent())):(o="add",c=void 0)}else if(this.deletes(i))o="delete",c=Qn(i.content.getContent());else return;t.set(s,{action:o,oldValue:c})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Lt(wo);let n=this.target,r=Ot(),s=Ot(),i=[];if(t={added:r,deleted:s,delta:i,keys:this.keys},this.transaction.changed.get(n).has(null)){let c=null,l=()=>{c&&i.push(c)};for(let a=n._start;a!==null;a=a.right)a.deleted?this.deletes(a)&&!this.adds(a)&&((c===null||c.delete===void 0)&&(l(),c={delete:0}),c.delete+=a.length,s.add(a)):this.adds(a)?((c===null||c.insert===void 0)&&(l(),c={insert:[]}),c.insert=c.insert.concat(a.content.getContent()),r.add(a)):((c===null||c.retain===void 0)&&(l(),c={retain:0}),c.retain+=a.length);c!==null&&c.retain===void 0&&l()}this._changes=t}return t}},Ga=(e,t)=>{let n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,s=t._item.parent._start;for(;s!==t._item&&s!==null;)!s.deleted&&s.countable&&(r+=s.length),s=s.right;n.unshift(r)}t=t._item.parent}return n},et=()=>{ys("Invalid access: Add Yjs type to a document before reading data.")},Po=80,Ys=0,As=class{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Ys++}},$a=e=>{e.timestamp=Ys++},jo=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Ys++},Ja=(e,t,n)=>{if(e.length>=Po){let r=e.reduce((s,i)=>s.timestamp<i.timestamp?s:i);return jo(r,t,n),r}else{let r=new As(t,n);return e.push(r),r}},Cr=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;let n=e._searchMarker.length===0?null:e._searchMarker.reduce((i,o)=>He(t-i.index)<He(t-o.index)?i:o),r=e._start,s=0;for(n!==null&&(r=n.p,s=n.index,$a(n));r.right!==null&&s<t;){if(!r.deleted&&r.countable){if(t<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>t;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&He(n.index-s)<r.parent.length/Po?(jo(n,r,s),n):Ja(e._searchMarker,r,s)},Vn=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){let s=e[r];if(n>0){let i=s.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(s.index-=i.length);if(i===null||i.marker===!0){e.splice(r,1);continue}s.p=i,i.marker=!0}(t<s.index||n>0&&t===s.index)&&(s.index=$t(t,s.index+n))}},Ka=e=>{e.doc??et();let t=e._start,n=[];for(;t;)n.push(t),t=t.right;return n},Ar=(e,t,n)=>{let r=e,s=t.changedParentTypes;for(;q(s,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;_o(r._eH,n,t)},Y=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=co(),this._dEH=co(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw Ut()}clone(){throw Ut()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){lo(this._eH,t)}observeDeep(t){lo(this._dEH,t)}unobserve(t){ao(this._eH,t)}unobserveDeep(t){ao(this._dEH,t)}toJSON(){}},Yo=(e,t,n)=>{e.doc??et(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t,s=[],i=e._start;for(;i!==null&&r>0;){if(i.countable&&!i.deleted){let o=i.content.getContent();if(o.length<=t)t-=o.length;else{for(let c=t;c<o.length&&r>0;c++)s.push(o[c]),r--;t=0}}i=i.right}return s},Ho=e=>{e.doc??et();let t=[],n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){let r=n.content.getContent();for(let s=0;s<r.length;s++)t.push(r[s])}n=n.right}return t},qa=(e,t)=>{let n=[],r=e._start;for(;r!==null;){if(r.countable&&ie(r,t)){let s=r.content.getContent();for(let i=0;i<s.length;i++)n.push(s[i])}r=r.right}return n},Bn=(e,t)=>{let n=0,r=e._start;for(e.doc??et();r!==null;){if(r.countable&&!r.deleted){let s=r.content.getContent();for(let i=0;i<s.length;i++)t(s[i],n++,e)}r=r.right}},zo=(e,t)=>{let n=[];return Bn(e,(r,s)=>{n.push(t(r,s,e))}),n},Wa=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}let s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},Go=(e,t)=>{e.doc??et();let n=Cr(e,t),r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},gr=(e,t,n,r)=>{let s=n,i=e.doc,o=i.clientID,c=i.store,l=n===null?t._start:n.right,a=[],u=()=>{a.length>0&&(s=new V(U(o,F(c,o)),s,s&&s.lastId,l,l&&l.id,t,null,new de(a)),s.integrate(e,0),a=[])};r.forEach(f=>{if(f===null)a.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:a.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:s=new V(U(o,F(c,o)),s,s&&s.lastId,l,l&&l.id,t,null,new Le(new Uint8Array(f))),s.integrate(e,0);break;case Bt:s=new V(U(o,F(c,o)),s,s&&s.lastId,l,l&&l.id,t,null,new Re(f)),s.integrate(e,0);break;default:if(f instanceof Y)s=new V(U(o,F(c,o)),s,s&&s.lastId,l,l&&l.id,t,null,new Et(f)),s.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},$o=()=>Lt("Length exceeded!"),Jo=(e,t,n,r)=>{if(n>t._length)throw $o();if(n===0)return t._searchMarker&&Vn(t._searchMarker,n,r.length),gr(e,t,null,r);let s=n,i=Cr(t,n),o=t._start;for(i!==null&&(o=i.p,n-=i.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&rt(e,U(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&Vn(t._searchMarker,s,r.length),gr(e,t,o,r)},Xa=(e,t,n)=>{let s=(t._searchMarker||[]).reduce((i,o)=>o.index>i.index?o:i,{index:0,p:t._start}).p;if(s)for(;s.right;)s=s.right;return gr(e,t,s,n)},Ko=(e,t,n,r)=>{if(r===0)return;let s=n,i=r,o=Cr(t,n),c=t._start;for(o!==null&&(c=o.p,n-=o.index);c!==null&&n>0;c=c.right)!c.deleted&&c.countable&&(n<c.length&&rt(e,U(c.id.client,c.id.clock+n)),n-=c.length);for(;r>0&&c!==null;)c.deleted||(r<c.length&&rt(e,U(c.id.client,c.id.clock+r)),c.delete(e),r-=c.length),c=c.right;if(r>0)throw $o();t._searchMarker&&Vn(t._searchMarker,s,-i+r)},mr=(e,t,n)=>{let r=t._map.get(n);r!==void 0&&r.delete(e)},Hs=(e,t,n,r)=>{let s=t._map.get(n)||null,i=e.doc,o=i.clientID,c;if(r==null)c=new de([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:c=new de([r]);break;case Uint8Array:c=new Le(r);break;case Bt:c=new Re(r);break;default:if(r instanceof Y)c=new Et(r);else throw new Error("Unexpected content type")}new V(U(o,F(i.store,o)),s,s&&s.lastId,null,null,t,n,c).integrate(e,0)},zs=(e,t)=>{e.doc??et();let n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},qo=e=>{let t={};return e.doc??et(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},Wo=(e,t)=>{e.doc??et();let n=e._map.get(t);return n!==void 0&&!n.deleted},Qa=(e,t,n)=>{let r=e._map.get(t)||null;for(;r!==null&&(!n.sv.has(r.id.client)||r.id.clock>=(n.sv.get(r.id.client)||0));)r=r.left;return r!==null&&ie(r,n)?r.content.getContent()[r.length-1]:void 0},Xo=(e,t)=>{let n={};return e._map.forEach((r,s)=>{let i=r;for(;i!==null&&(!t.sv.has(i.id.client)||i.id.clock>=(t.sv.get(i.id.client)||0));)i=i.left;i!==null&&ie(i,t)&&(n[s]=i.content.getContent()[i.length-1])}),n},cr=e=>(e.doc??et(),ro(e._map.entries(),t=>!t[1].deleted)),wr=class extends De{},Ue=class e extends Y{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){let n=new e;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new e}clone(){let t=new e;return t.insert(0,this.toArray().map(n=>n instanceof Y?n.clone():n)),t}get length(){return this.doc??et(),this._length}_callObserver(t,n){super._callObserver(t,n),Ar(this,t,new wr(this,t))}insert(t,n){this.doc!==null?M(this.doc,r=>{Jo(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?M(this.doc,n=>{Xa(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?M(this.doc,r=>{Ko(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return Go(this,t)}toArray(){return Ho(this)}slice(t=0,n=this.length){return Yo(this,t,n)}toJSON(){return this.map(t=>t instanceof Y?t.toJSON():t)}map(t){return zo(this,t)}forEach(t){Bn(this,t)}[Symbol.iterator](){return Wa(this)}_write(t){t.writeTypeRef(xd)}},Za=e=>new Ue,yr=class extends De{constructor(t,n,r){super(t,n),this.keysChanged=r}},Te=class e extends Y{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new e}clone(){let t=new e;return this.forEach((n,r)=>{t.set(r,n instanceof Y?n.clone():n)}),t}_callObserver(t,n){Ar(this,t,new yr(this,t,n))}toJSON(){this.doc??et();let t={};return this._map.forEach((n,r)=>{if(!n.deleted){let s=n.content.getContent()[n.length-1];t[r]=s instanceof Y?s.toJSON():s}}),t}get size(){return[...cr(this)].length}keys(){return ir(cr(this),t=>t[0])}values(){return ir(cr(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return ir(cr(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??et(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?M(this.doc,n=>{mr(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?M(this.doc,r=>{Hs(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return zs(this,t)}has(t){return Wo(this,t)}clear(){this.doc!==null?M(this.doc,t=>{this.forEach(function(n,r,s){mr(t,s,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Sd)}},td=e=>new Te,ce=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&os(e,t),Fn=class{constructor(t,n,r,s){this.left=t,this.right=n,this.index=r,this.currentAttributes=s}forward(){this.right===null&&ct(),this.right.content.constructor===H?this.right.deleted||an(this.currentAttributes,this.right.content):this.right.deleted||(this.index+=this.right.length),this.left=this.right,this.right=this.right.right}},yo=(e,t,n)=>{for(;t.right!==null&&n>0;)t.right.content.constructor===H?t.right.deleted||an(t.currentAttributes,t.right.content):t.right.deleted||(n<t.right.length&&rt(e,U(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length),t.left=t.right,t.right=t.right.right;return t},lr=(e,t,n,r)=>{let s=new Map,i=r?Cr(t,n):null;if(i){let o=new Fn(i.p.left,i.p,i.index,s);return yo(e,o,n-i.index)}else{let o=new Fn(null,t._start,0,s);return yo(e,o,n)}},Qo=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===H&&ce(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();let s=e.doc,i=s.clientID;r.forEach((o,c)=>{let l=n.left,a=n.right,u=new V(U(i,F(s.store,i)),l,l&&l.lastId,a,a&&a.id,t,null,new H(c,o));u.integrate(e,0),n.right=u,n.forward()})},an=(e,t)=>{let{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},Zo=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===H&&ce(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},tc=(e,t,n,r)=>{let s=e.doc,i=s.clientID,o=new Map;for(let c in r){let l=r[c],a=n.currentAttributes.get(c)??null;if(!ce(a,l)){o.set(c,a);let{left:u,right:f}=n;n.right=new V(U(i,F(s.store,i)),u,u&&u.lastId,f,f&&f.id,t,null,new H(c,l)),n.right.integrate(e,0),n.forward()}}return o},xs=(e,t,n,r,s)=>{n.currentAttributes.forEach((p,m)=>{s[m]===void 0&&(s[m]=null)});let i=e.doc,o=i.clientID;Zo(n,s);let c=tc(e,t,n,s),l=r.constructor===String?new Tt(r):r instanceof Y?new Et(r):new qt(r),{left:a,right:u,index:f}=n;t._searchMarker&&Vn(t._searchMarker,n.index,l.getLength()),u=new V(U(o,F(i.store,o)),a,a&&a.lastId,u,u&&u.id,t,null,l),u.integrate(e,0),n.right=u,n.index=f,n.forward(),Qo(e,t,n,c)},xo=(e,t,n,r,s)=>{let i=e.doc,o=i.clientID;Zo(n,s);let c=tc(e,t,n,s);t:for(;n.right!==null&&(r>0||c.size>0&&(n.right.deleted||n.right.content.constructor===H));){if(!n.right.deleted)switch(n.right.content.constructor){case H:{let{key:l,value:a}=n.right.content,u=s[l];if(u!==void 0){if(ce(u,a))c.delete(l);else{if(r===0)break t;c.set(l,a)}n.right.delete(e)}else n.currentAttributes.set(l,a);break}default:r<n.right.length&&rt(e,U(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;n.right=new V(U(o,F(i.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Tt(l)),n.right.integrate(e,0),n.forward()}Qo(e,t,n,c)},ec=(e,t,n,r,s)=>{let i=t,o=P();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===H){let a=i.content;o.set(a.key,a)}i=i.right}let c=0,l=!1;for(;t!==i;){if(n===t&&(l=!0),!t.deleted){let a=t.content;if(a.constructor===H){let{key:u,value:f}=a,p=r.get(u)??null;(o.get(u)!==a||p===f)&&(t.delete(e),c++,!l&&(s.get(u)??null)===f&&p!==f&&(p===null?s.delete(u):s.set(u,p))),!l&&!t.deleted&&an(s,a)}}t=t.right}return c},ed=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;let n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===H){let r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},nc=e=>{let t=0;return M(e.doc,n=>{let r=e._start,s=e._start,i=P(),o=Xn(i);for(;s;)s.deleted===!1&&(s.content.constructor===H?an(o,s.content):(t+=ec(n,r,s,i,o),i=Xn(o),r=s)),s=s.right}),t},nd=e=>{let t=new Set,n=e.doc;for(let[r,s]of e.afterState.entries()){let i=e.beforeState.get(r)||0;s!==i&&Uo(e,n.store.clients.get(r),i,s,o=>{!o.deleted&&o.content.constructor===H&&o.constructor!==st&&t.add(o.parent)})}M(n,r=>{ve(e,e.deleteSet,s=>{if(s instanceof st||!s.parent._hasFormatting||t.has(s.parent))return;let i=s.parent;s.content.constructor===H?t.add(i):ed(r,s)});for(let s of t)nc(s)})},So=(e,t,n)=>{let r=n,s=Xn(t.currentAttributes),i=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Et:case qt:case Tt:n<t.right.length&&rt(e,U(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}i&&ec(e,i,t.right,s,t.currentAttributes);let o=(t.left||t.right).parent;return o._searchMarker&&Vn(o._searchMarker,t.index,-r+n),t},xr=class extends De{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){let t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){let t=this.target.doc,n=[];M(t,r=>{let s=new Map,i=new Map,o=this.target._start,c=null,l={},a="",u=0,f=0,p=()=>{if(c!==null){let m=null;switch(c){case"delete":f>0&&(m={delete:f}),f=0;break;case"insert":(typeof a=="object"||a.length>0)&&(m={insert:a},s.size>0&&(m.attributes={},s.forEach((y,E)=>{y!==null&&(m.attributes[E]=y)}))),a="";break;case"retain":u>0&&(m={retain:u},Yi(l)||(m.attributes=Fi({},l))),u=0;break}m&&n.push(m),c=null}};for(;o!==null;){switch(o.content.constructor){case Et:case qt:this.adds(o)?this.deletes(o)||(p(),c="insert",a=o.content.getContent()[0],p()):this.deletes(o)?(c!=="delete"&&(p(),c="delete"),f+=1):o.deleted||(c!=="retain"&&(p(),c="retain"),u+=1);break;case Tt:this.adds(o)?this.deletes(o)||(c!=="insert"&&(p(),c="insert"),a+=o.content.str):this.deletes(o)?(c!=="delete"&&(p(),c="delete"),f+=o.length):o.deleted||(c!=="retain"&&(p(),c="retain"),u+=o.length);break;case H:{let{key:m,value:y}=o.content;if(this.adds(o)){if(!this.deletes(o)){let E=s.get(m)??null;ce(E,y)?y!==null&&o.delete(r):(c==="retain"&&p(),ce(y,i.get(m)??null)?delete l[m]:l[m]=y)}}else if(this.deletes(o)){i.set(m,y);let E=s.get(m)??null;ce(E,y)||(c==="retain"&&p(),l[m]=E)}else if(!o.deleted){i.set(m,y);let E=l[m];E!==void 0&&(ce(E,y)?E!==null&&o.delete(r):(c==="retain"&&p(),y===null?delete l[m]:l[m]=y))}o.deleted||(c==="insert"&&p(),an(s,o.content));break}}o=o.right}for(p();n.length>0;){let m=n[n.length-1];if(m.retain!==void 0&&m.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}},sn=class e extends Y{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??et(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new e}clone(){let t=new e;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);let r=new xr(this,t,n);Ar(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??et();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Tt&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?M(this.doc,r=>{let s=new Fn(null,this._start,0,new Map);for(let i=0;i<t.length;i++){let o=t[i];if(o.insert!==void 0){let c=!n&&typeof o.insert=="string"&&i===t.length-1&&s.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof c!="string"||c.length>0)&&xs(r,this,s,c,o.attributes||{})}else o.retain!==void 0?xo(r,this,s,o.retain,o.attributes||{}):o.delete!==void 0&&So(r,s,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??et();let s=[],i=new Map,o=this.doc,c="",l=this._start;function a(){if(c.length>0){let f={},p=!1;i.forEach((y,E)=>{p=!0,f[E]=y});let m={insert:c};p&&(m.attributes=f),s.push(m),c=""}}let u=()=>{for(;l!==null;){if(ie(l,t)||n!==void 0&&ie(l,n))switch(l.content.constructor){case Tt:{let f=i.get("ychange");t!==void 0&&!ie(l,t)?(f===void 0||f.user!==l.id.client||f.type!=="removed")&&(a(),i.set("ychange",r?r("removed",l.id):{type:"removed"})):n!==void 0&&!ie(l,n)?(f===void 0||f.user!==l.id.client||f.type!=="added")&&(a(),i.set("ychange",r?r("added",l.id):{type:"added"})):f!==void 0&&(a(),i.delete("ychange")),c+=l.content.str;break}case Et:case qt:{a();let f={insert:l.content.getContent()[0]};if(i.size>0){let p={};f.attributes=p,i.forEach((m,y)=>{p[y]=m})}s.push(f);break}case H:ie(l,t)&&(a(),an(i,l.content));break}l=l.right}a()};return t||n?M(o,f=>{t&&ks(f,t),n&&ks(f,n),u()},"cleanup"):u(),s}insert(t,n,r){if(n.length<=0)return;let s=this.doc;s!==null?M(s,i=>{let o=lr(i,this,t,!r);r||(r={},o.currentAttributes.forEach((c,l)=>{r[l]=c})),xs(i,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){let s=this.doc;s!==null?M(s,i=>{let o=lr(i,this,t,!r);xs(i,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;let r=this.doc;r!==null?M(r,s=>{So(s,lr(s,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;let s=this.doc;s!==null?M(s,i=>{let o=lr(i,this,t,!1);o.right!==null&&xo(i,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?M(this.doc,n=>{mr(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?M(this.doc,r=>{Hs(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return zs(this,t)}getAttributes(){return qo(this)}_write(t){t.writeTypeRef(bd)}},rd=e=>new sn,Tn=class{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??et()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===Oe||n.constructor===Ie)&&n._start!==null)t=n._start;else for(;t!==null;){let r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}},Ie=class e extends Y{constructor(){super(),this._prelimContent=[]}get firstChild(){let t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new e}clone(){let t=new e;return t.insert(0,this.toArray().map(n=>n instanceof Y?n.clone():n)),t}get length(){return this.doc??et(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Tn(this,t)}querySelector(t){t=t.toUpperCase();let r=new Tn(this,s=>s.nodeName&&s.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),At(new Tn(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){Ar(this,t,new Sr(this,n,t))}toString(){return zo(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){let s=t.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),Bn(this,i=>{s.insertBefore(i.toDOM(t,n,r),null)}),s}insert(t,n){this.doc!==null?M(this.doc,r=>{Jo(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)M(this.doc,r=>{let s=t&&t instanceof Y?t._item:t;gr(r,this,s,n)});else{let r=this._prelimContent,s=t===null?0:r.findIndex(i=>i===t)+1;if(s===0&&t!==null)throw Lt("Reference item not found");r.splice(s,0,...n)}}delete(t,n=1){this.doc!==null?M(this.doc,r=>{Ko(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Ho(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Go(this,t)}slice(t=0,n=this.length){return Yo(this,t,n)}forEach(t){Bn(this,t)}_write(t){t.writeTypeRef(kd)}},sd=e=>new Ie,Oe=class e extends Ie{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){let t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){let t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new e(this.nodeName)}clone(){let t=new e(this.nodeName),n=this.getAttributes();return ji(n,(r,s)=>{t.setAttribute(s,r)}),t.insert(0,this.toArray().map(r=>r instanceof Y?r.clone():r)),t}toString(){let t=this.getAttributes(),n=[],r=[];for(let c in t)r.push(c);r.sort();let s=r.length;for(let c=0;c<s;c++){let l=r[c];n.push(l+'="'+t[l]+'"')}let i=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${i}${o}>${super.toString()}</${i}>`}removeAttribute(t){this.doc!==null?M(this.doc,n=>{mr(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?M(this.doc,r=>{Hs(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return zs(this,t)}hasAttribute(t){return Wo(this,t)}getAttributes(t){return t?Xo(this,t):qo(this)}toDOM(t=document,n={},r){let s=t.createElement(this.nodeName),i=this.getAttributes();for(let o in i){let c=i[o];typeof c=="string"&&s.setAttribute(o,c)}return Bn(this,o=>{s.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(Ed),t.writeKey(this.nodeName)}},id=e=>new Oe(e.readKey()),Sr=class extends De{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}},Pn=class e extends Te{constructor(t){super(),this.hookName=t}_copy(){return new e(this.hookName)}clone(){let t=new e(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){let s=n[this.hookName],i;return s!==void 0?i=s.createDom(this):i=document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(vd),t.writeKey(this.hookName)}},od=e=>new Pn(e.readKey()),br=class e extends sn{get nextSibling(){let t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){let t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new e}clone(){let t=new e;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){let s=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(t=>{let n=[];for(let s in t.attributes){let i=[];for(let o in t.attributes[s])i.push({key:o,value:t.attributes[s][o]});i.sort((o,c)=>o.key<c.key?-1:1),n.push({nodeName:s,attrs:i})}n.sort((s,i)=>s.nodeName<i.nodeName?-1:1);let r="";for(let s=0;s<n.length;s++){let i=n[s];r+=`<${i.nodeName}`;for(let o=0;o<i.attrs.length;o++){let c=i.attrs[o];r+=` ${c.key}="${c.value}"`}r+=">"}r+=t.insert;for(let s=n.length-1;s>=0;s--)r+=`</${n[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(_d)}},cd=e=>new br,on=class{constructor(t,n){this.id=t,this.length=n}get deleted(){throw Ut()}mergeWith(t){return!1}write(t,n,r){throw Ut()}integrate(t,n){throw Ut()}},ld=0,st=class extends on{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),Do(t.doc.store,this)}write(t,n){t.writeInfo(ld),t.writeLen(this.length-n)}getMissing(t,n){return null}},Le=class e{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new e(this.content)}splice(t){throw Ut()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}},ad=e=>new Le(e.readBuf()),cn=class e{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new e(this.len)}splice(t){let n=new e(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){On(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}},dd=e=>new cn(e.readLen()),rc=(e,t)=>new Bt({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1}),Re=class e{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;let n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new e(rc(this.doc.guid,this.opts))}splice(t){throw Ut()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}},ud=e=>new Re(rc(e.readString(),e.readAny())),qt=class e{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new e(this.embed)}splice(t){throw Ut()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}},hd=e=>new qt(e.readJSON()),H=class e{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new e(this.key,this.value)}splice(t){throw Ut()}mergeWith(t){return!1}integrate(t,n){let r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}},fd=e=>new H(e.readKey(),e.readJSON()),jn=class e{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new e(this.arr)}splice(t){let n=new e(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){let r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){let i=this.arr[s];t.writeString(i===void 0?"undefined":JSON.stringify(i))}}getRef(){return 2}},pd=e=>{let t=e.readLen(),n=[];for(let r=0;r<t;r++){let s=e.readString();s==="undefined"?n.push(void 0):n.push(JSON.parse(s))}return new jn(n)},gd=Cn("node_env")==="development",de=class e{constructor(t){this.arr=t,gd&&cs(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new e(this.arr)}splice(t){let n=new e(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){let r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){let i=this.arr[s];t.writeAny(i)}}getRef(){return 8}},md=e=>{let t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new de(n)},Tt=class e{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new e(this.str)}splice(t){let n=new e(this.str.slice(t));this.str=this.str.slice(0,t);let r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"\uFFFD",n.str="\uFFFD"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}},wd=e=>new Tt(e.readString()),yd=[Za,td,rd,id,sd,od,cd],xd=0,Sd=1,bd=2,Ed=3,kd=4,vd=5,_d=6,Et=class e{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new e(this.type._copy())}splice(t){throw Ut()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}},Cd=e=>new Et(yd[e.readTypeRef()](e)),Ds=(e,t)=>{let n=t,r=0,s;do r>0&&(n=U(n.client,n.clock+r)),s=ke(e,n),r=n.clock-s.id.clock,n=s.redone;while(n!==null&&s instanceof V);return{item:s,diff:r}},Gs=(e,t)=>{for(;e!==null&&e.keep!==t;)e.keep=t,e=e.parent._item},Er=(e,t,n)=>{let{client:r,clock:s}=t.id,i=new V(U(r,s+n),t,U(r,s+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&i.markDeleted(),t.keep&&(i.keep=!0),t.redone!==null&&(i.redone=U(t.redone.client,t.redone.clock+n)),t.right=i,i.right!==null&&(i.right.left=i),e._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),t.length=n,i},bo=(e,t)=>Si(e,n=>Ne(n.deletions,t)),sc=(e,t,n,r,s,i)=>{let o=e.doc,c=o.store,l=o.clientID,a=t.redone;if(a!==null)return rt(e,a);let u=t.parent._item,f=null,p;if(u!==null&&u.deleted===!0){if(u.redone===null&&(!n.has(u)||sc(e,u,n,r,s,i)===null))return null;for(;u.redone!==null;)u=rt(e,u.redone)}let m=u===null?t.parent:u.content.type;if(t.parentSub===null){for(f=t.left,p=t;f!==null;){let D=f;for(;D!==null&&D.parent._item!==u;)D=D.redone===null?null:rt(e,D.redone);if(D!==null&&D.parent._item===u){f=D;break}f=f.left}for(;p!==null;){let D=p;for(;D!==null&&D.parent._item!==u;)D=D.redone===null?null:rt(e,D.redone);if(D!==null&&D.parent._item===u){p=D;break}p=p.right}}else if(p=null,t.right&&!s){for(f=t;f!==null&&f.right!==null&&(f.right.redone||Ne(r,f.right.id)||bo(i.undoStack,f.right.id)||bo(i.redoStack,f.right.id));)for(f=f.right;f.redone;)f=rt(e,f.redone);if(f&&f.right!==null)return null}else f=m._map.get(t.parentSub)||null;let y=F(c,l),E=U(l,y),C=new V(E,f,f&&f.lastId,p,p&&p.id,m,t.parentSub,t.content.copy());return t.redone=E,Gs(C,!0),C.integrate(e,0),C},V=class e extends on{constructor(t,n,r,s,i,o,c,l){super(t,l.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=i,this.parent=o,this.parentSub=c,this.redone=null,this.content=l,this.info=this.content.isCountable()?2:0}set marker(t){(this.info&8)>0!==t&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(t){this.keep!==t&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(t){this.deleted!==t&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=F(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=F(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Jt&&this.id.client!==this.parent.client&&this.parent.clock>=F(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=_s(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=rt(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===st||this.right&&this.right.constructor===st)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===e?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===e&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Jt){let r=ke(n,this.parent);r.constructor===st?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=_s(t,t.doc.store,U(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;let i=new Set,o=new Set;for(;s!==null&&s!==this.right;){if(o.add(s),i.add(s),Ee(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,i.clear();else if(Ee(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&o.has(ke(t.doc.store,s.origin)))i.has(ke(t.doc.store,s.origin))||(r=s,i.clear());else break;s=s.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Do(t.doc.store,this),this.content.integrate(t,this),po(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new st(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:U(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Ee(t.origin,this.lastId)&&this.right===t&&Ee(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){let n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){let n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),On(t.deleteSet,this.id.client,this.id.clock,this.length),po(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw ct();this.content.gc(t),n?La(t,this,new st(this.id,this.length)):this.content=new cn(this.length)}write(t,n){let r=n>0?U(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,i=this.parentSub,o=this.content.getRef()&31|(r===null?0:128)|(s===null?0:64)|(i===null?0:32);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),s!==null&&t.writeRightID(s),r===null&&s===null){let c=this.parent;if(c._item!==void 0){let l=c._item;if(l===null){let a=Bs(c);t.writeParentInfo(!0),t.writeString(a)}else t.writeParentInfo(!1),t.writeLeftID(l.id)}else c.constructor===String?(t.writeParentInfo(!0),t.writeString(c)):c.constructor===Jt?(t.writeParentInfo(!1),t.writeLeftID(c)):ct();i!==null&&t.writeString(i)}this.content.write(t,n)}},ic=(e,t)=>Ad[t&31](e),Ad=[()=>{ct()},dd,pd,ad,wd,hd,fd,Cd,md,ud,()=>{ct()}],Dd=10,tt=class extends on{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){ct()}write(t,n){t.writeInfo(Dd),A(t.restEncoder,this.length-n)}getMissing(t,n){return null}},oc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},cc="__ $YJS$ __";oc[cc]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");oc[cc]=!0;var $s=3e4,dn=class extends Ye{constructor(t){super(),this.doc=t,this.clientID=t.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let n=se();this.getLocalState()!==null&&$s/2<=n-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let r=[];this.meta.forEach((s,i)=>{i!==this.clientID&&$s<=n-s.lastUpdated&&this.states.has(i)&&r.push(i)}),r.length>0&&Js(this,r,"timeout")},ht($s/10)),t.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(t){let n=this.clientID,r=this.meta.get(n),s=r===void 0?0:r.clock+1,i=this.states.get(n);t===null?this.states.delete(n):this.states.set(n,t),this.meta.set(n,{clock:s,lastUpdated:se()});let o=[],c=[],l=[],a=[];t===null?a.push(n):i==null?t!=null&&o.push(n):(c.push(n),vn(i,t)||l.push(n)),(o.length>0||l.length>0||a.length>0)&&this.emit("change",[{added:o,updated:l,removed:a},"local"]),this.emit("update",[{added:o,updated:c,removed:a},"local"])}setLocalStateField(t,n){let r=this.getLocalState();r!==null&&this.setLocalState({...r,[t]:n})}getStates(){return this.states}},Js=(e,t,n)=>{let r=[];for(let s=0;s<t.length;s++){let i=t[s];if(e.states.has(i)){if(e.states.delete(i),i===e.clientID){let o=e.meta.get(i);e.meta.set(i,{clock:o.clock+1,lastUpdated:se()})}r.push(i)}}r.length>0&&(e.emit("change",[{added:[],updated:[],removed:r},n]),e.emit("update",[{added:[],updated:[],removed:r},n]))};var lc=1,Dr="fromPersistence",Ur="document",Me="documentMeta",Wt="savedAt",Tr="savedBy",ac="state",dc="version",Ir="gutenberg",un="syncManager",zn="_crdt_document";var fc=Pe(hc(),1),{lock:pc,unlock:Bu}=(0,fc.__dangerousOptInToUnstableAPIsOnlyForCoreModules)("I acknowledge private features are not for use in themes or plugins and doing so will break in the next version of WordPress.","@wordpress/sync");function Or(e={}){let t=new Map(Object.entries(e)),n=new Bt({meta:t});return n.getMap(ac).set(dc,lc),n}function Ks(e){let t=e.getMap(Me);t.set(Wt,Date.now()),t.set(Tr,e.clientID)}function gc(){return Math.floor(Math.random()*1e9)}function mc(e){return JSON.stringify({document:Ki(ln(e)),updateId:gc()})}function wc(e){try{let{document:t}=JSON.parse(e),n={[Dr]:!0},r=Or(n),s=qi(t);return ue(r,s),r.clientID=gc(),r}catch{return null}}function yc(e){let t=e.meta?.[zn];return t?wc(t):null}function xc(e){return{[zn]:mc(e)}}var Rc=Pe(bc(),1);var Ec=0,kc=1,Ud=2,vc=(e,t)=>{A(e,Ec);let n=Vs(t);Q(e,n)},Td=(e,t,n)=>{A(e,kc),Q(e,Rs(t,n))},Id=(e,t,n)=>Td(t,n,Z(e)),_c=(e,t,n)=>{try{Yn(t,Z(e),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}};var Od=_c,qs=(e,t,n,r)=>{let s=T(e);switch(s){case Ec:Id(e,t,n);break;case kc:_c(e,n,r);break;case Ud:Od(e,n,r);break;default:throw new Error("Unknown message type")}return s};var pt=(e=>(e.COMPACTION="compaction",e.SYNC_STEP_1="sync_step1",e.SYNC_STEP_2="sync_step2",e.UPDATE="update",e))(pt||{});var Dc=Pe(Ac(),1);var Rd="/wp/v2/sync/updates";function Nd(e){let t="",n=e.byteLength;for(let r=0;r<n;r++)t+=String.fromCharCode(e[r]);return globalThis.btoa(t)}function Ws(e){let t=globalThis.atob(e),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.charCodeAt(s);return r}function Gn(e,t){return{data:Nd(e),type:t}}function Uc(e=[],t=!0){let n=t,r=[...e];return{add(s){r.push(s)},addBulk(s){s.length!==0&&r.push(...s)},clear(){r.splice(0,r.length)},get(){return n?[]:r.splice(0,r.length)},pause(){n=!0},restore(s){let i=s.filter(o=>o.type!==pt.COMPACTION);i.length!==0&&r.unshift(...i)},resume(){n=!1},size(){return r.length}}}async function Tc(e){let t=await(0,Dc.default)({body:JSON.stringify(e),headers:{"Content-Type":"application/json"},method:"POST",parse:!1,path:Rd});if(!t.ok)throw new Error(`Sync update failed with status ${t.status}`);return await t.json()}var Ic=1e3,Md=250,Vd=30*1e3,$n="polling-manager",jt=new Map;function Bd(e){let t=e.filter(n=>[pt.COMPACTION,pt.UPDATE].includes(n.type)).map(n=>Ws(n.data));return Gn(vr(t),pt.COMPACTION)}function Fd(e){let t=Dt();return vc(t,e),Gn(nt(t),pt.SYNC_STEP_1)}function Pd(e,t){let n=$(t),r=Dt();return qs(n,r,e,$n),Gn(nt(r),pt.SYNC_STEP_2)}function jd(e,t){let n=t.getStates(),r=new Set,s=new Set,i=new Set(n.keys().filter(o=>!e[o]));Object.entries(e).forEach(([o,c])=>{let l=Number(o);if(l===t.clientID)return;if(c===null){n.delete(l),i.add(l);return}if(!n.has(l)){n.set(l,c),r.add(l);return}let a=n.get(l);JSON.stringify(a)!==JSON.stringify(c)&&(n.set(l,c),s.add(l))}),r.size+s.size>0&&t.emit("change",[{added:Array.from(r),updated:Array.from(s),removed:[]}]),i.size>0&&Js(t,Array.from(i),$n)}function Yd(e,t,n){let r=Ws(e.data);switch(e.type){case pt.SYNC_STEP_1:return Pd(t,r);case pt.SYNC_STEP_2:{let s=$(r),i=Dt();qs(s,i,t,$n),n();return}case pt.COMPACTION:case pt.UPDATE:Yn(t,r,$n)}}var Xs=!1,hn=Ic;function Oc(){Xs=!0;async function e(){if(jt.size===0){Xs=!1;return}let t={rooms:Array.from(jt.entries()).map(([n,r])=>({after:r.endCursor??0,awareness:r.localAwarenessState,client_id:r.clientId,room:n,updates:r.updateQueue.get()}))};try{let{rooms:n}=await Tc(t);hn=Ic,n.forEach(r=>{if(!jt.has(r.room))return;let s=jt.get(r.room);s.endCursor=r.end_cursor,s.processAwarenessUpdate(r.awareness),Object.keys(r.awareness).length>1&&(hn=Md,s.updateQueue.resume());let i=r.updates.map(o=>s.processDocUpdate(o)).filter(o=>!!o);s.updateQueue.addBulk(i),r.compaction_request&&s.updateQueue.add(Bd(r.compaction_request))})}catch(n){hn=Math.min(hn*2,Vd);for(let r of t.rooms){if(!jt.has(r.room))continue;let s=jt.get(r.room);s.updateQueue.restore(r.updates),s.log("Error posting sync update, will retry with backoff",{error:n,nextPoll:hn})}}setTimeout(Oc,hn)}e()}function Hd(e,t,n,r,s){if(jt.has(e))return;let i=Uc([Fd(t)]);function o(){a.localAwarenessState=n.getLocalState()??{}}function c(u,f){$n!==f&&i.add(Gn(u,pt.UPDATE))}function l(){t.off("update",c),n.off("change",o),i.clear()}let a={clientId:t.clientID,endCursor:0,localAwarenessState:n.getLocalState()??{},log:s,processAwarenessUpdate:u=>jd(u,n),processDocUpdate:u=>Yd(u,t,r),unregister:l,updateQueue:i};t.on("update",c),n.on("change",o),jt.set(e,a),Xs||Oc()}function zd(e){jt.get(e)?.unregister(),jt.delete(e)}var Qs={registerRoom:Hd,unregisterRoom:zd};var Gd=class extends te{constructor(e){super(),this.options=e,this.log("Initializing",{room:e.room}),this.awareness=e.awareness??new dn(e.ydoc),this.connect()}awareness;synced=!1;connect(){this.log("Connecting"),Qs.registerRoom(this.options.room,this.options.ydoc,this.awareness,this.onSync,this.log),this.emitStatus("connected")}destroy(){this.disconnect(),super.destroy()}disconnect(){this.log("Disconnecting"),Qs.unregisterRoom(this.options.room),this.emitStatus("disconnected")}emitStatus(e){this.emit("status",[{status:e}])}log=(e,t={})=>{this.options.debug&&console.log(`[${this.constructor.name}]: ${e}`,{room:this.options.room,...t})};onSync=()=>{this.synced||(this.synced=!0,this.log("Synced"),this.emit("synced",[{synced:!0}]))}};function Lc(){return async({awareness:e,objectType:t,objectId:n,ydoc:r})=>{let s=n?`${t}:${n}`:t,i=new Gd({awareness:e,room:s,ydoc:r});return{destroy:()=>i.destroy(),on:i.on.bind(i)}}}var fn=null;function $d(){return[Lc()]}function Jd(e){return typeof e=="function"}function Zs(){if(fn)return fn;if(!window.__wpSyncEnabled)return[];let e=(0,Rc.applyFilters)("sync.providers",$d());return Array.isArray(e)?(fn=e.filter(Jd),fn):(fn=[],fn)}var Nc=(e,t)=>{let n=t==="undo"?e.undoStack:e.redoStack;for(;n.length>0;){let r=n.pop(),s=t==="undo"?r.undoStack:r.redoStack,i=s.pop(),o=!1;if(t==="undo"?(r.undoStack=[i],o=r.undo()!==null,r.undoStack=s):(r.redoStack=[i],o=r.redo()!==null,r.redoStack=s),o)return i}return null},Mc=class extends Ye{constructor(e=[],t={}){super(),this.docs=new Map,this.trackedOrigins=t.trackedOrigins||new Set([null]),t.trackedOrigins=this.trackedOrigins,this._defaultOpts=t,this.undoStack=[],this.redoStack=[],this.addToScope(e)}addToScope(e){e=me(e)?e:[e],e.forEach(t=>{let n=t.doc,r=q(this.docs,n,()=>{let s=new Ae([t],this._defaultOpts);return s.on("stack-cleared",({undoStackCleared:i,redoStackCleared:o})=>{this.clear(i,o)}),n.on("destroy",()=>{this.docs.delete(n),this.undoStack=this.undoStack.filter(i=>i.doc!==n),this.redoStack=this.redoStack.filter(i=>i.doc!==n)}),s.on("stack-item-added",i=>{(i.type==="undo"?this.undoStack:this.redoStack).push(s),this.emit("stack-item-added",[{...i,ydoc:n},this])}),s.on("stack-item-updated",i=>{this.emit("stack-item-updated",[{...i,ydoc:n},this])}),s.on("stack-item-popped",i=>{this.emit("stack-item-popped",[{...i,ydoc:n},this])}),s});r.scope.every(s=>s!==t)&&r.scope.push(t)})}addTrackedOrigin(e){this.trackedOrigins.add(e)}removeTrackedOrigin(e){this.trackedOrigins.delete(e)}undo(){return Nc(this,"undo")}redo(){return Nc(this,"redo")}clear(e=!0,t=!0){(e&&this.canUndo()||t&&this.canRedo())&&(this.docs.forEach(n=>{e&&(this.undoStack=[]),t&&(this.redoStack=[]),n.clear(e,t)}),this.emit("stack-cleared",[{undoStackCleared:e,redoStackCleared:t}]))}stopCapturing(){this.docs.forEach(e=>{e.stopCapturing()})}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.docs.forEach(e=>e.destroy()),super.destroy()}};function Vc(){let e=new Mc([],{captureTimeout:500,trackedOrigins:new Set([Ir])});return{addRecord(t,n=!1){},addToScope(t,n){if(t.doc===null)return;let r=t.doc;e.addToScope(t);let{addUndoMeta:s,restoreUndoMeta:i}=n;e.on("stack-item-added",o=>{s(r,o.stackItem.meta)}),e.on("stack-item-popped",o=>{i(r,o.stackItem.meta)})},undo(){if(e.canUndo())return e.undo(),[]},redo(){if(e.canRedo())return e.redo(),[]},hasUndo(){return e.canUndo()},hasRedo(){return e.canRedo()},stopCapturing(){e.stopCapturing()}}}function Bc(){let e=new Map,t=new Map,n;async function r(p,m,y,E,C){let D=Zs();if(D.length===0)return;let z=o(m,y);if(t.has(z))return;let R=Or({objectType:m}),j=R.getMap(Ur),G=R.getMap(Me),wt=Date.now(),vt=()=>{Be.forEach(Qt=>Qt.destroy()),j.unobserveDeep(X),G.unobserve(Xt),R.destroy(),t.delete(z)},yt=p.createAwareness?.(R,y),X=(Qt,It)=>{It.local&&!(It.origin instanceof Ae)||u(m,y)},Xt=(Qt,It)=>{It.local||Qt.keysChanged.forEach(Mr=>{if(Mr===Wt){let Fe=G.get(Wt);typeof Fe=="number"&&Fe>wt&&C.refetchRecord().catch(()=>{})}})};n||(n=Vc());let{addUndoMeta:_t,restoreUndoMeta:Yt}=C;n.addToScope(j,{addUndoMeta:_t,restoreUndoMeta:Yt});let Nr={awareness:yt,handlers:C,objectId:y,objectType:m,syncConfig:p,unload:vt,ydoc:R};t.set(z,Nr);let Be=await Promise.all(D.map(async Qt=>{let It=await Qt({objectType:m,objectId:y,ydoc:R,awareness:yt});return It.on("sync-connection-status",C.onStateChange),It}));j.observeDeep(X),G.observe(Xt),l(m,y,E)}async function s(p,m,y){let E=Zs();if(E.length===0||e.has(m))return;let C=Or({collection:!0,objectType:m}),D=C.getMap(Me),z=Date.now(),R=()=>{vt.forEach(yt=>yt.destroy()),D.unobserve(j),C.destroy(),e.delete(m)},j=(yt,X)=>{X.local||yt.keysChanged.forEach(Xt=>{if(Xt===Wt){let _t=D.get(Wt);typeof _t=="number"&&_t>z&&y.refetchRecords().catch(()=>{})}})},G=p.createAwareness?.(C),wt={awareness:G,handlers:y,syncConfig:p,unload:R,ydoc:C};e.set(m,wt);let vt=await Promise.all(E.map(async yt=>{let X=await yt({awareness:G,objectType:m,objectId:null,ydoc:C});return X.on("sync-connection-status",y.onStateChange),X}));D.observe(j)}function i(p,m){t.get(o(p,m))?.unload(),a(p,null,{},origin,{isSave:!0})}function o(p,m){return`${p}_${m}`}function c(p,m){let y=o(p,m),E=t.get(y);if(!(!E||!E.awareness))return E.awareness}function l(p,m,y){let E=o(p,m),C=t.get(E);if(!C)return;let{handlers:D,syncConfig:{applyChangesToCRDTDoc:z,getChangesFromCRDTDoc:R,supports:j},ydoc:G}=C;if(!j?.crdtPersistence){G.transact(()=>{z(G,y)},un);return}let wt=yc(y);if(!wt){G.transact(()=>{z(G,y),D.saveRecord()},un);return}let vt=ln(wt);ue(G,vt);let yt=R(wt,y),X=Object.keys(yt);if(wt.destroy(),X.length===0)return;let Xt=X.reduce((_t,Yt)=>Object.assign(_t,{[Yt]:y[Yt]}),{});G.transact(()=>{z(G,Xt),D.saveRecord()},un)}function a(p,m,y,E,C={}){let{isSave:D=!1,isNewUndoLevel:z=!1}=C,R=o(p,m),j=t.get(R),G=e.get(p);if(j){let{syncConfig:wt,ydoc:vt}=j;z&&n&&n.stopCapturing?.(),vt.transact(()=>{wt.applyChangesToCRDTDoc(vt,y),D&&Ks(vt)},E)}G&&D&&G.ydoc.transact(()=>{Ks(G.ydoc)},E)}async function u(p,m){let y=o(p,m),E=t.get(y);if(!E)return;let{handlers:C,syncConfig:D,ydoc:z}=E,R=D.getChangesFromCRDTDoc(z,await C.getEditedRecord());Object.keys(R).length!==0&&C.editRecord(R)}function f(p,m){let y=o(p,m),E=t.get(y);return E?.syncConfig.supports?.crdtPersistence?xc(E.ydoc):{}}return{createMeta:f,getAwareness:c,load:r,loadCollection:s,get undoManager(){return n},unload:i,update:a}}var ri=Pe(Pc(),1),Rr=Pe(ti(),1);var Yc=Pe(ti(),1);function Kd(e){return JSON.parse(JSON.stringify(e))}var ei;(e=>{function t(i={},o={},c=!1){typeof i!="object"&&(i={}),typeof o!="object"&&(o={});let l=Kd(o);c||(l=Object.keys(l).reduce((a,u)=>((l[u]!==null||l[u]!==void 0)&&(a[u]=l[u]),a),{}));for(let a in i)i[a]!==void 0&&o[a]===void 0&&(l[a]=i[a]);return Object.keys(l).length>0?l:void 0}e.compose=t;function n(i={},o={}){typeof i!="object"&&(i={}),typeof o!="object"&&(o={});let c=Object.keys(i).concat(Object.keys(o)).reduce((l,a)=>((0,Yc.default)(i[a],o[a])||(l[a]=o[a]===void 0?null:o[a]),l),{});return Object.keys(c).length>0?c:void 0}e.diff=n;function r(i={},o={}){i=i||{};let c=Object.keys(o).reduce((l,a)=>(o[a]!==i[a]&&i[a]!==void 0&&(l[a]=o[a]),l),{});return Object.keys(i).reduce((l,a)=>(i[a]!==o[a]&&o[a]===void 0&&(l[a]=null),l),c)}e.invert=r;function s(i,o,c=!1){if(typeof i!="object")return o;if(typeof o!="object")return;if(!c)return o;let l=Object.keys(o).reduce((a,u)=>(i[u]===void 0&&(a[u]=o[u]),a),{});return Object.keys(l).length>0?l:void 0}e.transform=s})(ei||(ei={}));var Ve=ei;var ni;(e=>{function t(n){return typeof n.delete=="number"?n.delete:typeof n.retain=="number"?n.retain:typeof n.retain=="object"&&n.retain!==null?1:typeof n.insert=="string"?n.insert.length:1}e.length=t})(ni||(ni={}));var kt=ni;var gt=class{ops;index;offset;constructor(e){this.ops=e,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(e){e||(e=1/0);let t=this.ops[this.index];if(t){let n=this.offset,r=kt.length(t);if(e>=r-n?(e=r-n,this.index+=1,this.offset=0):this.offset+=e,typeof t.delete=="number")return{delete:e};let s={};return t.attributes&&(s.attributes=t.attributes),typeof t.retain=="number"?s.retain=e:typeof t.retain=="object"&&t.retain!==null?s.retain=t.retain:typeof t.insert=="string"?s.insert=t.insert.substr(n,e):s.insert=t.insert,s}return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?kt.length(this.ops[this.index])-this.offset:1/0}peekType(){let e=this.ops[this.index];return e?typeof e.delete=="number"?"delete":typeof e.retain=="number"||typeof e.retain=="object"&&e.retain!==null?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index)}else return[];let e=this.offset,t=this.index,n=this.next(),r=this.ops.slice(this.index);return this.offset=e,this.index=t,[n].concat(r)}};function qd(e){return JSON.parse(JSON.stringify(e))}var Wd="\0",Hc=(e,t)=>{if(typeof e!="object"||e===null)throw new Error(`cannot retain a ${typeof e}`);if(typeof t!="object"||t===null)throw new Error(`cannot retain a ${typeof t}`);let n=Object.keys(e)[0];if(!n||n!==Object.keys(t)[0])throw new Error(`embed types not matched: ${n} != ${Object.keys(t)[0]}`);return[n,e[n],t[n]]},Xd=class at{static Op=kt;static OpIterator=gt;static AttributeMap=Ve;static handlers={};static registerEmbed(t,n){this.handlers[t]=n}static unregisterEmbed(t){delete this.handlers[t]}static getHandler(t){let n=this.handlers[t];if(!n)throw new Error(`no handlers for embed type "${t}"`);return n}ops;constructor(t){Array.isArray(t)?this.ops=t:t!=null&&Array.isArray(t.ops)?this.ops=t.ops:this.ops=[]}insert(t,n){let r={};return typeof t=="string"&&t.length===0?this:(r.insert=t,n!=null&&typeof n=="object"&&Object.keys(n).length>0&&(r.attributes=n),this.push(r))}delete(t){return t<=0?this:this.push({delete:t})}retain(t,n){if(typeof t=="number"&&t<=0)return this;let r={retain:t};return n!=null&&typeof n=="object"&&Object.keys(n).length>0&&(r.attributes=n),this.push(r)}push(t){let n=this.ops.length,r=this.ops[n-1];if(t=qd(t),typeof r=="object"){if(typeof t.delete=="number"&&typeof r.delete=="number")return this.ops[n-1]={delete:r.delete+t.delete},this;if(typeof r.delete=="number"&&t.insert!==null&&t.insert!==void 0&&(n-=1,r=this.ops[n-1],typeof r!="object"))return this.ops.unshift(t),this;if((0,Rr.default)(t.attributes,r.attributes)){if(typeof t.insert=="string"&&typeof r.insert=="string")return this.ops[n-1]={insert:r.insert+t.insert},typeof t.attributes=="object"&&(this.ops[n-1].attributes=t.attributes),this;if(typeof t.retain=="number"&&typeof r.retain=="number")return this.ops[n-1]={retain:r.retain+t.retain},typeof t.attributes=="object"&&(this.ops[n-1].attributes=t.attributes),this}}return n===this.ops.length?this.ops.push(t):this.ops.splice(n,0,t),this}chop(){let t=this.ops[this.ops.length-1];return t&&typeof t.retain=="number"&&!t.attributes&&this.ops.pop(),this}filter(t){return this.ops.filter(t)}forEach(t){this.ops.forEach(t)}map(t){return this.ops.map(t)}partition(t){let n=[],r=[];return this.forEach(s=>{(t(s)?n:r).push(s)}),[n,r]}reduce(t,n){return this.ops.reduce(t,n)}changeLength(){return this.reduce((t,n)=>n.insert?t+kt.length(n):n.delete?t-n.delete:t,0)}length(){return this.reduce((t,n)=>t+kt.length(n),0)}slice(t=0,n=1/0){let r=[],s=new gt(this.ops),i=0;for(;i<n&&s.hasNext();){let o;i<t?o=s.next(t-i):(o=s.next(n-i),r.push(o)),i+=kt.length(o)}return new at(r)}compose(t){let n=new gt(this.ops),r=new gt(t.ops),s=[],i=r.peek();if(i!=null&&typeof i.retain=="number"&&(i.attributes===null||i.attributes===void 0)){let c=i.retain;for(;n.peekType()==="insert"&&n.peekLength()<=c;)c-=n.peekLength(),s.push(n.next());i.retain-c>0&&r.next(i.retain-c)}let o=new at(s);for(;n.hasNext()||r.hasNext();)if(r.peekType()==="insert")o.push(r.next());else if(n.peekType()==="delete")o.push(n.next());else{let c=Math.min(n.peekLength(),r.peekLength()),l=n.next(c),a=r.next(c);if(a.retain){let u={};if(typeof l.retain=="number")u.retain=typeof a.retain=="number"?c:a.retain;else if(typeof a.retain=="number")l.retain===null||l.retain===void 0?u.insert=l.insert:u.retain=l.retain;else{let p=l.retain===null||l.retain===void 0?"insert":"retain",[m,y,E]=Hc(l[p],a.retain),C=at.getHandler(m);u[p]={[m]:C.compose(y,E,p==="retain")}}let f=Ve.compose(l.attributes,a.attributes,typeof l.retain=="number");if(f&&(u.attributes=f),o.push(u),!r.hasNext()&&(0,Rr.default)(o.ops[o.ops.length-1],u)){let p=new at(n.rest());return o.concat(p).chop()}}else typeof a.delete=="number"&&(typeof l.retain=="number"||typeof l.retain=="object"&&l.retain!==null)&&o.push(a)}return o.chop()}concat(t){let n=new at(this.ops.slice());return t.ops.length>0&&(n.push(t.ops[0]),n.ops=n.ops.concat(t.ops.slice(1))),n}diff(t){if(this.ops===t.ops)return new at;let n=this.deltasToStrings(t),r=(0,ri.diffChars)(n[0],n[1]),s=new gt(this.ops),i=new gt(t.ops);return this.convertChangesToDelta(r,s,i).chop()}eachLine(t,n=`
`){let r=new gt(this.ops),s=new at,i=0;for(;r.hasNext();){if(r.peekType()!=="insert")return;let o=r.peek(),c=kt.length(o)-r.peekLength(),l=typeof o.insert=="string"?o.insert.indexOf(n,c)-c:-1;if(l<0)s.push(r.next());else if(l>0)s.push(r.next(l));else{if(t(s,r.next(1).attributes||{},i)===!1)return;i+=1,s=new at}}s.length()>0&&t(s,{},i)}invert(t){let n=new at;return this.reduce((r,s)=>{if(s.insert)n.delete(kt.length(s));else{if(typeof s.retain=="number"&&(s.attributes===null||s.attributes===void 0))return n.retain(s.retain),r+s.retain;if(s.delete||typeof s.retain=="number"){let i=s.delete||s.retain;return t.slice(r,r+i).forEach(c=>{s.delete?n.push(c):s.retain&&s.attributes&&n.retain(kt.length(c),Ve.invert(s.attributes,c.attributes))}),r+i}else if(typeof s.retain=="object"&&s.retain!==null){let i=t.slice(r,r+1),o=new gt(i.ops).next(),[c,l,a]=Hc(s.retain,o.insert),u=at.getHandler(c);return n.retain({[c]:u.invert(l,a)},Ve.invert(s.attributes,o.attributes)),r+1}}return r},0),n.chop()}transform(t,n=!1){if(n=!!n,typeof t=="number")return this.transformPosition(t,n);let r=t,s=new gt(this.ops),i=new gt(r.ops),o=new at;for(;s.hasNext()||i.hasNext();)if(s.peekType()==="insert"&&(n||i.peekType()!=="insert"))o.retain(kt.length(s.next()));else if(i.peekType()==="insert")o.push(i.next());else{let c=Math.min(s.peekLength(),i.peekLength()),l=s.next(c),a=i.next(c);if(l.delete)continue;if(a.delete)o.push(a);else{let u=l.retain,f=a.retain,p=typeof f=="object"&&f!==null?f:c;if(typeof u=="object"&&u!==null&&typeof f=="object"&&f!==null){let m=Object.keys(u)[0];if(m===Object.keys(f)[0]){let y=at.getHandler(m);y&&(p={[m]:y.transform(u[m],f[m],n)})}}o.retain(p,Ve.transform(l.attributes,a.attributes,n))}}return o.chop()}transformPosition(t,n=!1){n=!!n;let r=new gt(this.ops),s=0;for(;r.hasNext()&&s<=t;){let i=r.peekLength(),o=r.peekType();if(r.next(),o==="delete"){t-=Math.min(i,t-s);continue}else o==="insert"&&(s<t||!n)&&(t+=i);s+=i}return t}diffWithCursor(t,n){if(this.ops===t.ops)return new at;if(n===null)return this.diff(t);let r=this.deltasToStrings(t),s=(0,ri.diffChars)(r[0],r[1]),i=0,o=[];for(let u=0;u<s.length;u++){let f=s[u],p=i,m=i+(f.count??0),y=n>p&&n<=m,E=!f.added&&!f.removed,C=f.removed&&!f.added,D=s[u+1],z=D&&D.added&&!D.removed;if(E&&y&&z){let R=this.tryMoveInsertionToCursor(f,D,n,p);if(R){o.push(...R),u++,i=m;continue}}if(C){let R=this.tryMoveDeletionToCursor(f,o,n,i);if(R){o.pop(),o.push(...R),i+=f.count??0;continue}}o.push(f),f.added||(i+=f.count??0)}s=o;let c=new gt(this.ops),l=new gt(t.ops);return this.convertChangesToDelta(s,c,l).chop()}tryMoveInsertionToCursor(t,n,r,s){let i=n.value,o=i.length,c=r-s-o;if(!(t.value.substring(c,c+i.length)===i))return null;let u=t.value.substring(0,c),f=t.value.substring(c),p=[];return u.length>0&&p.push({value:u,count:u.length,added:!1,removed:!1}),p.push(n),f.length>0&&p.push({value:f,count:f.length,added:!1,removed:!1}),p}tryMoveDeletionToCursor(t,n,r,s){let i=n[n.length-1];if(!i||i.added||i.removed)return null;let o=s-(i.count??0),c=s;if(r<o||r>=c)return null;let l=t.value,a=r-o;if(!(i.value.substring(a,a+l.length)===l))return null;let p=i.value.substring(0,a),m=i.value.substring(a),y=t.count??0,E=m.substring(y),C=[];return p.length>0&&C.push({value:p,count:p.length,added:!1,removed:!1}),C.push(t),E.length>0&&C.push({value:E,count:E.length,added:!1,removed:!1}),C}deltasToStrings(t){return[this,t].map(n=>n.map(r=>{if(r.insert!==null||r.insert!==void 0)return typeof r.insert=="string"?r.insert:Wd;let s=n===t?"on":"with";throw new Error("diff() called "+s+" non-document")}).join(""))}convertChangesToDelta(t,n,r){let s=new at;return t.forEach(i=>{let o=i.count??0;for(;o>0;){let c=0;if(i.added)c=Math.min(r.peekLength(),o),s.push(r.next(c));else if(i.removed)c=Math.min(o,n.peekLength()),n.next(c),s.delete(c);else{c=Math.min(n.peekLength(),r.peekLength(),o);let l=n.next(c),a=r.next(c);(0,Rr.default)(l.insert,a.insert)?s.retain(c,Ve.diff(l.attributes,a.attributes)):s.push(a).delete(c)}o-=c}}),s}},zc=Xd;var si={};pc(si,{createSyncManager:Bc,Delta:zc,CRDT_DOC_META_PERSISTENCE_KEY:Dr,CRDT_RECORD_MAP_KEY:Ur,CRDT_RECORD_METADATA_MAP_KEY:Me,CRDT_RECORD_METADATA_SAVED_AT_KEY:Wt,CRDT_RECORD_METADATA_SAVED_BY_KEY:Tr,LOCAL_EDITOR_ORIGIN:Ir,LOCAL_SYNC_MANAGER_ORIGIN:un,WORDPRESS_META_KEY_FOR_CRDT_DOC_PERSISTENCE:zn});var Qd="13";return cl(Zd);})();
/*! Bundled license information:

diff/dist/diff.js:
  (*!
  
   diff v4.0.1
  
  Software License Agreement (BSD License)
  
  Copyright (c) 2009-2015, Kevin Decker <kpdecker@gmail.com>
  
  All rights reserved.
  
  Redistribution and use of this software in source and binary forms, with or without modification,
  are permitted provided that the following conditions are met:
  
  * Redistributions of source code must retain the above
    copyright notice, this list of conditions and the
    following disclaimer.
  
  * Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the
    following disclaimer in the documentation and/or other
    materials provided with the distribution.
  
  * Neither the name of Kevin Decker nor the names of its
    contributors may be used to endorse or promote products
    derived from this software without specific prior
    written permission.
  
  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR
  IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
  FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
  DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER
  IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
  OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  @license
  *)
*/
//# sourceMappingURL=index.min.js.map

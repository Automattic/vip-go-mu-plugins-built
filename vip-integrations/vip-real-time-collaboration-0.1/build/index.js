(()=>{var e={982:function(e,t,n){var s;!function(){var t={};!function(e){"use strict";e.__esModule=!0,e.digestLength=32,e.blockSize=64;var t=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function n(e,n,s,r,o){for(var i,a,c,l,u,d,h,f,p,g,b,v,m;o>=64;){for(i=n[0],a=n[1],c=n[2],l=n[3],u=n[4],d=n[5],h=n[6],f=n[7],g=0;g<16;g++)b=r+4*g,e[g]=(255&s[b])<<24|(255&s[b+1])<<16|(255&s[b+2])<<8|255&s[b+3];for(g=16;g<64;g++)v=((p=e[g-2])>>>17|p<<15)^(p>>>19|p<<13)^p>>>10,m=((p=e[g-15])>>>7|p<<25)^(p>>>18|p<<14)^p>>>3,e[g]=(v+e[g-7]|0)+(m+e[g-16]|0);for(g=0;g<64;g++)v=(((u>>>6|u<<26)^(u>>>11|u<<21)^(u>>>25|u<<7))+(u&d^~u&h)|0)+(f+(t[g]+e[g]|0)|0)|0,m=((i>>>2|i<<30)^(i>>>13|i<<19)^(i>>>22|i<<10))+(i&a^i&c^a&c)|0,f=h,h=d,d=u,u=l+v|0,l=c,c=a,a=i,i=v+m|0;n[0]+=i,n[1]+=a,n[2]+=c,n[3]+=l,n[4]+=u,n[5]+=d,n[6]+=h,n[7]+=f,r+=64,o-=64}return r}var s=function(){function t(){this.digestLength=e.digestLength,this.blockSize=e.blockSize,this.state=new Int32Array(8),this.temp=new Int32Array(64),this.buffer=new Uint8Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}return t.prototype.reset=function(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this},t.prototype.clean=function(){for(var e=0;e<this.buffer.length;e++)this.buffer[e]=0;for(e=0;e<this.temp.length;e++)this.temp[e]=0;this.reset()},t.prototype.update=function(e,t){if(void 0===t&&(t=e.length),this.finished)throw new Error("SHA256: can't update because hash was finished.");var s=0;if(this.bytesHashed+=t,this.bufferLength>0){for(;this.bufferLength<64&&t>0;)this.buffer[this.bufferLength++]=e[s++],t--;64===this.bufferLength&&(n(this.temp,this.state,this.buffer,0,64),this.bufferLength=0)}for(t>=64&&(s=n(this.temp,this.state,e,s,t),t%=64);t>0;)this.buffer[this.bufferLength++]=e[s++],t--;return this},t.prototype.finish=function(e){if(!this.finished){var t=this.bytesHashed,s=this.bufferLength,r=t/536870912|0,o=t<<3,i=t%64<56?64:128;this.buffer[s]=128;for(var a=s+1;a<i-8;a++)this.buffer[a]=0;this.buffer[i-8]=r>>>24&255,this.buffer[i-7]=r>>>16&255,this.buffer[i-6]=r>>>8&255,this.buffer[i-5]=r>>>0&255,this.buffer[i-4]=o>>>24&255,this.buffer[i-3]=o>>>16&255,this.buffer[i-2]=o>>>8&255,this.buffer[i-1]=o>>>0&255,n(this.temp,this.state,this.buffer,0,i),this.finished=!0}for(a=0;a<8;a++)e[4*a+0]=this.state[a]>>>24&255,e[4*a+1]=this.state[a]>>>16&255,e[4*a+2]=this.state[a]>>>8&255,e[4*a+3]=this.state[a]>>>0&255;return this},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype._saveState=function(e){for(var t=0;t<this.state.length;t++)e[t]=this.state[t]},t.prototype._restoreState=function(e,t){for(var n=0;n<this.state.length;n++)this.state[n]=e[n];this.bytesHashed=t,this.finished=!1,this.bufferLength=0},t}();e.Hash=s;var r=function(){function e(e){this.inner=new s,this.outer=new s,this.blockSize=this.inner.blockSize,this.digestLength=this.inner.digestLength;var t=new Uint8Array(this.blockSize);if(e.length>this.blockSize)(new s).update(e).finish(t).clean();else for(var n=0;n<e.length;n++)t[n]=e[n];for(n=0;n<t.length;n++)t[n]^=54;for(this.inner.update(t),n=0;n<t.length;n++)t[n]^=106;for(this.outer.update(t),this.istate=new Uint32Array(8),this.ostate=new Uint32Array(8),this.inner._saveState(this.istate),this.outer._saveState(this.ostate),n=0;n<t.length;n++)t[n]=0}return e.prototype.reset=function(){return this.inner._restoreState(this.istate,this.inner.blockSize),this.outer._restoreState(this.ostate,this.outer.blockSize),this},e.prototype.clean=function(){for(var e=0;e<this.istate.length;e++)this.ostate[e]=this.istate[e]=0;this.inner.clean(),this.outer.clean()},e.prototype.update=function(e){return this.inner.update(e),this},e.prototype.finish=function(e){return this.outer.finished?this.outer.finish(e):(this.inner.finish(e),this.outer.update(e,this.digestLength).finish(e)),this},e.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},e}();function o(e){var t=(new s).update(e),n=t.digest();return t.clean(),n}function i(e,t){var n=new r(e).update(t),s=n.digest();return n.clean(),s}function a(e,t,n,s){var r=s[0];if(0===r)throw new Error("hkdf: cannot expand more");t.reset(),r>1&&t.update(e),n&&t.update(n),t.update(s),t.finish(e),s[0]++}e.HMAC=r,e.hash=o,e.default=o,e.hmac=i;var c=new Uint8Array(e.digestLength);e.hkdf=function(e,t,n,s){void 0===t&&(t=c),void 0===s&&(s=32);for(var o=new Uint8Array([1]),l=i(t,e),u=new r(l),d=new Uint8Array(u.digestLength),h=d.length,f=new Uint8Array(s),p=0;p<s;p++)h===d.length&&(a(d,u,n,o),h=0),f[p]=d[h++];return u.clean(),d.fill(0),o.fill(0),f},e.pbkdf2=function(e,t,n,s){for(var o=new r(e),i=o.digestLength,a=new Uint8Array(4),c=new Uint8Array(i),l=new Uint8Array(i),u=new Uint8Array(s),d=0;d*i<s;d++){var h=d+1;a[0]=h>>>24&255,a[1]=h>>>16&255,a[2]=h>>>8&255,a[3]=h>>>0&255,o.reset(),o.update(t),o.update(a),o.finish(l);for(var f=0;f<i;f++)c[f]=l[f];for(f=2;f<=n;f++){o.reset(),o.update(l).finish(l);for(var p=0;p<i;p++)c[p]^=l[p]}for(f=0;f<i&&d*i+f<s;f++)u[d*i+f]=c[f]}for(d=0;d<i;d++)c[d]=l[d]=0;for(d=0;d<4;d++)a[d]=0;return o.clean(),u}}(t);var r=t.default;for(var o in t)r[o]=t[o];"object"==typeof e.exports?e.exports=r:void 0===(s=function(){return r}.call(t,n,t,e))||(e.exports=s)}()}},t={};function n(s){var r=t[s];if(void 0!==r)return r.exports;var o=t[s]={exports:{}};return e[s].call(o.exports,o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=window.wp.hooks,t=window.wp.plugins,s=window.ReactJSXRuntime,r=window.wp.blockEditor,o=window.wp.components,i=window.wp.data,a=window.wp.editor,c=window.wp.i18n;function l({userState:e,showUserColorBorder:t}){const n={border:!0===t?`2px solid ${e.color}`:void 0,opacity:e.isConnected?1:.5};return(0,s.jsx)("div",{className:"vip-real-time-collaboration-avatar",children:(0,s.jsx)("img",{alt:e.name,src:e.avatarUrl,style:n,title:e.name})})}const u=window.wp.element,d=window.wp.coreData,h=window.wp.sync.Y.applyUpdate,f=window.wp.sync.Y.applyUpdateV2,p=window.wp.sync.Y.encodeStateVector,g=window.wp.sync.Y.encodeStateAsUpdate,b=window.wp.sync.Y.encodeStateAsUpdateV2,v=window.wp.sync.Y.createRelativePositionFromTypeIndex,m=window.wp.sync.Y.createAbsolutePositionFromRelativePosition,w=window.wp.sync.Y.Doc,y=A("rtcPostMetaKey"),S=A("wsUrl"),E=A("blogId");function A(e){return"undefined"==typeof window||void 0===window.VIP_RTC?null:window.VIP_RTC[e]}var I;!function(e){e[e.CRITICAL=5]="CRITICAL",e[e.ERROR=4]="ERROR",e[e.WARNING=3]="WARNING",e[e.INFO=2]="INFO",e[e.DEBUG=1]="DEBUG"}(I||(I={}));const C=I.WARNING;class k{constructor(e="",t=C){this.threshold=t,this.namespace="vip-rtc"+(e?`:${e}`:"")}log(e,...t){if(e<this.threshold)return;const n=I[e];console.log(`[${this.namespace}][${n}]`,...t)}debug(...e){this.log(I.DEBUG,...e)}info(...e){this.log(I.INFO,...e)}warn(...e){this.log(I.WARNING,...e)}error(...e){this.log(I.ERROR,...e)}critical(...e){this.log(I.CRITICAL,...e)}}const x=new k("selection");var _;function j(e,t,n){const s=0===Object.keys(e).length,r={type:_.None};if(s)return r;const o=e.clientId===t.clientId,i=o&&e.offset===t.offset;if(o&&void 0===e.offset&&void 0===t.offset)return{type:_.WholeBlock,blockId:e.clientId};if(i){const t=U(e,n);return t?{type:_.Cursor,blockId:e.clientId,cursorPosition:t}:r}if(o){const s=U(e,n),o=U(t,n);return s&&o?{type:_.SelectionInOneBlock,blockId:e.clientId,cursorStartPosition:s,cursorEndPosition:o}:r}const a=U(e,n),c=U(t,n);return a&&c?{type:_.SelectionInMultipleBlocks,blockStartId:e.clientId,blockEndId:t.clientId,cursorStartPosition:a,cursorEndPosition:c}:r}function U(e,t){const n=M(e.clientId,t);if(!n)return null;const s=n.get("attributes").get(e.attributeKey);return{relativePosition:v(s,e.offset),absoluteOffset:e.offset}}function M(e,t){for(const n of t){if(n.get("clientId")===e)return n;if(n.get("innerBlocks").length>0){const t=M(e,n.get("innerBlocks"));if(t)return t}}return null}function O(e,t){const n=JSON.stringify(e.relativePosition)===JSON.stringify(t.relativePosition),s=e.absoluteOffset===t.absoluteOffset;return n&&s}function N(e,t){return Object.keys(e).length===Object.keys(t).length&&Object.entries(e).every(([n,s])=>{return"editorState"===n?(r=e.editorState,o=t.editorState,Boolean(r&&o&&function(e,t){if(e.type!==t.type)return!1;switch(e.type){case _.None:return!0;case _.Cursor:return e.blockId===t.blockId&&O(e.cursorPosition,t.cursorPosition);case _.SelectionInOneBlock:return e.blockId===t.blockId&&O(e.cursorStartPosition,t.cursorStartPosition)&&O(e.cursorEndPosition,t.cursorEndPosition);case _.SelectionInMultipleBlocks:return e.blockStartId===t.blockStartId&&e.blockEndId===t.blockEndId&&O(e.cursorStartPosition,t.cursorStartPosition)&&O(e.cursorEndPosition,t.cursorEndPosition);case _.WholeBlock:return e.blockId===t.blockId;default:return x.error("Unable to compare selection types:",e,t),!1}}(r.selection,o.selection))):s===t[n];var r,o})}!function(e){e.None="none",e.Cursor="cursor",e.SelectionInOneBlock="selection-in-one-block",e.SelectionInMultipleBlocks="selection-in-multiple-blocks",e.WholeBlock="whole-block"}(_||(_={}));const T={userMap:new Map},R={getActiveClientIds:e=>Array.from(e.userMap.keys()),getActiveUsers:e=>e.userMap,isDisconnected:e=>-1!==Array.from(R.getActiveUsers(e).values()).findIndex(e=>e.isMe&&!1===e.isConnected)},D=(0,i.createReduxStore)("vip-real-time-collaboration/awareness",{reducer:(e=T,t)=>{switch(t.type){case"PATCH_USER":if(e.userMap.has(t.payload.clientId)){const n=e.userMap.get(t.payload.clientId),s=Object.assign(Object.assign({},n),t.payload.userState);if(!N(n,s))return e.userMap.set(t.payload.clientId,s),Object.assign(Object.assign({},e),{userMap:new Map(e.userMap)})}return e;case"REMOVE_USER":return e.userMap.delete(t.payload.clientId),Object.assign(Object.assign({},e),{userMap:new Map(e.userMap)});case"UPSERT_USER":return e.userMap.has(t.payload.clientId)&&N(e.userMap.get(t.payload.clientId),t.payload.userState)?e:(e.userMap.set(t.payload.clientId,t.payload.userState),Object.assign(Object.assign({},e),{userMap:new Map(e.userMap)}));default:return e}},actions:{patchUser:(e,t)=>({type:"PATCH_USER",payload:{clientId:e,userState:t}}),removeUser:e=>({type:"REMOVE_USER",payload:{clientId:e}}),upsertUser:(e,t)=>({type:"UPSERT_USER",payload:{clientId:e,userState:t}})},selectors:R});function P(){const e=(0,i.useSelect)(e=>e(D).getActiveUsers());return(0,u.useMemo)(()=>Array.from(e.values()).sort((e,t)=>e.isMe&&!t.isMe?-1:!e.isMe&&t.isMe?1:0),[e])}(0,i.register)(D);const L=new k("local-storage"),B=(e,t)=>{try{const n=localStorage.getItem(e);if(n){const e=JSON.parse(n);return"object"!=typeof e||null===e||Array.isArray(e)?e:Object.assign(Object.assign({},t),e)}}catch(t){L.warn(`Failed to load data from localStorage (key: ${e}):`,t)}return t},$=(e,t)=>{try{localStorage.setItem(e,JSON.stringify(t))}catch(t){L.warn(`Failed to save data to localStorage (key: ${e}):`,t)}},F="vip-rtc-settings",H={isAwarenessAvatarsEnabled:!0,isAwarenessCursorsEnabled:!0,isDebugToolsEnabled:!1,isSelfAwarenessEnabled:!1},W={isAwarenessAvatarsEnabled(e){const{isAwarenessAvatarsEnabled:t}=e;return t},isAwarenessCursorsEnabled(e){const{isAwarenessCursorsEnabled:t}=e;return t},isDebugToolsEnabled:e=>!1,isSelfAwarenessEnabled(e){const{isSelfAwarenessEnabled:t}=e;return t}},V=(0,i.createReduxStore)("vip-real-time-collaboration/settings",{reducer:(e=B(F,H),t)=>{switch(t.type){case"SET_AWARENESS_AVATARS_ENABLED":{const n=Object.assign(Object.assign({},e),{isAwarenessAvatarsEnabled:t.payload});return $(F,n),n}case"SET_AWARENESS_CURSORS_ENABLED":{const n=Object.assign(Object.assign({},e),{isAwarenessCursorsEnabled:t.payload});return $(F,n),n}case"SET_DEBUG_TOOLS_ENABLED":{const n=Object.assign(Object.assign({},e),{isDebugToolsEnabled:t.payload});return $(F,n),n}case"SET_SELF_AWARENESS_ENABLED":{const n=Object.assign(Object.assign({},e),{isSelfAwarenessEnabled:t.payload});return $(F,n),n}default:return e}},actions:{setAwarenessAvatarsEnabled:e=>({type:"SET_AWARENESS_AVATARS_ENABLED",payload:e}),setAwarenessCursorsEnabled:e=>({type:"SET_AWARENESS_CURSORS_ENABLED",payload:e}),setDebugToolsEnabled:e=>({type:"SET_DEBUG_TOOLS_ENABLED",payload:e}),setSelfAwarenessEnabled:e=>({type:"SET_SELF_AWARENESS_ENABLED",payload:e})},selectors:W});function q(){const e=P(),t=(0,i.useSelect)(e=>e(V).isSelfAwarenessEnabled());if(e.length<=1&&!t)return null;const n=e.slice(0,3),r=e.slice(3),o=r.map(e=>e.name).join(", ");return(0,s.jsx)("div",{className:"vip-real-time-collaboration-avatars-container",children:(0,s.jsxs)("div",{className:"vip-real-time-collaboration-avatars",children:[n.map(e=>(0,s.jsx)(l,{userState:e,showUserColorBorder:!0},e.clientId)),r.length>0&&(0,s.jsxs)("div",{className:"vip-real-time-collaboration-avatar-remaining",title:o,children:["+",r.length]})]})})}(0,i.register)(V);const z=window.wp.blocks;function G(e,t,n){const s=n.getSelection();if(s&&s.rangeCount>0){const e=s.getRangeAt(0);e.deleteContents();const r=n.createTextNode(t);e.insertNode(r),e.setStartAfter(r),e.setEndAfter(r),s.removeAllRanges(),s.addRange(e)}else{const r=n.createRange();r.selectNodeContents(e),r.collapse(!1);const o=n.createTextNode(t);r.insertNode(o),r.setStartAfter(o),r.setEndAfter(o),null==s||s.removeAllRanges(),null==s||s.addRange(r)}}function J({iframeDocument:e}){const[t,n]=(0,u.useState)(!1),[o,a]=(0,u.useState)(null),[c,l]=(0,u.useState)(100),d=(0,u.useRef)(null),h=(0,i.useSelect)(e=>e(r.store).getSelectedBlockClientId),f=h(),{selectBlock:p,insertBlock:g}=(0,i.useDispatch)(r.store);(0,u.useEffect)(()=>{f&&!t&&a(f)},[f,t]);const b=()=>{return e=this,t=void 0,s=function*(){if(o)return o;if(f)return a(f),f;const e=(0,z.createBlock)("core/paragraph");return g(e),new Promise(e=>{setTimeout(()=>{const t=h();t?(a(t),e(t)):e(null)},10)})},new((n=void 0)||(n=Promise))(function(r,o){function i(e){try{c(s.next(e))}catch(e){o(e)}}function a(e){try{c(s.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,a)}c((s=s.apply(e,t||[])).next())});var e,t,n,s};return(0,u.useEffect)(()=>(t?b().then(t=>{t?(t=>{let s=0,r=0,o=Y[Math.floor(Math.random()*Y.length)]||"";p(t),d.current=setInterval(()=>{const i=function(e,t){const n=e.querySelector(`[data-block="${t}"]`);return n&&"true"===n.getAttribute("contenteditable")?n:null}(e,t);if(!i)return void n(!1);e.activeElement!==i&&i.focus();let a=o[s];a||(o=Y[Math.floor(Math.random()*Y.length)]||"",s=0,a=o[s],r>0&&G(i," ",e),r++),a&&(G(i,a,e),s++)},c)})(t):n(!1)}).catch(()=>{n(!1)}):d.current&&(clearInterval(d.current),d.current=null),()=>{d.current&&clearInterval(d.current)}),[t,c,e,p,g]),(0,s.jsxs)("div",{className:"vip-real-time-collaboration-debug-interface",children:[(0,s.jsx)("div",{className:"vip-real-time-collaboration-debug-header",children:"Debug Tools"}),(0,s.jsx)("button",{type:"button",onClick:()=>{n(!t)},className:"vip-real-time-collaboration-debug-reset",children:t?"Stop typing":"Start typing"}),t&&(0,s.jsxs)("div",{className:"vip-real-time-collaboration-debug-speed",children:[(0,s.jsxs)("div",{className:"vip-real-time-collaboration-debug-speed-header",children:[(0,s.jsx)("span",{children:"Speed:"}),(0,s.jsx)("button",{type:"button",onClick:()=>{l(100)},className:"vip-real-time-collaboration-debug-reset",children:"Reset"})]}),(0,s.jsx)("input",{type:"range",min:"20",max:"1000",value:c,onChange:e=>{l(parseInt(e.target.value,10))},className:"vip-real-time-collaboration-debug-slider"}),(0,s.jsxs)("div",{className:"vip-real-time-collaboration-debug-speed-value",children:[c,"ms per character"]})]})]})}const Y=["Lorem ipsum dolor sit amet, consectetur adipiscing elit. ","Suspendisse sem leo, gravida id nulla at, blandit laoreet risus. ","Pellentesque velit justo, ullamcorper a ante nec, efficitur vulputate tortor. ","Etiam sem dui, mollis vitae felis nec, sagittis facilisis libero. ","Fusce justo tellus, consequat id enim eu, lacinia euismod lorem. ","Donec faucibus varius aliquam. ","Maecenas sit amet nisl ac sem pulvinar consequat vel a metus. ","Suspendisse potenti. ","Morbi blandit, enim vitae blandit malesuada, enim lorem accumsan nibh, nec maximus tellus quam vitae dui. ","Curabitur lacinia, lectus et eleifend pretium, leo ante tincidunt quam, nec cursus tellus sem id odio. ","Morbi eget nisl ligula. ","Proin eget neque eget felis interdum dignissim. ","Ut justo augue, accumsan eu efficitur et, placerat non ex. ","Nullam id gravida risus. ","Etiam vitae tortor vel nisl imperdiet mollis sed quis tortor. ","Donec velit quam, elementum eu nibh in, convallis vehicula erat. ","Sed viverra accumsan justo, eu egestas quam vehicula non. ","Cras egestas consequat erat, ut laoreet massa ornare ut. ","Vivamus vitae consequat arcu. ","In at mollis libero, quis convallis elit. ","Mauris bibendum mauris odio, et condimentum nisi convallis eu. ","Mauris pharetra metus id laoreet tempor. ","Sed gravida massa quis risus laoreet iaculis. ","Donec non eros gravida nisl sodales porta. ","Nullam a pellentesque tortor. ","Curabitur rhoncus consectetur mauris ut ornare. ","Vestibulum quis posuere enim. ","Fusce id orci pharetra enim vestibulum imperdiet et ut nunc. ","Mauris tempus arcu et est aliquet, sit amet tincidunt felis ultricies. ","Curabitur in lorem lorem. "],X=window.wp.primitives,Z=(0,s.jsx)(X.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)(X.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M12.218 5.377a.25.25 0 0 0-.436 0l-7.29 12.96a.25.25 0 0 0 .218.373h14.58a.25.25 0 0 0 .218-.372l-7.29-12.96Zm-1.743-.735c.669-1.19 2.381-1.19 3.05 0l7.29 12.96a1.75 1.75 0 0 1-1.525 2.608H4.71a1.75 1.75 0 0 1-1.525-2.608l7.29-12.96ZM12.75 17.46h-1.5v-1.5h1.5v1.5Zm-1.5-3h1.5v-5h-1.5v5Z"})}),K=window.wp.compose;function Q(){const e=function(e=()=>{}){const t=(0,i.useSelect)(e=>{const{getEditedPostContent:t}=e(a.store);return t()});return(0,K.useCopyToClipboard)(null!=t?t:"",e)}();return function(){const[e,t]=(0,u.useState)(!1),n=(0,u.useRef)(null),s=(0,i.useSelect)(e=>e(D).isDisconnected());return(0,u.useEffect)(()=>{var e;return s?n.current=setTimeout(()=>{t(!0)},5e3):(t(!1),clearTimeout(null!==(e=n.current)&&void 0!==e?e:void 0)),()=>{var e;return clearTimeout(null!==(e=n.current)&&void 0!==e?e:void 0)}},[s]),e}()?(0,s.jsx)(o.Modal,{__experimentalHideHeader:!0,icon:Z,isDismissible:!1,isFullScreen:!1,onRequestClose:()=>{},shouldCloseOnClickOutside:!1,shouldCloseOnEsc:!1,children:(0,s.jsx)("div",{className:"vip-rtc-post-locked-modal__container",children:(0,s.jsxs)(o.__experimentalVStack,{alignment:"center",justify:"center",spacing:2,children:[(0,s.jsx)(o.Icon,{fill:"#ccc",icon:Z,size:64}),(0,s.jsx)("h1",{children:(0,c.__)("Disconnected","vip-real-time-collaboration")}),(0,s.jsxs)("p",{className:"vip-rtc-post-locked-modal__p",children:[(0,c.__)("You are currently disconnected from the collaborative editing server.","vip-real-time-collaboration")," ",(0,c.__)("Editing is temporarily disabled to prevent conflicts with other users.","vip-real-time-collaboration")]}),(0,s.jsxs)(o.__experimentalHStack,{spacing:2,justify:"center",children:[(0,s.jsx)(o.Button,{ref:e,variant:"primary",children:(0,c.__)("Copy post content","vip-real-time-collaboration")}),(0,s.jsx)(o.Button,{href:"edit.php",isDestructive:!0,variant:"secondary",children:(0,c.__)("Edit another post","vip-real-time-collaboration")})]})]})})}):null}const ee=(e,t)=>e.querySelector(`[data-block="${t}"]`),te=window.wp.notices;function ne(){const e=window.navigator.userAgent;let t="Unknown";return e.includes("Firefox")?t="Firefox":e.includes("Edg")?t="Microsoft Edge":e.includes("Chrome")&&!e.includes("Edg")?t="Chrome":e.includes("Safari")&&!e.includes("Chrome")?t="Safari":e.includes("MSIE")||e.includes("Trident")?t="Internet Explorer":(e.includes("Opera")||e.includes("OPR"))&&(t="Opera"),t}new k("crypto");var se=function(e,t,n,s){return new(n||(n=Promise))(function(r,o){function i(e){try{c(s.next(e))}catch(e){o(e)}}function a(e){try{c(s.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,a)}c((s=s.apply(e,t||[])).next())})};function re(){return se(this,void 0,void 0,function*(){var e;const{avatar_urls:t,id:n,name:s}=null!==(e=(0,i.select)(d.store).getCurrentUser())&&void 0!==e?e:{};return n?{avatarUrl:(null==t?void 0:t[24])||(null==t?void 0:t[48])||(null==t?void 0:t[96]),id:n,name:s}:(yield new Promise(e=>setTimeout(e,100)),yield re())})}function oe(e,t){return se(this,void 0,void 0,function*(){const n=t.getInitialObjectData(e),{blocks:s,date:r}=n,o=function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(n[s[r]]=e[s[r]])}return n}(n,["blocks","date"]),i=Object.assign(Object.assign({},o),{content:ie(e,"content")}),a=JSON.stringify(i,Object.keys(i).sort());return yield function(e,t){return n=this,s=arguments,o=function*(e,t,n=16){const s=(new TextEncoder).encode(e);if(window.isSecureContext)return function(e,t=16){return Array.from(new Uint8Array(e)).map(e=>e.toString(t).padStart(2,"0")).join("")}(yield window.crypto.subtle.digest(t,s),n);throw new Error("Unable to generate hash outside of secure context in non-development mode!")},new((r=void 0)||(r=Promise))(function(e,t){function i(e){try{c(o.next(e))}catch(e){t(e)}}function a(e){try{c(o.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(i,a)}c((o=o.apply(n,s||[])).next())});var n,s,r,o}(a,"SHA-256")})}function ie(e,t){const n=t in e?e[t]:null;return"string"==typeof n?n:n&&"object"==typeof n&&"raw"in n&&"string"==typeof n.raw?n.raw:""}const ae=["#A4C400","#60A917","#008A00","#00ABA9","#1BA1E2","#0050EF","#6A00FF","#AA00FF","#F472D0","#D80073","#A20025","#E51400","#FA6800","#F0A30A","#E3C800","#647687"],ce="vip-rtc-preferred-color",le=e=>{e=e.map(e=>e.slice(0,-2));const t=ae.filter(t=>!e.includes(t));if(0===t.length)return`hsla(${ue(0,360)}, ${ue(50,100)}%, ${ue(45,95)}%, 0.7)`;let n=null;const s=B(ce,null);return s&&t.includes(s)?n=s:(n=t[`${ue(0,t.length-1)}`],$(ce,n)),`${n}${Math.round(178.5).toString(16).padStart(2,"0").toUpperCase()}`},ue=(e,t)=>Math.floor(Math.random()*(t-e+1))+e;var de;class he{constructor(e,t){this.awareness=e,this.userInfo=t,this.logger=new k("awareness-manager"),this.setCurrentUserState(),this.refreshAwareness(),this.subscribeToCRDTChanges(),this.subscribeToSelectionChanges(),this.subscribeToUserChanges()}static initialize(e){return t=this,n=void 0,r=function*(){he.__instance?he.__instance.logger.error(`AwarenessManager was created more than once for client ID ${e.clientID}.`):he.__instance=new he(e,yield re())},new((s=void 0)||(s=Promise))(function(e,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s(function(e){e(n)})).then(i,a)}c((r=r.apply(t,n||[])).next())});var t,n,s,r}static setConnectionStatus(e,t){var n;if(e!==(null===(n=he.__instance)||void 0===n?void 0:n.awareness.clientID))return;const{patchUser:s}=(0,i.dispatch)(D);s(e,{isConnected:t})}static convertRelativePositionToAbsolutePosition(e){var t,n;return(null===(n=null===(t=he.__instance)||void 0===t?void 0:t.awareness)||void 0===n?void 0:n.doc)?m(e,he.__instance.awareness.doc):(console.error("convertRelativePositionToAbsolutePosition() awareness document not found"),null)}setCurrentUserState(){var e;const t=this.getStates(),n=Array.from(t.values()).filter(e=>!e.isMe).map(e=>e.color).filter(Boolean),s=Object.assign(Object.assign({},this.userInfo),{browserType:ne(),clientId:this.awareness.clientID,color:le(n),editorState:null!==(e=this.getLocalStateField("editorState"))&&void 0!==e?e:{selection:{type:_.None}},isConnected:!0,isMe:!0});this.awareness.setLocalState(s)}getStates(){return this.awareness.getStates()}getLocalStateField(e){var t;return null===(t=this.awareness.getLocalState())||void 0===t?void 0:t[e]}setLocalStateField(e,t){this.awareness.setLocalStateField(e,t)}refreshAwareness(){const{removeUser:e,upsertUser:t}=(0,i.dispatch)(D),{getActiveClientIds:n}=(0,i.select)(D),s=new Set(n()),r=new Set;this.getStates().forEach((e,n)=>{this.validateUserState(e)&&(e.isMe=e.clientId===this.awareness.clientID,t(n,e),r.add(n))}),s.forEach(t=>{r.has(t)||e(t)})}subscribeToCRDTChanges(){const e=Date.now(),t=this.awareness.doc.getMap("document"),n=this.awareness.doc.getMap("state"),{createNotice:s}=(0,i.dispatch)(te.store);n.observe((r,o)=>{r.keysChanged.forEach(r=>{switch(r){case"persistedAt":{if(o.local)break;const r=n.get("persistedBy"),i=this.getStates().get(r);if(this.logger.debug(`Document was persisted by client ID ${r}.`,{remoteClientId:r,userState:i,stateMap:n}),e>n.get("persistedAt")||!i||i.id===this.userInfo.id)break;const a=function(e,t){let n="Draft",s="saved";return["future","private","publish"].includes(t)&&(n="Post",s="updated"),`${n} ${s} by ${e.name}.`}(i,t.get("status"));s("info",a,{id:`remote-user-persisted-${r}`,isDismissible:!1,type:"snackbar"});break}case"restoredAt":{const t=n.get("restoredBy"),r=this.getStates().get(t);if(this.logger.debug(`Document was restored by client ID ${t}.`,{remoteClientId:t,userState:r,stateMap:n}),e>n.get("restoredAt")||!r)break;const o=function(e){let t=`${e.name} restored`;return e.isMe&&(t="Restored"),`${t} newer content from the server.`}(r);s("info",o,{id:`remote-user-restored-${t}`,isDismissible:!1,type:"snackbar"});break}}})})}subscribeToSelectionChanges(){const{getSelectionStart:e,getSelectionEnd:t,getSelectedBlocksInitialCaretPosition:n}=(0,i.select)(r.store);let s=e(),o=t();(0,i.subscribe)(()=>{const r=e(),c=t();if(r===s&&c===o)return;s=r,o=c,function(e,t,n){var s,r,o,c;s=this,r=void 0,c=function*(){const{editEntityRecord:s}=(0,i.dispatch)(d.store),{getCurrentPostId:r,getCurrentPostType:o}=(0,i.select)(a.store),c=r(),l=o();if(!c||!l||!e.clientId)return;const u={selection:{selectionStart:e,selectionEnd:t,initialPosition:n}};yield s("postType",l,c,u,{undoIgnore:!0})},new((o=void 0)||(o=Promise))(function(e,t){function n(e){try{a(c.next(e))}catch(e){t(e)}}function i(e){try{a(c.throw(e))}catch(e){t(e)}}function a(t){var s;t.done?e(t.value):(s=t.value,s instanceof o?s:new o(function(e){e(s)})).then(n,i)}a((c=c.apply(s,r||[])).next())})}(s,o,n());let l=null;l&&clearTimeout(l),l=setTimeout(()=>{this.updateSelectionState(s,o)},5)})}updateSelectionState(e,t){const{patchUser:n}=(0,i.dispatch)(D),s={selection:j(e,t,this.awareness.doc.getMap("document").get("blocks"))};n(this.awareness.clientID,{editorState:s});let r=null,o=null;o=s,r||(r=setTimeout(()=>{o&&(this.setLocalStateField("editorState",o),o=null),r=null},50))}subscribeToUserChanges(){const e=new Map,{patchUser:t,removeUser:n,upsertUser:s}=(0,i.dispatch)(D);this.awareness.on("change",({added:r,removed:o,updated:i})=>{const a=this.getStates();[...r,...i].forEach(n=>{const r=a.get(n);e.has(n)&&(clearTimeout(e.get(n)),e.delete(n)),this.validateUserState(r)&&(r.clientId!==this.awareness.clientID?(r.isConnected=!0,r.isMe=!1,s(n,r)):!0===r.isConnected&&t(n,{isConnected:!0}))}),o.forEach(s=>{e.has(s)||(t(s,{isConnected:!1}),e.set(s,setTimeout(()=>{e.delete(s),n(s)},5e3)))})})}validateUserState(e){return!!((null==e?void 0:e.clientId)&&(null==e?void 0:e.id)&&(null==e?void 0:e.editorState))}}!function(e){e[e.None=0]="None",e[e.OtherUsers=1]="OtherUsers",e[e.All=2]="All"}(de||(de={}));const fe=new k("use-render-cursors"),pe=(e,t,n,s)=>{e&&t&&(e.querySelectorAll(".vip-real-time-collaboration-user").forEach(e=>{e.remove()}),s!==de.None&&n.forEach(({userName:n,selection:r,color:o,isMe:i})=>{if(i&&s===de.OtherUsers)return;let a=null;if(r.type===_.None);else if(r.type===_.WholeBlock);else if(r.type===_.Cursor)a=ge(r,t,e);else if(r.type===_.SelectionInOneBlock){const n={type:_.Cursor,blockId:r.blockId,cursorPosition:r.cursorStartPosition};a=ge(n,t,e)}else if(r.type===_.SelectionInMultipleBlocks){const n={type:_.Cursor,blockId:r.blockStartId,cursorPosition:r.cursorStartPosition};a=ge(n,t,e)}if(a){const t=document.createElement("div");t.className="vip-real-time-collaboration-user",t.style.left=`${a.x}px`,t.style.top=`${a.y}px`;const s=document.createElement("div");s.className="vip-real-time-collaboration-user-cursor",s.style.backgroundColor=o,s.style.height=`${a.height}px`;const r=document.createElement("div");r.className="vip-real-time-collaboration-user-label",r.textContent=n,r.style.backgroundColor=o,t.appendChild(s),t.appendChild(r),e.appendChild(t)}}))},ge=(e,t,n)=>{const s=he.convertRelativePositionToAbsolutePosition(e.cursorPosition.relativePosition);if(null===s)return null;const r=t.querySelector(`[data-block="${e.blockId}"]`);if(!r)return null;const o=be(r,s.index,t,n);return null!=o?o:null},be=(e,t,n,s)=>{const{node:r,offset:o}=ve(e,t,n),i=n.createRange();try{i.setStart(r,o)}catch(e){return fe.error("Failed to create a range for cursor:",{error:e,node:r,offset:o}),null}i.collapse(!0);const a=i.getBoundingClientRect(),c=s.getBoundingClientRect(),l=e.getBoundingClientRect();let u=0,d=0;0===a.x&&0===a.y&&0===a.width&&0===a.height?(u=l.left-c.left,d=l.top-c.top):(u=a.left-c.left,d=a.top-c.top);let h=a.height;return 0===h&&(h=parseInt(window.getComputedStyle(e).lineHeight,10)||l.height),{x:u,y:d,height:h}},ve=(e,t,n)=>{var s,r,o,i,a;const c=n.createTreeWalker(e,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT);let l=0,u=null,d=null,h=1;for(;d=c.nextNode();){if(h++,h>1e3)return u?{node:u,offset:0}:{node:e,offset:0};const n=null!==(r=null===(s=d.nodeValue)||void 0===s?void 0:s.length)&&void 0!==r?r:0;if(d.nodeType!==Node.ELEMENT_NODE){if(0!==n){if(l+n>=t)return{node:d,offset:t-l};l+=n,d.nodeType===Node.TEXT_NODE&&(u=d)}}else if("BR"===d.nodeName){if(l+1>=t){const t=c.nextNode();return(null==t?void 0:t.nodeType)===Node.TEXT_NODE?{node:t,offset:0}:u?{node:u,offset:null!==(i=null===(o=u.nodeValue)||void 0===o?void 0:o.length)&&void 0!==i?i:0}:{node:e,offset:0}}l+=1;continue}}return u&&(null===(a=u.nodeValue)||void 0===a?void 0:a.length)?{node:u,offset:u.nodeValue.length}:{node:e,offset:0}};function me({containerRef:e}){const t=(0,u.useRef)(null),[n,r]=(0,u.useState)(null);(0,u.useEffect)(()=>{var t,n;const s=null!==(n=null===(t=e.current)||void 0===t?void 0:t.ownerDocument)&&void 0!==n?n:null;r(s),s&&setTimeout(()=>{var e;null===(e=o.current)||void 0===e||e.call(o)},500)},[]);const o=function(e,t){const n=(0,u.useRef)(),s=(0,i.useSelect)(e=>{const{isAwarenessCursorsEnabled:t,isSelfAwarenessEnabled:n}=e(V);return t()?n()?de.All:de.OtherUsers:de.None}),r=P();return(0,u.useEffect)(()=>{n.current=()=>{const n=r.map(e=>{var t;return{userName:e.name,selection:null!==(t=e.editorState.selection)&&void 0!==t?t:{type:_.None},color:e.color,isMe:e.isMe}});pe(e.current,t,n,s)},n.current()},[s,r,e.current,t]),n}(t,n),a=(0,K.useResizeObserver)(()=>{var e;null===(e=o.current)||void 0===e||e.call(o)}),c=(0,K.useMergeRefs)([t,a]);return function(e){const t=(0,u.useRef)(new Set),n=(0,i.useSelect)(e=>Array.from(e(D).getActiveUsers().values())),{isAwarenessCursorsEnabled:s,isSelfAwarenessEnabled:r}=(0,i.useSelect)(e=>({isAwarenessCursorsEnabled:e(V).isAwarenessCursorsEnabled(),isSelfAwarenessEnabled:e(V).isSelfAwarenessEnabled()}));(0,u.useEffect)(()=>{if(null===e)return;const o=n=>{n.forEach(n=>{const s=ee(e,n);s&&(s.style.boxShadow="",s.style.borderRadius=""),t.current.delete(n)})},i=n.map(e=>{var t,n;const s=(null===(n=null===(t=e.editorState)||void 0===t?void 0:t.selection)||void 0===n?void 0:n.type)===_.WholeBlock,o=!e.isMe||r;return s&&o?{blockId:e.editorState.selection.blockId,color:e.color}:null}).filter(e=>null!==e);if(!s)return void o(Array.from(t.current));const a=i.map(e=>e.blockId);o(Array.from(t.current).filter(e=>!a.includes(e))),i.forEach(n=>{const{color:s,blockId:r}=n,o=ee(e,r);o&&o&&(o.style.boxShadow=`${s} 0 0 0 2px`,o.style.borderRadius="4px",t.current.add(r))})},[n,s,r,e])}(n),(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"vip-real-time-collaboration-overlay-full",ref:c})})}const we=String.fromCharCode,ye=(String.fromCodePoint,/^\s*/g),Se=/([A-Z])/g,Ee=(e,t)=>(e=>e.replace(ye,""))(e.replace(Se,e=>`${t}${(e=>e.toLowerCase())(e)}`));"undefined"!=typeof TextEncoder&&new TextEncoder;let Ae="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Ae&&1===Ae.decode(new Uint8Array).length&&(Ae=null);const Ie=()=>new Map;let Ce=new class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},ke=!0;try{"undefined"!=typeof localStorage&&(Ce=localStorage,ke=!1)}catch(e){}const xe=Ce,_e="undefined"!=typeof process&&process.release&&/node|io\.js/.test(process.release.name),je="undefined"!=typeof window&&!_e;let Ue;"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);const Me=[];(e=>(()=>{if(void 0===Ue)if(_e){Ue=Ie();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const s=e[n];"-"===s[0]?(null!==t&&Ue.set(t,""),t=s):null!==t?(Ue.set(t,s),t=null):Me.push(s)}null!==t&&Ue.set(t,"")}else"object"==typeof location?(Ue=Ie(),(location.search||"?").slice(1).split("&").forEach(e=>{if(0!==e.length){const[t,n]=e.split("=");Ue.set(`--${Ee(t,"-")}`,n),Ue.set(`-${Ee(t,"-")}`,n)}})):Ue=Ie();return Ue})().has(e))("--"+"production")||(e=>{return void 0===(t=_e?process.env[e.toUpperCase()]:xe.getItem(e))?null:t;var t})("production");const Oe=je?e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=we(e[n]);return btoa(t)}:e=>Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),Ne=je?e=>{const t=atob(e),n=(s=t.length,new Uint8Array(s));var s;for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}:e=>{const t=Buffer.from(e,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)},Te=new k("crdt");function Re(e){return Oe(b(e))}function De(e,t){var n;try{if(!y)return Te.error("Persisted post meta key is undefined"),null;const s=null!==(n=e[y])&&void 0!==n?n:null;if("string"!=typeof s)return null;const r=JSON.parse(s);if(!function(e){return"object"!=typeof e||null===e?(Te.debug("Persisted CRDT document was not found",{metaValue:e}),!1):"contentHash"in e&&"crdtDoc"in e?"string"==typeof e.contentHash&&e.contentHash?!("string"!=typeof e.crdtDoc||!e.crdtDoc)||(Te.error("Persisted CRDT document is empty",{metaValue:e}),!1):(Te.warn("Persisted CRDT content hash is empty",{metaValue:e}),!1):(Te.error("Persisted CRDT document is missing expected properties",{metaValue:e}),!1)}(r))return null;const o={};return t!==r.contentHash&&(Te.debug("Persisted CRDT content hash mismatch",{expectedContentHash:t,metaValue:r}),o.invalidated=!0),function(e,t={}){const n=new Map(Object.entries(t)),s=new w({meta:n}),r=Ne(e);return f(s,r),s.clientID=Math.floor(1e9*Math.random()),s}(r.crdtDoc,o)}catch(e){return null}}const Pe=window.wp.apiFetch;var Le=n.n(Pe);const Be=()=>new Map,$e=(e,t,n)=>{let s=e.get(t);return void 0===s&&e.set(t,s=n()),s},Fe=()=>new Set,He=String.fromCharCode,We=(String.fromCodePoint,He(65535),/^\s*/g),Ve=/([A-Z])/g,qe=(e,t)=>(e=>e.replace(We,""))(e.replace(Ve,e=>`${t}${(e=>e.toLowerCase())(e)}`)),ze="undefined"!=typeof TextEncoder?new TextEncoder:null;let Ge="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Ge&&1===Ge.decode(new Uint8Array).length&&(Ge=null);let Je=new class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},Ye=!0;try{"undefined"!=typeof localStorage&&localStorage&&(Je=localStorage,Ye=!1)}catch(e){}const Xe=Je,Ze=Array.from,Ke=(Array.isArray,"undefined"!=typeof process&&process.release&&/node|io\.js/.test(process.release.name)&&"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)),Qe="undefined"!=typeof window&&"undefined"!=typeof document&&!Ke;let et;"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);const tt=[],nt=e=>(()=>{if(void 0===et)if(Ke){et=Be();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const s=e[n];"-"===s[0]?(null!==t&&et.set(t,""),t=s):null!==t?(et.set(t,s),t=null):tt.push(s)}null!==t&&et.set(t,"")}else"object"==typeof location?(et=Be(),(location.search||"?").slice(1).split("&").forEach(e=>{if(0!==e.length){const[t,n]=e.split("=");et.set(`--${qe(t,"-")}`,n),et.set(`-${qe(t,"-")}`,n)}})):et=Be();return et})().has(e),st=e=>{return void 0===(t=Ke?process.env[e.toUpperCase().replaceAll("-","_")]:Xe.getItem(e))?null:t;var t},rt=e=>nt("--"+e)||null!==st(e);var ot;rt("production"),Ke&&(ot=process.env.FORCE_COLOR,["true","1","2"].includes(ot))||!nt("--no-colors")&&!rt("no-color")&&(!Ke||process.stdout.isTTY)&&(!Ke||nt("--color")||null!==st("COLORTERM")||(st("TERM")||"").includes("color"));const it=Qe?e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=He(e[n]);return btoa(t)}:e=>Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),at=Qe?e=>{const t=atob(e),n=(s=t.length,new Uint8Array(s));var s;for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}:e=>{const t=Buffer.from(e,"base64");return n=t.buffer,s=t.byteOffset,r=t.byteLength,new Uint8Array(n,s,r);var n,s,r},ct=new Map,lt="undefined"==typeof BroadcastChannel?class{constructor(e){var t;this.room=e,this.onmessage=null,this._onChange=t=>t.key===e&&null!==this.onmessage&&this.onmessage({data:at(t.newValue||"")}),t=this._onChange,Ye||addEventListener("storage",t)}postMessage(e){Xe.setItem(this.room,it(new Uint8Array(e)))}close(){var e;e=this._onChange,Ye||removeEventListener("storage",e)}}:BroadcastChannel,ut=e=>$e(ct,e,()=>{const t=Fe(),n=new lt(e);return n.onmessage=e=>t.forEach(t=>t(e.data,"broadcastchannel")),{bc:n,subs:t}}),dt=(e,t,n=null)=>{const s=ut(e);s.bc.postMessage(t),s.subs.forEach(e=>e(t,n))},ht=Date.now,ft=Math.floor,pt=(Math.ceil,Math.abs,Math.imul,Math.round,Math.log10,Math.log2,Math.log,Math.sqrt,(e,t)=>e<t?e:t),gt=(Number.isNaN,Math.pow),bt=(Math.sign,128),vt=127;class mt{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const wt=()=>new mt,yt=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},St=e=>{const t=new Uint8Array(yt(e));let n=0;for(let s=0;s<e.bufs.length;s++){const r=e.bufs[s];t.set(r,n),n+=r.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},Et=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(2*n),e.cpos=0),e.cbuf[e.cpos++]=t},At=(e,t)=>{for(;t>vt;)Et(e,bt|vt&t),t=ft(t/128);Et(e,vt&t)},It=(new Uint8Array(3e4).length,ze&&ze.encodeInto,(e,t)=>{const n=e.cbuf.length,s=e.cpos,r=pt(n-s,t.length),o=t.length-r;var i,a;e.cbuf.set(t.subarray(0,r),s),e.cpos+=r,o>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array((i=2*n)>(a=o)?i:a),e.cbuf.set(t.subarray(r)),e.cpos=o)}),Ct=(e,t)=>{At(e,t.byteLength),It(e,t)};new DataView(new ArrayBuffer(4));const kt=Number.MAX_SAFE_INTEGER,xt=(Number.MIN_SAFE_INTEGER,Number.isInteger,Number.isNaN,Number.parseInt,e=>new Error(e)),_t=xt("Unexpected end of array"),jt=xt("Integer out of Range");class Ut{constructor(e){this.arr=e,this.pos=0}}const Mt=e=>((e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n})(e,Ot(e)),Ot=e=>{let t=0,n=1;const s=e.arr.length;for(;e.pos<s;){const s=e.arr[e.pos++];if(t+=(s&vt)*n,n*=128,s<bt)return t;if(t>kt)throw jt}throw _t},Nt=Math.floor,Tt=(Math.ceil,Math.abs,Math.imul,Math.round,Math.log10,Math.log2,Math.log,Math.sqrt,Number.isNaN,Math.pow,Math.sign,128),Rt=127,Dt=String.fromCharCode,Pt=(String.fromCodePoint,Dt(65535),"undefined"!=typeof TextEncoder?new TextEncoder:null),Lt=Pt?e=>Pt.encode(e):e=>{const t=unescape(encodeURIComponent(e)),n=t.length,s=new Uint8Array(n);for(let e=0;e<n;e++)s[e]=t.codePointAt(e);return s};let Bt="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Bt&&1===Bt.decode(new Uint8Array).length&&(Bt=null);class $t{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Ft=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(2*n),e.cpos=0),e.cbuf[e.cpos++]=t},Ht=(e,t)=>{for(;t>Rt;)Ft(e,Tt|Rt&t),t=Nt(t/128);Ft(e,Rt&t)},Wt=new Uint8Array(3e4),Vt=Wt.length/3,qt=Pt&&Pt.encodeInto?(e,t)=>{if(t.length<Vt){const n=Pt.encodeInto(t,Wt).written||0;Ht(e,n);for(let t=0;t<n;t++)Ft(e,Wt[t])}else zt(e,Lt(t))}:(e,t)=>{const n=unescape(encodeURIComponent(t)),s=n.length;Ht(e,s);for(let t=0;t<s;t++)Ft(e,n.codePointAt(t))},zt=(e,t)=>{Ht(e,t.byteLength),((e,t)=>{const n=e.cbuf.length,s=e.cpos,r=(o=n-s)<(i=t.length)?o:i;var o,i;const a=t.length-r;e.cbuf.set(t.subarray(0,r),s),e.cpos+=r,a>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(((e,t)=>e>t?e:t)(2*n,a)),e.cbuf.set(t.subarray(r)),e.cpos=a)})(e,t)};new DataView(new ArrayBuffer(4));const Gt=Number.MAX_SAFE_INTEGER,Jt=(Number.MIN_SAFE_INTEGER,Number.isInteger,Number.isNaN,Number.parseInt,e=>new Error(e)),Yt=Jt("Unexpected end of array"),Xt=Jt("Integer out of Range");class Zt{constructor(e){this.arr=e,this.pos=0}}const Kt=e=>((e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n})(e,en(e)),Qt=e=>e.arr[e.pos++],en=e=>{let t=0,n=1;const s=e.arr.length;for(;e.pos<s;){const s=e.arr[e.pos++];if(t+=(s&Rt)*n,n*=128,s<Tt)return t;if(t>Gt)throw Xt}throw Yt},tn=Bt?e=>Bt.decode(Kt(e)):e=>{let t=en(e);if(0===t)return"";{let n=String.fromCodePoint(Qt(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Qt(e));else for(;t>0;){const s=t<1e4?t:1e4,r=e.arr.subarray(e.pos,e.pos+s);e.pos+=s,n+=String.fromCodePoint.apply(null,r),t-=s}return decodeURIComponent(escape(n))}},nn=(e,t)=>{Ht(e,0);const n=p(t);zt(e,n)},sn=(e,t,n)=>{Ht(e,1),zt(e,g(t,n))},rn=(e,t,n)=>{try{h(t,Kt(e),n)}catch(e){console.error("Caught error while handling a Yjs update",e)}},on=rn,an=Date.now,cn=()=>new Map,ln=()=>new Set,un=Array.from;Array.isArray;class dn{constructor(){this._observers=cn()}on(e,t){((e,t,n)=>{let s=e.get(t);return void 0===s&&e.set(t,s=n()),s})(this._observers,e,ln).add(t)}once(e,t){const n=(...s)=>{this.off(e,n),t(...s)};this.on(e,n)}off(e,t){const n=this._observers.get(e);void 0!==n&&(n.delete(t),0===n.size&&this._observers.delete(e))}emit(e,t){return un((this._observers.get(e)||cn()).values()).forEach(e=>e(...t))}destroy(){this._observers=cn()}}Object.assign;const hn=Object.keys,fn=(Object.values,e=>hn(e).length),pn=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),gn=(Object.freeze,Symbol("Equality")),bn=(e,t)=>{if(e===t)return!0;if(null==e||null==t||e.constructor!==t.constructor)return!1;if(null!=e[gn])return e[gn](t);switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break;case Set:if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;break;case Map:if(e.size!==t.size)return!1;for(const n of e.keys())if(!t.has(n)||!bn(e.get(n),t.get(n)))return!1;break;case Object:if(fn(e)!==fn(t))return!1;for(const n in e)if(!pn(e,n)||!bn(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!bn(e[n],t[n]))return!1;break;default:return!1}return!0};class vn extends dn{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const e=an();null!==this.getLocalState()&&15e3<=e-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const t=[];this.meta.forEach((n,s)=>{s!==this.clientID&&3e4<=e-n.lastUpdated&&this.states.has(s)&&t.push(s)}),t.length>0&&mn(this,t,"timeout")},Nt(3e3)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const t=this.clientID,n=this.meta.get(t),s=void 0===n?0:n.clock+1,r=this.states.get(t);null===e?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:s,lastUpdated:an()});const o=[],i=[],a=[],c=[];null===e?c.push(t):null==r?null!=e&&o.push(t):(i.push(t),bn(r,e)||a.push(t)),(o.length>0||a.length>0||c.length>0)&&this.emit("change",[{added:o,updated:a,removed:c},"local"]),this.emit("update",[{added:o,updated:i,removed:c},"local"])}setLocalStateField(e,t){const n=this.getLocalState();null!==n&&this.setLocalState({...n,[e]:t})}getStates(){return this.states}}const mn=(e,t,n)=>{const s=[];for(let n=0;n<t.length;n++){const r=t[n];if(e.states.has(r)){if(e.states.delete(r),r===e.clientID){const t=e.meta.get(r);e.meta.set(r,{clock:t.clock+1,lastUpdated:an()})}s.push(r)}}s.length>0&&(e.emit("change",[{added:[],updated:[],removed:s},n]),e.emit("update",[{added:[],updated:[],removed:s},n]))},wn=(e,t,n=e.states)=>{const s=t.length,r=new $t;Ht(r,s);for(let o=0;o<s;o++){const s=t[o],i=n.get(s)||null,a=e.meta.get(s).clock;Ht(r,s),Ht(r,a),qt(r,JSON.stringify(i))}return(e=>{const t=new Uint8Array((e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t})(e));let n=0;for(let s=0;s<e.bufs.length;s++){const r=e.bufs[s];t.set(r,n),n+=r.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t})(r)};class yn{constructor(){this._observers=Be()}on(e,t){return $e(this._observers,e,Fe).add(t),t}once(e,t){const n=(...s)=>{this.off(e,n),t(...s)};this.on(e,n)}off(e,t){const n=this._observers.get(e);void 0!==n&&(n.delete(t),0===n.size&&this._observers.delete(e))}emit(e,t){return Ze((this._observers.get(e)||Be()).values()).forEach(e=>e(...t))}destroy(){this._observers=Be()}}Object.assign,Object.keys,Object.values,Object.freeze;const Sn=[];Sn[0]=(e,t,n,s,r)=>{At(e,0);const o=((e,t,n,s)=>{const r=en(e);switch(r){case 0:((e,t,n)=>{sn(t,n,Kt(e))})(e,t,n);break;case 1:rn(e,n,s);break;case 2:on(e,n,s);break;default:throw new Error("Unknown message type")}return r})(t,e,n.doc,n);s&&1===o&&!n.synced&&(n.synced=!0)},Sn[3]=(e,t,n,s,r)=>{At(e,1),Ct(e,wn(n.awareness,Array.from(n.awareness.getStates().keys())))},Sn[1]=(e,t,n,s,r)=>{((e,t,n)=>{const s=new Zt(t),r=an(),o=[],i=[],a=[],c=[],l=en(s);for(let t=0;t<l;t++){const t=en(s);let n=en(s);const l=JSON.parse(tn(s)),u=e.meta.get(t),d=e.states.get(t),h=void 0===u?0:u.clock;(h<n||h===n&&null===l&&e.states.has(t))&&(null===l?t===e.clientID&&null!=e.getLocalState()?n++:e.states.delete(t):e.states.set(t,l),e.meta.set(t,{clock:n,lastUpdated:r}),void 0===u&&null!==l?o.push(t):void 0!==u&&null===l?c.push(t):null!==l&&(bn(l,d)||a.push(t),i.push(t)))}(o.length>0||a.length>0||c.length>0)&&e.emit("change",[{added:o,updated:a,removed:c},n]),(o.length>0||i.length>0||c.length>0)&&e.emit("update",[{added:o,updated:i,removed:c},n])})(n.awareness,Mt(t),n)},Sn[2]=(e,t,n,s,r)=>{((e,t,n)=>{0===en(e)&&n(0,tn(e))})(t,n.doc,(e,t)=>En(n,t))};const En=(e,t)=>console.warn(`Permission denied to access ${e.url}.\n${t}`),An=(e,t,n)=>{const s=new Ut(t),r=wt(),o=Ot(s),i=e.messageHandlers[o];return i?i(r,s,e,n,o):console.error("Unable to compute message"),r},In=(e,t,n)=>{t===e.ws&&(e.emit("connection-close",[n,e]),e.ws=null,t.close(),e.wsconnecting=!1,e.wsconnected?(e.wsconnected=!1,e.synced=!1,mn(e.awareness,Array.from(e.awareness.getStates().keys()).filter(t=>t!==e.doc.clientID),e),e.emit("status",[{status:"disconnected"}])):e.wsUnsuccessfulReconnects++,setTimeout(Cn,pt(100*gt(2,e.wsUnsuccessfulReconnects),e.maxBackoffTime),e))},Cn=e=>{if(e.shouldConnect&&null===e.ws){const t=new e._WS(e.url,e.protocols);t.binaryType="arraybuffer",e.ws=t,e.wsconnecting=!0,e.wsconnected=!1,e.synced=!1,t.onmessage=n=>{e.wsLastMessageReceived=ht();const s=An(e,new Uint8Array(n.data),!0);yt(s)>1&&t.send(St(s))},t.onerror=t=>{e.emit("connection-error",[t,e])},t.onclose=n=>{In(e,t,n)},t.onopen=()=>{e.wsLastMessageReceived=ht(),e.wsconnecting=!1,e.wsconnected=!0,e.wsUnsuccessfulReconnects=0,e.emit("status",[{status:"connected"}]);const n=wt();if(At(n,0),nn(n,e.doc),t.send(St(n)),null!==e.awareness.getLocalState()){const n=wt();At(n,1),Ct(n,wn(e.awareness,[e.doc.clientID])),t.send(St(n))}},e.emit("status",[{status:"connecting"}])}},kn=(e,t)=>{const n=e.ws;e.wsconnected&&n&&n.readyState===n.OPEN&&n.send(t),e.bcconnected&&dt(e.bcChannel,t,e)};class xn extends yn{constructor(e,t,n,{connect:s=!0,awareness:r=new vn(n),params:o={},protocols:i=[],WebSocketPolyfill:a=WebSocket,resyncInterval:c=-1,maxBackoffTime:l=2500,disableBc:u=!1}={}){for(super();"/"===e[e.length-1];)e=e.slice(0,e.length-1);this.serverUrl=e,this.bcChannel=e+"/"+t,this.maxBackoffTime=l,this.params=o,this.protocols=i,this.roomname=t,this.doc=n,this._WS=a,this.awareness=r,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=u,this.wsUnsuccessfulReconnects=0,this.messageHandlers=Sn.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=s,this._resyncInterval=0,c>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){const e=wt();At(e,0),nn(e,n),this.ws.send(St(e))}},c)),this._bcSubscriber=(e,t)=>{if(t!==this){const t=An(this,new Uint8Array(e),!1);yt(t)>1&&dt(this.bcChannel,St(t),this)}},this._updateHandler=(e,t)=>{if(t!==this){const t=wt();At(t,0),((e,t)=>{Ht(e,2),zt(e,t)})(t,e),kn(this,St(t))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:e,updated:t,removed:n},s)=>{const o=e.concat(t).concat(n),i=wt();At(i,1),Ct(i,wn(r,o)),kn(this,St(i))},this._exitHandler=()=>{mn(this.awareness,[n.clientID],"app closed")},Ke&&"undefined"!=typeof process&&process.on("exit",this._exitHandler),r.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{this.wsconnected&&3e4<ht()-this.wsLastMessageReceived&&In(this,this.ws,null)},3e3),s&&this.connect()}get url(){const e=(()=>((e,t)=>{const n=[];for(const s in e)n.push(t(e[s],s));return n})(this.params,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&"))();return this.serverUrl+"/"+this.roomname+(0===e.length?"":"?"+e)}get synced(){return this._synced}set synced(e){this._synced!==e&&(this._synced=e,this.emit("synced",[e]),this.emit("sync",[e]))}destroy(){0!==this._resyncInterval&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),Ke&&"undefined"!=typeof process&&process.off("exit",this._exitHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;var e,t;this.bcconnected||(e=this.bcChannel,t=this._bcSubscriber,ut(e).subs.add(t),this.bcconnected=!0);const n=wt();At(n,0),nn(n,this.doc),dt(this.bcChannel,St(n),this);const s=wt();At(s,0),sn(s,this.doc),dt(this.bcChannel,St(s),this);const r=wt();At(r,3),dt(this.bcChannel,St(r),this);const o=wt();At(o,1),Ct(o,wn(this.awareness,[this.doc.clientID])),dt(this.bcChannel,St(o),this)}disconnectBc(){const e=wt();At(e,1),Ct(e,wn(this.awareness,[this.doc.clientID],new Map)),kn(this,St(e)),this.bcconnected&&(((e,t)=>{const n=ut(e);n.subs.delete(t)&&0===n.subs.size&&(n.bc.close(),ct.delete(e))})(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),null!==this.ws&&In(this,this.ws,null)}connect(){this.shouldConnect=!0,this.wsconnected||null!==this.ws||(Cn(this),this.connectBc())}}function jn(e,t){return e instanceof Error?e.message:e&&"object"==typeof e&&"data"in e&&e.data&&"object"==typeof e.data&&"error"in e.data?jn(e.data.error,t):e&&"object"==typeof e&&"message"in e&&"string"==typeof e.message?e.message:null!=t?t:(0,c.__)("Unknown error","vip-real-time-collaboration")}var Un=function(e,t,n,s){return new(n||(n=Promise))(function(r,o){function i(e){try{c(s.next(e))}catch(e){o(e)}}function a(e){try{c(s.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(i,a)}c((s=s.apply(e,t||[])).next())})};const Mn=function(){const e=new Map;return(...t)=>{const n=JSON.stringify(t);if(e.has(n))return e.get(n);const s=(()=>function(){if(window.isSecureContext)return window.crypto.randomUUID();throw new Error("Unable to generate UUID outside of secure context in non-development mode!")}())(...t);return e.set(n,s),s}}(),On=new k("websocket-client");function Nn(e,t,n){let s=0;return function(){return Un(this,void 0,void 0,function*(){if(s>0){const e=Math.min(1e3*Math.pow(2,s),15e3);On.warn(`Attempting to reconnect to WebSocket in ${Math.floor(e/1e3)}s...`),yield new Promise(t=>setTimeout(t,e))}s+=1;try{const s=yield function(e,t){return Un(this,void 0,void 0,function*(){const n=yield Le()({path:"/vip-rtc/v1/websocket/auth",method:"POST",data:{syncObjectType:e,syncObjectId:t,connectionId:Mn()}});if(!n.token)throw new Error((0,c.__)("No auth token returned","vip-real-time-collaboration"));return n.token})}(t,n);e.params={auth:s},e.connect(),e.shouldConnect=!1,function(e){var t;const n={createNewDoc:!1,room:`${e.roomname}?auth=${null===(t=e.params)||void 0===t?void 0:t.auth}`,provider:"y-websocket",url:S},s=`http://localhost:5173/#/connection=${encodeURIComponent(JSON.stringify(n))}`;On.info(`Yjs inspector for ${e.roomname}: ${s}`)}(e)}catch(e){On.error(`${(0,c.__)("Failed to fetch auth token and connect to WebSocket","vip-real-time-collaboration")}: ${jn(e)}`)}})}}function Tn(e){return function(){return Un(this,arguments,void 0,function*(t="unknown",n,s,r){try{const o=`site-${null!=E?E:1}/${n}-${t}`,i=Object.assign(Object.assign({},e.options),{awareness:r}),a=new xn(e.serverUrl,o,s,i),c=Nn(a,n,t);return a.on("connection-close",c),a.on("connection-error",()=>{var t;null===(t=e.onStatusChange)||void 0===t||t.call(e,{status:"connection-error"},a)}),a.on("status",t=>{var n;return null===(n=e.onStatusChange)||void 0===n?void 0:n.call(e,t,a)}),r&&(On.debug("Initializing awareness for WebSocket connection",{objectType:n,objectId:t}),yield he.initialize(r)),yield c(),{destroy:()=>a.destroy()}}catch(e){}return{destroy:()=>{}}})}}var Rn=function(e,t,n,s){return new(n||(n=Promise))(function(r,o){function i(e){try{c(s.next(e))}catch(e){o(e)}}function a(e){try{c(s.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(i,a)}c((s=s.apply(e,t||[])).next())})};class Dn extends window.wp.sync.SyncProvider{constructor(e){super([Tn(Object.assign(Object.assign({},e),{onStatusChange:(...e)=>this.onProviderStatusChange(...e)}))]),this.logger=new k("provider")}createEntityMeta(e,t){return Rn(this,void 0,void 0,function*(){var n,s;if(!(null===(n=e.supports)||void 0===n?void 0:n.crdtPersistence))return{};const r=e.getObjectId(t).toString(),o=e.objectType.toString(),i=null===(s=this.entityStates.get(this.getEntityId(o,r)))||void 0===s?void 0:s.ydoc;if(!i||"auto-draft"===t.status)return{};const a=function(e,t){if(!y)return Te.error("Persisted post meta key is undefined"),{};const n=function(e,t){return{contentHash:t,crdtDoc:Re(e)}}(e,t);return{[y]:JSON.stringify(n)}}(i,yield oe(t,e));return this.logger.debug("Providing updated entity meta to saveEntityRecord",{objectType:o,objectId:r,entityMeta:a}),a})}getPersistedCRDTDoc(e,t){return Rn(this,void 0,void 0,function*(){var n;if(!(null===(n=e.supports)||void 0===n?void 0:n.crdtPersistence))return Promise.resolve(null);const s=e.getObjectId(t).toString(),r=e.objectType.toString();var o;const i=De("meta"in(o=t)&&o.meta&&"object"==typeof o.meta?o.meta:{},yield oe(t,e)),a=i?"Found persisted CRDT doc in entity meta":"Persisted CRDT doc not found in entity meta";return this.logger.debug(a,{objectType:r,objectId:s,persistedDoc:i}),Promise.resolve(i)})}onProviderStatusChange(e,t){switch(e.status){case"connecting":break;case"connection-error":case"disconnected":he.setConnectionStatus(t.awareness.clientID,!1);break;case"connected":he.setConnectionStatus(t.awareness.clientID,!0)}}}(0,e.addFilter)("core.getSyncProvider","vip-rtc",e=>{if(e)return e;if(!S)return(new k).critical("VIP Real-Time Collaboration WebSocket URL has not been configured. The plugin will not be functional without it."),null;return new Dn({serverUrl:S,options:{connect:!1}})}),(0,t.registerPlugin)("vip-real-time-collaboration",{render:function(){const{isAvatarsEnabled:e,isCursorsEnabled:t,isDebugToolsEnabled:n,isSelfAwarenessEnabled:u}=(0,i.useSelect)(e=>({isAvatarsEnabled:e(V).isAwarenessAvatarsEnabled(),isCursorsEnabled:e(V).isAwarenessCursorsEnabled(),isDebugToolsEnabled:e(V).isDebugToolsEnabled(),isSelfAwarenessEnabled:e(V).isSelfAwarenessEnabled()})),{setAwarenessAvatarsEnabled:d,setAwarenessCursorsEnabled:h,setDebugToolsEnabled:f,setSelfAwarenessEnabled:p}=(0,i.useDispatch)(V),g=P();return(0,s.jsxs)(s.Fragment,{children:[e&&(0,s.jsx)(r.BlockCanvasCover.Fill,{children:(0,s.jsx)(q,{})}),(0,s.jsx)(r.BlockCanvasCover.Fill,{children:({containerRef:e})=>{var t,r;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(me,{containerRef:e}),n&&(null===(t=e.current)||void 0===t?void 0:t.ownerDocument)&&(0,s.jsx)(J,{iframeDocument:null===(r=e.current)||void 0===r?void 0:r.ownerDocument}),(0,s.jsx)(Q,{})]})}}),(0,s.jsx)(Q,{}),(0,s.jsxs)(a.PluginDocumentSettingPanel,{name:"vip-real-time-collaboration",title:"Real-time collaboration",className:"vip-real-time-collaboration-settings",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(o.ToggleControl,{label:"Enable avatars",checked:e,onChange:e=>{(e=>{d(e)})(e)}}),(0,s.jsx)(o.ToggleControl,{label:"Enable cursors",checked:t,onChange:e=>{(e=>{h(e)})(e)}}),(0,s.jsx)(o.ToggleControl,{label:"Show my awareness",checked:u,onChange:e=>{(e=>{p(e)})(e)}}),!1]}),(0,s.jsx)(o.__experimentalHeading,{level:3,style:{marginTop:"24px"},children:(0,c.__)("Collaborators","vip-real-time-collaboration")}),(0,s.jsx)(o.Flex,{direction:"column",className:"vip-real-time-collaboration-sidebar-users",gap:0,children:g.map(e=>(0,s.jsx)(o.FlexItem,{children:(0,s.jsxs)(o.Flex,{direction:"row",justify:"flex-start",className:"vip-real-time-collaboration-sidebar-user-row",children:[(0,s.jsx)(l,{showUserColorBorder:!0,userState:e},e.clientId),(0,s.jsx)(o.__experimentalText,{children:e.name})]})},e.clientId))}),(0,s.jsx)("div",{className:"vip-telemetry-target"})]})]})}})})()})();
//# sourceMappingURL=index.js.map
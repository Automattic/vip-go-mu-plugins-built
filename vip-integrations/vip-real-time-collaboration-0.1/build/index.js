(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var s in n)e.o(n,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:n[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.hooks,n=window.wp.plugins,s=window.wp.data,o=window.wp.editPost,r=window.wp.element,i=window.ReactJSXRuntime,a=window.wp.blockEditor,c=window.wp.components,l=window.wp.editor,u=window.wp.i18n,d=window.wp.privateApis;function h({userInfo:e,showUserColorBorder:t,size:n="small"}){const s=["vip-real-time-collaboration-avatar",`vip-real-time-collaboration-avatar--${n}`,t&&"vip-real-time-collaboration-avatar--with-color-border"].filter(Boolean).join(" "),o={"--avatar-url":`url(${e.avatarUrl})`,"--user-color":e.color};return(0,i.jsx)("div",{className:s,style:o,"aria-hidden":"true"})}const f=window.wp.a11y,p=window.wp.primitives,g=(0,i.jsx)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,i.jsx)(p.Path,{d:"m13.06 12 6.47-6.47-1.06-1.06L12 10.94 5.53 4.47 4.47 5.53 10.94 12l-6.47 6.47 1.06 1.06L12 13.06l6.47 6.47 1.06-1.06L13.06 12Z"})});function b({activeUsers:e,cursorRegistry:t,popoverAnchor:n,setIsPopoverVisible:s}){return(0,i.jsx)(c.Popover,{anchor:n,placement:"bottom",offset:8,className:"vip-real-time-collaboration-collaborators-list",children:(0,i.jsxs)("div",{className:"vip-real-time-collaboration-collaborators-list-content",children:[(0,i.jsxs)("div",{className:"vip-real-time-collaboration-collaborators-list-header",children:[(0,i.jsxs)("div",{className:"vip-real-time-collaboration-collaborators-list-header-title",children:["Collaborators",(0,i.jsxs)("span",{children:[" ",e.length," "]})]}),(0,i.jsx)("div",{className:"vip-real-time-collaboration-collaborators-list-header-action",children:(0,i.jsx)(c.Button,{icon:g,iconSize:16,label:"Close Collaborators List",onClick:()=>s(!1)})})]}),(0,i.jsx)("div",{className:"vip-real-time-collaboration-collaborators-list-items",children:e.map(n=>(0,i.jsxs)("button",{className:"vip-real-time-collaboration-collaborators-list-item",onClick:()=>(n=>{var o;const r=null===(o=e.find(e=>e.userInfo.clientId===n))||void 0===o?void 0:o.userInfo.name,i=t.scrollToCursor(n,{behavior:"smooth",block:"center",highlightDuration:2e3});i&&r&&(0,f.speak)(`Scrolled to ${r}'s cursor`,"polite"),i&&s(!1)})(n.userInfo.clientId),disabled:!n.userInfo.isConnected,"aria-description":"Clicking scrolls to cursor position in the editor",style:{opacity:n.userInfo.isConnected?1:.5},children:[(0,i.jsx)(h,{userInfo:n.userInfo,showUserColorBorder:!0,size:"medium"}),(0,i.jsxs)("div",{className:"vip-real-time-collaboration-collaborators-list-item-info",children:[(0,i.jsx)("div",{className:"vip-real-time-collaboration-collaborators-list-item-name",children:n.userInfo.name}),(0,i.jsx)("div",{className:"vip-real-time-collaboration-collaborators-list-item-email",children:n.userInfo.email})]})]},n.userInfo.clientId))})]})})}const m=window.wp.notices,v=y("wsUrl"),w=y("blogId");function y(e){return"undefined"==typeof window||void 0===window.VIP_RTC?null:window.VIP_RTC[e]}var I;!function(e){e[e.CRITICAL=5]="CRITICAL",e[e.ERROR=4]="ERROR",e[e.WARNING=3]="WARNING",e[e.INFO=2]="INFO",e[e.DEBUG=1]="DEBUG"}(I||(I={}));const S=I.WARNING;class E{constructor(e="",t=S){this.threshold=t,this.namespace="vip-rtc"+(e?`:${e}`:"")}log(e,...t){if(e<this.threshold)return;const n=I[e];console.log(`[${this.namespace}][${n}]`,...t)}debug(...e){this.log(I.DEBUG,...e)}info(...e){this.log(I.INFO,...e)}warn(...e){this.log(I.WARNING,...e)}error(...e){this.log(I.ERROR,...e)}critical(...e){this.log(I.CRITICAL,...e)}}const A=new E("local-storage"),_=(e,t)=>{try{const n=localStorage.getItem(e);if(n){const e=JSON.parse(n);return"object"!=typeof e||null===e||Array.isArray(e)?e:Object.assign(Object.assign({},t),e)}}catch(t){A.warn(`Failed to load data from localStorage (key: ${e}):`,t)}return t},C=(e,t)=>{try{localStorage.setItem(e,JSON.stringify(t))}catch(t){A.warn(`Failed to save data to localStorage (key: ${e}):`,t)}},T="vip-rtc-settings";var N;!function(e){e.AWARENESS_AVATARS="Awareness_Avatars",e.AWARENESS_CURSORS="Awareness_Cursors",e.DEBUG_TOOLS="Debug_Tools",e.SELF_AWARENESS="Self_Awareness",e.POST_UPDATE_NOTIFICATION="Post_Update_Notification",e.USER_ENTER_NOTIFICATION="User_Enter_Notification",e.USER_EXIT_NOTIFICATION="User_Exit_Notification"}(N||(N={}));const R={[N.AWARENESS_AVATARS]:!0,[N.AWARENESS_CURSORS]:!0,[N.DEBUG_TOOLS]:!1,[N.SELF_AWARENESS]:!1,[N.POST_UPDATE_NOTIFICATION]:!0,[N.USER_ENTER_NOTIFICATION]:!0,[N.USER_EXIT_NOTIFICATION]:!1},U={getSetting:(e,t)=>t!==N.DEBUG_TOOLS&&e[t]},O=(0,s.createReduxStore)("vip-real-time-collaboration/settings",{reducer:(e=_(T,R),t)=>{if("SET_SETTING"===t.type){const n=Object.assign(Object.assign({},e),{[t.payload.setting]:t.payload.enabled});return C(T,n),n}return e},actions:{setSetting:(e,t)=>({type:"SET_SETTING",payload:{setting:e,enabled:t}})},selectors:U});var x;(0,s.register)(O),function(e){e.PostUpdated="remote-user-post-updated",e.UserEntered="remote-user-user-entered",e.UserExited="remote-user-user-exited"}(x||(x={}));const k={[x.PostUpdated]:N.POST_UPDATE_NOTIFICATION,[x.UserEntered]:N.USER_ENTER_NOTIFICATION,[x.UserExited]:N.USER_EXIT_NOTIFICATION};function M(e,t,n,o){const{createNotice:r}=(0,s.dispatch)(m.store),i=function(e,t,n){switch(t){case x.PostUpdated:return function(e,t){let n="Draft",s="saved";return["future","private","publish"].includes(t)&&(n="Post",s="updated"),`${n} ${s} by ${e.name}.`}(e,null!=n?n:"");case x.UserEntered:case x.UserExited:return function(e,t){const n=t===x.UserEntered?"entered":"exited";return`${e.name} has ${n} the post.`}(e,t);default:return""}}(t,e,n);(function(e,t,n,o){return!(!n||t in k&&(!(0,s.select)(O).getSetting(k[t])||(t===x.UserEntered||t===x.UserExited)&&e.isMe||t===x.UserEntered&&o&&o.enteredAt>e.enteredAt))})(t,e,i,o)&&r("info",i,{id:`${e}-${t.clientId}`,isDismissible:!1,type:"snackbar"})}const j=window.wp.coreData,P=wp.sync.Y;const D=new E("selection");var B;function F(e,t,n){const s=0===Object.keys(e).length,o={type:B.None};if(s)return o;const r=e.clientId===t.clientId,i=r&&e.offset===t.offset;if(r&&void 0===e.offset&&void 0===t.offset)return{type:B.WholeBlock,blockId:e.clientId};if(i){const t=L(e,n);return t?{type:B.Cursor,blockId:e.clientId,cursorPosition:t}:o}if(r){const s=L(e,n),r=L(t,n);return s&&r?{type:B.SelectionInOneBlock,blockId:e.clientId,cursorStartPosition:s,cursorEndPosition:r}:o}const a=L(e,n),c=L(t,n);return a&&c?{type:B.SelectionInMultipleBlocks,blockStartId:e.clientId,blockEndId:t.clientId,cursorStartPosition:a,cursorEndPosition:c}:o}function L(e,t){const n=$(e.clientId,t);if(!n)return null;const s=n.get("attributes").get(e.attributeKey);return{relativePosition:P.createRelativePositionFromTypeIndex(s,e.offset),absoluteOffset:e.offset}}function $(e,t){for(const n of t){if(n.get("clientId")===e)return n;if(n.get("innerBlocks").length>0){const t=$(e,n.get("innerBlocks"));if(t)return t}}return null}function W(e,t){const n=JSON.stringify(e.relativePosition)===JSON.stringify(t.relativePosition),s=e.absoluteOffset===t.absoluteOffset;return n&&s}function V(e,t){return Object.keys(e).length===Object.keys(t).length&&Object.entries(e).every(([e,n])=>n===t[e])}function q(e,t){return Boolean(e&&t&&function(e,t){if(e.type!==t.type)return!1;switch(e.type){case B.None:return!0;case B.Cursor:return e.blockId===t.blockId&&W(e.cursorPosition,t.cursorPosition);case B.SelectionInOneBlock:return e.blockId===t.blockId&&W(e.cursorStartPosition,t.cursorStartPosition)&&W(e.cursorEndPosition,t.cursorEndPosition);case B.SelectionInMultipleBlocks:return e.blockStartId===t.blockStartId&&e.blockEndId===t.blockEndId&&W(e.cursorStartPosition,t.cursorStartPosition)&&W(e.cursorEndPosition,t.cursorEndPosition);case B.WholeBlock:return e.blockId===t.blockId;default:return D.error("Unable to compare selection types:",e,t),!1}}(e.selection,t.selection))}!function(e){e.None="none",e.Cursor="cursor",e.SelectionInOneBlock="selection-in-one-block",e.SelectionInMultipleBlocks="selection-in-multiple-blocks",e.WholeBlock="whole-block"}(B||(B={}));const H={userMap:new Map},G={getActiveClientIds:e=>Array.from(e.userMap.keys()),getActiveUsers:e=>e.userMap,isDisconnected:e=>-1!==Array.from(G.getActiveUsers(e).values()).findIndex(e=>e.userInfo.isMe&&!1===e.userInfo.isConnected)},z=(0,s.createReduxStore)("vip-real-time-collaboration/awareness",{reducer:(e=H,t)=>{switch(t.type){case"PATCH_USER_INFO":{if(!e.userMap.has(t.payload.clientId))return e;const n=e.userMap.get(t.payload.clientId),s=Object.assign(Object.assign({},n),{userInfo:Object.assign(Object.assign({},n.userInfo),t.payload.userInfo)});return V(n.userInfo,s.userInfo)?e:(e.userMap.set(t.payload.clientId,s),Object.assign(Object.assign({},e),{userMap:new Map(e.userMap)}))}case"REMOVE_USER":{const n=e.userMap.get(t.payload.clientId);return(null==n?void 0:n.userInfo)&&M(x.UserExited,n.userInfo),e.userMap.delete(t.payload.clientId),Object.assign(Object.assign({},e),{userMap:new Map(e.userMap)})}case"UPDATE_EDITOR_STATE":{if(!e.userMap.has(t.payload.clientId))return e;const n=e.userMap.get(t.payload.clientId),s=Object.assign(Object.assign({},n),{editorState:t.payload.editorState});return q(n.editorState,s.editorState)?e:(e.userMap.set(t.payload.clientId,s),Object.assign(Object.assign({},e),{userMap:new Map(e.userMap)}))}case"UPSERT_USER":if(e.userMap.has(t.payload.clientId)){if(n=e.userMap.get(t.payload.clientId),s=t.payload.userState,V(n.userInfo,s.userInfo)&&q(n.editorState,s.editorState))return e}else{const{userInfo:n}=t.payload.userState,s=Array.from(e.userMap.values()).find(e=>e.userInfo.isMe&&e.userInfo.isConnected);M(x.UserEntered,n,void 0,null==s?void 0:s.userInfo)}return e.userMap.set(t.payload.clientId,t.payload.userState),Object.assign(Object.assign({},e),{userMap:new Map(e.userMap)});default:return e}var n,s},actions:{patchUserInfo:(e,t)=>({type:"PATCH_USER_INFO",payload:{clientId:e,userInfo:t}}),removeUser:e=>({type:"REMOVE_USER",payload:{clientId:e}}),updateEditorState:(e,t)=>({type:"UPDATE_EDITOR_STATE",payload:{clientId:e,editorState:t}}),upsertUser:(e,t)=>({type:"UPSERT_USER",payload:{clientId:e,userState:t}})},selectors:G});function Y(){const e=(0,s.useSelect)(e=>e(z).getActiveUsers());return(0,r.useMemo)(()=>Array.from(e.values()).sort((e,t)=>e.userInfo.isMe&&!t.userInfo.isMe?-1:!e.userInfo.isMe&&t.userInfo.isMe?1:0),[e])}function X({cursorRegistry:e}){const t=Y().filter(e=>!e.userInfo.isMe),[n,s]=(0,r.useState)(!1),[o,a]=(0,r.useState)(null);if(0===t.length)return null;const l=t.slice(0,3),u=t.slice(3),d=u.map(({userInfo:e})=>e.name).join(", ");return l.length>0?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(c.Button,{className:"vip-real-time-collaboration-avatars-container",onClick:()=>s(!n),isPressed:n,ref:a,"aria-label":`Collaborators list, ${t.length} online`,children:[l.map(e=>(0,i.jsx)(h,{userInfo:e.userInfo,showUserColorBorder:!1,size:"small"},e.userInfo.clientId)),u.length>0&&(0,i.jsxs)("div",{className:"vip-real-time-collaboration-avatar-remaining",title:d,children:["+",u.length]})]}),n&&(0,i.jsx)(b,{activeUsers:t,cursorRegistry:e,popoverAnchor:o,setIsPopoverVisible:s})]}):null}(0,s.register)(z);const J=window.wp.blocks;function K(e,t,n){const s=n.getSelection();if(s&&s.rangeCount>0){const e=s.getRangeAt(0);e.deleteContents();const o=n.createTextNode(t);e.insertNode(o),e.setStartAfter(o),e.setEndAfter(o),s.removeAllRanges(),s.addRange(e)}else{const o=n.createRange();o.selectNodeContents(e),o.collapse(!1);const r=n.createTextNode(t);o.insertNode(r),o.setStartAfter(r),o.setEndAfter(r),null==s||s.removeAllRanges(),null==s||s.addRange(o)}}function Z({iframeDocument:e}){const[t,n]=(0,r.useState)(!1),[o,c]=(0,r.useState)(null),[l,u]=(0,r.useState)(100),d=(0,r.useRef)(null),h=(0,s.useSelect)(e=>e(a.store).getSelectedBlockClientId),f=h(),{selectBlock:p,insertBlock:g}=(0,s.useDispatch)(a.store);(0,r.useEffect)(()=>{f&&!t&&c(f)},[f,t]);const b=()=>{return e=this,t=void 0,s=function*(){if(o)return o;if(f)return c(f),f;const e=(0,J.createBlock)("core/paragraph");return g(e),new Promise(e=>{setTimeout(()=>{const t=h();t?(c(t),e(t)):e(null)},10)})},new((n=void 0)||(n=Promise))(function(o,r){function i(e){try{c(s.next(e))}catch(e){r(e)}}function a(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,a)}c((s=s.apply(e,t||[])).next())});var e,t,n,s};return(0,r.useEffect)(()=>(t?b().then(t=>{t?(t=>{let s=0,o=0,r=Q[Math.floor(Math.random()*Q.length)]||"";p(t),d.current=setInterval(()=>{const i=function(e,t){const n=e.querySelector(`[data-block="${t}"]`);return n&&"true"===n.getAttribute("contenteditable")?n:null}(e,t);if(!i)return void n(!1);e.activeElement!==i&&i.focus();let a=r[s];a||(r=Q[Math.floor(Math.random()*Q.length)]||"",s=0,a=r[s],o>0&&K(i," ",e),o++),a&&(K(i,a,e),s++)},l)})(t):n(!1)}).catch(()=>{n(!1)}):d.current&&(clearInterval(d.current),d.current=null),()=>{d.current&&clearInterval(d.current)}),[t,l,e,p,g]),(0,i.jsxs)("div",{className:"vip-real-time-collaboration-debug-interface",children:[(0,i.jsx)("div",{className:"vip-real-time-collaboration-debug-header",children:"Debug Tools"}),(0,i.jsx)("button",{type:"button",onClick:()=>{n(!t)},className:"vip-real-time-collaboration-debug-reset",children:t?"Stop typing":"Start typing"}),t&&(0,i.jsxs)("div",{className:"vip-real-time-collaboration-debug-speed",children:[(0,i.jsxs)("div",{className:"vip-real-time-collaboration-debug-speed-header",children:[(0,i.jsx)("span",{children:"Speed:"}),(0,i.jsx)("button",{type:"button",onClick:()=>{u(100)},className:"vip-real-time-collaboration-debug-reset",children:"Reset"})]}),(0,i.jsx)("input",{type:"range",min:"20",max:"1000",value:l,onChange:e=>{u(parseInt(e.target.value,10))},className:"vip-real-time-collaboration-debug-slider"}),(0,i.jsxs)("div",{className:"vip-real-time-collaboration-debug-speed-value",children:[l,"ms per character"]})]})]})}const Q=["Lorem ipsum dolor sit amet, consectetur adipiscing elit. ","Suspendisse sem leo, gravida id nulla at, blandit laoreet risus. ","Pellentesque velit justo, ullamcorper a ante nec, efficitur vulputate tortor. ","Etiam sem dui, mollis vitae felis nec, sagittis facilisis libero. ","Fusce justo tellus, consequat id enim eu, lacinia euismod lorem. ","Donec faucibus varius aliquam. ","Maecenas sit amet nisl ac sem pulvinar consequat vel a metus. ","Suspendisse potenti. ","Morbi blandit, enim vitae blandit malesuada, enim lorem accumsan nibh, nec maximus tellus quam vitae dui. ","Curabitur lacinia, lectus et eleifend pretium, leo ante tincidunt quam, nec cursus tellus sem id odio. ","Morbi eget nisl ligula. ","Proin eget neque eget felis interdum dignissim. ","Ut justo augue, accumsan eu efficitur et, placerat non ex. ","Nullam id gravida risus. ","Etiam vitae tortor vel nisl imperdiet mollis sed quis tortor. ","Donec velit quam, elementum eu nibh in, convallis vehicula erat. ","Sed viverra accumsan justo, eu egestas quam vehicula non. ","Cras egestas consequat erat, ut laoreet massa ornare ut. ","Vivamus vitae consequat arcu. ","In at mollis libero, quis convallis elit. ","Mauris bibendum mauris odio, et condimentum nisi convallis eu. ","Mauris pharetra metus id laoreet tempor. ","Sed gravida massa quis risus laoreet iaculis. ","Donec non eros gravida nisl sodales porta. ","Nullam a pellentesque tortor. ","Curabitur rhoncus consectetur mauris ut ornare. ","Vestibulum quis posuere enim. ","Fusce id orci pharetra enim vestibulum imperdiet et ut nunc. ","Mauris tempus arcu et est aliquet, sit amet tincidunt felis ultricies. ","Curabitur in lorem lorem. "],ee=(0,i.jsx)(p.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,i.jsx)(p.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M12.218 5.377a.25.25 0 0 0-.436 0l-7.29 12.96a.25.25 0 0 0 .218.373h14.58a.25.25 0 0 0 .218-.372l-7.29-12.96Zm-1.743-.735c.669-1.19 2.381-1.19 3.05 0l7.29 12.96a1.75 1.75 0 0 1-1.525 2.608H4.71a1.75 1.75 0 0 1-1.525-2.608l7.29-12.96ZM12.75 17.46h-1.5v-1.5h1.5v1.5Zm-1.5-3h1.5v-5h-1.5v5Z"})}),te=window.wp.compose;function ne(){const e=function(e=()=>{}){const t=(0,s.useSelect)(e=>e(l.store).getEditedPostContent());return(0,te.useCopyToClipboard)(null!=t?t:"",e)}();return function(){const[e,t]=(0,r.useState)(!1),n=(0,r.useRef)(null),o=(0,s.useSelect)(e=>e(z).isDisconnected());return(0,r.useEffect)(()=>{var e;return o?n.current=setTimeout(()=>{t(!0)},5e3):(t(!1),clearTimeout(null!==(e=n.current)&&void 0!==e?e:void 0)),()=>{var e;return clearTimeout(null!==(e=n.current)&&void 0!==e?e:void 0)}},[o]),e}()?(0,i.jsx)(c.Modal,{__experimentalHideHeader:!0,icon:ee,isDismissible:!1,isFullScreen:!1,onRequestClose:()=>{},shouldCloseOnClickOutside:!1,shouldCloseOnEsc:!1,children:(0,i.jsx)("div",{className:"vip-rtc-post-locked-modal__container",children:(0,i.jsxs)(c.__experimentalVStack,{alignment:"center",justify:"center",spacing:2,children:[(0,i.jsx)(c.Icon,{fill:"#ccc",icon:ee,size:64}),(0,i.jsx)("h1",{children:(0,u.__)("Disconnected","vip-real-time-collaboration")}),(0,i.jsxs)("p",{className:"vip-rtc-post-locked-modal__p",children:[(0,u.__)("You are currently disconnected from the collaborative editing server.","vip-real-time-collaboration")," ",(0,u.__)("Editing is temporarily disabled to prevent conflicts with other users.","vip-real-time-collaboration")]}),(0,i.jsxs)(c.__experimentalHStack,{spacing:2,justify:"center",children:[(0,i.jsx)(c.Button,{ref:e,variant:"primary",children:(0,u.__)("Copy post content","vip-real-time-collaboration")}),(0,i.jsx)(c.Button,{href:"edit.php",isDestructive:!0,variant:"secondary",children:(0,u.__)("Edit another post","vip-real-time-collaboration")})]})]})})}):null}const se=(e,t)=>e.querySelector(`[data-block="${t}"]`),oe=wp.sync;function re(){const e=window.navigator.userAgent;let t="Unknown";return e.includes("Firefox")?t="Firefox":e.includes("Edg")?t="Microsoft Edge":e.includes("Chrome")&&!e.includes("Edg")?t="Chrome":e.includes("Safari")&&!e.includes("Chrome")?t="Safari":e.includes("MSIE")||e.includes("Trident")?t="Internet Explorer":(e.includes("Opera")||e.includes("OPR"))&&(t="Opera"),t}var ie=function(e,t,n,s){return new(n||(n=Promise))(function(o,r){function i(e){try{c(s.next(e))}catch(e){r(e)}}function a(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,a)}c((s=s.apply(e,t||[])).next())})};function ae(){return ie(this,void 0,void 0,function*(){var e;const t=null!==(e=(0,s.select)(j.store).getCurrentUser())&&void 0!==e?e:{},{avatar_urls:n,id:o,name:r,slug:i}=t;if(!o)return yield new Promise(e=>setTimeout(e,100)),yield ae();const a=(null==n?void 0:n[48])||(null==n?void 0:n[96])||(null==n?void 0:n[24]),c=yield function(e){return ie(this,void 0,void 0,function*(){const t=yield(0,s.resolveSelect)(j.store).getUser(e,{context:"edit"});return null==t?void 0:t.email})}(o);return{avatarUrl:a,id:o,name:null!=r?r:i,email:null!=c?c:""}})}const ce=["#A4C400","#60A917","#008A00","#00ABA9","#1BA1E2","#0050EF","#6A00FF","#AA00FF","#F472D0","#D80073","#A20025","#E51400","#FA6800","#F0A30A","#E3C800","#647687"],le="vip-rtc-preferred-color",ue=e=>{e=e.map(e=>e.slice(0,-2));const t=ce.filter(t=>!e.includes(t));if(0===t.length)return`hsla(${de(0,360)}, ${de(50,100)}%, ${de(45,95)}%, 0.7)`;let n=null;const s=_(le,null);return s&&t.includes(s)?n=s:(n=t[`${de(0,t.length-1)}`],C(le,n)),`${n}${Math.round(178.5).toString(16).padStart(2,"0").toUpperCase()}`},de=(e,t)=>Math.floor(Math.random()*(t-e+1))+e;var he;class fe{constructor(e,t){this.awareness=e,this.userInfo=t,this.logger=new E("awareness-manager"),this.setCurrentUserState(),this.refreshAwareness(),this.subscribeToCRDTChanges(),this.subscribeToSelectionChanges(),this.subscribeToUserChanges()}static initialize(e){return t=this,n=void 0,o=function*(){fe.__instance?fe.__instance.logger.error(`AwarenessManager was created more than once for client ID ${e.clientID}.`):fe.__instance=new fe(e,yield ae())},new((s=void 0)||(s=Promise))(function(e,r){function i(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s(function(e){e(n)})).then(i,a)}c((o=o.apply(t,n||[])).next())});var t,n,s,o}static setConnectionStatus(e,t){var n;if(e!==(null===(n=fe.__instance)||void 0===n?void 0:n.awareness.clientID))return;const{patchUserInfo:o}=(0,s.dispatch)(z);o(e,{isConnected:t})}static convertRelativePositionToAbsolutePosition(e){var t,n;return(null===(n=null===(t=fe.__instance)||void 0===t?void 0:t.awareness)||void 0===n?void 0:n.doc)?P.createAbsolutePositionFromRelativePosition(e,fe.__instance.awareness.doc):(console.error("convertRelativePositionToAbsolutePosition() awareness document not found"),null)}setCurrentUserState(){const e=this.getStates(),t=Array.from(e.values()).filter(e=>e.userInfo&&!e.userInfo.isMe).map(e=>e.userInfo.color).filter(Boolean),n=Object.assign(Object.assign({},this.userInfo),{browserType:re(),clientId:this.awareness.clientID,color:ue(t),isConnected:!0,isMe:!0,enteredAt:Date.now()});this.setLocalStateField("userInfo",n)}getStates(){return this.awareness.getStates()}setLocalStateField(e,t){this.awareness.setLocalStateField(e,t)}refreshAwareness(){const{removeUser:e,upsertUser:t}=(0,s.dispatch)(z),{getActiveClientIds:n}=(0,s.select)(z),o=new Set(n()),r=new Set;this.getStates().forEach((e,n)=>{this.validateUserState(e)&&(e.userInfo.isMe=e.userInfo.clientId===this.awareness.clientID,t(n,e),r.add(n))}),o.forEach(t=>{r.has(t)||e(t)})}subscribeToCRDTChanges(){const e=Date.now(),t=this.awareness.doc.getMap(oe.CRDT_RECORD_MAP_KEY),n=this.awareness.doc.getMap(oe.CRDT_RECORD_METADATA_MAP_KEY);n.observe((s,o)=>{s.keysChanged.forEach(s=>{switch(s){case oe.CRDT_RECORD_METADATA_SAVED_AT_KEY:{if(o.local)break;const s=n.get(oe.CRDT_RECORD_METADATA_SAVED_AT_KEY),r=n.get(oe.CRDT_RECORD_METADATA_SAVED_BY_KEY);if("number"!=typeof r||"number"!=typeof s)break;const i=this.getStates().get(r);if(e>s||!i||i.userInfo.id===this.userInfo.id)break;this.logger.debug(`Document was saved by client ID ${r}.`,{remoteClientId:r,userState:i,recordMeta:n});const a=t.get("status");M(x.PostUpdated,i.userInfo,a);break}}})})}subscribeToSelectionChanges(){const{getSelectionStart:e,getSelectionEnd:t,getSelectedBlocksInitialCaretPosition:n}=(0,s.select)(a.store);let o=e(),r=t(),i=null;(0,s.subscribe)(()=>{const a=e(),c=t();a===o&&c===r||(o=a,r=c,function(e,t,n){var o,r,i,a;o=this,r=void 0,a=function*(){const{editEntityRecord:o}=(0,s.dispatch)(j.store),{getCurrentPostId:r,getCurrentPostType:i}=(0,s.select)(l.store),a=r(),c=i();if(!a||!c||!e.clientId)return;const u={selection:{selectionStart:e,selectionEnd:t,initialPosition:n}};yield o("postType",c,a,u,{undoIgnore:!0})},new((i=void 0)||(i=Promise))(function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function s(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i(function(e){e(o)})).then(n,s)}c((a=a.apply(o,r||[])).next())})}(o,r,n()),i&&clearTimeout(i),i=setTimeout(()=>{this.updateSelectionState(o,r)},5))})}updateSelectionState(e,t){const{updateEditorState:n}=(0,s.dispatch)(z),o={selection:F(e,t,this.awareness.doc.getMap(oe.CRDT_RECORD_MAP_KEY).get("blocks"))};n(this.awareness.clientID,o);let r=null,i=null;i=o,r||(r=setTimeout(()=>{i&&(this.setLocalStateField("editorState",i),i=null),r=null},50))}subscribeToUserChanges(){const e=new Map,{patchUserInfo:t,removeUser:n,upsertUser:o}=(0,s.dispatch)(z);this.awareness.on("change",({added:s,removed:r,updated:i})=>{const a=this.getStates();[...s,...i].forEach(n=>{const s=a.get(n);e.has(n)&&(clearTimeout(e.get(n)),e.delete(n)),this.validateUserState(s)&&(s.userInfo.clientId!==this.awareness.clientID?(s.userInfo.isConnected=!0,s.userInfo.isMe=!1,o(n,s)):!0===s.userInfo.isConnected&&t(n,{isConnected:!0}))}),r.forEach(s=>{e.has(s)||(t(s,{isConnected:!1}),e.set(s,setTimeout(()=>{e.delete(s),n(s)},5e3)))})})}validateUserState(e){var t,n;return!(!(null===(t=null==e?void 0:e.userInfo)||void 0===t?void 0:t.clientId)||!(null===(n=null==e?void 0:e.userInfo)||void 0===n?void 0:n.id))}}!function(e){e[e.None=0]="None",e[e.OtherUsers=1]="OtherUsers",e[e.All=2]="All"}(he||(he={}));const pe=new E("use-render-cursors"),ge=(e,t,n,s,o)=>{e&&t&&(o.removeAll(),s!==he.None&&n.forEach(({userName:n,clientId:r,selection:i,color:a,isMe:c})=>{if(c&&s===he.OtherUsers)return;let l=null;if(i.type===B.None);else if(i.type===B.WholeBlock);else if(i.type===B.Cursor)l=be(i,t,e);else if(i.type===B.SelectionInOneBlock){const n={type:B.Cursor,blockId:i.blockId,cursorPosition:i.cursorStartPosition};l=be(n,t,e)}else if(i.type===B.SelectionInMultipleBlocks){const n={type:B.Cursor,blockId:i.blockStartId,cursorPosition:i.cursorStartPosition};l=be(n,t,e)}if(l){const t=document.createElement("div");t.className="vip-real-time-collaboration-user",t.style.left=`${l.x}px`,t.style.top=`${l.y}px`;const s=document.createElement("div");s.className="vip-real-time-collaboration-user-cursor",s.style.backgroundColor=a,s.style.height=`${l.height}px`;const i=document.createElement("div");i.className="vip-real-time-collaboration-user-label",i.textContent=n,i.style.backgroundColor=a,t.appendChild(s),t.appendChild(i),e.appendChild(t),o.registerCursor(r,t)}}))},be=(e,t,n)=>{const s=fe.convertRelativePositionToAbsolutePosition(e.cursorPosition.relativePosition);if(null===s)return null;const o=t.querySelector(`[data-block="${e.blockId}"]`);if(!o)return null;const r=me(o,s.index,t,n);return null!=r?r:null},me=(e,t,n,s)=>{const{node:o,offset:r}=ve(e,t,n),i=n.createRange();try{i.setStart(o,r)}catch(e){return pe.error("Failed to create a range for cursor:",{error:e,node:o,offset:r}),null}i.collapse(!0);const a=i.getBoundingClientRect(),c=s.getBoundingClientRect(),l=e.getBoundingClientRect();let u=0,d=0;0===a.x&&0===a.y&&0===a.width&&0===a.height?(u=l.left-c.left,d=l.top-c.top):(u=a.left-c.left,d=a.top-c.top);let h=a.height;return 0===h&&(h=parseInt(window.getComputedStyle(e).lineHeight,10)||l.height),{x:u,y:d,height:h}},ve=(e,t,n)=>{var s,o,r,i,a;const c=n.createTreeWalker(e,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT);let l=0,u=null,d=null,h=1;for(;d=c.nextNode();){if(h++,h>1e3)return u?{node:u,offset:0}:{node:e,offset:0};const n=null!==(o=null===(s=d.nodeValue)||void 0===s?void 0:s.length)&&void 0!==o?o:0;if(d.nodeType!==Node.ELEMENT_NODE){if(0!==n){if(l+n>=t)return{node:d,offset:t-l};l+=n,d.nodeType===Node.TEXT_NODE&&(u=d)}}else if("BR"===d.nodeName){if(l+1>=t){const t=c.nextNode();return(null==t?void 0:t.nodeType)===Node.TEXT_NODE?{node:t,offset:0}:u?{node:u,offset:null!==(i=null===(r=u.nodeValue)||void 0===r?void 0:r.length)&&void 0!==i?i:0}:{node:e,offset:0}}l+=1;continue}}return u&&(null===(a=u.nodeValue)||void 0===a?void 0:a.length)?{node:u,offset:u.nodeValue.length}:{node:e,offset:0}};function we({containerRef:e,cursorRegistry:t}){const n=(0,r.useRef)(null),[o,a]=(0,r.useState)(null);(0,r.useEffect)(()=>{var t,n;const s=null!==(n=null===(t=e.current)||void 0===t?void 0:t.ownerDocument)&&void 0!==n?n:null;a(s),s&&setTimeout(()=>{var e;null===(e=c.current)||void 0===e||e.call(c)},500)},[]);const c=function(e,t,n){const o=(0,r.useRef)(),i=(0,s.useSelect)(e=>{const{getSetting:t}=e(O);return t(N.AWARENESS_CURSORS)?t(N.SELF_AWARENESS)?he.All:he.OtherUsers:he.None},[]),a=Y();return(0,r.useEffect)(()=>{o.current=()=>{const s=a.map(e=>{var t,n;return{userName:e.userInfo.name,clientId:e.userInfo.clientId,selection:null!==(n=null===(t=e.editorState)||void 0===t?void 0:t.selection)&&void 0!==n?n:{type:B.None},color:e.userInfo.color,isMe:e.userInfo.isMe}});ge(e.current,t,s,i,n)},o.current()},[i,a,e.current,t,n]),o}(n,o,t),l=(0,te.useResizeObserver)(()=>{var e;null===(e=c.current)||void 0===e||e.call(c)}),u=(0,te.useMergeRefs)([n,l]);return function(e){const t=(0,r.useRef)(new Set),n=(0,s.useSelect)(e=>Array.from(e(z).getActiveUsers().values())),{isAwarenessCursorsEnabled:o,isSelfAwarenessEnabled:i}=(0,s.useSelect)(e=>{const{getSetting:t}=e(O);return{isAwarenessCursorsEnabled:t(N.AWARENESS_CURSORS),isSelfAwarenessEnabled:t(N.SELF_AWARENESS)}},[]);(0,r.useEffect)(()=>{if(null===e)return;const s=n=>{n.forEach(n=>{const s=se(e,n);s&&(s.style.boxShadow="",s.style.borderRadius=""),t.current.delete(n)})},r=n.map(e=>{var t,n,s;const o=(null===(n=null===(t=e.editorState)||void 0===t?void 0:t.selection)||void 0===n?void 0:n.type)===B.WholeBlock,r=!e.userInfo.isMe||i;return o&&r?{blockId:(null===(s=e.editorState)||void 0===s?void 0:s.selection).blockId,color:e.userInfo.color}:null}).filter(e=>null!==e);if(!o)return void s(Array.from(t.current));const a=r.map(e=>e.blockId);s(Array.from(t.current).filter(e=>!a.includes(e))),r.forEach(n=>{const{color:s,blockId:o}=n,r=se(e,o);r&&r&&(r.style.boxShadow=`${s} 0 0 0 2px`,r.style.borderRadius="4px",t.current.add(o))})},[n,o,i,e])}(o),(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:"vip-real-time-collaboration-overlay-full",ref:u})})}class ye{constructor(){this.cursorMap=new Map}registerCursor(e,t){this.cursorMap.set(e,t)}scrollToCursor(e,t){var n,s,o;const r=this.cursorMap.get(e);return!!r&&(r.scrollIntoView({behavior:null!==(n=null==t?void 0:t.behavior)&&void 0!==n?n:"smooth",block:null!==(s=null==t?void 0:t.block)&&void 0!==s?s:"center",inline:null!==(o=null==t?void 0:t.inline)&&void 0!==o?o:"nearest"}),(null==t?void 0:t.highlightDuration)&&this.highlightCursor(r,t.highlightDuration),!0)}removeAll(){this.cursorMap.forEach(e=>e.remove()),this.cursorMap.clear()}highlightCursor(e,t){e.classList.add("vip-real-time-collaboration-cursor-highlighted"),setTimeout(()=>{e.classList.remove("vip-real-time-collaboration-cursor-highlighted")},t)}}const{unlock:Ie}=(0,d.__dangerousOptInToUnstableAPIsOnlyForCoreModules)("I acknowledge private features are not for use in themes or plugins and doing so will break in the next version of WordPress.","@wordpress/editor"),{EditorPresence:Se}=Ie(l.privateApis),Ee=window.wp.apiFetch;var Ae=e.n(Ee);const _e=()=>new Map,Ce=(e,t,n)=>{let s=e.get(t);return void 0===s&&e.set(t,s=n()),s},Te=()=>new Set,Ne=String.fromCharCode,Re=(String.fromCodePoint,Ne(65535),/^\s*/g),Ue=/([A-Z])/g,Oe=(e,t)=>(e=>e.replace(Re,""))(e.replace(Ue,e=>`${t}${(e=>e.toLowerCase())(e)}`)),xe="undefined"!=typeof TextEncoder?new TextEncoder:null;let ke="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});ke&&1===ke.decode(new Uint8Array).length&&(ke=null);let Me=new class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},je=!0;try{"undefined"!=typeof localStorage&&localStorage&&(Me=localStorage,je=!1)}catch(e){}const Pe=Me,De=Array.from,Be=(Array.isArray,"undefined"!=typeof process&&process.release&&/node|io\.js/.test(process.release.name)&&"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)),Fe="undefined"!=typeof window&&"undefined"!=typeof document&&!Be;let Le;"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);const $e=[],We=e=>(()=>{if(void 0===Le)if(Be){Le=_e();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const s=e[n];"-"===s[0]?(null!==t&&Le.set(t,""),t=s):null!==t?(Le.set(t,s),t=null):$e.push(s)}null!==t&&Le.set(t,"")}else"object"==typeof location?(Le=_e(),(location.search||"?").slice(1).split("&").forEach(e=>{if(0!==e.length){const[t,n]=e.split("=");Le.set(`--${Oe(t,"-")}`,n),Le.set(`-${Oe(t,"-")}`,n)}})):Le=_e();return Le})().has(e),Ve=e=>{return void 0===(t=Be?process.env[e.toUpperCase().replaceAll("-","_")]:Pe.getItem(e))?null:t;var t},qe=e=>We("--"+e)||null!==Ve(e);var He;qe("production"),Be&&(He=process.env.FORCE_COLOR,["true","1","2"].includes(He))||!We("--no-colors")&&!qe("no-color")&&(!Be||process.stdout.isTTY)&&(!Be||We("--color")||null!==Ve("COLORTERM")||(Ve("TERM")||"").includes("color"));const Ge=Fe?e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=Ne(e[n]);return btoa(t)}:e=>Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),ze=Fe?e=>{const t=atob(e),n=(s=t.length,new Uint8Array(s));var s;for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}:e=>{const t=Buffer.from(e,"base64");return n=t.buffer,s=t.byteOffset,o=t.byteLength,new Uint8Array(n,s,o);var n,s,o},Ye=new Map,Xe="undefined"==typeof BroadcastChannel?class{constructor(e){var t;this.room=e,this.onmessage=null,this._onChange=t=>t.key===e&&null!==this.onmessage&&this.onmessage({data:ze(t.newValue||"")}),t=this._onChange,je||addEventListener("storage",t)}postMessage(e){Pe.setItem(this.room,Ge(new Uint8Array(e)))}close(){var e;e=this._onChange,je||removeEventListener("storage",e)}}:BroadcastChannel,Je=e=>Ce(Ye,e,()=>{const t=Te(),n=new Xe(e);return n.onmessage=e=>t.forEach(t=>t(e.data,"broadcastchannel")),{bc:n,subs:t}}),Ke=(e,t,n=null)=>{const s=Je(e);s.bc.postMessage(t),s.subs.forEach(e=>e(t,n))},Ze=Date.now,Qe=Math.floor,et=(Math.ceil,Math.abs,Math.imul,Math.round,Math.log10,Math.log2,Math.log,Math.sqrt,(e,t)=>e<t?e:t),tt=(Number.isNaN,Math.pow),nt=(Math.sign,128),st=127;class ot{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const rt=()=>new ot,it=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},at=e=>{const t=new Uint8Array(it(e));let n=0;for(let s=0;s<e.bufs.length;s++){const o=e.bufs[s];t.set(o,n),n+=o.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},ct=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(2*n),e.cpos=0),e.cbuf[e.cpos++]=t},lt=(e,t)=>{for(;t>st;)ct(e,nt|st&t),t=Qe(t/128);ct(e,st&t)},ut=(new Uint8Array(3e4).length,xe&&xe.encodeInto,(e,t)=>{const n=e.cbuf.length,s=e.cpos,o=et(n-s,t.length),r=t.length-o;var i,a;e.cbuf.set(t.subarray(0,o),s),e.cpos+=o,r>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array((i=2*n)>(a=r)?i:a),e.cbuf.set(t.subarray(o)),e.cpos=r)}),dt=(e,t)=>{lt(e,t.byteLength),ut(e,t)};new DataView(new ArrayBuffer(4));const ht=Number.MAX_SAFE_INTEGER,ft=(Number.MIN_SAFE_INTEGER,Number.isInteger,Number.isNaN,Number.parseInt,e=>new Error(e)),pt=ft("Unexpected end of array"),gt=ft("Integer out of Range");class bt{constructor(e){this.arr=e,this.pos=0}}const mt=e=>((e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n})(e,vt(e)),vt=e=>{let t=0,n=1;const s=e.arr.length;for(;e.pos<s;){const s=e.arr[e.pos++];if(t+=(s&st)*n,n*=128,s<nt)return t;if(t>ht)throw gt}throw pt},wt=Math.floor,yt=(Math.ceil,Math.abs,Math.imul,Math.round,Math.log10,Math.log2,Math.log,Math.sqrt,Number.isNaN,Math.pow,Math.sign,128),It=127,St=String.fromCharCode,Et=(String.fromCodePoint,St(65535),"undefined"!=typeof TextEncoder?new TextEncoder:null),At=Et?e=>Et.encode(e):e=>{const t=unescape(encodeURIComponent(e)),n=t.length,s=new Uint8Array(n);for(let e=0;e<n;e++)s[e]=t.codePointAt(e);return s};let _t="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});_t&&1===_t.decode(new Uint8Array).length&&(_t=null);class Ct{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Tt=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(2*n),e.cpos=0),e.cbuf[e.cpos++]=t},Nt=(e,t)=>{for(;t>It;)Tt(e,yt|It&t),t=wt(t/128);Tt(e,It&t)},Rt=new Uint8Array(3e4),Ut=Rt.length/3,Ot=Et&&Et.encodeInto?(e,t)=>{if(t.length<Ut){const n=Et.encodeInto(t,Rt).written||0;Nt(e,n);for(let t=0;t<n;t++)Tt(e,Rt[t])}else xt(e,At(t))}:(e,t)=>{const n=unescape(encodeURIComponent(t)),s=n.length;Nt(e,s);for(let t=0;t<s;t++)Tt(e,n.codePointAt(t))},xt=(e,t)=>{Nt(e,t.byteLength),((e,t)=>{const n=e.cbuf.length,s=e.cpos,o=(r=n-s)<(i=t.length)?r:i;var r,i;const a=t.length-o;e.cbuf.set(t.subarray(0,o),s),e.cpos+=o,a>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(((e,t)=>e>t?e:t)(2*n,a)),e.cbuf.set(t.subarray(o)),e.cpos=a)})(e,t)};new DataView(new ArrayBuffer(4));const kt=Number.MAX_SAFE_INTEGER,Mt=(Number.MIN_SAFE_INTEGER,Number.isInteger,Number.isNaN,Number.parseInt,e=>new Error(e)),jt=Mt("Unexpected end of array"),Pt=Mt("Integer out of Range");class Dt{constructor(e){this.arr=e,this.pos=0}}const Bt=e=>((e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n})(e,Lt(e)),Ft=e=>e.arr[e.pos++],Lt=e=>{let t=0,n=1;const s=e.arr.length;for(;e.pos<s;){const s=e.arr[e.pos++];if(t+=(s&It)*n,n*=128,s<yt)return t;if(t>kt)throw Pt}throw jt},$t=_t?e=>_t.decode(Bt(e)):e=>{let t=Lt(e);if(0===t)return"";{let n=String.fromCodePoint(Ft(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Ft(e));else for(;t>0;){const s=t<1e4?t:1e4,o=e.arr.subarray(e.pos,e.pos+s);e.pos+=s,n+=String.fromCodePoint.apply(null,o),t-=s}return decodeURIComponent(escape(n))}},Wt=(e,t)=>{Nt(e,0);const n=P.encodeStateVector(t);xt(e,n)},Vt=(e,t,n)=>{Nt(e,1),xt(e,P.encodeStateAsUpdate(t,n))},qt=(e,t,n)=>{try{P.applyUpdate(t,Bt(e),n)}catch(e){console.error("Caught error while handling a Yjs update",e)}},Ht=qt,Gt=Date.now,zt=()=>new Map,Yt=()=>new Set,Xt=Array.from;Array.isArray;class Jt{constructor(){this._observers=zt()}on(e,t){((e,t,n)=>{let s=e.get(t);return void 0===s&&e.set(t,s=n()),s})(this._observers,e,Yt).add(t)}once(e,t){const n=(...s)=>{this.off(e,n),t(...s)};this.on(e,n)}off(e,t){const n=this._observers.get(e);void 0!==n&&(n.delete(t),0===n.size&&this._observers.delete(e))}emit(e,t){return Xt((this._observers.get(e)||zt()).values()).forEach(e=>e(...t))}destroy(){this._observers=zt()}}Object.assign;const Kt=Object.keys,Zt=(Object.values,e=>Kt(e).length),Qt=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),en=(Object.freeze,Symbol("Equality")),tn=(e,t)=>{if(e===t)return!0;if(null==e||null==t||e.constructor!==t.constructor)return!1;if(null!=e[en])return e[en](t);switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break;case Set:if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;break;case Map:if(e.size!==t.size)return!1;for(const n of e.keys())if(!t.has(n)||!tn(e.get(n),t.get(n)))return!1;break;case Object:if(Zt(e)!==Zt(t))return!1;for(const n in e)if(!Qt(e,n)||!tn(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!tn(e[n],t[n]))return!1;break;default:return!1}return!0};class nn extends Jt{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const e=Gt();null!==this.getLocalState()&&15e3<=e-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const t=[];this.meta.forEach((n,s)=>{s!==this.clientID&&3e4<=e-n.lastUpdated&&this.states.has(s)&&t.push(s)}),t.length>0&&sn(this,t,"timeout")},wt(3e3)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const t=this.clientID,n=this.meta.get(t),s=void 0===n?0:n.clock+1,o=this.states.get(t);null===e?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:s,lastUpdated:Gt()});const r=[],i=[],a=[],c=[];null===e?c.push(t):null==o?null!=e&&r.push(t):(i.push(t),tn(o,e)||a.push(t)),(r.length>0||a.length>0||c.length>0)&&this.emit("change",[{added:r,updated:a,removed:c},"local"]),this.emit("update",[{added:r,updated:i,removed:c},"local"])}setLocalStateField(e,t){const n=this.getLocalState();null!==n&&this.setLocalState({...n,[e]:t})}getStates(){return this.states}}const sn=(e,t,n)=>{const s=[];for(let n=0;n<t.length;n++){const o=t[n];if(e.states.has(o)){if(e.states.delete(o),o===e.clientID){const t=e.meta.get(o);e.meta.set(o,{clock:t.clock+1,lastUpdated:Gt()})}s.push(o)}}s.length>0&&(e.emit("change",[{added:[],updated:[],removed:s},n]),e.emit("update",[{added:[],updated:[],removed:s},n]))},on=(e,t,n=e.states)=>{const s=t.length,o=new Ct;Nt(o,s);for(let r=0;r<s;r++){const s=t[r],i=n.get(s)||null,a=e.meta.get(s).clock;Nt(o,s),Nt(o,a),Ot(o,JSON.stringify(i))}return(e=>{const t=new Uint8Array((e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t})(e));let n=0;for(let s=0;s<e.bufs.length;s++){const o=e.bufs[s];t.set(o,n),n+=o.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t})(o)};class rn{constructor(){this._observers=_e()}on(e,t){return Ce(this._observers,e,Te).add(t),t}once(e,t){const n=(...s)=>{this.off(e,n),t(...s)};this.on(e,n)}off(e,t){const n=this._observers.get(e);void 0!==n&&(n.delete(t),0===n.size&&this._observers.delete(e))}emit(e,t){return De((this._observers.get(e)||_e()).values()).forEach(e=>e(...t))}destroy(){this._observers=_e()}}Object.assign,Object.keys,Object.values,Object.freeze;const an=[];an[0]=(e,t,n,s,o)=>{lt(e,0);const r=((e,t,n,s)=>{const o=Lt(e);switch(o){case 0:((e,t,n)=>{Vt(t,n,Bt(e))})(e,t,n);break;case 1:qt(e,n,s);break;case 2:Ht(e,n,s);break;default:throw new Error("Unknown message type")}return o})(t,e,n.doc,n);s&&1===r&&!n.synced&&(n.synced=!0)},an[3]=(e,t,n,s,o)=>{lt(e,1),dt(e,on(n.awareness,Array.from(n.awareness.getStates().keys())))},an[1]=(e,t,n,s,o)=>{((e,t,n)=>{const s=new Dt(t),o=Gt(),r=[],i=[],a=[],c=[],l=Lt(s);for(let t=0;t<l;t++){const t=Lt(s);let n=Lt(s);const l=JSON.parse($t(s)),u=e.meta.get(t),d=e.states.get(t),h=void 0===u?0:u.clock;(h<n||h===n&&null===l&&e.states.has(t))&&(null===l?t===e.clientID&&null!=e.getLocalState()?n++:e.states.delete(t):e.states.set(t,l),e.meta.set(t,{clock:n,lastUpdated:o}),void 0===u&&null!==l?r.push(t):void 0!==u&&null===l?c.push(t):null!==l&&(tn(l,d)||a.push(t),i.push(t)))}(r.length>0||a.length>0||c.length>0)&&e.emit("change",[{added:r,updated:a,removed:c},n]),(r.length>0||i.length>0||c.length>0)&&e.emit("update",[{added:r,updated:i,removed:c},n])})(n.awareness,mt(t),n)},an[2]=(e,t,n,s,o)=>{((e,t,n)=>{0===Lt(e)&&n(0,$t(e))})(t,n.doc,(e,t)=>cn(n,t))};const cn=(e,t)=>console.warn(`Permission denied to access ${e.url}.\n${t}`),ln=(e,t,n)=>{const s=new bt(t),o=rt(),r=vt(s),i=e.messageHandlers[r];return i?i(o,s,e,n,r):console.error("Unable to compute message"),o},un=(e,t,n)=>{t===e.ws&&(e.emit("connection-close",[n,e]),e.ws=null,t.close(),e.wsconnecting=!1,e.wsconnected?(e.wsconnected=!1,e.synced=!1,sn(e.awareness,Array.from(e.awareness.getStates().keys()).filter(t=>t!==e.doc.clientID),e),e.emit("status",[{status:"disconnected"}])):e.wsUnsuccessfulReconnects++,setTimeout(dn,et(100*tt(2,e.wsUnsuccessfulReconnects),e.maxBackoffTime),e))},dn=e=>{if(e.shouldConnect&&null===e.ws){const t=new e._WS(e.url,e.protocols);t.binaryType="arraybuffer",e.ws=t,e.wsconnecting=!0,e.wsconnected=!1,e.synced=!1,t.onmessage=n=>{e.wsLastMessageReceived=Ze();const s=ln(e,new Uint8Array(n.data),!0);it(s)>1&&t.send(at(s))},t.onerror=t=>{e.emit("connection-error",[t,e])},t.onclose=n=>{un(e,t,n)},t.onopen=()=>{e.wsLastMessageReceived=Ze(),e.wsconnecting=!1,e.wsconnected=!0,e.wsUnsuccessfulReconnects=0,e.emit("status",[{status:"connected"}]);const n=rt();if(lt(n,0),Wt(n,e.doc),t.send(at(n)),null!==e.awareness.getLocalState()){const n=rt();lt(n,1),dt(n,on(e.awareness,[e.doc.clientID])),t.send(at(n))}},e.emit("status",[{status:"connecting"}])}},hn=(e,t)=>{const n=e.ws;e.wsconnected&&n&&n.readyState===n.OPEN&&n.send(t),e.bcconnected&&Ke(e.bcChannel,t,e)};class fn extends rn{constructor(e,t,n,{connect:s=!0,awareness:o=new nn(n),params:r={},protocols:i=[],WebSocketPolyfill:a=WebSocket,resyncInterval:c=-1,maxBackoffTime:l=2500,disableBc:u=!1}={}){for(super();"/"===e[e.length-1];)e=e.slice(0,e.length-1);this.serverUrl=e,this.bcChannel=e+"/"+t,this.maxBackoffTime=l,this.params=r,this.protocols=i,this.roomname=t,this.doc=n,this._WS=a,this.awareness=o,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=u,this.wsUnsuccessfulReconnects=0,this.messageHandlers=an.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=s,this._resyncInterval=0,c>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){const e=rt();lt(e,0),Wt(e,n),this.ws.send(at(e))}},c)),this._bcSubscriber=(e,t)=>{if(t!==this){const t=ln(this,new Uint8Array(e),!1);it(t)>1&&Ke(this.bcChannel,at(t),this)}},this._updateHandler=(e,t)=>{if(t!==this){const t=rt();lt(t,0),((e,t)=>{Nt(e,2),xt(e,t)})(t,e),hn(this,at(t))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:e,updated:t,removed:n},s)=>{const r=e.concat(t).concat(n),i=rt();lt(i,1),dt(i,on(o,r)),hn(this,at(i))},this._exitHandler=()=>{sn(this.awareness,[n.clientID],"app closed")},Be&&"undefined"!=typeof process&&process.on("exit",this._exitHandler),o.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{this.wsconnected&&3e4<Ze()-this.wsLastMessageReceived&&un(this,this.ws,null)},3e3),s&&this.connect()}get url(){const e=(()=>((e,t)=>{const n=[];for(const s in e)n.push(t(e[s],s));return n})(this.params,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&"))();return this.serverUrl+"/"+this.roomname+(0===e.length?"":"?"+e)}get synced(){return this._synced}set synced(e){this._synced!==e&&(this._synced=e,this.emit("synced",[e]),this.emit("sync",[e]))}destroy(){0!==this._resyncInterval&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),Be&&"undefined"!=typeof process&&process.off("exit",this._exitHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;var e,t;this.bcconnected||(e=this.bcChannel,t=this._bcSubscriber,Je(e).subs.add(t),this.bcconnected=!0);const n=rt();lt(n,0),Wt(n,this.doc),Ke(this.bcChannel,at(n),this);const s=rt();lt(s,0),Vt(s,this.doc),Ke(this.bcChannel,at(s),this);const o=rt();lt(o,3),Ke(this.bcChannel,at(o),this);const r=rt();lt(r,1),dt(r,on(this.awareness,[this.doc.clientID])),Ke(this.bcChannel,at(r),this)}disconnectBc(){const e=rt();lt(e,1),dt(e,on(this.awareness,[this.doc.clientID],new Map)),hn(this,at(e)),this.bcconnected&&(((e,t)=>{const n=Je(e);n.subs.delete(t)&&0===n.subs.size&&(n.bc.close(),Ye.delete(e))})(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),null!==this.ws&&un(this,this.ws,null)}connect(){this.shouldConnect=!0,this.wsconnected||null!==this.ws||(dn(this),this.connectBc())}}function pn(e,t){return e instanceof Error?e.message:e&&"object"==typeof e&&"data"in e&&e.data&&"object"==typeof e.data&&"error"in e.data?pn(e.data.error,t):e&&"object"==typeof e&&"message"in e&&"string"==typeof e.message?e.message:null!=t?t:(0,u.__)("Unknown error","vip-real-time-collaboration")}new E("crypto");var gn=function(e,t,n,s){return new(n||(n=Promise))(function(o,r){function i(e){try{c(s.next(e))}catch(e){r(e)}}function a(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){e.done?o(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(i,a)}c((s=s.apply(e,t||[])).next())})};const bn={destroy:()=>{}},mn=function(){const e=new Map;return(...t)=>{const n=JSON.stringify(t);if(e.has(n))return e.get(n);const s=(()=>function(){if(window.isSecureContext)return window.crypto.randomUUID();throw new Error("Unable to generate UUID outside of secure context in non-development mode!")}())(...t);return e.set(n,s),s}}(),vn=new E("websocket-client");function wn(e,t){switch(e.status){case"connecting":break;case"connection-error":case"disconnected":fe.setConnectionStatus(t.awareness.clientID,!1);break;case"connected":fe.setConnectionStatus(t.awareness.clientID,!0)}}function yn(e,t,n){let s=0;return function(){return gn(this,void 0,void 0,function*(){if(s>0){const e=Math.min(1e3*Math.pow(2,s),15e3);vn.warn(`Attempting to reconnect to WebSocket in ${Math.floor(e/1e3)}s...`),yield new Promise(t=>setTimeout(t,e))}s+=1;try{const s=yield function(e,t){return gn(this,void 0,void 0,function*(){const n=yield Ae()({path:"/vip-rtc/v1/websocket/auth",method:"POST",data:{syncObjectType:e,syncObjectId:t,connectionId:mn()}});if(!n.token)throw new Error((0,u.__)("No auth token returned","vip-real-time-collaboration"));return n.token})}(t,n);e.params={auth:s},e.connect(),e.shouldConnect=!1,function(e){var t;const n={createNewDoc:!1,room:`${e.roomname}?auth=${null===(t=e.params)||void 0===t?void 0:t.auth}`,provider:"y-websocket",url:v},s=`http://localhost:5173/#/connection=${encodeURIComponent(JSON.stringify(n))}`;vn.info(`Yjs inspector for ${e.roomname}: ${s}`)}(e)}catch(e){vn.error(`${(0,u.__)("Failed to fetch auth token and connect to WebSocket","vip-real-time-collaboration")}: ${pn(e)}`)}})}}function In(e){const t={serverUrl:e,options:{connect:!1}};return function(e,n,s,o){return gn(this,void 0,void 0,function*(){try{if(!(null===n||e.startsWith("postType/")&&parseInt(n,10)))return vn.debug("WebSocket connection skipped for unsupported object",{objectType:e,objectId:n}),bn;const r=`site-${null!=w?w:1}/${e}-${null!=n?n:"collection"}`,i=Object.assign(Object.assign({},t.options),{awareness:o}),a=new fn(t.serverUrl,r,s,i),c=yn(a,e,null!=n?n:"collection");return a.on("connection-close",c),a.on("connection-error",()=>{wn({status:"connection-error"},a)}),a.on("status",e=>wn(e,a)),o&&(vn.debug("Initializing awareness for WebSocket connection",{objectType:e,objectId:n}),yield fe.initialize(o)),yield c(),{destroy:()=>a.destroy()}}catch(e){vn.critical("Failed to create WebSocket connection",{error:e})}return bn})}}(0,t.addFilter)("sync.providers","vip-rtc",()=>v?[In(v)]:((new E).critical("VIP Real-Time Collaboration WebSocket URL has not been configured. The plugin will not be functional without it."),[])),(0,n.registerPlugin)("vip-rtc-settings-panel",{render:function(){const{isAvatarsEnabled:e,isCursorsEnabled:t,isDebugToolsEnabled:n,isSelfAwarenessEnabled:o,isPostUpdateNotificationEnabled:d,isUserEnterNotificationEnabled:h,isUserExitNotificationEnabled:f}=(0,s.useSelect)(e=>{const{getSetting:t}=e(O);return{isAvatarsEnabled:t(N.AWARENESS_AVATARS),isCursorsEnabled:t(N.AWARENESS_CURSORS),isDebugToolsEnabled:t(N.DEBUG_TOOLS),isSelfAwarenessEnabled:t(N.SELF_AWARENESS),isPostUpdateNotificationEnabled:t(N.POST_UPDATE_NOTIFICATION),isUserEnterNotificationEnabled:t(N.USER_ENTER_NOTIFICATION),isUserExitNotificationEnabled:t(N.USER_EXIT_NOTIFICATION)}},[]),{setSetting:p}=(0,s.useDispatch)(O),g=(0,r.useRef)(new ye);return(0,i.jsxs)(i.Fragment,{children:[e&&(0,i.jsx)(Se,{children:(0,i.jsx)(X,{cursorRegistry:g.current})}),(0,i.jsx)(a.BlockCanvasCover.Fill,{children:({containerRef:e})=>{var t,s;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(we,{containerRef:e,cursorRegistry:g.current}),n&&(null===(t=e.current)||void 0===t?void 0:t.ownerDocument)&&(0,i.jsx)(Z,{iframeDocument:null===(s=e.current)||void 0===s?void 0:s.ownerDocument}),(0,i.jsx)(ne,{})]})}}),(0,i.jsx)(ne,{}),(0,i.jsxs)(l.PluginDocumentSettingPanel,{name:"vip-real-time-collaboration",title:"Real-time collaboration",className:"vip-real-time-collaboration-settings",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(c.ToggleControl,{label:"Enable avatars",checked:e,onChange:e=>p(N.AWARENESS_AVATARS,e)}),(0,i.jsx)(c.ToggleControl,{label:"Enable cursors",checked:t,onChange:e=>p(N.AWARENESS_CURSORS,e)}),(0,i.jsx)(c.ToggleControl,{label:"Show my awareness",checked:o,onChange:e=>p(N.SELF_AWARENESS,e)}),!1,(0,i.jsx)(c.__experimentalHeading,{level:3,style:{marginTop:"24px"},children:(0,u.__)("Notifications","vip-real-time-collaboration")}),(0,i.jsx)(c.__experimentalHeading,{level:2,style:{marginBottom:"2px"},children:(0,u.__)("Post","vip-real-time-collaboration")}),(0,i.jsx)(c.ToggleControl,{label:"Save/Publish",checked:d,onChange:e=>{p(N.POST_UPDATE_NOTIFICATION,e)}}),(0,i.jsx)(c.ToggleControl,{label:"Enters",checked:h,onChange:e=>p(N.USER_ENTER_NOTIFICATION,e)}),(0,i.jsx)(c.ToggleControl,{label:"Exits",checked:f,onChange:e=>p(N.USER_EXIT_NOTIFICATION,e)})]}),(0,i.jsx)("div",{className:"vip-telemetry-target"})]})]})}}),(0,n.registerPlugin)("vip-rtc-read-only-code-editor",{render:function(){const e=(0,s.useSelect)(e=>e(o.store).getEditorMode());return(0,r.useEffect)(()=>{if("text"===e){const e=document.querySelector(".editor-post-text-editor");if(null!==(s=null==(n=e)?void 0:n.matches("textarea"))&&void 0!==s&&s){const n=(0,t.applyFilters)("vip_rtc_read_only_code_editor",!0);e.readOnly="boolean"!=typeof n||n}}var n,s},[e]),null}})})();
//# sourceMappingURL=index.js.map
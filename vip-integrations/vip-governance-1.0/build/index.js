!function(){"use strict";var e=window.wp.hooks,n=window.wp.data,o=window.wp.blockEditor,t=window.wp.notices,r=window.wp.i18n,i=window.lodash;function c(e,n={},o=!1){const t=["allowedBlocks"];for(const[i,l]of Object.entries(e))if(!t.includes(i))if(i.includes("/"))Object.entries(e).forEach((([e,o])=>{t.includes(e)||c(o,n,e)}));else if(!1!==o){var r;const e=s(l,`${i}.`);n[o]={...null!==(r=n[o])&&void 0!==r?r:{},...e}}return n}function l(e,n,o,t={depth:0,value:void 0},r=1){const[c,...s]=e,a=o[c];if(0===s.length){const e=(0,i.get)(a,n);return void 0!==e&&r>=t.depth&&(t.depth=r,t.value=e),t}return void 0!==a&&(t=l(s,n,a,t,r+1)),l(s,n,o,t,r)}function s(e,n=""){const o={};return Object.entries(e).forEach((([e,t])=>{"object"==typeof t&&t&&!Array.isArray(t)?(o[`${n}${e}`]=!0,Object.assign(o,s(t,`${n}${e}.`))):o[`${n}${e}`]=!0})),o}var a=window.wp.element,d=window.wp.components,u=window.wp.compose;const p={"core/list":["core/list-item"],"core/columns":["core/column"],"core/page-list":["core/page-list-item"],"core/navigation":["core/navigation-link","core/navigation-submenu"],"core/navigation-link":["core/navigation-link","core/navigation-submenu","core/page-list"],"core/quote":["core/paragraph"],"core/media-text":["core/paragraph"],"core/social-links":["core/social-link"],"core/comments-pagination":["core/comments-pagination-previous","core/comments-pagination-numbers","core/comments-pagination-next"]};function g(n,o,t){const r=(0,e.applyFilters)("vip_governance__is_block_allowed_in_hierarchy",!0,n,o,t)||0===o.length?[...t.allowedBlocks]:[];if(o.length>0){if(p[o[0]]&&p[o[0]].includes(n))return!0;if(t.blockSettings){const e=l(o.reverse(),"allowedBlocks",t.blockSettings);e&&e.value&&r.push(...e.value)}}return function(e,n){return n.some((n=>function(e,n){return n.includes("*")?e.match(new RegExp(n.replace("*",".*"))):n===e}(e,n)))}(n,r)}const m={};!function(){if(VIP_GOVERNANCE.error)return void(0,n.dispatch)(t.store).createErrorNotice(VIP_GOVERNANCE.error,{id:"wpcomvip-governance-error",isDismissible:!0,actions:[{label:(0,r.__)("Open governance settings"),url:VIP_GOVERNANCE.urlSettingsPage}]});const i=VIP_GOVERNANCE.governanceRules;(0,e.addFilter)("blockEditor.__unstableCanInsertBlockType","wpcomvip-governance/block-insertion",((t,r,c,{getBlock:l})=>{if(!1===t)return t;let s=[];if(c){const{getBlockParents:e,getBlockName:t}=(0,n.select)(o.store),r=l(c),i=e(c,!0);s=[r.clientId,...i].map((e=>t(e)))}const a=g(r.name,s,i);return(0,e.applyFilters)("vip_governance__is_block_allowed_for_insertion",a,r.name,s,i)}));const s=VIP_GOVERNANCE.nestedSettings,p=c(s);(0,e.addFilter)("blockEditor.useSetting.before","wpcomvip-governance/nested-block-settings",((e,t,r,i)=>{if(void 0===p[i]||!0!==p[i][t])return e;const c=[r,...(0,n.select)(o.store).getBlockParents(r,!0)].map((e=>(0,n.select)(o.store).getBlockName(e))).reverse();return({value:e}=l(c,t,s)),e&&e.theme?e.theme:e})),i?.allowedBlocks&&function(t){const r=(0,u.createHigherOrderComponent)((r=>i=>{const{name:c,clientId:l}=i,{getBlockParents:s,getBlockName:u}=(0,n.select)(o.store),p=s(l,!0),v=p.some((e=>function(e){return e in m}(e)));if(v)return(0,a.createElement)(r,{...i});const w=p.map((e=>u(e)));let k=g(c,w,t);return k=(0,e.applyFilters)("vip_governance__is_block_allowed_for_editing",k,c,w,t),k?(0,a.createElement)(r,{...i}):(function(e){m[e]=!0}(l),(0,a.createElement)(a.Fragment,null,(0,a.createElement)(d.Disabled,null,(0,a.createElement)("div",{style:{opacity:.6,"background-color":"#eee",border:"2px dashed #999"}},(0,a.createElement)(r,{...i})))))}),"withDisabledBlocks");(0,e.addFilter)("editor.BlockEdit","wpcomvip-governance/with-disabled-blocks",r)}(i)}()}();